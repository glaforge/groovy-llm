<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Groovy Language Documentation</title>
<link rel="stylesheet" href="assets/css/A.style.css.pagespeed.cf.jbv2jICbsG.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<style>.listingblock a.view-result{float:right;font-weight:normal;text-decoration:none;font-size:.9em;line-height:1.4;margin-top:.15em}.exampleblock.result{display:none}</style>
<script src='assets/js/jquery-min-2.1.1.js'></script>
<script>//<![CDATA[
function toggle_result_block(e){this.prev().toggleClass('stacked');this.toggle();return false;}function insert_result_links(){$('.result').each(function(idx,node){znode=$(node);p=$(znode.parent().children()[0]);p.append(' <a class="view-result" href="#">[ view example ]</a>');view_result_link=p.children().last();view_result_link.on('click',$.proxy(toggle_result_block,znode));});}$('document').ready(insert_result_links);
//]]></script></head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Groovy Language Documentation</h1>
<div class="details">
<span id="revnumber">version 4.0.15</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_groovy_language_specification">1. Groovy Language Specification</a>
<ul class="sectlevel2">
<li><a href="#_syntax">1.1. Syntax</a>
<ul class="sectlevel3">
<li><a href="#_comments">1.1.1. Comments</a>
<ul class="sectlevel4">
<li><a href="#_single_line_comment">Single-line comment</a></li>
<li><a href="#_multiline_comment">Multiline comment</a></li>
<li><a href="#_groovydoc_comment">Groovydoc comment</a></li>
<li><a href="#_shebang_line">Shebang line</a></li>
</ul>
</li>
<li><a href="#_keywords">1.1.2. Keywords</a></li>
<li><a href="#_identifiers">1.1.3. Identifiers</a>
<ul class="sectlevel4">
<li><a href="#_normal_identifiers">Normal identifiers</a></li>
<li><a href="#_quoted_identifiers">Quoted identifiers</a></li>
</ul>
</li>
<li><a href="#all-strings">1.1.4. Strings</a>
<ul class="sectlevel4">
<li><a href="#_single_quoted_string">Single-quoted string</a></li>
<li><a href="#_string_concatenation">String concatenation</a></li>
<li><a href="#_triple_single_quoted_string">Triple-single-quoted string</a>
<ul class="sectlevel5">
<li><a href="#_escaping_special_characters">Escaping special characters</a></li>
<li><a href="#_unicode_escape_sequence">Unicode escape sequence</a></li>
</ul>
</li>
<li><a href="#_double_quoted_string">Double-quoted string</a>
<ul class="sectlevel5">
<li><a href="#_string_interpolation">String interpolation</a></li>
<li><a href="#_special_case_of_interpolating_closure_expressions">Special case of interpolating closure expressions</a></li>
<li><a href="#_interoperability_with_java">Interoperability with Java</a></li>
<li><a href="#_gstring_and_string_hashcodes">GString and String hashCodes</a></li>
</ul>
</li>
<li><a href="#_triple_double_quoted_string">Triple-double-quoted string</a></li>
<li><a href="#_slashy_string">Slashy string</a>
<ul class="sectlevel5">
<li><a href="#_special_cases">Special cases</a></li>
</ul>
</li>
<li><a href="#_dollar_slashy_string">Dollar slashy string</a></li>
<li><a href="#_string_summary_table">String summary table</a></li>
<li><a href="#_characters">Characters</a></li>
</ul>
</li>
<li><a href="#_numbers">1.1.5. Numbers</a>
<ul class="sectlevel4">
<li><a href="#_integral_literals">Integral literals</a>
<ul class="sectlevel5">
<li><a href="#_alternative_non_base_10_representations">Alternative non-base 10 representations</a>
<ul class="sectlevel6">
<li><a href="#_binary_literal">Binary literal</a></li>
<li><a href="#_octal_literal">Octal literal</a></li>
<li><a href="#_hexadecimal_literal">Hexadecimal literal</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_decimal_literals">Decimal literals</a></li>
<li><a href="#_underscore_in_literals">Underscore in literals</a></li>
<li><a href="#_number_type_suffixes">Number type suffixes</a></li>
<li><a href="#_math_operations">Math operations</a>
<ul class="sectlevel5">
<li><a href="#integer_division">The case of the division operator</a></li>
<li><a href="#power_operator">The case of the power operator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_booleans">1.1.6. Booleans</a></li>
<li><a href="#_lists">1.1.7. Lists</a></li>
<li><a href="#_arrays">1.1.8. Arrays</a>
<ul class="sectlevel4">
<li><a href="#_java_style_array_initialization">Java-style array initialization</a></li>
</ul>
</li>
<li><a href="#_maps">1.1.9. Maps</a></li>
</ul>
</li>
<li><a href="#groovy-operators">1.2. Operators</a>
<ul class="sectlevel3">
<li><a href="#_arithmetic_operators">1.2.1. Arithmetic operators</a>
<ul class="sectlevel4">
<li><a href="#_normal_arithmetic_operators">Normal arithmetic operators</a></li>
<li><a href="#_unary_operators">Unary operators</a></li>
<li><a href="#_assignment_arithmetic_operators">Assignment arithmetic operators</a></li>
</ul>
</li>
<li><a href="#_relational_operators">1.2.2. Relational operators</a></li>
<li><a href="#_logical_operators">1.2.3. Logical operators</a>
<ul class="sectlevel4">
<li><a href="#_precedence">Precedence</a></li>
<li><a href="#_short_circuiting">Short-circuiting</a></li>
</ul>
</li>
<li><a href="#_bitwise_and_bit_shift_operators">1.2.4. Bitwise and bit shift operators</a>
<ul class="sectlevel4">
<li><a href="#_bitwise_operators">Bitwise operators</a></li>
<li><a href="#_bit_shift_operators">Bit shift operators</a></li>
</ul>
</li>
<li><a href="#_conditional_operators">1.2.5. Conditional operators</a>
<ul class="sectlevel4">
<li><a href="#_not_operator">Not operator</a></li>
<li><a href="#_ternary_operator">Ternary operator</a></li>
<li><a href="#_elvis_operator">Elvis operator</a></li>
<li><a href="#_elvis_assignment_operator">Elvis assignment operator</a></li>
</ul>
</li>
<li><a href="#_object_operators">1.2.6. Object operators</a>
<ul class="sectlevel4">
<li><a href="#_safe_navigation_operator">Safe navigation operator</a></li>
<li><a href="#_direct_field_access_operator">Direct field access operator</a></li>
<li><a href="#method-pointer-operator">Method pointer operator</a></li>
<li><a href="#method-reference-operator">Method reference operator</a></li>
</ul>
</li>
<li><a href="#_regular_expression_operators">1.2.7. Regular expression operators</a>
<ul class="sectlevel4">
<li><a href="#_pattern_operator">Pattern operator</a></li>
<li><a href="#_find_operator">Find operator</a></li>
<li><a href="#_match_operator">Match operator</a></li>
<li><a href="#_comparing_find_vs_match_operators">Comparing Find vs Match operators</a></li>
</ul>
</li>
<li><a href="#_other_operators">1.2.8. Other operators</a>
<ul class="sectlevel4">
<li><a href="#_spread_operator">Spread operator</a>
<ul class="sectlevel5">
<li><a href="#_spreading_method_arguments">Spreading method arguments</a></li>
<li><a href="#_spread_list_elements">Spread list elements</a></li>
<li><a href="#_spread_map_elements">Spread map elements</a></li>
</ul>
</li>
<li><a href="#_range_operator">Range operator</a></li>
<li><a href="#_spaceship_operator">Spaceship operator</a></li>
<li><a href="#subscript-operator">Subscript operator</a></li>
<li><a href="#_safe_index_operator">Safe index operator</a></li>
<li><a href="#_membership_operator">Membership operator</a></li>
<li><a href="#_identity_operator">Identity operator</a></li>
<li><a href="#_coercion_operator">Coercion operator</a></li>
<li><a href="#_diamond_operator">Diamond operator</a></li>
<li><a href="#_call_operator">Call operator</a></li>
</ul>
</li>
<li><a href="#_operator_precedence">1.2.9. Operator precedence</a></li>
<li><a href="#Operator-Overloading">1.2.10. Operator overloading</a></li>
</ul>
</li>
<li><a href="#_program_structure">1.3. Program structure</a>
<ul class="sectlevel3">
<li><a href="#_package_names">1.3.1. Package names</a></li>
<li><a href="#_imports">1.3.2. Imports</a>
<ul class="sectlevel4">
<li><a href="#_default_imports">Default imports</a></li>
<li><a href="#_simple_import">Simple import</a></li>
<li><a href="#_star_import">Star import</a></li>
<li><a href="#_static_import">Static import</a></li>
<li><a href="#_static_import_aliasing">Static import aliasing</a></li>
<li><a href="#_static_star_import">Static star import</a></li>
<li><a href="#_import_aliasing">Import aliasing</a></li>
</ul>
</li>
<li><a href="#_scripts_versus_classes">1.3.3. Scripts versus classes</a>
<ul class="sectlevel4">
<li><a href="#_public_static_void_main_vs_script">public static void main vs script</a></li>
<li><a href="#_script_class">Script class</a></li>
<li><a href="#_methods">Methods</a></li>
<li><a href="#_variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_object_orientation">1.4. Object orientation</a>
<ul class="sectlevel3">
<li><a href="#_types">1.4.1. Types</a>
<ul class="sectlevel4">
<li><a href="#_primitive_types">Primitive types</a></li>
<li><a href="#_reference_types">Reference Types</a></li>
<li><a href="#generics">Generics</a></li>
</ul>
</li>
<li><a href="#_classes">1.4.2. Classes</a>
<ul class="sectlevel4">
<li><a href="#_normal_class">Normal class</a></li>
<li><a href="#_inner_class">Inner class</a>
<ul class="sectlevel5">
<li><a href="#_anonymous_inner_class">Anonymous inner class</a></li>
<li><a href="#_abstract_class">Abstract class</a></li>
</ul>
</li>
<li><a href="#_inheritance">Inheritance</a></li>
<li><a href="#superclass">Superclasses</a></li>
<li><a href="#interfaces">Interfaces</a></li>
</ul>
</li>
<li><a href="#_class_members">1.4.3. Class members</a>
<ul class="sectlevel4">
<li><a href="#_constructors">Constructors</a>
<ul class="sectlevel5">
<li><a href="#_positional_parameters">Positional parameters</a></li>
<li><a href="#_named_parameters">Named parameters</a></li>
</ul>
</li>
<li><a href="#_methods_2">Methods</a>
<ul class="sectlevel5">
<li><a href="#_method_definition">Method definition</a></li>
<li><a href="#_named_parameters_2">Named parameters</a>
<ul class="sectlevel6">
<li><a href="#_mixing_named_and_positional_parameters">Mixing named and positional parameters</a></li>
</ul>
</li>
<li><a href="#_default_arguments">Default arguments</a></li>
<li><a href="#_varargs">Varargs</a></li>
<li><a href="#_method_selection_algorithm">Method selection algorithm</a></li>
<li><a href="#_exception_declaration">Exception declaration</a></li>
</ul>
</li>
<li><a href="#_fields_and_properties">Fields and Properties</a>
<ul class="sectlevel5">
<li><a href="#fields">Fields</a></li>
<li><a href="#properties">Properties</a>
<ul class="sectlevel6">
<li><a href="#_property_naming_conventions">Property naming conventions</a></li>
<li><a href="#_modifiers_on_a_property">Modifiers on a property</a></li>
<li><a href="#_annotations_on_a_property">Annotations on a property</a></li>
<li><a href="#split-properties">Split property definition with an explicit backing field</a></li>
<li><a href="#_explicit_accessor_methods">Explicit accessor methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_annotations">1.4.4. Annotations</a>
<ul class="sectlevel4">
<li><a href="#ann-definition">Annotation definition</a>
<ul class="sectlevel5">
<li><a href="#ann-placement">Annotation placement</a></li>
<li><a href="#_annotation_member_values">Annotation member values</a></li>
<li><a href="#_retention_policy">Retention policy</a></li>
<li><a href="#_closure_annotation_parameters">Closure annotation parameters</a></li>
</ul>
</li>
<li><a href="#_meta_annotations">Meta-annotations</a>
<ul class="sectlevel5">
<li><a href="#_declaring_meta_annotations">Declaring meta-annotations</a></li>
<li><a href="#meta-ann-behavior">Behavior of meta-annotations</a></li>
<li><a href="#meta-ann-members">Meta-annotation parameters</a></li>
<li><a href="#handling_duplicate_annotations">Handling duplicate annotations in meta-annotations</a></li>
<li><a href="#meta-ann-processor">Custom meta-annotation processors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_traits">1.4.5. Traits</a>
<ul class="sectlevel4">
<li><a href="#_methods_3">Methods</a>
<ul class="sectlevel5">
<li><a href="#_public_methods">Public methods</a></li>
<li><a href="#_abstract_methods">Abstract methods</a></li>
<li><a href="#_private_methods">Private methods</a></li>
<li><a href="#_final_methods">Final methods</a></li>
</ul>
</li>
<li><a href="#_the_meaning_of_this">The meaning of this</a></li>
<li><a href="#_interfaces">Interfaces</a></li>
<li><a href="#_properties">Properties</a></li>
<li><a href="#_fields">Fields</a>
<ul class="sectlevel5">
<li><a href="#_private_fields">Private fields</a></li>
<li><a href="#_public_fields">Public fields</a></li>
</ul>
</li>
<li><a href="#_composition_of_behaviors">Composition of behaviors</a></li>
<li><a href="#_overriding_default_methods">Overriding default methods</a></li>
<li><a href="#_extending_traits">Extending traits</a>
<ul class="sectlevel5">
<li><a href="#_simple_inheritance">Simple inheritance</a></li>
<li><a href="#_multiple_inheritance">Multiple inheritance</a></li>
</ul>
</li>
<li><a href="#_duck_typing_and_traits">Duck typing and traits</a>
<ul class="sectlevel5">
<li><a href="#_dynamic_code">Dynamic code</a></li>
<li><a href="#_dynamic_methods_in_a_trait">Dynamic methods in a trait</a></li>
</ul>
</li>
<li><a href="#_multiple_inheritance_conflicts">Multiple inheritance conflicts</a>
<ul class="sectlevel5">
<li><a href="#_default_conflict_resolution">Default conflict resolution</a></li>
<li><a href="#_user_conflict_resolution">User conflict resolution</a></li>
</ul>
</li>
<li><a href="#_runtime_implementation_of_traits">Runtime implementation of traits</a>
<ul class="sectlevel5">
<li><a href="#_implementing_a_trait_at_runtime">Implementing a trait at runtime</a></li>
<li><a href="#_implementing_multiple_traits_at_once">Implementing multiple traits at once</a></li>
</ul>
</li>
<li><a href="#_chaining_behavior">Chaining behavior</a>
<ul class="sectlevel5">
<li><a href="#_semantics_of_super_inside_a_trait">Semantics of super inside a trait</a></li>
</ul>
</li>
<li><a href="#_advanced_features">Advanced features</a>
<ul class="sectlevel5">
<li><a href="#_sam_type_coercion">SAM type coercion</a></li>
<li><a href="#_differences_with_java_8_default_methods">Differences with Java 8 default methods</a></li>
</ul>
</li>
<li><a href="#_differences_with_mixins">Differences with mixins</a></li>
<li><a href="#_static_methods_properties_and_fields">Static methods, properties and fields</a></li>
<li><a href="#_inheritance_of_state_gotchas">Inheritance of state gotchas</a></li>
<li><a href="#_self_types">Self types</a>
<ul class="sectlevel5">
<li><a href="#_type_constraints_on_traits">Type constraints on traits</a></li>
<li><a href="#traits-selftype">The @SelfType annotation</a></li>
<li><a href="#_differences_with_sealed_annotation_incubating">Differences with Sealed annotation (incubating)</a></li>
</ul>
</li>
<li><a href="#_limitations">Limitations</a>
<ul class="sectlevel5">
<li><a href="#_compatibility_with_ast_transformations">Compatibility with AST transformations</a></li>
<li><a href="#_prefix_and_postfix_operations">Prefix and postfix operations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_record_classes_incubating">1.4.6. Record classes (incubating)</a>
<ul class="sectlevel4">
<li><a href="#_special_record_features">Special record features</a>
<ul class="sectlevel5">
<li><a href="#_compact_constructor">Compact constructor</a></li>
<li><a href="#_serializability">Serializability</a></li>
</ul>
</li>
<li><a href="#_groovy_enhancements">Groovy enhancements</a>
<ul class="sectlevel5">
<li><a href="#_argument_defaults">Argument defaults</a></li>
<li><a href="#_declarative_tostring_customization">Declarative <code>toString</code> customization</a></li>
<li><a href="#_obtaining_a_list_of_the_record_component_values">Obtaining a list of the record component values</a></li>
<li><a href="#_obtaining_a_map_of_the_record_component_values">Obtaining a map of the record component values</a></li>
<li><a href="#_obtaining_the_number_of_components_in_a_record">Obtaining the number of components in a record</a></li>
<li><a href="#_obtaining_the_nth_component_from_a_record">Obtaining the n<sup>th</sup> component from a record</a></li>
</ul>
</li>
<li><a href="#_optional_groovy_features">Optional Groovy features</a>
<ul class="sectlevel5">
<li><a href="#_copying">Copying</a></li>
<li><a href="#_deep_immutability">Deep immutability</a></li>
<li><a href="#_obtaining_the_components_of_a_record_as_a_typed_tuple">Obtaining the components of a record as a typed tuple</a></li>
</ul>
</li>
<li><a href="#_other_differences_to_java">Other differences to Java</a></li>
</ul>
</li>
<li><a href="#_sealed_hierarchies_incubating">1.4.7. Sealed hierarchies (incubating)</a>
<ul class="sectlevel4">
<li><a href="#_differences_to_java">Differences to Java</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_closures">1.5. Closures</a>
<ul class="sectlevel3">
<li><a href="#_syntax_2">1.5.1. Syntax</a>
<ul class="sectlevel4">
<li><a href="#_defining_a_closure">Defining a closure</a></li>
<li><a href="#closure-as-object">Closures as an object</a></li>
<li><a href="#_calling_a_closure">Calling a closure</a></li>
</ul>
</li>
<li><a href="#_parameters">1.5.2. Parameters</a>
<ul class="sectlevel4">
<li><a href="#_normal_parameters">Normal parameters</a></li>
<li><a href="#implicit-it">Implicit parameter</a></li>
<li><a href="#_varargs_2">Varargs</a></li>
</ul>
</li>
<li><a href="#_delegation_strategy">1.5.3. Delegation strategy</a>
<ul class="sectlevel4">
<li><a href="#_groovy_closures_vs_lambda_expressions">Groovy closures vs lambda expressions</a></li>
<li><a href="#closure-owner">Owner, delegate and this</a>
<ul class="sectlevel5">
<li><a href="#closure-this">The meaning of this</a></li>
<li><a href="#_owner_of_a_closure">Owner of a closure</a></li>
<li><a href="#_delegate_of_a_closure">Delegate of a closure</a></li>
<li><a href="#_delegation_strategy_2">Delegation strategy</a></li>
<li><a href="#_delegation_strategy_in_the_presence_of_metaprogramming">Delegation strategy in the presence of metaprogramming</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_closures_in_gstrings">1.5.4. Closures in GStrings</a></li>
<li><a href="#_closure_coercion">1.5.5. Closure coercion</a></li>
<li><a href="#_functional_programming">1.5.6. Functional programming</a>
<ul class="sectlevel4">
<li><a href="#_currying">Currying</a>
<ul class="sectlevel5">
<li><a href="#_left_currying">Left currying</a></li>
<li><a href="#_right_currying">Right currying</a></li>
<li><a href="#_index_based_currying">Index based currying</a></li>
</ul>
</li>
<li><a href="#_memoization">Memoization</a></li>
<li><a href="#_composition">Composition</a></li>
<li><a href="#_trampoline">Trampoline</a></li>
<li><a href="#_method_pointers">Method pointers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_semantics">1.6. Semantics</a>
<ul class="sectlevel3">
<li><a href="#_statements">1.6.1. Statements</a>
<ul class="sectlevel4">
<li><a href="#_variable_definition">Variable definition</a></li>
<li><a href="#_variable_assignment">Variable assignment</a>
<ul class="sectlevel5">
<li><a href="#_multiple_assignment">Multiple assignment</a></li>
<li><a href="#_overflow_and_underflow">Overflow and Underflow</a></li>
<li><a href="#_object_destructuring_with_multiple_assignment">Object destructuring with multiple assignment</a></li>
</ul>
</li>
<li><a href="#_control_structures">Control structures</a>
<ul class="sectlevel5">
<li><a href="#_conditional_structures">Conditional structures</a>
<ul class="sectlevel6">
<li><a href="#_if_else">if / else</a></li>
<li><a href="#_switch_case">switch / case</a></li>
</ul>
</li>
<li><a href="#_looping_structures">Looping structures</a>
<ul class="sectlevel6">
<li><a href="#_classic_for_loop">Classic for loop</a></li>
<li><a href="#_enhanced_classic_java_style_for_loop">Enhanced classic Java-style for loop</a></li>
<li><a href="#_multi_assignment_in_combination_with_for_loop">Multi-assignment in combination with for loop</a></li>
<li><a href="#_for_in_loop">for in loop</a></li>
<li><a href="#_while_loop">while loop</a></li>
<li><a href="#_dowhile_loop">do/while loop</a></li>
</ul>
</li>
<li><a href="#_exception_handling">Exception handling</a></li>
<li><a href="#_try_catch_finally">try / catch / finally</a></li>
<li><a href="#_multi_catch">Multi-catch</a></li>
<li><a href="#_arm_try_with_resources">ARM Try with resources</a></li>
</ul>
</li>
<li><a href="#_power_assertion">Power assertion</a></li>
<li><a href="#_labeled_statements">Labeled statements</a></li>
</ul>
</li>
<li><a href="#_expressions">1.6.2. Expressions</a>
<ul class="sectlevel4">
<li><a href="#gpath_expressions">GPath expressions</a>
<ul class="sectlevel5">
<li><a href="#_object_navigation">Object navigation</a></li>
<li><a href="#_expression_deconstruction">Expression Deconstruction</a></li>
<li><a href="#_gpath_for_xml_navigation">GPath for XML navigation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_promotion_and_coercion">1.6.3. Promotion and coercion</a>
<ul class="sectlevel4">
<li><a href="#_number_promotion">Number promotion</a></li>
<li><a href="#closure-coercion">Closure to type coercion</a>
<ul class="sectlevel5">
<li><a href="#_assigning_a_closure_to_a_sam_type">Assigning a closure to a SAM type</a></li>
<li><a href="#_calling_a_method_accepting_a_sam_type_with_a_closure">Calling a method accepting a SAM type with a closure</a></li>
<li><a href="#_closure_to_arbitrary_type_coercion">Closure to arbitrary type coercion</a></li>
</ul>
</li>
<li><a href="#_map_to_type_coercion">Map to type coercion</a></li>
<li><a href="#_string_to_enum_coercion">String to enum coercion</a></li>
<li><a href="#_custom_type_coercion">Custom type coercion</a></li>
<li><a href="#_class_literals_vs_variables_and_the_as_operator">Class literals vs variables and the as operator</a></li>
</ul>
</li>
<li><a href="#_optionality">1.6.4. Optionality</a>
<ul class="sectlevel4">
<li><a href="#_optional_parentheses">Optional parentheses</a></li>
<li><a href="#_optional_semicolons">Optional semicolons</a></li>
<li><a href="#_optional_return_keyword">Optional return keyword</a></li>
<li><a href="#_optional_public_keyword">Optional public keyword</a></li>
</ul>
</li>
<li><a href="#the-groovy-truth">1.6.5. The Groovy Truth</a>
<ul class="sectlevel4">
<li><a href="#_boolean_expressions">Boolean expressions</a></li>
<li><a href="#_collections_and_arrays">Collections and Arrays</a></li>
<li><a href="#_matchers">Matchers</a></li>
<li><a href="#_iterators_and_enumerations">Iterators and Enumerations</a></li>
<li><a href="#_maps_2">Maps</a></li>
<li><a href="#_strings">Strings</a></li>
<li><a href="#_numbers_2">Numbers</a></li>
<li><a href="#_object_references">Object References</a></li>
<li><a href="#_customizing_the_truth_with_asboolean_methods">Customizing the truth with asBoolean() methods</a></li>
</ul>
</li>
<li><a href="#_typing">1.6.6. Typing</a>
<ul class="sectlevel4">
<li><a href="#_optional_typing">Optional typing</a></li>
<li><a href="#static-type-checking">Static type checking</a>
<ul class="sectlevel5">
<li><a href="#_the_typechecked_annotation">The <code>@TypeChecked</code> annotation</a>
<ul class="sectlevel6">
<li><a href="#_activating_type_checking_at_compile_time">Activating type checking at compile time</a></li>
<li><a href="#_skipping_sections">Skipping sections</a></li>
</ul>
</li>
<li><a href="#_type_checking_assignments">Type checking assignments</a></li>
<li><a href="#_list_and_map_constructors">List and map constructors</a></li>
<li><a href="#_method_resolution">Method resolution</a></li>
<li><a href="#type-inference">Type inference</a>
<ul class="sectlevel6">
<li><a href="#_principles">Principles</a></li>
<li><a href="#_variables_vs_fields_in_type_inference">Variables vs fields in type inference</a></li>
<li><a href="#_collection_literal_type_inference">Collection literal type inference</a></li>
<li><a href="#section-lub">Least upper bound</a></li>
<li><a href="#_instanceof_inference">instanceof inference</a></li>
<li><a href="#section-flow-typing">Flow typing</a></li>
<li><a href="#_advanced_type_inference">Advanced type inference</a></li>
</ul>
</li>
<li><a href="#_closures_and_type_inference">Closures and type inference</a>
<ul class="sectlevel6">
<li><a href="#_return_type_inference">Return type inference</a></li>
<li><a href="#_parameter_type_inference">Parameter type inference</a>
<ul class="sectlevel7">
<li><a href="#_explicit_closure_parameters">Explicit closure parameters</a></li>
<li><a href="#_parameters_inferred_from_single_abstract_method_types">Parameters inferred from single-abstract method types</a></li>
<li><a href="#_the_closureparams_annotation">The <code>@ClosureParams</code> annotation</a></li>
</ul>
</li>
<li><a href="#_delegatesto"><code>@DelegatesTo</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_static_compilation">Static compilation</a>
<ul class="sectlevel5">
<li><a href="#_dynamic_vs_static">Dynamic vs static</a></li>
<li><a href="#compilestatic-annotation">The <code>@CompileStatic</code> annotation</a></li>
<li><a href="#_key_benefits">Key benefits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_type_checking_extensions">1.6.7. Type checking extensions</a>
<ul class="sectlevel4">
<li><a href="#_writing_a_type_checking_extension">Writing a type checking extension</a>
<ul class="sectlevel5">
<li><a href="#_towards_a_smarter_type_checker">Towards a smarter type checker</a></li>
<li><a href="#Typecheckingextensions-Howdoesitwork">The extensions attribute</a></li>
<li><a href="#_a_dsl_for_type_checking">A DSL for type checking</a></li>
<li><a href="#Typecheckingextensions-TheAPI">Type checking extensions API</a>
<ul class="sectlevel6">
<li><a href="#Typecheckingextensions-AST">AST</a></li>
<li><a href="#Typecheckingextensions-Events">Events</a></li>
</ul>
</li>
<li><a href="#Typecheckingextensions-Workingwithextensions">Working with extensions</a>
<ul class="sectlevel6">
<li><a href="#Typecheckingextensions-Supportclasses">Support classes</a></li>
<li><a href="#Typecheckingextensions-Classnodes">Class nodes</a></li>
<li><a href="#Typecheckingextensions-Helpingthetypechecker">Helping the type checker</a></li>
<li><a href="#Typecheckingextensions-Throwinganerror">Throwing an error</a></li>
<li><a href="#Typecheckingextensions-isXXXExpression">isXXXExpression</a></li>
<li><a href="#Typecheckingextensions-Virtualmethods">Virtual methods</a></li>
<li><a href="#Typecheckingextensions-Scoping">Scoping</a></li>
<li><a href="#Typecheckingextensions-Otherusefulmethods">Other useful methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_advanced_type_checking_extensions">Advanced type checking extensions</a>
<ul class="sectlevel5">
<li><a href="#_precompiled_type_checking_extensions">Precompiled type checking extensions</a></li>
<li><a href="#_using_grab_in_a_type_checking_extension">Using @Grab in a type checking extension</a></li>
<li><a href="#_sharing_or_packaging_type_checking_extensions">Sharing or packaging type checking extensions</a></li>
<li><a href="#_global_type_checking_extensions">Global type checking extensions</a></li>
<li><a href="#_type_checking_extensions_and_compilestatic">Type checking extensions and @CompileStatic</a></li>
<li><a href="#mixed-mode">Mixed mode compilation</a></li>
<li><a href="#ast-xform-as-extension">Transforming the AST in an extension</a></li>
<li><a href="#_examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tools">2. Tools</a>
<ul class="sectlevel2">
<li><a href="#_running_groovy_from_the_commandline">2.1. Running Groovy from the commandline</a>
<ul class="sectlevel3">
<li><a href="#section-groovy-commandline">2.1.1. groovy, the Groovy command</a></li>
</ul>
</li>
<li><a href="#_compiling_groovy">2.2. Compiling Groovy</a>
<ul class="sectlevel3">
<li><a href="#section-groovyc-compiler">2.2.1. groovyc, the Groovy compiler</a></li>
<li><a href="#_ant_task">2.2.2. Ant task</a></li>
<li><a href="#Gant">2.2.3. Gant</a></li>
<li><a href="#Gradle">2.2.4. Gradle</a></li>
<li><a href="#_maven_integration">2.2.5. Maven integration</a>
<ul class="sectlevel4">
<li><a href="#_gmaven_and_gmavenplus">GMaven and GMavenPlus</a>
<ul class="sectlevel5">
<li><a href="#section-gmaven">GMaven</a></li>
<li><a href="#section-gmavenplus">GMavenPlus</a></li>
<li><a href="#section-gmaven2">GMaven 2</a></li>
</ul>
</li>
<li><a href="#section-groovyeclipse">The Groovy Eclipse Maven plugin</a></li>
</ul>
</li>
<li><a href="#section-jointcompilation">2.2.6. Joint compilation</a></li>
<li><a href="#section-android">2.2.7. Android support</a></li>
</ul>
</li>
<li><a href="#_groovysh_the_groovy_shell">2.3. Groovysh, the Groovy shell</a>
<ul class="sectlevel3">
<li><a href="#_groovy_groovy_shell">2.3.1. Groovy : Groovy Shell</a>
<ul class="sectlevel4">
<li><a href="#GroovyShell-Features">Features</a></li>
<li><a href="#GroovyShell-Command-lineOptionsandArguments">Command-line Options and Arguments</a></li>
<li><a href="#GroovyShell-EvaluatingExpressions">Evaluating Expressions</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-SimpleExpressions">Simple Expressions</a></li>
<li><a href="#GroovyShell-EvaluationResult">Evaluation Result</a></li>
<li><a href="#GroovyShell-Multi-lineExpressions">Multi-line Expressions</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-DefineaClass">Define a Class</a></li>
<li><a href="#GroovyShell-UsetheClass">Use the Class</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Variables">Variables</a></li>
<li><a href="#GroovyShell-Functions">Functions</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Commands">Commands</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-RecognizedCommands">Recognized Commands</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-help"><code>help</code></a></li>
<li><a href="#GroovyShell-exit"><code>exit</code></a></li>
<li><a href="#GroovyShell-import"><code>import</code></a></li>
<li><a href="#GroovyShell-grab"><code>grab</code></a></li>
<li><a href="#GroovyShell-display"><code>display</code></a></li>
<li><a href="#GroovyShell-clear"><code>clear</code></a></li>
<li><a href="#GroovyShell-show"><code>show</code></a></li>
<li><a href="#GroovyShell-inspect"><code>inspect</code></a></li>
<li><a href="#GroovyShell-purge"><code>purge</code></a></li>
<li><a href="#GroovyShell-edit"><code>edit</code></a></li>
<li><a href="#GroovyShell-load"><code>load</code></a></li>
<li><a href="#GroovyShell-save"><code>save</code></a></li>
<li><a href="#GroovyShell-record"><code>record</code></a></li>
<li><a href="#GroovyShell-history"><code>history</code></a></li>
<li><a href="#GroovyShell-alias"><code>alias</code></a></li>
<li><a href="#GroovyShell-doc"><code>doc</code></a></li>
<li><a href="#GroovyShell-set"><code>set</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-Preferences">Preferences</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-RecognizedPreferences">Recognized Preferences</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-InterpreterMode"><code>interpreterMode</code></a></li>
<li><a href="#GroovyShell-verbosity"><code>verbosity</code></a></li>
<li><a href="#_colors"><code>colors</code></a></li>
<li><a href="#GroovyShell-show-last-result"><code>show-last-result</code></a></li>
<li><a href="#GroovyShell-sanitize-stack-trace"><code>sanitize-stack-trace</code></a></li>
<li><a href="#GroovyShell-editor"><code>editor</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-SettingaPreference">Setting a Preference</a></li>
<li><a href="#GroovyShell-ListingPreferences">Listing Preferences</a></li>
<li><a href="#GroovyShell-ClearingPreferencesieResettingtoDefaults">Clearing Preferences (i.e. Resetting to Defaults)</a></li>
</ul>
</li>
<li><a href="#GroovyShell-UserProfileScriptsandState">User Profile Scripts and State</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-ProfileScripts">Profile Scripts</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-HOMEgroovygroovyshprofile"><code>$HOME/.groovy/groovysh.profile</code></a></li>
<li><a href="#GroovyShell-HOMEgroovygroovyshrc"><code>$HOME/.groovy/groovysh.rc</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-State">State</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-HOMEgroovygroovyshhistory"><code>$HOME/.groovy/groovysh.history</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-register">Custom commands</a></li>
<li><a href="#GroovyShell-Troubleshooting">Troubleshooting</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-PlatformProblems">Platform Problems</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-ProblemsloadingtheJLineDLL">Problems loading the JLine DLL</a></li>
<li><a href="#GroovyShell-ProblemswithCygwinonWindows">Problems with Cygwin on Windows</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-GMavenPlus">2.3.2. GMavenPlus Maven Plugin</a></li>
<li><a href="#GroovyShell-GradleGroovyshPlugin">2.3.3. Gradle Groovysh Plugin</a></li>
</ul>
</li>
<li><a href="#_groovyconsole_the_groovy_swing_console">2.4. groovyConsole, the Groovy swing console</a>
<ul class="sectlevel3">
<li><a href="#title-heading">2.4.1. Groovy : Groovy Console</a></li>
<li><a href="#GroovyConsole-Basics">2.4.2. Basics</a></li>
<li><a href="#GroovyConsole-Features">2.4.3. Features</a>
<ul class="sectlevel4">
<li><a href="#GroovyConsole-Command-lineOptionsandArguments">Command-line Options and Arguments</a></li>
<li><a href="#GroovyConsole-RunningScripts">Running Scripts</a></li>
<li><a href="#GroovyConsole-EditingFiles">Editing Files</a></li>
<li><a href="#GroovyConsole-Historyandresults">History and results</a></li>
<li><a href="#GroovyConsole-Interrupt">Interrupting a script</a></li>
<li><a href="#GroovyConsole-Andmore">And more</a></li>
</ul>
</li>
<li><a href="#GroovyConsole-EmbeddingtheConsole">2.4.4. Embedding the Console</a></li>
<li><a href="#GroovyConsole-Visualizingscriptoutputresults">2.4.5. Visualizing script output results</a></li>
<li><a href="#GroovyConsole-ASTbrowser">2.4.6. Advanced debugging: AST browser</a></li>
<li><a href="#GroovyConsole-CSTbrowser">2.4.7. Advanced debugging: CST browser</a></li>
</ul>
</li>
<li><a href="#_groovydoc_the_groovy_java_documentation_generator">2.5. groovydoc, the Groovy &amp; Java documentation generator</a>
<ul class="sectlevel3">
<li><a href="#Groovydoc-CommandLine">2.5.1. The groovydoc command line tool</a></li>
<li><a href="#Groovydoc-Ant">2.5.2. The groovydoc Ant task</a>
<ul class="sectlevel4">
<li><a href="#ThegroovydocAnttask-Requiredtaskdef">Required taskdef</a></li>
<li><a href="#ThegroovydocAnttask-groovydocAttributes">&lt;groovydoc&gt; Attributes</a></li>
<li><a href="#ThegroovydocAnttask-groovydocNestedElements">&lt;groovydoc&gt; Nested Elements</a>
<ul class="sectlevel5">
<li><a href="#ThegroovydocAnttask-link">link</a></li>
<li><a href="#ThegroovydocAnttask-Example1-groovydocAnttask">Example #1 - &lt;groovydoc&gt; Ant task</a></li>
<li><a href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy">Example #2 - Executing &lt;groovydoc&gt; from Groovy</a></li>
</ul>
</li>
<li><a href="#_custom_templates">Custom templates</a>
<ul class="sectlevel5">
<li><a href="#_custom_groovydoc_class">Custom Groovydoc class</a></li>
<li><a href="#_using_the_custom_groovydoc_task">Using the custom groovydoc task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Groovydoc-GMavenPlus">2.5.3. GMavenPlus Maven Plugin</a></li>
</ul>
</li>
<li><a href="#_ide_integration">2.6. IDE integration</a></li>
</ul>
</li>
<li><a href="#_user_guides">3. User Guides</a>
<ul class="sectlevel2">
<li><a href="#_getting_started">3.1. Getting started</a>
<ul class="sectlevel3">
<li><a href="#_download">3.1.1. Download</a>
<ul class="sectlevel4">
<li><a href="#_stable">Stable</a></li>
<li><a href="#_snapshots">Snapshots</a></li>
<li><a href="#_prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a href="#_maven_repository">3.1.2. Maven Repository</a></li>
<li><a href="#SDKMAN">3.1.3. SDKMAN! (The Software Development Kit Manager)</a></li>
<li><a href="#_other_ways_to_get_groovy">3.1.4. Other ways to get Groovy</a>
<ul class="sectlevel4">
<li><a href="#_installation_on_mac_os_x">Installation on Mac OS X</a>
<ul class="sectlevel5">
<li><a href="#_macports">MacPorts</a></li>
<li><a href="#_homebrew">Homebrew</a></li>
</ul>
</li>
<li><a href="#_installation_on_windows">Installation on Windows</a></li>
<li><a href="#_other_distributions">Other Distributions</a></li>
<li><a href="#_source_code">Source Code</a></li>
<li><a href="#_ide_plugin">IDE plugin</a></li>
</ul>
</li>
<li><a href="#_install_binary">3.1.5. Install Binary</a></li>
</ul>
</li>
<li><a href="#_differences_with_java">3.2. Differences with Java</a>
<ul class="sectlevel3">
<li><a href="#_default_imports_2">3.2.1. Default imports</a></li>
<li><a href="#_multi_methods">3.2.2. Multi-methods</a></li>
<li><a href="#_array_initializers">3.2.3. Array initializers</a></li>
<li><a href="#_package_scope_visibility">3.2.4. Package scope visibility</a></li>
<li><a href="#_arm_blocks">3.2.5. ARM blocks</a></li>
<li><a href="#_inner_classes">3.2.6. Inner classes</a>
<ul class="sectlevel4">
<li><a href="#_static_inner_classes">Static inner classes</a></li>
<li><a href="#_anonymous_inner_classes">Anonymous Inner Classes</a></li>
<li><a href="#_creating_instances_of_non_static_inner_classes">Creating Instances of Non-Static Inner Classes</a></li>
</ul>
</li>
<li><a href="#_lambda_expressions_and_the_method_reference_operator">3.2.7. Lambda expressions and the method reference operator</a></li>
<li><a href="#_gstrings">3.2.8. GStrings</a></li>
<li><a href="#_string_and_character_literals">3.2.9. String and Character literals</a></li>
<li><a href="#_behaviour_of">3.2.10. Behaviour of <code>==</code></a></li>
<li><a href="#_primitives_and_wrappers">3.2.11. Primitives and wrappers</a>
<ul class="sectlevel4">
<li><a href="#primitive-optimisation-numbers">Numeric Primitive Optimisation with <code>@CompileStatic</code></a></li>
<li><a href="#zero-edge-case">Positive/Negative zero edge case</a></li>
</ul>
</li>
<li><a href="#_conversions">3.2.12. Conversions</a></li>
<li><a href="#_extra_keywords">3.2.13. Extra keywords</a></li>
</ul>
</li>
<li><a href="#_groovy_development_kit">3.3. Groovy Development Kit</a>
<ul class="sectlevel3">
<li><a href="#_working_with_io">3.3.1. Working with IO</a>
<ul class="sectlevel4">
<li><a href="#_reading_files">Reading files</a></li>
<li><a href="#_writing_files">Writing files</a></li>
<li><a href="#_traversing_file_trees">Traversing file trees</a></li>
<li><a href="#_data_and_objects">Data and objects</a></li>
<li><a href="#process-management">Executing External Processes</a></li>
</ul>
</li>
<li><a href="#_working_with_collections">3.3.2. Working with collections</a>
<ul class="sectlevel4">
<li><a href="#Collections-Lists">Lists</a>
<ul class="sectlevel5">
<li><a href="#_list_literals">List literals</a></li>
<li><a href="#_list_as_a_boolean_expression">List as a boolean expression</a></li>
<li><a href="#_iterating_on_a_list">Iterating on a list</a></li>
<li><a href="#_manipulating_lists">Manipulating lists</a>
<ul class="sectlevel6">
<li><a href="#List-Filtering">Filtering and searching</a></li>
<li><a href="#_adding_or_removing_elements">Adding or removing elements</a></li>
<li><a href="#_set_operations">Set operations</a></li>
<li><a href="#_sorting">Sorting</a></li>
<li><a href="#_duplicating_elements">Duplicating elements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Collections-Maps">Maps</a>
<ul class="sectlevel5">
<li><a href="#_map_literals">Map literals</a></li>
<li><a href="#_map_property_notation">Map property notation</a></li>
<li><a href="#_iterating_on_maps">Iterating on maps</a></li>
<li><a href="#_manipulating_maps">Manipulating maps</a>
<ul class="sectlevel6">
<li><a href="#_adding_or_removing_elements_2">Adding or removing elements</a></li>
<li><a href="#JN1035-Maps-Collectionviewsofamap">Keys, values and entries</a></li>
<li><a href="#_filtering_and_searching">Filtering and searching</a></li>
<li><a href="#Maps-Grouping">Grouping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Collections-Ranges">Ranges</a></li>
<li><a href="#_syntax_enhancements_for_collections">Syntax enhancements for collections</a>
<ul class="sectlevel5">
<li><a href="#_gpath_support">GPath support</a></li>
<li><a href="#_spread_operator_2">Spread operator</a></li>
<li><a href="#Collections-Gettingefficientwiththestar-dotoperator">The star-dot `*.' operator</a></li>
<li><a href="#Collections-Slicingwiththesubscriptoperator">Slicing with the subscript operator</a></li>
</ul>
</li>
<li><a href="#Collections-EnhancedCollectionMethods">Enhanced Collection Methods</a></li>
</ul>
</li>
<li><a href="#_working_with_arrays">3.3.3. Working with arrays</a>
<ul class="sectlevel4">
<li><a href="#Arrays">Arrays</a>
<ul class="sectlevel5">
<li><a href="#_array_literals">Array literals</a></li>
<li><a href="#_iterating_on_a_list_2">Iterating on a list</a></li>
<li><a href="#_other_useful_methods">Other useful methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_working_with_legacy_datecalendar_types">3.3.4. Working with legacy Date/Calendar types</a></li>
<li><a href="#_working_with_datetime_types">3.3.5. Working with Date/Time types</a>
<ul class="sectlevel4">
<li><a href="#_formatting_and_parsing">Formatting and parsing</a></li>
<li><a href="#_manipulating_datetime">Manipulating date/time</a>
<ul class="sectlevel5">
<li><a href="#_addition_and_subtraction">Addition and subtraction</a></li>
<li><a href="#_multiplication_and_division">Multiplication and division</a></li>
<li><a href="#_incrementing_and_decrementing">Incrementing and decrementing</a></li>
<li><a href="#_negation">Negation</a></li>
</ul>
</li>
<li><a href="#_interacting_with_datetime_values">Interacting with date/time values</a>
<ul class="sectlevel5">
<li><a href="#_property_notation">Property notation</a></li>
<li><a href="#_ranges_upto_and_downto">Ranges, <code>upto</code>, and <code>downto</code></a></li>
<li><a href="#_combining_datetime_values">Combining date/time values</a></li>
<li><a href="#_creating_periods_and_durations">Creating periods and durations</a></li>
</ul>
</li>
<li><a href="#_converting_between_legacy_and_jsr_310_types">Converting between legacy and JSR 310 types</a></li>
</ul>
</li>
<li><a href="#_handy_utilities">3.3.6. Handy utilities</a>
<ul class="sectlevel4">
<li><a href="#_configslurper">ConfigSlurper</a></li>
<li><a href="#_expando">Expando</a></li>
<li><a href="#_observable_list_map_and_set">Observable list, map and set</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_metaprogramming">3.4. Metaprogramming</a>
<ul class="sectlevel3">
<li><a href="#_runtime_metaprogramming">3.4.1. Runtime metaprogramming</a>
<ul class="sectlevel4">
<li><a href="#_groovyobject_interface">GroovyObject interface</a>
<ul class="sectlevel5">
<li><a href="#_invokemethod">invokeMethod</a></li>
<li><a href="#_getsetproperty">get/setProperty</a></li>
<li><a href="#_getsetmetaclass">get/setMetaClass</a></li>
</ul>
</li>
<li><a href="#_getsetattribute">get/setAttribute</a></li>
<li><a href="#_methodmissing">methodMissing</a></li>
<li><a href="#_propertymissing">propertyMissing</a></li>
<li><a href="#_static_methodmissing">static methodMissing</a></li>
<li><a href="#_static_propertymissing">static propertyMissing</a></li>
<li><a href="#_groovyinterceptable">GroovyInterceptable</a></li>
<li><a href="#categories">Categories</a></li>
<li><a href="#_metaclasses">Metaclasses</a>
<ul class="sectlevel5">
<li><a href="#_the_default_metaclass_metaclassimpl">The default metaclass <code>MetaClassImpl</code></a></li>
<li><a href="#_custom_metaclasses">Custom metaclasses</a>
<ul class="sectlevel6">
<li><a href="#_delegating_metaclass">Delegating metaclass</a></li>
<li><a href="#_magic_package">Magic package</a></li>
</ul>
</li>
<li><a href="#_per_instance_metaclass">Per instance metaclass</a></li>
<li><a href="#metaprogramming_emc">ExpandoMetaClass</a>
<ul class="sectlevel6">
<li><a href="#_methods_4">Methods</a></li>
<li><a href="#_properties_2">Properties</a></li>
<li><a href="#_constructors_2">Constructors</a></li>
<li><a href="#_static_methods">Static Methods</a></li>
<li><a href="#_borrowing_methods">Borrowing Methods</a></li>
<li><a href="#_dynamic_method_names">Dynamic Method Names</a></li>
<li><a href="#_runtime_discovery">Runtime Discovery</a></li>
<li><a href="#_groovyobject_methods">GroovyObject Methods</a></li>
<li><a href="#_overriding_static_invokemethod">Overriding Static invokeMethod</a></li>
<li><a href="#_extending_interfaces">Extending Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_extension_modules">Extension modules</a>
<ul class="sectlevel5">
<li><a href="#_extending_existing_classes">Extending existing classes</a></li>
<li><a href="#_instance_methods">Instance methods</a></li>
<li><a href="#_static_methods_2">Static methods</a></li>
<li><a href="#module-descriptor">Module descriptor</a></li>
<li><a href="#_extension_modules_and_classpath">Extension modules and classpath</a></li>
<li><a href="#_compatibility_with_type_checking">Compatibility with type checking</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compile_time_metaprogramming">3.4.2. Compile-time metaprogramming</a>
<ul class="sectlevel4">
<li><a href="#_available_ast_transformations">Available AST transformations</a>
<ul class="sectlevel5">
<li><a href="#_code_generation_transformations">Code generation transformations</a>
<ul class="sectlevel6">
<li><a href="#xform-ToString"><code>@groovy.transform.ToString</code></a></li>
<li><a href="#xform-EqualsAndHashCode"><code>@groovy.transform.EqualsAndHashCode</code></a></li>
<li><a href="#xform-TupleConstructor"><code>@groovy.transform.TupleConstructor</code></a></li>
<li><a href="#_implementation_details">Implementation Details</a></li>
<li><a href="#_immutability_support">Immutability support</a></li>
<li><a href="#_customization_options">Customization options</a></li>
<li><a href="#xform-MapConstructor"><code>@groovy.transform.MapConstructor</code></a></li>
<li><a href="#xform-Canonical"><code>@groovy.transform.Canonical</code></a></li>
<li><a href="#xform-InheritConstructors"><code>@groovy.transform.InheritConstructors</code></a></li>
<li><a href="#xform-Category"><code>@groovy.lang.Category</code></a></li>
<li><a href="#xform-IndexedProperty"><code>@groovy.transform.IndexedProperty</code></a></li>
<li><a href="#xform-Lazy"><code>@groovy.lang.Lazy</code></a></li>
<li><a href="#xform-Newify"><code>@groovy.lang.Newify</code></a></li>
<li><a href="#xform-Sortable"><code>@groovy.transform.Sortable</code></a></li>
<li><a href="#xform-Builder"><code>@groovy.transform.builder.Builder</code></a></li>
<li><a href="#xform-AutoImplement"><code>@groovy.transform.AutoImplement</code></a></li>
<li><a href="#xform-NullCheck"><code>@groovy.transform.NullCheck</code></a></li>
</ul>
</li>
<li><a href="#_class_design_annotations">Class design annotations</a>
<ul class="sectlevel6">
<li><a href="#xform-BaseScript"><code>@groovy.transform.BaseScript</code></a></li>
<li><a href="#xform-Delegate"><code>@groovy.lang.Delegate</code></a></li>
<li><a href="#xform-Immutable"><code>@groovy.transform.Immutable</code></a></li>
<li><a href="#xform-ImmutableBase"><code>@groovy.transform.ImmutableBase</code></a></li>
<li><a href="#xform-PropertyOptions"><code>@groovy.transform.PropertyOptions</code></a></li>
<li><a href="#xform-VisibilityOptions"><code>@groovy.transform.VisibilityOptions</code></a></li>
<li><a href="#xform-ImmutableOptions"><code>@groovy.transform.ImmutableOptions</code></a></li>
<li><a href="#xform-KnownImmutable"><code>@groovy.transform.KnownImmutable</code></a></li>
<li><a href="#xform-Memoized"><code>@groovy.transform.Memoized</code></a></li>
<li><a href="#xform-TailRecursive"><code>@groovy.transform.TailRecursive</code></a></li>
<li><a href="#xform-Singleton"><code>@groovy.lang.Singleton</code></a></li>
<li><a href="#xform-Mixin"><code>@groovy.lang.Mixin</code></a></li>
</ul>
</li>
<li><a href="#_logging_improvements">Logging improvements</a>
<ul class="sectlevel6">
<li><a href="#xform-Log"><code>@groovy.util.logging.Log</code></a></li>
<li><a href="#xform-Commons"><code>@groovy.util.logging.Commons</code></a></li>
<li><a href="#xform-Log4j"><code>@groovy.util.logging.Log4j</code></a></li>
<li><a href="#xform-Log4j2"><code>@groovy.util.logging.Log4j2</code></a></li>
<li><a href="#xform-Slf4j"><code>@groovy.util.logging.Slf4j</code></a></li>
<li><a href="#xform-PlatformLog"><code>@groovy.util.logging.PlatformLog</code></a></li>
</ul>
</li>
<li><a href="#_declarative_concurrency">Declarative concurrency</a>
<ul class="sectlevel6">
<li><a href="#xform-Synchronized"><code>@groovy.transform.Synchronized</code></a></li>
<li><a href="#xform-WithReadLock"><code>@groovy.transform.WithReadLock</code> and <code>@groovy.transform.WithWriteLock</code></a></li>
</ul>
</li>
<li><a href="#_easier_cloning_and_externalizing">Easier cloning and externalizing</a>
<ul class="sectlevel6">
<li><a href="#xform-AutoClone"><code>@groovy.transform.AutoClone</code></a></li>
<li><a href="#xform-AutoExternalize"><code>@groovy.transform.AutoExternalize</code></a></li>
</ul>
</li>
<li><a href="#_safer_scripting">Safer scripting</a>
<ul class="sectlevel6">
<li><a href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a></li>
<li><a href="#xform-TimedInterrupt"><code>@groovy.transform.TimedInterrupt</code></a></li>
<li><a href="#xform-ConditionalInterrupt"><code>@groovy.transform.ConditionalInterrupt</code></a></li>
</ul>
</li>
<li><a href="#_compiler_directives">Compiler directives</a>
<ul class="sectlevel6">
<li><a href="#xform-Field"><code>@groovy.transform.Field</code></a></li>
<li><a href="#xform-PackageScope"><code>@groovy.transform.PackageScope</code></a></li>
<li><a href="#xform-Final"><code>@groovy.transform.Final</code></a></li>
<li><a href="#xform-AutoFinal"><code>@groovy.transform.AutoFinal</code></a></li>
<li><a href="#xform-AnnotationCollector"><code>@groovy.transform.AnnotationCollector</code></a></li>
<li><a href="#xform-TypeChecked"><code>@groovy.transform.TypeChecked</code></a></li>
<li><a href="#xform-CompileStatic"><code>@groovy.transform.CompileStatic</code></a></li>
<li><a href="#xform-CompileDynamic"><code>@groovy.transform.CompileDynamic</code></a></li>
<li><a href="#xform-DelegatesTo"><code>@groovy.lang.DelegatesTo</code></a></li>
<li><a href="#xform-SelfType"><code>@groovy.transform.SelfType</code></a></li>
</ul>
</li>
<li><a href="#_swing_patterns">Swing patterns</a>
<ul class="sectlevel6">
<li><a href="#xform-Bindable"><code>@groovy.beans.Bindable</code></a></li>
<li><a href="#xform-ListenerList"><code>@groovy.beans.ListenerList</code></a></li>
<li><a href="#xform-Vetoable"><code>@groovy.beans.Vetoable</code></a></li>
</ul>
</li>
<li><a href="#_test_assistance">Test assistance</a>
<ul class="sectlevel6">
<li><a href="#xform-NotYetImplemented"><code>@groovy.test.NotYetImplemented</code></a></li>
<li><a href="#xform-ASTTest"><code>@groovy.transform.ASTTest</code></a></li>
</ul>
</li>
<li><a href="#_grape_handling">Grape handling</a>
<ul class="sectlevel6">
<li><a href="#xform-Grab"><code>@groovy.lang.Grab</code></a></li>
<li><a href="#xform-GrabConfig"><code>@groovy.lang.GrabConfig</code></a></li>
<li><a href="#xform-GrabExclude"><code>@groovy.lang.GrabExclude</code></a></li>
<li><a href="#xform-GrabResolver"><code>@groovy.lang.GrabResolver</code></a></li>
<li><a href="#xform-Grapes"><code>@groovy.lang.Grapes</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-ast-xforms">Developing AST transformations</a>
<ul class="sectlevel5">
<li><a href="#_compilation_phases_guide">Compilation phases guide</a></li>
<li><a href="#transforms-local">Local transformations</a></li>
<li><a href="#transforms-global">Global transformations</a></li>
<li><a href="#_ast_api_guide">AST API guide</a>
<ul class="sectlevel6">
<li><a href="#_abstractasttransformation">AbstractASTTransformation</a></li>
<li><a href="#_classcodeexpressiontransformer">ClassCodeExpressionTransformer</a></li>
<li><a href="#_ast_nodes">AST Nodes</a></li>
</ul>
</li>
<li><a href="#_macros">Macros</a>
<ul class="sectlevel6">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_statements_and_expressions">Statements and expressions</a></li>
<li><a href="#_variable_substitution">Variable substitution</a></li>
<li><a href="#_macroclass">MacroClass</a></li>
<li><a href="#_macro_methods">@Macro methods</a></li>
</ul>
</li>
<li><a href="#_testing_ast_transformations">Testing AST transformations</a>
<ul class="sectlevel6">
<li><a href="#_separating_source_trees">Separating source trees</a></li>
<li><a href="#_debugging_ast_transformations">Debugging AST transformations</a></li>
<li><a href="#_astmatcher">ASTMatcher</a></li>
<li><a href="#_asttest">ASTTest</a></li>
</ul>
</li>
<li><a href="#_external_references">External references</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#section-grape">3.5. Dependency management with Grape</a>
<ul class="sectlevel3">
<li><a href="#_quick_start">3.5.1. Quick start</a>
<ul class="sectlevel4">
<li><a href="#_add_a_dependency">Add a Dependency</a></li>
<li><a href="#Grape-SpecifyAdditionalRepositories">Specify Additional Repositories</a></li>
<li><a href="#Grape-MavenClassifiers">Maven Classifiers</a></li>
<li><a href="#Grape-ExcludingTransitiveDependencies">Excluding Transitive Dependencies</a></li>
<li><a href="#Grape-JDBCDrivers">JDBC Drivers</a></li>
<li><a href="#Grape-UsingGrapeFromtheGroovyShell">Using Grape From the Groovy Shell</a></li>
<li><a href="#Grape-Proxysettings">Proxy settings</a></li>
<li><a href="#Grape-Logging">Logging</a></li>
</ul>
</li>
<li><a href="#Grape-Detail">3.5.2. Detail</a></li>
<li><a href="#Grape-Usage">3.5.3. Usage</a>
<ul class="sectlevel4">
<li><a href="#Grape-Annotation">Annotation</a></li>
<li><a href="#Grape-MultipleGrapeAnnotations">Multiple Grape Annotations</a></li>
<li><a href="#Grape-Methodcall">Method call</a>
<ul class="sectlevel5">
<li><a href="#Grape-grabHashMapParameters">grab(HashMap) Parameters</a></li>
<li><a href="#Grape-ArgumentsMaparguments">Arguments Map arguments</a></li>
</ul>
</li>
<li><a href="#Grape-CommandLineTool">Command Line Tool</a></li>
<li><a href="#Grape-Advancedconfiguration">Advanced configuration</a>
<ul class="sectlevel5">
<li><a href="#Grape-RepositoryDirectory">Repository Directory</a></li>
<li><a href="#Grape-CustomizeIvysettings">Customize Ivy settings</a></li>
</ul>
</li>
<li><a href="#Grape-MoreExamples">More Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing_guide">3.6. Testing Guide</a>
<ul class="sectlevel3">
<li><a href="#_introduction_3">3.6.1. Introduction</a></li>
<li><a href="#_language_features">3.6.2. Language Features</a>
<ul class="sectlevel4">
<li><a href="#_power_assertions">Power Assertions</a></li>
<li><a href="#_mocking_and_stubbing">Mocking and Stubbing</a>
<ul class="sectlevel5">
<li><a href="#_map_coercion">Map Coercion</a></li>
<li><a href="#_closure_coercion_2">Closure Coercion</a></li>
<li><a href="#_mockfor_and_stubfor">MockFor and StubFor</a></li>
<li><a href="#testing_guide_emc">Expando Meta-Class (EMC)</a></li>
</ul>
</li>
<li><a href="#_gdk_methods">GDK Methods</a>
<ul class="sectlevel5">
<li><a href="#_iterablecombinations">Iterable#combinations</a></li>
<li><a href="#_iterableeachcombination">Iterable#eachCombination</a></li>
</ul>
</li>
<li><a href="#_tool_support">Tool Support</a>
<ul class="sectlevel5">
<li><a href="#_test_code_coverage">Test Code Coverage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing_with_junit">3.6.3. Testing with JUnit</a>
<ul class="sectlevel4">
<li><a href="#_junit_3">JUnit 3</a>
<ul class="sectlevel5">
<li><a href="#_assertion_methods">Assertion Methods</a></li>
<li><a href="#_shouldfail_methods">shouldFail Methods</a></li>
<li><a href="#_notyetimplemented_method">notYetImplemented Method</a></li>
</ul>
</li>
<li><a href="#_junit_4">JUnit 4</a></li>
<li><a href="#_junit_5">JUnit 5</a></li>
</ul>
</li>
<li><a href="#_testing_with_spock">3.6.4. Testing with Spock</a>
<ul class="sectlevel4">
<li><a href="#_specifications">Specifications</a></li>
<li><a href="#_more_spock">More Spock</a></li>
</ul>
</li>
<li><a href="#_functional_tests_with_geb">3.6.5. Functional Tests with Geb</a>
<ul class="sectlevel4">
<li><a href="#_a_geb_script">A Geb Script</a></li>
<li><a href="#_more_geb">More Geb</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tune_parsing_performance_of_parrot_parser">3.7. Tune parsing performance of Parrot parser</a></li>
<li><a href="#_processing_json">3.8. Processing JSON</a>
<ul class="sectlevel3">
<li><a href="#json_jsonslurper">3.8.1. JsonSlurper</a>
<ul class="sectlevel4">
<li><a href="#_parser_variants">Parser Variants</a></li>
</ul>
</li>
<li><a href="#_jsonoutput">3.8.2. JsonOutput</a>
<ul class="sectlevel4">
<li><a href="#_customizing_output">Customizing Output</a>
<ul class="sectlevel5">
<li><a href="#_formatted_output">Formatted Output</a></li>
</ul>
</li>
<li><a href="#_builders">Builders</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#processing-sql">3.9. Interacting with a SQL database</a>
<ul class="sectlevel3">
<li><a href="#_connecting_to_the_database">3.9.1. Connecting to the database</a>
<ul class="sectlevel4">
<li><a href="#_connecting_with_a_datasource">Connecting with a DataSource</a></li>
<li><a href="#_connecting_using_grab">Connecting using @Grab</a></li>
</ul>
</li>
<li><a href="#_executing_sql">3.9.2. Executing SQL</a>
<ul class="sectlevel4">
<li><a href="#_creating_tables">Creating tables</a></li>
</ul>
</li>
<li><a href="#_basic_crud_operations">3.9.3. Basic CRUD operations</a>
<ul class="sectlevel4">
<li><a href="#_creatinginserting_data">Creating/Inserting data</a></li>
<li><a href="#_reading_rows">Reading rows</a></li>
<li><a href="#_updating_rows">Updating rows</a></li>
<li><a href="#_deleting_rows">Deleting rows</a></li>
</ul>
</li>
<li><a href="#_advanced_sql_operations">3.9.4. Advanced SQL operations</a>
<ul class="sectlevel4">
<li><a href="#_working_with_transactions">Working with transactions</a></li>
<li><a href="#_using_batches">Using batches</a></li>
<li><a href="#_performing_pagination">Performing pagination</a></li>
<li><a href="#_fetching_metadata">Fetching metadata</a></li>
<li><a href="#_named_and_named_ordinal_parameters">Named and named-ordinal parameters</a></li>
<li><a href="#_stored_procedures">Stored procedures</a></li>
</ul>
</li>
<li><a href="#_using_datasets">3.9.5. Using DataSets</a></li>
</ul>
</li>
<li><a href="#_querying_collections_in_sql_like_style">3.10. Querying collections in SQL-like style</a>
<ul class="sectlevel3">
<li><a href="#_ginq_a_k_a_groovy_integrated_query">3.10.1. GINQ a.k.a. Groovy-Integrated Query</a>
<ul class="sectlevel4">
<li><a href="#_ginq_syntax">GINQ Syntax</a>
<ul class="sectlevel5">
<li><a href="#_data_source">Data Source</a>
<ul class="sectlevel6">
<li><a href="#_iterable_data_source"><code>Iterable</code> Data Source</a></li>
<li><a href="#_stream_data_source"><code>Stream</code> Data Source</a></li>
<li><a href="#_array_data_source">Array Data Source</a></li>
<li><a href="#_ginq_result_set_data_source">GINQ Result Set Data Source</a></li>
</ul>
</li>
<li><a href="#_projection">Projection</a>
<ul class="sectlevel6">
<li><a href="#_distinct">Distinct</a></li>
</ul>
</li>
<li><a href="#_filtering">Filtering</a>
<ul class="sectlevel6">
<li><a href="#_in">In</a></li>
<li><a href="#_not_in">Not In</a></li>
<li><a href="#_exists">Exists</a></li>
<li><a href="#_not_exists">Not Exists</a></li>
</ul>
</li>
<li><a href="#_joining">Joining</a></li>
<li><a href="#_grouping">Grouping</a>
<ul class="sectlevel6">
<li><a href="#_aggregate_functions">Aggregate Functions</a></li>
</ul>
</li>
<li><a href="#_sorting_2">Sorting</a></li>
<li><a href="#_pagination">Pagination</a></li>
<li><a href="#_nested_ginq">Nested GINQ</a>
<ul class="sectlevel6">
<li><a href="#_nested_ginq_in_from_clause">Nested GINQ in <code>from</code> clause</a></li>
<li><a href="#_nested_ginq_in_where_clause">Nested GINQ in <code>where</code> clause</a></li>
<li><a href="#_nested_ginq_in_select_clause">Nested GINQ in <code>select</code> clause</a></li>
</ul>
</li>
<li><a href="#_window_functions">Window Functions</a>
<ul class="sectlevel6">
<li><a href="#_rownumber"><code>rowNumber</code></a></li>
<li><a href="#_rank_denserank_percentrank_cumedist_and_ntile"><code>rank</code>, <code>denseRank</code>, <code>percentRank</code>, <code>cumeDist</code> and <code>ntile</code></a></li>
<li><a href="#_lead_and_lag"><code>lead</code> and <code>lag</code></a></li>
<li><a href="#_firstvalue_lastvalue_and_nthvalue"><code>firstValue</code>, <code>lastValue</code> and <code>nthValue</code></a></li>
<li><a href="#_min_max_count_sum_avg_median_stdev_stdevp_var_varp_and_agg"><code>min</code>, <code>max</code>, <code>count</code>, <code>sum</code>, <code>avg</code>, <code>median</code>, <code>stdev</code>, <code>stdevp</code>, <code>var</code> ,<code>varp</code> and <code>agg</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ginq_tips">GINQ Tips</a>
<ul class="sectlevel5">
<li><a href="#_row_number">Row Number</a></li>
<li><a href="#_list_comprehension">List Comprehension</a></li>
<li><a href="#_query_update">Query &amp; Update</a></li>
<li><a href="#_alternative_for_with_clause">Alternative for <code>with</code> clause</a></li>
<li><a href="#_alternative_for_case_when">Alternative for <code>case-when</code></a></li>
<li><a href="#_query_json">Query JSON</a></li>
<li><a href="#_parallel_querying">Parallel Querying</a></li>
<li><a href="#_customize_ginq">Customize GINQ</a></li>
<li><a href="#_optimize_ginq">Optimize GINQ</a></li>
</ul>
</li>
<li><a href="#_ginq_examples">GINQ Examples</a>
<ul class="sectlevel5">
<li><a href="#_generate_multiplication_table">Generate Multiplication Table</a></li>
<li><a href="#_more_examples">More examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#processing-xml">3.11. Processing XML</a>
<ul class="sectlevel3">
<li><a href="#_parsing_xml">3.11.1. Parsing XML</a>
<ul class="sectlevel4">
<li><a href="#_xmlparser_and_xmlslurper">XmlParser and XmlSlurper</a></li>
<li><a href="#_domcategory">DOMCategory</a></li>
</ul>
</li>
<li><a href="#_gpath">3.11.2. GPath</a>
<ul class="sectlevel4">
<li><a href="#_simply_traversing_the_tree">Simply traversing the tree</a></li>
<li><a href="#_flexible_navigation_with_children_depthfirst_and_breadthfirst">Flexible navigation with children (*), depthFirst (**) and breadthFirst</a></li>
</ul>
</li>
<li><a href="#_creating_xml">3.11.3. Creating XML</a>
<ul class="sectlevel4">
<li><a href="#_markupbuilder">MarkupBuilder</a></li>
<li><a href="#_streamingmarkupbuilder">StreamingMarkupBuilder</a></li>
<li><a href="#_markupbuilderhelper">MarkupBuilderHelper</a></li>
<li><a href="#_domtogroovy">DOMToGroovy</a></li>
</ul>
</li>
<li><a href="#_manipulating_xml">3.11.4. Manipulating XML</a>
<ul class="sectlevel4">
<li><a href="#_adding_nodes">Adding nodes</a></li>
<li><a href="#_modifying_removing_nodes">Modifying / Removing nodes</a></li>
<li><a href="#_printing_xml">Printing XML</a>
<ul class="sectlevel5">
<li><a href="#_xmlutil">XmlUtil</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processing_yaml">3.12. Processing YAML</a>
<ul class="sectlevel3">
<li><a href="#yaml_yamlslurper">3.12.1. YamlSlurper</a>
<ul class="sectlevel4">
<li><a href="#_builders_2">Builders</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processing_toml">3.13. Processing TOML</a>
<ul class="sectlevel3">
<li><a href="#toml_tomlslurper">3.13.1. TomlSlurper</a>
<ul class="sectlevel4">
<li><a href="#_builders_3">Builders</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_groovy_contracts_design_by_contract_support_for_groovy">3.14. Groovy Contracts – design by contract support for Groovy</a>
<ul class="sectlevel3">
<li><a href="#_applying_invariant_requires_and_ensures">3.14.1. Applying @Invariant, @Requires and @Ensures</a></li>
<li><a href="#_more_features">3.14.2. More Features</a></li>
<li><a href="#_the_stack_example">3.14.3. The Stack Example</a></li>
</ul>
</li>
<li><a href="#_scripting_ant_tasks">3.15. Scripting Ant tasks</a></li>
<li><a href="#_the_groovy_ant_task">3.16. The &lt;groovy&gt; Ant Task</a>
<ul class="sectlevel3">
<li><a href="#groovy-ant-task-using">3.16.1. <code>&lt;groovy&gt;</code></a></li>
<li><a href="#_required_taskdef">3.16.2. Required taskdef</a></li>
<li><a href="#_groovy_attributes">3.16.3. &lt;groovy&gt; attributes</a></li>
<li><a href="#_parameters_specified_as_nested_elements">3.16.4. Parameters specified as nested elements</a>
<ul class="sectlevel4">
<li><a href="#_classpath">&lt;classpath&gt;</a></li>
<li><a href="#_arg">&lt;arg&gt;</a></li>
</ul>
</li>
<li><a href="#_available_bindings">3.16.5. Available bindings</a></li>
<li><a href="#_examples_2">3.16.6. Examples</a></li>
</ul>
</li>
<li><a href="#_the_groovyc_ant_task">3.17. The &lt;groovyc&gt; Ant Task</a>
<ul class="sectlevel3">
<li><a href="#groovyc-ant-task-using">3.17.1. <code>&lt;groovyc&gt;</code></a>
<ul class="sectlevel4">
<li><a href="#groovyc-ant-task-description">Description</a></li>
<li><a href="#groovyc-ant-task-taskdef">Required taskdef</a></li>
<li><a href="#groovyc-ant-task-attributes">&lt;groovyc&gt; Attributes</a></li>
<li><a href="#groovyc-ant-task-nested-elements">&lt;groovyc&gt; Nested Elements</a></li>
<li><a href="#groovyc-ant-task-joint-compilation">Joint Compilation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_template_engines">3.18. Template engines</a>
<ul class="sectlevel3">
<li><a href="#_introduction_4">3.18.1. Introduction</a></li>
<li><a href="#_template_framework">3.18.2. Template framework</a></li>
<li><a href="#_simpletemplateengine">3.18.3. SimpleTemplateEngine</a>
<ul class="sectlevel4">
<li><a href="#_advanced_usage_note">Advanced Usage Note</a></li>
</ul>
</li>
<li><a href="#_streamingtemplateengine">3.18.4. StreamingTemplateEngine</a></li>
<li><a href="#_gstringtemplateengine">3.18.5. GStringTemplateEngine</a></li>
<li><a href="#_xmltemplateengine">3.18.6. XmlTemplateEngine</a></li>
<li><a href="#_the_markuptemplateengine">3.18.7. The MarkupTemplateEngine</a>
<ul class="sectlevel4">
<li><a href="#_the_template_format">The template format</a>
<ul class="sectlevel5">
<li><a href="#_basics">Basics</a></li>
<li><a href="#_support_methods">Support methods</a></li>
<li><a href="#_includes">Includes</a></li>
<li><a href="#_fragments">Fragments</a></li>
<li><a href="#_layouts">Layouts</a></li>
</ul>
</li>
<li><a href="#_rendering_contents">Rendering contents</a>
<ul class="sectlevel5">
<li><a href="#_creation_of_a_template_engine">Creation of a template engine</a></li>
<li><a href="#markuptemplate-config">Configuration options</a></li>
<li><a href="#markuptemplate-autoformat">Automatic formatting</a></li>
<li><a href="#markuptemplate-autoescape">Automatic escaping</a></li>
<li><a href="#markuptemplate-gotchas">Common gotchas</a>
<ul class="sectlevel6">
<li><a href="#_strings_containing_markup">Strings containing markup</a></li>
</ul>
</li>
<li><a href="#markuptemplate-i18n">Internationalization</a></li>
<li><a href="#markuptemplate-basetemplate">Custom template classes</a></li>
</ul>
</li>
<li><a href="#_type_checked_templates">Type checked templates</a>
<ul class="sectlevel5">
<li><a href="#_optional_type_checking">Optional type checking</a></li>
<li><a href="#_alternative_declaration_of_types">Alternative declaration of types</a></li>
<li><a href="#_performance_of_type_checked_templates">Performance of type checked templates</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_other_solutions">3.18.8. Other solutions</a></li>
</ul>
</li>
<li><a href="#_servlet_support">3.19. Servlet support</a>
<ul class="sectlevel3">
<li><a href="#_implicit_variables">3.19.1. Implicit variables</a></li>
<li><a href="#_setting_up_groovlets">3.19.2. Setting up groovlets</a></li>
</ul>
</li>
<li><a href="#_integrating_groovy_in_a_java_application">3.20. Integrating Groovy in a Java application</a>
<ul class="sectlevel3">
<li><a href="#_groovy_integration_mechanisms">3.20.1. Groovy integration mechanisms</a>
<ul class="sectlevel4">
<li><a href="#integ-eval">Eval</a></li>
<li><a href="#integ-groovyshell">GroovyShell</a>
<ul class="sectlevel5">
<li><a href="#_multiple_sources">Multiple sources</a></li>
<li><a href="#_sharing_data_between_a_script_and_the_application">Sharing data between a script and the application</a></li>
<li><a href="#_custom_script_class">Custom script class</a></li>
</ul>
</li>
<li><a href="#groovyclassloader">GroovyClassLoader</a></li>
<li><a href="#_groovyscriptengine">GroovyScriptEngine</a></li>
<li><a href="#_compilationunit">CompilationUnit</a></li>
</ul>
</li>
<li><a href="#jsr223">3.20.2. JSR 223 javax.script API</a></li>
</ul>
</li>
<li><a href="#_domain_specific_languages">3.21. Domain-Specific Languages</a>
<ul class="sectlevel3">
<li><a href="#_command_chains">3.21.1. Command chains</a></li>
<li><a href="#_operator_overloading">3.21.2. Operator overloading</a></li>
<li><a href="#_script_base_classes">3.21.3. Script base classes</a>
<ul class="sectlevel4">
<li><a href="#_the_script_class">The Script class</a></li>
<li><a href="#dsl-basescript">The @BaseScript annotation</a></li>
<li><a href="#_alternate_abstract_method">Alternate abstract method</a></li>
</ul>
</li>
<li><a href="#_adding_properties_to_numbers">3.21.4. Adding properties to numbers</a></li>
<li><a href="#section-delegatesto">3.21.5. @DelegatesTo</a>
<ul class="sectlevel4">
<li><a href="#TheDelegatesToannotation-DSLsmadeeasy">Explaining delegation strategy at compile time</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTo">@DelegatesTo</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTomodes">DelegatesTo modes</a>
<ul class="sectlevel5">
<li><a href="#TheDelegatesToannotation-Simpledelegation">Simple delegation</a></li>
<li><a href="#TheDelegatesToannotation-Delegationstrategy">Delegation strategy</a></li>
<li><a href="#TheDelegatesToannotation-Delegatetoparameter">Delegate to parameter</a></li>
<li><a href="#TheDelegatesToannotation-Multipleclosures">Multiple closures</a></li>
<li><a href="#_delegating_to_a_generic_type">Delegating to a generic type</a></li>
<li><a href="#_delegating_to_an_arbitrary_type">Delegating to an arbitrary type</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compilation-customizers">3.21.6. Compilation customizers</a>
<ul class="sectlevel4">
<li><a href="#_introduction_5">Introduction</a></li>
<li><a href="#_import_customizer">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer">Source aware customizer</a></li>
<li><a href="#_customizer_builder">Customizer builder</a>
<ul class="sectlevel5">
<li><a href="#_import_customizer_2">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer_2">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer_2">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer_2">Source aware customizer</a></li>
<li><a href="#_inlining_a_customizer">Inlining a customizer</a></li>
<li><a href="#_multiple_customizers">Multiple customizers</a></li>
</ul>
</li>
<li><a href="#_the_configscript_commandline_parameter">The <code>configscript</code> commandline parameter</a>
<ul class="sectlevel5">
<li><a href="#_configscript_example_static_compilation_by_default">Configscript example: Static compilation by default</a></li>
<li><a href="#_configscript_example_setting_system_properties">Configscript example: Setting system properties</a></li>
</ul>
</li>
<li><a href="#_ast_transformations">AST transformations</a></li>
</ul>
</li>
<li><a href="#_custom_type_checking_extensions">3.21.7. Custom type checking extensions</a></li>
<li><a href="#_builders_4">3.21.8. Builders</a>
<ul class="sectlevel4">
<li><a href="#_existing_builders">Existing builders</a>
<ul class="sectlevel5">
<li><a href="#_markupbuilder_2">MarkupBuilder</a></li>
<li><a href="#_streamingmarkupbuilder_2">StreamingMarkupBuilder</a></li>
<li><a href="#_saxbuilder">SaxBuilder</a></li>
<li><a href="#_staxbuilder">StaxBuilder</a></li>
<li><a href="#_dombuilder">DOMBuilder</a></li>
<li><a href="#_nodebuilder">NodeBuilder</a></li>
<li><a href="#_jsonbuilder">JsonBuilder</a></li>
<li><a href="#_streamingjsonbuilder">StreamingJsonBuilder</a></li>
<li><a href="#swingbuilder">SwingBuilder</a></li>
<li><a href="#antbuilder">AntBuilder</a></li>
<li><a href="#_clibuilder">CliBuilder</a>
<ul class="sectlevel6">
<li><a href="#_using_annotations_and_an_interface">Using Annotations and an interface</a></li>
<li><a href="#_using_annotations_and_an_instance">Using Annotations and an instance</a></li>
<li><a href="#_using_annotations_and_a_script">Using Annotations and a script</a></li>
<li><a href="#_options_with_arguments">Options with arguments</a></li>
<li><a href="#_specifying_a_type">Specifying a type</a></li>
<li><a href="#_custom_parsing_of_the_argument_string">Custom parsing of the argument String</a></li>
<li><a href="#_options_with_multiple_arguments">Options with multiple arguments</a></li>
<li><a href="#_types_and_multiple_arguments">Types and multiple arguments</a></li>
<li><a href="#_setting_a_default_value">Setting a default value</a></li>
<li><a href="#_use_with_typechecked">Use with <code>TypeChecked</code></a></li>
<li><a href="#_advanced_cli_usage">Advanced CLI Usage</a>
<ul class="sectlevel7">
<li><a href="#_apache_commons_cli">Apache Commons CLI</a></li>
<li><a href="#_picocli">Picocli</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_objectgraphbuilder">ObjectGraphBuilder</a></li>
<li><a href="#_jmxbuilder">JmxBuilder</a></li>
<li><a href="#_filetreebuilder">FileTreeBuilder</a></li>
</ul>
</li>
<li><a href="#_creating_a_builder">Creating a builder</a>
<ul class="sectlevel5">
<li><a href="#_buildersupport">BuilderSupport</a></li>
<li><a href="#_factorybuildersupport">FactoryBuilderSupport</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_working_with_jmx">3.22. Working with JMX</a>
<ul class="sectlevel3">
<li><a href="#_introduction_6">3.22.1. Introduction</a></li>
<li><a href="#_monitoring_the_jvm">3.22.2. Monitoring the JVM</a></li>
<li><a href="#_monitoring_tomcat">3.22.3. Monitoring Tomcat</a></li>
<li><a href="#_oc4j_example">3.22.4. OC4J Example</a></li>
<li><a href="#_weblogic_example">3.22.5. WebLogic Example</a></li>
<li><a href="#_spring_example">3.22.6. Spring Example</a></li>
<li><a href="#_troubleshooting">3.22.7. Troubleshooting</a>
<ul class="sectlevel4">
<li><a href="#_java_lang_securityexception">java.lang.SecurityException</a></li>
</ul>
</li>
<li><a href="#jmx_jmxbuilder">3.22.8. JmxBuilder</a>
<ul class="sectlevel4">
<li><a href="#_instantiating_jmxbuilder">Instantiating JmxBuilder</a></li>
<li><a href="#_jmx_connectors">JMX Connectors</a>
<ul class="sectlevel5">
<li><a href="#_connector_server">Connector Server</a></li>
<li><a href="#_connector_client">Connector Client</a></li>
</ul>
</li>
<li><a href="#_jmxbuilder_mbean_export">JmxBuilder MBean Export</a>
<ul class="sectlevel5">
<li><a href="#_implicit_vs_explicit_descriptors">Implicit vs Explicit Descriptors</a></li>
<li><a href="#_the_jmxbuilder_export_node">The JmxBuilder.export() Node</a></li>
<li><a href="#_jmxbuilder_export_syntax">JmxBuilder.export() Syntax</a></li>
<li><a href="#_integration_with_groovymbean_class">Integration with GroovyMBean Class</a></li>
<li><a href="#_mbean_registration_with_jmxbuilder_bean">MBean Registration with JmxBuilder.bean()</a>
<ul class="sectlevel6">
<li><a href="#_implicit_export">Implicit Export</a>
<ul class="sectlevel7">
<li><a href="#_jconsole_view_of_exported_bean">JConsole view of Exported Bean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_jmxbuilder_bean_syntax">JmxBuilder.bean() Syntax</a></li>
<li><a href="#_bean_node_specifying_mbean_objectname">Bean() Node - Specifying MBean ObjectName</a></li>
</ul>
</li>
<li><a href="#_bean_node_attribute_export">Bean() Node - Attribute Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_attributes_with_wildcard">Export All Attributes with Wildcard "*"</a></li>
<li><a href="#_export_attribute_list">Export Attribute List</a></li>
<li><a href="#_export_attribute_with_explicit_descriptors">Export Attribute with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_bean_node_constructor_export">Bean() Node - Constructor Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_constructors_with">Export all Constructors with "*"</a></li>
<li><a href="#_export_constructors_using_parameter_descriptor">Export Constructors using Parameter Descriptor</a></li>
<li><a href="#_export_constructor_with_explicit_descriptors">Export Constructor with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_bean_node_operation_export">Bean() Node - Operation Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_operations_with">Export All Operations with "*"</a></li>
<li><a href="#_export_operation_list">Export Operation List</a></li>
<li><a href="#_export_operations_by_signature">Export Operations by Signature</a></li>
<li><a href="#_export_operations_with_explicit_descriptors">Export Operations with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_embedding_descriptor">Embedding Descriptor</a></li>
<li><a href="#_timer_export">Timer Export</a>
<ul class="sectlevel5">
<li><a href="#_timer_node_syntax">Timer Node Syntax</a></li>
<li><a href="#_exporting_a_timer">Exporting a Timer</a></li>
<li><a href="#_timer_period">Timer Period</a></li>
</ul>
</li>
<li><a href="#_jmxbuilder_and_events">JmxBuilder and Events</a>
<ul class="sectlevel5">
<li><a href="#_event_handling_closures">Event Handling Closures</a>
<ul class="sectlevel6">
<li><a href="#_parameterless">Parameterless</a></li>
<li><a href="#_with_event_parameter">With Event Parameter</a></li>
</ul>
</li>
<li><a href="#_handling_attribute_onchange_event">Handling Attribute onChange Event</a></li>
<li><a href="#_attribute_onchange_event_object">Attribute onChange Event Object</a></li>
<li><a href="#_handling_operation_oncall_event">Handling Operation onCall Event</a></li>
<li><a href="#_operation_oncall_event_object">Operation onCall Event Object</a></li>
</ul>
</li>
<li><a href="#_listener_mbean">Listener MBean</a>
<ul class="sectlevel5">
<li><a href="#_listening_to_jmx_events">Listening to JMX Events</a></li>
<li><a href="#_listener_node_syntax">Listener Node Syntax</a></li>
</ul>
</li>
<li><a href="#_emitting_jmx_events">Emitting JMX Events</a>
<ul class="sectlevel5">
<li><a href="#_emitter_syntax">Emitter Syntax</a></li>
<li><a href="#_declare_the_emitter">Declare the Emitter</a></li>
<li><a href="#_broadcast_event">Broadcast Event</a></li>
<li><a href="#_sending_event_objects">Sending Event Objects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_further_jmx_information">3.22.9. Further JMX Information</a></li>
</ul>
</li>
<li><a href="#_creating_swing_uis">3.23. Creating Swing UIs</a></li>
<li><a href="#_security">3.24. Security</a></li>
<li><a href="#_design_patterns_in_groovy">3.25. Design patterns in Groovy</a>
<ul class="sectlevel3">
<li><a href="#_patterns">3.25.1. Patterns</a>
<ul class="sectlevel4">
<li><a href="#_abstract_factory_pattern">Abstract Factory Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example">Example</a></li>
</ul>
</li>
<li><a href="#_adapter_pattern">Adapter Pattern</a>
<ul class="sectlevel5">
<li><a href="#_delegation_example">Delegation Example</a></li>
<li><a href="#_inheritance_example">Inheritance Example</a></li>
<li><a href="#_adapting_using_closures">Adapting using Closures</a></li>
<li><a href="#_adapting_using_the_expandometaclass">Adapting using the ExpandoMetaClass</a></li>
</ul>
</li>
<li><a href="#_bouncer_pattern">Bouncer Pattern</a>
<ul class="sectlevel5">
<li><a href="#_null_checking_example">Null Checking Example</a></li>
<li><a href="#_validation_example">Validation Example</a></li>
</ul>
</li>
<li><a href="#_chain_of_responsibility_pattern">Chain of Responsibility Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_using_traditional_classes">Example using traditional classes</a></li>
<li><a href="#_example_using_simplifying_strategies">Example using simplifying strategies</a></li>
<li><a href="#_when_not_to_use">When not to use</a></li>
<li><a href="#_going_further">Going further</a></li>
</ul>
</li>
<li><a href="#_command_pattern">Command Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_with_traditional_classes">Example with traditional classes</a></li>
<li><a href="#_simplifying_variations">Simplifying variations</a></li>
</ul>
</li>
<li><a href="#_composite_pattern">Composite Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_2">Example</a></li>
</ul>
</li>
<li><a href="#_decorator_pattern">Decorator Pattern</a>
<ul class="sectlevel5">
<li><a href="#_traditional_example">Traditional Example</a></li>
<li><a href="#_simplifying_with_closures_or_lambdas">Simplifying with closures or lambdas</a></li>
<li><a href="#_a_touch_of_dynamic_behaviour">A touch of dynamic behaviour</a></li>
<li><a href="#_runtime_behaviour_embellishment">Runtime behaviour embellishment</a></li>
<li><a href="#_more_dynamic_decorating">More dynamic decorating</a></li>
<li><a href="#_decorating_with_an_interceptor">Decorating with an Interceptor</a></li>
<li><a href="#_decorating_with_java_lang_reflect_proxy">Decorating with java.lang.reflect.Proxy</a></li>
<li><a href="#_decorating_with_spring">Decorating with Spring</a></li>
<li><a href="#_asynchronous_decorators_using_gpars">Asynchronous Decorators using GPars</a></li>
</ul>
</li>
<li><a href="#_delegation_pattern">Delegation Pattern</a>
<ul class="sectlevel5">
<li><a href="#_implement_delegation_pattern_using_expandometaclass">Implement Delegation Pattern using ExpandoMetaClass</a></li>
<li><a href="#_implement_delegation_pattern_using_delegate_annotation">Implement Delegation Pattern using @Delegate annotation</a></li>
</ul>
</li>
<li><a href="#_flyweight_pattern">Flyweight Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_3">Example</a></li>
</ul>
</li>
<li><a href="#_iterator_pattern">Iterator Pattern</a></li>
<li><a href="#_loan_my_resource_pattern">Loan my Resource Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_4">Example</a></li>
</ul>
</li>
<li><a href="#_using_monoids">Using Monoids</a>
<ul class="sectlevel5">
<li><a href="#_a_touch_of_formalism">A touch of formalism</a></li>
<li><a href="#_benefits_of_monoids">Benefits of monoids</a></li>
<li><a href="#_working_with_non_monoids">Working with Non-monoids</a></li>
</ul>
</li>
<li><a href="#_null_object_pattern">Null Object Pattern</a>
<ul class="sectlevel5">
<li><a href="#_simple_example">Simple Example</a></li>
<li><a href="#_tree_example">Tree Example</a></li>
</ul>
</li>
<li><a href="#_observer_pattern">Observer Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_5">Example</a></li>
<li><a href="#_bindable_and_vetoable">@Bindable and @Vetoable</a></li>
</ul>
</li>
<li><a href="#_pimp_my_library_pattern">Pimp my Library Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_6">Example</a></li>
</ul>
</li>
<li><a href="#_proxy_pattern">Proxy Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_7">Example</a></li>
</ul>
</li>
<li><a href="#_singleton_pattern">Singleton Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_the_classic_java_singleton">Example: The Classic Java Singleton</a></li>
<li><a href="#_example_singleton_via_metaprogramming">Example: Singleton via MetaProgramming</a></li>
<li><a href="#_guice_example">Guice Example</a></li>
<li><a href="#_spring_example_2">Spring Example</a></li>
<li><a href="#_further_information">Further information</a></li>
</ul>
</li>
<li><a href="#_state_pattern">State Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_8">Example</a></li>
<li><a href="#_variation_1_leveraging_interface_oriented_design">Variation 1: Leveraging Interface-Oriented Design</a></li>
<li><a href="#_variation_2_extract_state_pattern_logic">Variation 2: Extract State Pattern Logic</a></li>
<li><a href="#_variation_3_bring_on_the_dsl">Variation 3: Bring on the DSL</a></li>
</ul>
</li>
<li><a href="#_strategy_pattern">Strategy Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_using_traditional_class_hierarchy">Example using traditional class hierarchy</a></li>
<li><a href="#_example_using_closures">Example using closures</a></li>
<li><a href="#_example_using_lambdas">Example using lambdas</a></li>
</ul>
</li>
<li><a href="#_template_method_pattern">Template Method Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_with_traditional_classes_2">Example with traditional classes</a></li>
<li><a href="#_example_with_simplifying_strategies">Example with simplifying strategies</a></li>
</ul>
</li>
<li><a href="#_visitor_pattern">Visitor Pattern</a>
<ul class="sectlevel5">
<li><a href="#_simple_example_2">Simple Example</a></li>
<li><a href="#_advanced_example">Advanced Example</a>
<ul class="sectlevel6">
<li><a href="#_when_to_use_this">When to use this</a></li>
<li><a href="#_what_happens_if_we_add_a_new_type">What happens if we add a new type?</a></li>
<li><a href="#_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</a></li>
<li><a href="#_make_it_groovy">Make it Groovy</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_further_information_2">Further Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">3.25.2. References</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_acknowledgements">4. Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_contributors">4.1. Contributors</a></li>
<li><a href="#_license">4.2. License</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">Introduction</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Groovy&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is an agile and dynamic language for the Java Virtual Machine</p>
</li>
<li>
<p>builds upon the strengths of Java but has additional power features inspired by languages like Python, Ruby and Smalltalk</p>
</li>
<li>
<p>makes modern programming features available to Java developers with almost-zero learning curve</p>
</li>
<li>
<p>provides the ability to statically type check and statically compile your code for robustness and performance</p>
</li>
<li>
<p>supports Domain-Specific Languages and other compact syntax so your code becomes easy to read and maintain</p>
</li>
<li>
<p>makes writing shell and build scripts easy with its powerful processing primitives, OO abilities and an Ant DSL</p>
</li>
<li>
<p>increases developer productivity by reducing scaffolding code when developing web, GUI, database or console applications</p>
</li>
<li>
<p>simplifies testing by supporting unit testing and mocking out-of-the-box</p>
</li>
<li>
<p>seamlessly integrates with all existing Java classes and libraries</p>
</li>
<li>
<p>compiles straight to Java bytecode so you can use it anywhere you can use Java</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_language_specification"><a class="anchor" href="#_groovy_language_specification"></a><a class="link" href="#_groovy_language_specification">1. Groovy Language Specification</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_syntax"><a class="anchor" href="#_syntax"></a><a class="link" href="#_syntax">1.1. Syntax</a></h3>
<div class="paragraph">
<p>This chapter covers the syntax of the Groovy programming language.
The grammar of the language derives from the Java grammar,
but enhances it with specific constructs for Groovy, and allows certain simplifications.</p>
</div>
<div class="sect3">
<h4 id="_comments"><a class="anchor" href="#_comments"></a><a class="link" href="#_comments">1.1.1. Comments</a></h4>
<div class="sect4">
<h5 id="_single_line_comment"><a class="anchor" href="#_single_line_comment"></a><a class="link" href="#_single_line_comment">Single-line comment</a></h5>
<div class="paragraph">
<p>Single-line comments start with <code>//</code> and can be found at any position in the line.
The characters following <code>//</code>, until the end of the line, are considered part of the comment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// a standalone single line comment
println "hello" // a comment till the end of the line</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiline_comment"><a class="anchor" href="#_multiline_comment"></a><a class="link" href="#_multiline_comment">Multiline comment</a></h5>
<div class="paragraph">
<p>A multiline comment starts with <code>/*</code> and can be found at any position in the line.
The characters following <code>/*</code> will be considered part of the comment, including new line characters,
up to the first <code>*/</code> closing the comment.
Multiline comments can thus be put at the end of a statement, or even inside a statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">/* a standalone multiline comment
   spanning two lines */
println "hello" /* a multiline comment starting
                   at the end of a statement */
println 1 /* one */ + 2 /* two */</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovydoc_comment"><a class="anchor" href="#_groovydoc_comment"></a><a class="link" href="#_groovydoc_comment">Groovydoc comment</a></h5>
<div class="paragraph">
<p>Similarly to multiline comments, Groovydoc comments are multiline, but start with <code>/**</code> and end with <code>*/</code>.
Lines following the first Groovydoc comment line can optionally start with a star <code>*</code>.
Those comments are associated with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type definitions (classes, interfaces, enums, annotations),</p>
</li>
<li>
<p>fields and properties definitions</p>
</li>
<li>
<p>methods definitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although the compiler will not complain about Groovydoc comments not being associated with the above language elements,
you should prepend those constructs with the comment right before it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">/**
 * A Class description
 */
class Person {
    /** the name of the person */
    String name

    /**
     * Creates a greeting method for a certain person.
     *
     * @param otherPerson the person to greet
     * @return a greeting message
     */
    String greet(String otherPerson) {
       "Hello ${otherPerson}"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovydoc follows the same conventions as Java&#8217;s own Javadoc.
So you&#8217;ll be able to use the same tags as with Javadoc.</p>
</div>
<div class="paragraph">
<p>In addition, Groovy supports <strong>Runtime Groovydoc</strong> since 3.0.0, i.e. Groovydoc can be retained at runtime.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Runtime Groovydoc is disabled by default. It can be enabled by adding JVM option <code>-Dgroovy.attach.runtime.groovydoc=true</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Runtime Groovydoc starts with <code>/**@</code> and ends with <code>*/</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">/**@
 * Some class groovydoc for Foo
 */
class Foo {
    /**@
     * Some method groovydoc for bar
     */
    void bar() {
    }
}

assert Foo.class.groovydoc.content.contains('Some class groovydoc for Foo') <i class="conum" data-value="1"></i><b>(1)</b>
assert Foo.class.getMethod('bar', new Class[0]).groovydoc.content.contains('Some method groovydoc for bar') <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the runtime groovydoc for class <code>Foo</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the runtime groovydoc for method <code>bar</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_shebang_line"><a class="anchor" href="#_shebang_line"></a><a class="link" href="#_shebang_line">Shebang line</a></h5>
<div class="paragraph">
<p>Beside the single-line comment, there is a special line comment, often called the <em>shebang</em> line understood by UNIX systems
which allows scripts to be run directly from the command-line, provided you have installed the Groovy distribution
and the <code>groovy</code> command is available on the <code>PATH</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">#!/usr/bin/env groovy
println "Hello from the shebang line"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>#</code> character must be the first character of the file. Any indentation would yield a compilation error.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keywords"><a class="anchor" href="#_keywords"></a><a class="link" href="#_keywords">1.1.2. Keywords</a></h4>
<div class="paragraph">
<p>Groovy has the following reserved keywords:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Reserved Keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abstract</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">break</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">catch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">const</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">continue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">def</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">do</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">else</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">finally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">for</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">goto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">import</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instanceof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">native</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">new</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-sealed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">protected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strictfp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">super</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">switch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronized</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadsafe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">throw</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">throws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">while</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of these, <code>const</code>, <code>goto</code>, <code>strictfp</code>, and <code>threadsafe</code> are not currently in use.</p>
</div>
<div class="paragraph">
<p>The reserved keywords can&#8217;t in general be used for variable, field and method names.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A trick allows methods to be defined having the same name as a keyword
by surrounding the name in quotes as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// reserved keywords can be used for method names if quoted
def "abstract"() { true }
// when calling such methods, the name must be qualified using "this."
this.abstract()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using such names might be confusing and is often best to avoid.
The trick is primarily intended to enable certain Java integration scenarios
and certain <a href="core-domain-specific-languages.html">DSL</a> scenarios where
having "verbs" and "nouns" with the same name as keywords may be desirable.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition, Groovy has the following contextual keywords:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Contextual Keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">permits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">record</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sealed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yields</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These words are only keywords in certain contexts and can be more freely used in some places,
in particular for variables, fields and method names.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>This extra lenience allows using method or variable names that were not keywords in earlier
versions of Groovy or are not keywords in Java. Examples are shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// contextual keywords can be used for field and variable names
def as = true
assert as

// contextual keywords can be used for method names
def in() { true }
// when calling such methods, the name only needs to be qualified using "this." in scenarios which would be ambiguous
this.in()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy programmers familiar with these contextual keywords may still wish to avoid
using those names unless there is a good reason to use such a name.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The restrictions on reserved keywords also apply for the
primitive types, the boolean literals and the null literal (all of which are discussed later):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Other reserved words</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>While not recommended, the same trick as for reserved keywords can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def "null"() { true }  // not recommended; potentially confusing
assert this.null()     // must be qualified</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using such words as method names is potentially confusing and is often best to avoid, however,
it might be useful for certain kinds of <a href="core-domain-specific-languages.html">DSLs</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_identifiers"><a class="anchor" href="#_identifiers"></a><a class="link" href="#_identifiers">1.1.3. Identifiers</a></h4>
<div class="sect4">
<h5 id="_normal_identifiers"><a class="anchor" href="#_normal_identifiers"></a><a class="link" href="#_normal_identifiers">Normal identifiers</a></h5>
<div class="paragraph">
<p>Identifiers start with a letter, a dollar or an underscore.
They cannot start with a number.</p>
</div>
<div class="paragraph">
<p>A letter can be in the following ranges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'a' to 'z' (lowercase ascii letter)</p>
</li>
<li>
<p>'A' to 'Z' (uppercase ascii letter)</p>
</li>
<li>
<p>'\u00C0' to '\u00D6'</p>
</li>
<li>
<p>'\u00D8' to '\u00F6'</p>
</li>
<li>
<p>'\u00F8' to '\u00FF'</p>
</li>
<li>
<p>'\u0100' to '\uFFFE'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then following characters can contain letters and numbers.</p>
</div>
<div class="paragraph">
<p>Here are a few examples of valid identifiers (here, variable names):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def name
def item3
def with_underscore
def $dollarStart</code></pre>
</div>
</div>
<div class="paragraph">
<p>But the following ones are invalid identifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def 3tier
def a+b
def a#b</code></pre>
</div>
</div>
<div class="paragraph">
<p>All keywords are also valid identifiers when following a dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">foo.as
foo.assert
foo.break
foo.case
foo.catch</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_quoted_identifiers"><a class="anchor" href="#_quoted_identifiers"></a><a class="link" href="#_quoted_identifiers">Quoted identifiers</a></h5>
<div class="paragraph">
<p>Quoted identifiers appear after the dot of a dotted expression.
For instance, the <code>name</code> part of the <code>person.name</code> expression can be quoted with <code>person."name"</code> or <code>person.'name'</code>.
This is particularly interesting when certain identifiers contain illegal characters that are forbidden by the Java Language Specification,
but which are allowed by Groovy when quoted. For example, characters like a dash, a space, an exclamation mark, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [:]

map."an identifier with a space and double quotes" = "ALLOWED"
map.'with-dash-signs-and-single-quotes' = "ALLOWED"

assert map."an identifier with a space and double quotes" == "ALLOWED"
assert map.'with-dash-signs-and-single-quotes' == "ALLOWED"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we shall see in the <a href="#all-strings">following section on strings</a>, Groovy provides different string literals.
All kind of strings are actually allowed after the dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">map.'single quote'
map."double quote"
map.'''triple single quote'''
map."""triple double quote"""
map./slashy string/
map.$/dollar slashy string/$</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a difference between plain character strings and Groovy&#8217;s GStrings (interpolated strings),
as in that the latter case, the interpolated values are inserted in the final string for evaluating the whole identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def firstname = "Homer"
map."Simpson-${firstname}" = "Homer Simpson"

assert map.'Simpson-Homer' == "Homer Simpson"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="all-strings"><a class="anchor" href="#all-strings"></a><a class="link" href="#all-strings">1.1.4. Strings</a></h4>
<div class="paragraph">
<p>Text literals are represented in the form of chain of characters called strings.
Groovy lets you instantiate <code>java.lang.String</code> objects, as well as GStrings (<code>groovy.lang.GString</code>)
which are also called <em>interpolated strings</em> in other programming languages.</p>
</div>
<div class="sect4">
<h5 id="_single_quoted_string"><a class="anchor" href="#_single_quoted_string"></a><a class="link" href="#_single_quoted_string">Single-quoted string</a></h5>
<div class="paragraph">
<p>Single-quoted strings are a series of characters surrounded by single quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">'a single-quoted string'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Single-quoted strings are plain <code>java.lang.String</code> and don&#8217;t support interpolation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_string_concatenation"><a class="anchor" href="#_string_concatenation"></a><a class="link" href="#_string_concatenation">String concatenation</a></h5>
<div class="paragraph">
<p>All the Groovy strings can be concatenated with the <code>+</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'ab' == 'a' + 'b'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_single_quoted_string"><a class="anchor" href="#_triple_single_quoted_string"></a><a class="link" href="#_triple_single_quoted_string">Triple-single-quoted string</a></h5>
<div class="paragraph">
<p>Triple-single-quoted strings are a series of characters surrounded by triplets of single quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">'''a triple-single-quoted string'''</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Triple-single-quoted strings are plain <code>java.lang.String</code> and don&#8217;t support interpolation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Triple-single-quoted strings may span multiple lines.
The content of the string can cross line boundaries without the need to split the string in several pieces
and without concatenation or newline escape characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def aMultilineString = '''line one
line two
line three'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your code is indented, for example in the body of the method of a class, your string will contain the whitespace of the indentation.
The Groovy Development Kit contains methods for stripping out the indentation with the <code>String#stripIndent()</code> method,
and with the <code>String#stripMargin()</code> method that takes a delimiter character to identify the text to remove from the beginning of a string.</p>
</div>
<div class="paragraph">
<p>When creating a string as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def startingAndEndingWithANewline = '''
line one
line two
line three
'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will notice that the resulting string contains a newline character as first character.
It is possible to strip that character by escaping the newline with a backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def strippedFirstNewline = '''\
line one
line two
line three
'''

assert !strippedFirstNewline.startsWith('\n')</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_escaping_special_characters"><a class="anchor" href="#_escaping_special_characters"></a><a class="link" href="#_escaping_special_characters">Escaping special characters</a></h6>
<div class="paragraph">
<p>You can escape single quotes with the backslash character to avoid terminating the string literal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">'an escaped single quote: \' needs a backslash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can escape the escape character itself with a double backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">'an escaped escape character: \\ needs a double backslash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some special characters also use the backslash as escape character:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Escape sequence</th>
<th class="tableblock halign-left valign-top">Character</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">formfeed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carriage return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single space</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tabulation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backslash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single quote within a single-quoted string (and optional for triple-single-quoted and double-quoted strings)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double quote within a double-quoted string (and optional for triple-double-quoted and single-quoted strings)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We&#8217;ll see some more escaping details when it comes to other types of strings discussed later.</p>
</div>
</div>
<div class="sect5">
<h6 id="_unicode_escape_sequence"><a class="anchor" href="#_unicode_escape_sequence"></a><a class="link" href="#_unicode_escape_sequence">Unicode escape sequence</a></h6>
<div class="paragraph">
<p>For characters that are not present on your keyboard, you can use unicode escape sequences:
a backslash, followed by 'u', then 4 hexadecimal digits.</p>
</div>
<div class="paragraph">
<p>For example, the Euro currency symbol can be represented with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">'The Euro currency symbol: \u20AC'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_double_quoted_string"><a class="anchor" href="#_double_quoted_string"></a><a class="link" href="#_double_quoted_string">Double-quoted string</a></h5>
<div class="paragraph">
<p>Double-quoted strings are a series of characters surrounded by double quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">"a double-quoted string"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Double-quoted strings are plain <code>java.lang.String</code> if there&#8217;s no interpolated expression,
but are <code>groovy.lang.GString</code> instances if interpolation is present.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To escape a double quote, you can use the backslash character: "A double quote: \"".
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_string_interpolation"><a class="anchor" href="#_string_interpolation"></a><a class="link" href="#_string_interpolation">String interpolation</a></h6>
<div class="paragraph">
<p>Any Groovy expression can be interpolated in all string literals, apart from single and triple-single-quoted strings.
Interpolation is the act of replacing a placeholder in the string with its value upon evaluation of the string.
The placeholder expressions are surrounded by <code>${}</code>. The curly braces may be omitted for unambiguous dotted expressions,
i.e. we can use just a $ prefix in those cases.
If the GString is ever passed to a method taking a String, the expression value inside the placeholder
is evaluated to its string representation (by calling <code>toString()</code> on that expression) and the resulting
String is passed to the method.</p>
</div>
<div class="paragraph">
<p>Here, we have a string with a placeholder referencing a local variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def name = 'Guillaume' // a plain string
def greeting = "Hello ${name}"

assert greeting.toString() == 'Hello Guillaume'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any Groovy expression is valid, as we can see in this example with an arithmetic expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sum = "The sum of 2 and 3 equals ${2 + 3}"
assert sum.toString() == 'The sum of 2 and 3 equals 5'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not only are expressions allowed in between the <code>${}</code> placeholder, but so are statements. However, a statement&#8217;s value is just <code>null</code>.
So if several statements are inserted in that placeholder, the last one should somehow return a meaningful value to be inserted.
For instance, "The sum of 1 and 2 is equal to ${def a = 1; def b = 2; a + b}" is supported and works as expected but a good practice is usually to stick to simple expressions inside GString placeholders.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to <code>${}</code> placeholders, we can also use a lone <code>$</code> sign prefixing a dotted expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def person = [name: 'Guillaume', age: 36]
assert "$person.name is $person.age years old" == 'Guillaume is 36 years old'</code></pre>
</div>
</div>
<div class="paragraph">
<p>But only dotted expressions of the form <code>a.b</code>, <code>a.b.c</code>, etc, are valid. Expressions containing parentheses like method calls,
curly braces for closures, dots which aren&#8217;t part of a property expression or arithmetic operators would be invalid.
Given the following variable definition of a number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def number = 3.14</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following statement will throw a <code>groovy.lang.MissingPropertyException</code> because Groovy believes you&#8217;re trying to access the <code>toString</code> property of that number, which doesn&#8217;t exist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">shouldFail(MissingPropertyException) {
    println "$number.toString()"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can think of <code>"$number.toString()"</code> as being interpreted by the parser as <code>"${number.toString}()"</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly, if the expression is ambiguous, you need to keep the curly braces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String thing = 'treasure'
assert 'The x-coordinate of the treasure is represented by treasure.x' ==
    "The x-coordinate of the $thing is represented by $thing.x"   // &lt;= Not allowed: ambiguous!!
assert 'The x-coordinate of the treasure is represented by treasure.x' ==
        "The x-coordinate of the $thing is represented by ${thing}.x"  // &lt;= Curly braces required</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to escape the <code>$</code> or <code>${}</code> placeholders in a GString so they appear as is without interpolation,
you just need to use a <code>\</code> backslash character to escape the dollar sign:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert '$5' == "\$5"
assert '${name}' == "\${name}"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_special_case_of_interpolating_closure_expressions"><a class="anchor" href="#_special_case_of_interpolating_closure_expressions"></a><a class="link" href="#_special_case_of_interpolating_closure_expressions">Special case of interpolating closure expressions</a></h6>
<div class="paragraph">
<p>So far, we&#8217;ve seen we could interpolate arbitrary expressions inside the <code>${}</code> placeholder, but there is a special case and notation for closure expressions. When the placeholder contains an arrow, <code>${&#8594;}</code>, the expression is actually a closure expression&#8201;&#8212;&#8201;you can think of it as a closure with a dollar prepended in front of it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sParameterLessClosure = "1 + 2 == ${-&gt; 3}" <i class="conum" data-value="1"></i><b>(1)</b>
assert sParameterLessClosure == '1 + 2 == 3'

def sOneParamClosure = "1 + 2 == ${ w -&gt; w &lt;&lt; 3}" <i class="conum" data-value="2"></i><b>(2)</b>
assert sOneParamClosure == '1 + 2 == 3'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The closure is a parameterless closure which doesn&#8217;t take arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here, the closure takes a single <code>java.io.StringWriter</code> argument, to which you can append content  with the <code>&lt;&lt;</code> leftShift operator.
In either case, both placeholders are embedded closures.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In appearance, it looks like a more verbose way of defining expressions to be interpolated,
but closures have an interesting advantage over mere expressions: lazy evaluation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def number = 1 <i class="conum" data-value="1"></i><b>(1)</b>
def eagerGString = "value == ${number}"
def lazyGString = "value == ${ -&gt; number }"

assert eagerGString == "value == 1" <i class="conum" data-value="2"></i><b>(2)</b>
assert lazyGString ==  "value == 1" <i class="conum" data-value="3"></i><b>(3)</b>

number = 2 <i class="conum" data-value="4"></i><b>(4)</b>
assert eagerGString == "value == 1" <i class="conum" data-value="5"></i><b>(5)</b>
assert lazyGString ==  "value == 2" <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a <code>number</code> variable containing <code>1</code> that we then interpolate within two GStrings,
as an expression in <code>eagerGString</code> and as a closure in <code>lazyGString</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We expect the resulting string to contain the same string value of 1 for <code>eagerGString</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Similarly for <code>lazyGString</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then we change the value of the variable to a new number</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>With a plain interpolated expression, the value was actually bound at the time of creation of the GString.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>But with a closure expression, the closure is called upon each coercion of the GString into String,
resulting in an updated string containing the new number value.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An embedded closure expression taking more than one parameter will generate an exception at runtime.
Only closures with zero or one parameter are allowed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_interoperability_with_java"><a class="anchor" href="#_interoperability_with_java"></a><a class="link" href="#_interoperability_with_java">Interoperability with Java</a></h6>
<div class="paragraph">
<p>When a method (whether implemented in Java or Groovy) expects a <code>java.lang.String</code>,
but we pass a <code>groovy.lang.GString</code> instance,
the <code>toString()</code> method of the GString is automatically and transparently called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String takeString(String message) {         <i class="conum" data-value="4"></i><b>(4)</b>
    assert message instanceof String        <i class="conum" data-value="5"></i><b>(5)</b>
    return message
}

def message = "The message is ${'hello'}"   <i class="conum" data-value="1"></i><b>(1)</b>
assert message instanceof GString           <i class="conum" data-value="2"></i><b>(2)</b>

def result = takeString(message)            <i class="conum" data-value="3"></i><b>(3)</b>
assert result instanceof String
assert result == 'The message is hello'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create a GString variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We double-check it&#8217;s an instance of the GString</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We then pass that GString to a method taking a String as parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The signature of the <code>takeString()</code> method explicitly says its sole parameter is a String</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We also verify that the parameter is indeed a String and not a GString.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_gstring_and_string_hashcodes"><a class="anchor" href="#_gstring_and_string_hashcodes"></a><a class="link" href="#_gstring_and_string_hashcodes">GString and String hashCodes</a></h6>
<div class="paragraph">
<p>Although interpolated strings can be used in lieu of plain Java strings,
they differ with strings in a particular way: their hashCodes are different.
Plain Java strings are immutable, whereas the resulting String representation of a GString can vary,
depending on its interpolated values.
Even for the same resulting string, GStrings and Strings don&#8217;t have the same hashCode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert "one: ${1}".hashCode() != "one: 1".hashCode()</code></pre>
</div>
</div>
<div class="paragraph">
<p>GString and Strings having different hashCode values, using GString as Map keys should be avoided,
especially if we try to retrieve an associated value with a String instead of a GString.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def key = "a"
def m = ["${key}": "letter ${key}"]     <i class="conum" data-value="1"></i><b>(1)</b>

assert m["a"] == null                   <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The map is created with an initial pair whose key is a GString</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When we try to fetch the value with a String key, we will not find it, as Strings and GString have different hashCode values</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_double_quoted_string"><a class="anchor" href="#_triple_double_quoted_string"></a><a class="link" href="#_triple_double_quoted_string">Triple-double-quoted string</a></h5>
<div class="paragraph">
<p>Triple-double-quoted strings behave like double-quoted strings, with the addition that they are multiline, like the triple-single-quoted strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def name = 'Groovy'
def template = """
    Dear Mr ${name},

    You're the winner of the lottery!

    Yours sincerly,

    Dave
"""

assert template.toString().contains('Groovy')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Neither double quotes nor single quotes need be escaped in triple-double-quoted strings.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_slashy_string"><a class="anchor" href="#_slashy_string"></a><a class="link" href="#_slashy_string">Slashy string</a></h5>
<div class="paragraph">
<p>Beyond the usual quoted strings, Groovy offers slashy strings, which use <code>/</code> as the opening and closing delimiter.
Slashy strings are particularly useful for defining regular expressions and patterns,
as there is no need to escape backslashes.</p>
</div>
<div class="paragraph">
<p>Example of a slashy string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def fooPattern = /.*foo.*/
assert fooPattern == '.*foo.*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only forward slashes need to be escaped with a backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def escapeSlash = /The character \/ is a forward slash/
assert escapeSlash == 'The character / is a forward slash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Slashy strings are multiline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def multilineSlashy = /one
    two
    three/

assert multilineSlashy.contains('\n')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Slashy strings can be thought of as just another way to define a GString but with different escaping rules. They hence support interpolation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def color = 'blue'
def interpolatedSlashy = /a ${color} car/

assert interpolatedSlashy == 'a blue car'</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_special_cases"><a class="anchor" href="#_special_cases"></a><a class="link" href="#_special_cases">Special cases</a></h6>
<div class="paragraph">
<p>An empty slashy string cannot be represented with a double forward slash, as it&#8217;s understood by the Groovy parser as a line comment.
That&#8217;s why the following assert would actually not compile as it would look like a non-terminated statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert '' == //</code></pre>
</div>
</div>
<div class="paragraph">
<p>As slashy strings were mostly designed to make regexp easier so a few things that
are errors in GStrings like <code>$()</code> or <code>$5</code> will work with slashy strings.</p>
</div>
<div class="paragraph">
<p>Remember that escaping backslashes is not required. An alternative way of thinking of this is
that in fact escaping is not supported. The slashy string <code>/\t/</code> won&#8217;t contain a tab but instead
a backslash followed by the character 't'. Escaping is only allowed for the slash character, i.e. <code>/\/folder/</code>
will be a slashy string containing <code>'/folder'</code>. A consequence of slash escaping is that a slashy string
can&#8217;t end with a backslash. Otherwise that will escape the slashy string terminator.
You can instead use a special trick, <code>/ends with slash ${'\'}/</code>. But best just avoid using a slashy string in such a case.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dollar_slashy_string"><a class="anchor" href="#_dollar_slashy_string"></a><a class="link" href="#_dollar_slashy_string">Dollar slashy string</a></h5>
<div class="paragraph">
<p>Dollar slashy strings are multiline GStrings delimited with an opening <code>$/</code> and a closing <code>/$</code>.
The escaping character is the dollar sign, and it can escape another dollar, or a forward slash.
Escaping for the dollar and forward slash characters is only needed where conflicts arise with
the special use of those characters. The characters <code>$foo</code> would normally indicate a GString
placeholder, so those four characters can be entered into a dollar slashy string by escaping the dollar, i.e. <code>$$foo</code>.
Similarly, you will need to escape a dollar slashy closing delimiter if you want it to appear in your string.</p>
</div>
<div class="paragraph">
<p>Here are a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def name = "Guillaume"
def date = "April, 1st"

def dollarSlashy = $/
    Hello $name,
    today we're ${date}.

    $ dollar sign
    $$ escaped dollar sign
    \ backslash
    / forward slash
    $/ escaped forward slash
    $$$/ escaped opening dollar slashy
    $/$$ escaped closing dollar slashy
/$

assert [
    'Guillaume',
    'April, 1st',
    '$ dollar sign',
    '$ escaped dollar sign',
    '\\ backslash',
    '/ forward slash',
    '/ escaped forward slash',
    '$/ escaped opening dollar slashy',
    '/$ escaped closing dollar slashy'
].every { dollarSlashy.contains(it) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It was created to overcome some of the limitations of the slashy string escaping rules.
Use it when its escaping rules suit your string contents (typically if it has some slashes you don&#8217;t want to escape).</p>
</div>
</div>
<div class="sect4">
<h5 id="_string_summary_table"><a class="anchor" href="#_string_summary_table"></a><a class="link" href="#_string_summary_table">String summary table</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpolated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single-quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'&#8230;&#8203;'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple-single-quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'''&#8230;&#8203;'''</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double-quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"&#8230;&#8203;"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple-double-quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"""&#8230;&#8203;"""</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slashy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/&#8230;&#8203;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dollar slashy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$/&#8230;&#8203;/$</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_characters"><a class="anchor" href="#_characters"></a><a class="link" href="#_characters">Characters</a></h5>
<div class="paragraph">
<p>Unlike Java, Groovy doesn&#8217;t have an explicit character literal.
However, you can be explicit about making a Groovy string an actual character, by three different means:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">char c1 = 'A' <i class="conum" data-value="1"></i><b>(1)</b>
assert c1 instanceof Character

def c2 = 'B' as char <i class="conum" data-value="2"></i><b>(2)</b>
assert c2 instanceof Character

def c3 = (char)'C' <i class="conum" data-value="3"></i><b>(3)</b>
assert c3 instanceof Character</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>by being explicit when declaring a variable holding the character by specifying the <code>char</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>by using type coercion with the <code>as</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>by using a cast to char operation</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first option <em class="conum">1</em> is interesting when the character is held in a variable,
while the other two (<em class="conum">2</em> and <em class="conum">3</em>) are more interesting when a char value must be passed as argument of a method call.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numbers"><a class="anchor" href="#_numbers"></a><a class="link" href="#_numbers">1.1.5. Numbers</a></h4>
<div class="paragraph">
<p>Groovy supports different kinds of integral literals and decimal literals, backed by the usual <code>Number</code> types of Java.</p>
</div>
<div class="sect4">
<h5 id="_integral_literals"><a class="anchor" href="#_integral_literals"></a><a class="link" href="#_integral_literals">Integral literals</a></h5>
<div class="paragraph">
<p>The integral literal types are the same as in Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>byte</code></p>
</li>
<li>
<p><code>char</code></p>
</li>
<li>
<p><code>short</code></p>
</li>
<li>
<p><code>int</code></p>
</li>
<li>
<p><code>long</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create integral numbers of those types with the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// primitive types
byte  b = 1
char  c = 2
short s = 3
int   i = 4
long  l = 5

// infinite precision
BigInteger bi =  6</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use optional typing by using the <code>def</code> keyword, the type of the integral number will vary:
it&#8217;ll adapt to the capacity of the type that can hold that number.</p>
</div>
<div class="paragraph">
<p>For positive numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def a = 1
assert a instanceof Integer

// Integer.MAX_VALUE
def b = 2147483647
assert b instanceof Integer

// Integer.MAX_VALUE + 1
def c = 2147483648
assert c instanceof Long

// Long.MAX_VALUE
def d = 9223372036854775807
assert d instanceof Long

// Long.MAX_VALUE + 1
def e = 9223372036854775808
assert e instanceof BigInteger</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as for negative numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def na = -1
assert na instanceof Integer

// Integer.MIN_VALUE
def nb = -2147483648
assert nb instanceof Integer

// Integer.MIN_VALUE - 1
def nc = -2147483649
assert nc instanceof Long

// Long.MIN_VALUE
def nd = -9223372036854775808
assert nd instanceof Long

// Long.MIN_VALUE - 1
def ne = -9223372036854775809
assert ne instanceof BigInteger</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_non_base_10_representations"><a class="anchor" href="#_alternative_non_base_10_representations"></a><a class="link" href="#_alternative_non_base_10_representations">Alternative non-base 10 representations</a></h6>
<div class="paragraph">
<p>Numbers can also be represented in binary, octal, hexadecimal and decimal bases.</p>
</div>
<div class="sect6">
<h7 id="_binary_literal"><a class="anchor" href="#_binary_literal"></a><a class="link" href="#_binary_literal">Binary literal</a></h7>
<div class="paragraph">
<p>Binary numbers start with a <code>0b</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int xInt = 0b10101111
assert xInt == 175

short xShort = 0b11001001
assert xShort == 201 as short

byte xByte = 0b11
assert xByte == 3 as byte

long xLong = 0b101101101101
assert xLong == 2925l

BigInteger xBigInteger = 0b111100100001
assert xBigInteger == 3873g

int xNegativeInt = -0b10101111
assert xNegativeInt == -175</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_octal_literal"><a class="anchor" href="#_octal_literal"></a><a class="link" href="#_octal_literal">Octal literal</a></h7>
<div class="paragraph">
<p>Octal numbers are specified in the typical format of <code>0</code> followed by octal digits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int xInt = 077
assert xInt == 63

short xShort = 011
assert xShort == 9 as short

byte xByte = 032
assert xByte == 26 as byte

long xLong = 0246
assert xLong == 166l

BigInteger xBigInteger = 01111
assert xBigInteger == 585g

int xNegativeInt = -077
assert xNegativeInt == -63</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_hexadecimal_literal"><a class="anchor" href="#_hexadecimal_literal"></a><a class="link" href="#_hexadecimal_literal">Hexadecimal literal</a></h7>
<div class="paragraph">
<p>Hexadecimal numbers are specified in the typical format of <code>0x</code> followed by hex digits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int xInt = 0x77
assert xInt == 119

short xShort = 0xaa
assert xShort == 170 as short

byte xByte = 0x3a
assert xByte == 58 as byte

long xLong = 0xffff
assert xLong == 65535l

BigInteger xBigInteger = 0xaaaa
assert xBigInteger == 43690g

Double xDouble = new Double('0x1.0p0')
assert xDouble == 1.0d

int xNegativeInt = -0x77
assert xNegativeInt == -119</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decimal_literals"><a class="anchor" href="#_decimal_literals"></a><a class="link" href="#_decimal_literals">Decimal literals</a></h5>
<div class="paragraph">
<p>The decimal literal types are the same as in Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>float</code></p>
</li>
<li>
<p><code>double</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create decimal numbers of those types with the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// primitive types
float  f = 1.234
double d = 2.345

// infinite precision
BigDecimal bd =  3.456</code></pre>
</div>
</div>
<div class="paragraph">
<p>Decimals can use exponents, with the <code>e</code> or <code>E</code> exponent letter, followed by an optional sign,
and an integral number representing the exponent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 1e3  ==  1_000.0
assert 2E4  == 20_000.0
assert 3e+1 ==     30.0
assert 4E-2 ==      0.04
assert 5e-1 ==      0.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conveniently for exact decimal number calculations, Groovy chooses <code>java.math.BigDecimal</code> as its decimal number type.
In addition, both <code>float</code> and <code>double</code> are supported, but require an explicit type declaration, type coercion or suffix.
Even if <code>BigDecimal</code> is the default for decimal numbers, such literals are accepted in methods or closures taking <code>float</code> or <code>double</code> as parameter types.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Decimal numbers can&#8217;t be represented using a binary, octal or hexadecimal representation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_underscore_in_literals"><a class="anchor" href="#_underscore_in_literals"></a><a class="link" href="#_underscore_in_literals">Underscore in literals</a></h5>
<div class="paragraph">
<p>When writing long literal numbers, it’s harder on the eye to figure out how some numbers are grouped together, for example with groups of thousands, of words, etc. By allowing you to place underscore in number literals, it’s easier to spot those groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">long creditCardNumber = 1234_5678_9012_3456L
long socialSecurityNumbers = 999_99_9999L
double monetaryAmount = 12_345_132.12
long hexBytes = 0xFF_EC_DE_5E
long hexWords = 0xFFEC_DE5E
long maxLong = 0x7fff_ffff_ffff_ffffL
long alsoMaxLong = 9_223_372_036_854_775_807L
long bytes = 0b11010010_01101001_10010100_10010010</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_number_type_suffixes"><a class="anchor" href="#_number_type_suffixes"></a><a class="link" href="#_number_type_suffixes">Number type suffixes</a></h5>
<div class="paragraph">
<p>We can force a number (including binary, octals and hexadecimals) to have a specific type by giving a suffix (see table below), either uppercase or lowercase.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Suffix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>L</code> or <code>l</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>I</code> or <code>i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D</code> or <code>d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>F</code> or <code>f</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 42I == Integer.valueOf('42')
assert 42i == Integer.valueOf('42') // lowercase i more readable
assert 123L == Long.valueOf("123") // uppercase L more readable
assert 2147483648 == Long.valueOf('2147483648') // Long type used, value too large for an Integer
assert 456G == new BigInteger('456')
assert 456g == new BigInteger('456')
assert 123.45 == new BigDecimal('123.45') // default BigDecimal type used
assert .321 == new BigDecimal('.321')
assert 1.200065D == Double.valueOf('1.200065')
assert 1.234F == Float.valueOf('1.234')
assert 1.23E23D == Double.valueOf('1.23E23')
assert 0b1111L.class == Long // binary
assert 0xFFi.class == Integer // hexadecimal
assert 034G.class == BigInteger // octal</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_math_operations"><a class="anchor" href="#_math_operations"></a><a class="link" href="#_math_operations">Math operations</a></h5>
<div class="paragraph">
<p>Although <a href="#groovy-operators">operators</a> are covered in more detail elsewhere, it&#8217;s important to discuss the behavior of math operations
and what their resulting types are.</p>
</div>
<div class="paragraph">
<p>Division and power binary operations aside (covered below),</p>
</div>
<div class="ulist">
<ul>
<li>
<p>binary operations between <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>int</code></p>
</li>
<li>
<p>binary operations involving <code>long</code> with <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>long</code></p>
</li>
<li>
<p>binary operations involving <code>BigInteger</code> and any other integral type result in <code>BigInteger</code></p>
</li>
<li>
<p>binary operations involving <code>BigDecimal</code> with <code>byte</code>, <code>char</code>, <code>short</code>, <code>int</code> and <code>BigInteger</code> result in <code>BigDecimal</code></p>
</li>
<li>
<p>binary operations between <code>float</code>, <code>double</code> and <code>BigDecimal</code> result in <code>double</code></p>
</li>
<li>
<p>binary operations between two <code>BigDecimal</code> result in <code>BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table summarizes those rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">byte</th>
<th class="tableblock halign-left valign-top">char</th>
<th class="tableblock halign-left valign-top">short</th>
<th class="tableblock halign-left valign-top">int</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">BigInteger</th>
<th class="tableblock halign-left valign-top">float</th>
<th class="tableblock halign-left valign-top">double</th>
<th class="tableblock halign-left valign-top">BigDecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigInteger</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigDecimal</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Thanks to Groovy&#8217;s operator overloading, the usual arithmetic operators work as well with <code>BigInteger</code> and <code>BigDecimal</code>,
unlike in Java where you have to use explicit methods for operating on those numbers.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="integer_division"><a class="anchor" href="#integer_division"></a><a class="link" href="#integer_division">The case of the division operator</a></h6>
<div class="paragraph">
<p>The division operators <code>/</code> (and <code>/=</code> for division and assignment) produce a <code>double</code> result
if either operand is a <code>float</code> or <code>double</code>, and a <code>BigDecimal</code> result otherwise
(when both operands are any combination of an integral type <code>short</code>, <code>char</code>, <code>byte</code>, <code>int</code>, <code>long</code>,
<code>BigInteger</code> or <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p><code>BigDecimal</code> division is performed with the <code>divide()</code> method if the division is exact
(i.e. yielding a result that can be represented within the bounds of the same precision and scale),
or using a <code>MathContext</code> with a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#precision()">precision</a>
of the maximum of the two operands' precision plus an extra precision of 10,
and a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#scale()">scale</a>
of the maximum of 10 and the maximum of the operands' scale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For integer division like in Java, you should use the <code>intdiv()</code> method,
as Groovy doesn&#8217;t provide a dedicated integer division operator symbol.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="power_operator"><a class="anchor" href="#power_operator"></a><a class="link" href="#power_operator">The case of the power operator</a></h6>
<div class="paragraph">
<p>The power operation is represented by the <code>**</code> operator, with two parameters: the base and the exponent.
The result of the power operation depends on its operands, and the result of the operation
(in particular if the result can be represented as an integral value).</p>
</div>
<div class="paragraph">
<p>The following rules are used by Groovy&#8217;s power operation to determine the resulting type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the exponent is a decimal value</p>
<div class="ulist">
<ul>
<li>
<p>if the result can be represented as an <code>Integer</code>, then return an <code>Integer</code></p>
</li>
<li>
<p>else if the result can be represented as a <code>Long</code>, then return a <code>Long</code></p>
</li>
<li>
<p>otherwise return a <code>Double</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If the exponent is an integral value</p>
<div class="ulist">
<ul>
<li>
<p>if the exponent is strictly negative, then return an <code>Integer</code>, <code>Long</code> or <code>Double</code> if the result value fits in that type</p>
</li>
<li>
<p>if the exponent is positive or zero</p>
<div class="ulist">
<ul>
<li>
<p>if the base is a <code>BigDecimal</code>, then return a <code>BigDecimal</code> result value</p>
</li>
<li>
<p>if the base is a <code>BigInteger</code>, then return a <code>BigInteger</code> result value</p>
</li>
<li>
<p>if the base is an <code>Integer</code>, then return an <code>Integer</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
<li>
<p>if the base is a <code>Long</code>, then return a <code>Long</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can illustrate those rules with a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// base and exponent are ints and the result can be represented by an Integer
assert    2    **   3    instanceof Integer    //  8
assert   10    **   9    instanceof Integer    //  1_000_000_000

// the base is a long, so fit the result in a Long
// (although it could have fit in an Integer)
assert    5L   **   2    instanceof Long       //  25

// the result can't be represented as an Integer or Long, so return a BigInteger
assert  100    **  10    instanceof BigInteger //  10e20
assert 1234    ** 123    instanceof BigInteger //  170515806212727042875...

// the base is a BigDecimal and the exponent a negative int
// but the result can be represented as an Integer
assert    0.5  **  -2    instanceof Integer    //  4

// the base is an int, and the exponent a negative float
// but again, the result can be represented as an Integer
assert    1    **  -0.3f instanceof Integer    //  1

// the base is an int, and the exponent a negative int
// but the result will be calculated as a Double
// (both base and exponent are actually converted to doubles)
assert   10    **  -1    instanceof Double     //  0.1

// the base is a BigDecimal, and the exponent is an int, so return a BigDecimal
assert    1.2  **  10    instanceof BigDecimal //  6.1917364224

// the base is a float or double, and the exponent is an int
// but the result can only be represented as a Double value
assert    3.4f **   5    instanceof Double     //  454.35430372146965
assert    5.6d **   2    instanceof Double     //  31.359999999999996

// the exponent is a decimal value
// and the result can only be represented as a Double value
assert    7.8  **   1.9  instanceof Double     //  49.542708423868476
assert    2    **   0.1f instanceof Double     //  1.0717734636432956</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_booleans"><a class="anchor" href="#_booleans"></a><a class="link" href="#_booleans">1.1.6. Booleans</a></h4>
<div class="paragraph">
<p>Boolean is a special data type that is used to represent truth values: <code>true</code> and <code>false</code>.
Use this data type for simple flags that track true/false <a href="#_conditional_operators">conditions</a>.</p>
</div>
<div class="paragraph">
<p>Boolean values can be stored in variables, assigned into fields, just like any other data type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def myBooleanVariable = true
boolean untypedBooleanVar = false
booleanField = true</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>true</code> and <code>false</code> are the only two primitive boolean values.
But more complex boolean expressions can be represented using <a href="#_logical_operators">logical operators</a>.</p>
</div>
<div class="paragraph">
<p>In addition, Groovy has <a href="#the-groovy-truth">special rules</a> (often referred to as <em>Groovy Truth</em>)
for coercing non-boolean objects to a boolean value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lists"><a class="anchor" href="#_lists"></a><a class="link" href="#_lists">1.1.7. Lists</a></h4>
<div class="paragraph">
<p>Groovy uses a comma-separated list of values, surrounded by square brackets, to denote lists.
Groovy lists are plain JDK <code>java.util.List</code>, as Groovy doesn&#8217;t define its own collection classes.
The concrete list implementation used when defining list literals are <code>java.util.ArrayList</code> by default,
unless you decide to specify otherwise, as we shall see later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def numbers = [1, 2, 3]         <i class="conum" data-value="1"></i><b>(1)</b>

assert numbers instanceof List  <i class="conum" data-value="2"></i><b>(2)</b>
assert numbers.size() == 3      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a list numbers delimited by commas and surrounded by square brackets, and we assign that list into a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The list is an instance of Java&#8217;s <code>java.util.List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The size of the list can be queried with the <code>size()</code> method, and shows our list contains 3 elements</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example, we used a homogeneous list, but you can also create lists containing values of heterogeneous types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def heterogeneous = [1, "a", true]  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our list here contains a number, a string and a boolean value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We mentioned that by default, list literals are actually instances of <code>java.util.ArrayList</code>,
but it is possible to use a different backing type for our lists,
thanks to using type coercion with the <code>as</code> operator, or with explicit type declaration for your variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def arrayList = [1, 2, 3]
assert arrayList instanceof java.util.ArrayList

def linkedList = [2, 3, 4] as LinkedList    <i class="conum" data-value="1"></i><b>(1)</b>
assert linkedList instanceof java.util.LinkedList

LinkedList otherLinked = [3, 4, 5]          <i class="conum" data-value="2"></i><b>(2)</b>
assert otherLinked instanceof java.util.LinkedList</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use coercion with the <code>as</code> operator to explicitly request a <code>java.util.LinkedList</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We can say that the variable holding the list literal is of type <code>java.util.LinkedList</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can access elements of the list with the <code>[]</code> subscript operator (both for reading and setting values)
with positive indices or negative indices to access elements from the end of the list, as well as with ranges,
and use the <code>&lt;&lt;</code> leftShift operator to append elements to a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def letters = ['a', 'b', 'c', 'd']

assert letters[0] == 'a'     <i class="conum" data-value="1"></i><b>(1)</b>
assert letters[1] == 'b'

assert letters[-1] == 'd'    <i class="conum" data-value="2"></i><b>(2)</b>
assert letters[-2] == 'c'

letters[2] = 'C'             <i class="conum" data-value="3"></i><b>(3)</b>
assert letters[2] == 'C'

letters &lt;&lt; 'e'               <i class="conum" data-value="4"></i><b>(4)</b>
assert letters[ 4] == 'e'
assert letters[-1] == 'e'

assert letters[1, 3] == ['b', 'd']         <i class="conum" data-value="5"></i><b>(5)</b>
assert letters[2..4] == ['C', 'd', 'e']    <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access the first element of the list (zero-based counting)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the last element of the list with a negative index: -1 is the first element from the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use an assignment to set a new value for the third element of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the <code>&lt;&lt;</code> leftShift operator to append an element at the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Access two elements at once, returning a new list containing those two elements</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use a range to access a range of values from the list, from a start to an end element position</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As lists can be heterogeneous in nature, lists can also contain other lists to create multidimensional lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def multi = [[0, 1], [2, 3]]     <i class="conum" data-value="1"></i><b>(1)</b>
assert multi[1][0] == 2          <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a list of numbers</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the second element of the top-most list, and the first element of the inner list</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_arrays"><a class="anchor" href="#_arrays"></a><a class="link" href="#_arrays">1.1.8. Arrays</a></h4>
<div class="paragraph">
<p>Groovy reuses the list notation for arrays, but to make such literals arrays,
you need to explicitly define the type of the array through coercion or type declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String[] arrStr = ['Ananas', 'Banana', 'Kiwi']  <i class="conum" data-value="1"></i><b>(1)</b>

assert arrStr instanceof String[]    <i class="conum" data-value="2"></i><b>(2)</b>
assert !(arrStr instanceof List)

def numArr = [1, 2, 3] as int[]      <i class="conum" data-value="3"></i><b>(3)</b>

assert numArr instanceof int[]       <i class="conum" data-value="4"></i><b>(4)</b>
assert numArr.size() == 3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define an array of strings using explicit variable type declaration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assert that we created an array of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an array of ints with the <code>as</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert that we created an array of primitive ints</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also create multi-dimensional arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def matrix3 = new Integer[3][3]         <i class="conum" data-value="1"></i><b>(1)</b>
assert matrix3.size() == 3

Integer[][] matrix2                     <i class="conum" data-value="2"></i><b>(2)</b>
matrix2 = [[1, 2], [3, 4]]
assert matrix2 instanceof Integer[][]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define the bounds of a new array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Or declare an array without specifying its bounds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Access to elements of an array follows the same notation as for lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String[] names = ['Cédric', 'Guillaume', 'Jochen', 'Paul']
assert names[0] == 'Cédric'     <i class="conum" data-value="1"></i><b>(1)</b>

names[2] = 'Blackdrag'          <i class="conum" data-value="2"></i><b>(2)</b>
assert names[2] == 'Blackdrag'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Retrieve the first element of the array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the value of the third element of the array to a new value</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_java_style_array_initialization"><a class="anchor" href="#_java_style_array_initialization"></a><a class="link" href="#_java_style_array_initialization">Java-style array initialization</a></h5>
<div class="paragraph">
<p>Groovy has always supported literal list/array definitions using square brackets
and has avoided Java-style curly braces so as not to conflict with closure definitions.
In the case where the curly braces come immediately after an array type declaration however,
there is no ambiguity with closure definitions,
so Groovy 3 and above support that variant of the Java array initialization expression.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def primes = new int[] {2, 3, 5, 7, 11}
assert primes.size() == 5 &amp;&amp; primes.sum() == 28
assert primes.class.name == '[I'

def pets = new String[] {'cat', 'dog'}
assert pets.size() == 2 &amp;&amp; pets.sum() == 'catdog'
assert pets.class.name == '[Ljava.lang.String;'

// traditional Groovy alternative still supported
String[] groovyBooks = [ 'Groovy in Action', 'Making Java Groovy' ]
assert groovyBooks.every{ it.contains('Groovy') }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maps"><a class="anchor" href="#_maps"></a><a class="link" href="#_maps">1.1.9. Maps</a></h4>
<div class="paragraph">
<p>Sometimes called dictionaries or associative arrays in other languages, Groovy features maps.
Maps associate keys to values, separating keys and values with colons, and each key/value pairs with commas,
and the whole keys and values surrounded by square brackets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def colors = [red: '#FF0000', green: '#00FF00', blue: '#0000FF']   <i class="conum" data-value="1"></i><b>(1)</b>

assert colors['red'] == '#FF0000'    <i class="conum" data-value="2"></i><b>(2)</b>
assert colors.green  == '#00FF00'    <i class="conum" data-value="3"></i><b>(3)</b>

colors['pink'] = '#FF00FF'           <i class="conum" data-value="4"></i><b>(4)</b>
colors.yellow  = '#FFFF00'           <i class="conum" data-value="5"></i><b>(5)</b>

assert colors.pink == '#FF00FF'
assert colors['yellow'] == '#FFFF00'

assert colors instanceof java.util.LinkedHashMap</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a map of string color names, associated with their hexadecimal-coded html colors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the subscript notation to check the content associated with the <code>red</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We can also use the property notation to assert the color green&#8217;s hexadecimal representation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Similarly, we can use the subscript notation to add a new key/value pair</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Or the property notation, to add the <code>yellow</code> color</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using names for the keys, we actually define string keys in the map.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy creates maps that are actually instances of <code>java.util.LinkedHashMap</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you try to access a key which is not present in the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert colors.unknown == null

def emptyMap = [:]
assert emptyMap.anyKey == null</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will retrieve a <code>null</code> result.</p>
</div>
<div class="paragraph">
<p>In the examples above, we used string keys, but you can also use values of other types as keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def numbers = [1: 'one', 2: 'two']

assert numbers[1] == 'one'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we used numbers as keys, as numbers can unambiguously be recognized as numbers,
so Groovy will not create a string key like in our previous examples.
But consider the case you want to pass a variable in lieu of the key, to have the value of that variable become the key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def key = 'name'
def person = [key: 'Guillaume']      <i class="conum" data-value="1"></i><b>(1)</b>

assert !person.containsKey('name')   <i class="conum" data-value="2"></i><b>(2)</b>
assert person.containsKey('key')     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>key</code> associated with the <code>'Guillaume'</code> name will actually be the <code>"key"</code> string, not the value associated with the <code>key</code> variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map doesn&#8217;t contain the <code>'name'</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instead, the map contains a <code>'key'</code> key</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also pass quoted strings as well as keys: ["name": "Guillaume"].
This is mandatory if your key string isn&#8217;t a valid identifier,
for example if you wanted to create a string key containing a dash like in: ["street-name": "Main street"].
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you need to pass variable values as keys in your map definitions, you must surround the variable or expression with parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">person = [(key): 'Guillaume']        <i class="conum" data-value="1"></i><b>(1)</b>

assert person.containsKey('name')    <i class="conum" data-value="2"></i><b>(2)</b>
assert !person.containsKey('key')    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time, we surround the <code>key</code> variable with parentheses, to instruct the parser we are passing a variable rather than defining a string key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map does contain the <code>name</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>But the map doesn&#8217;t contain the <code>key</code> key as before</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy-operators"><a class="anchor" href="#groovy-operators"></a><a class="link" href="#groovy-operators">1.2. Operators</a></h3>
<div class="paragraph">
<p>This chapter covers the operators of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_arithmetic_operators"><a class="anchor" href="#_arithmetic_operators"></a><a class="link" href="#_arithmetic_operators">1.2.1. Arithmetic operators</a></h4>
<div class="paragraph">
<p>Groovy supports the usual familiar arithmetic operators you find in mathematics and in other programming languages like Java.
All the Java arithmetic operators are supported. Let&#8217;s go through them in the following examples.</p>
</div>
<div class="sect4">
<h5 id="_normal_arithmetic_operators"><a class="anchor" href="#_normal_arithmetic_operators"></a><a class="link" href="#_normal_arithmetic_operators">Normal arithmetic operators</a></h5>
<div class="paragraph">
<p>The following binary arithmetic operators are available in Groovy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtraction</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiplication</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>intdiv()</code> for integer division, and see the section about <a href="#integer_division">integer division</a> for more information on the return type of the division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remainder</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">power</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See the section about <a href="#power_operator">the power operation</a> for more information on the return type of the operation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are a few examples of usage of those operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert  1  + 2 == 3
assert  4  - 3 == 1
assert  3  * 5 == 15
assert  3  / 2 == 1.5
assert 10  % 3 == 1
assert  2 ** 3 == 8</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unary_operators"><a class="anchor" href="#_unary_operators"></a><a class="link" href="#_unary_operators">Unary operators</a></h5>
<div class="paragraph">
<p>The <code>+</code> and <code>-</code> operators are also available as unary operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert +3 == 3
assert -4 == 0 - 4

assert -(-1) == 1  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the usage of parentheses to surround an expression to apply the unary minus to that surrounded expression.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In terms of unary arithmetics operators, the <code>++</code> (increment) and <code>--</code> (decrement) operators are available,
both in prefix and postfix notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def a = 2
def b = a++ * 3             <i class="conum" data-value="1"></i><b>(1)</b>

assert a == 3 &amp;&amp; b == 6

def c = 3
def d = c-- * 2             <i class="conum" data-value="2"></i><b>(2)</b>

assert c == 2 &amp;&amp; d == 6

def e = 1
def f = ++e + 3             <i class="conum" data-value="3"></i><b>(3)</b>

assert e == 2 &amp;&amp; f == 5

def g = 4
def h = --g + 1             <i class="conum" data-value="4"></i><b>(4)</b>

assert g == 3 &amp;&amp; h == 4</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The postfix increment will increment <code>a</code> after the expression has been evaluated and assigned into <code>b</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The postfix decrement will decrement <code>c</code> after the expression has been evaluated and assigned into <code>d</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The prefix increment will increment <code>e</code> before the expression is evaluated and assigned into <code>f</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The prefix decrement will decrement <code>g</code> before the expression is evaluated and assigned into <code>h</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the unary not operator on Booleans, see <a href="#_conditional_operators">Conditional operators</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_assignment_arithmetic_operators"><a class="anchor" href="#_assignment_arithmetic_operators"></a><a class="link" href="#_assignment_arithmetic_operators">Assignment arithmetic operators</a></h5>
<div class="paragraph">
<p>The binary arithmetic operators we have seen above are also available in an assignment form:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+=</code></p>
</li>
<li>
<p><code>-=</code></p>
</li>
<li>
<p><code>*=</code></p>
</li>
<li>
<p><code>/=</code></p>
</li>
<li>
<p><code>%=</code></p>
</li>
<li>
<p><code>**=</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s see them in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def a = 4
a += 3

assert a == 7

def b = 5
b -= 3

assert b == 2

def c = 5
c *= 3

assert c == 15

def d = 10
d /= 2

assert d == 5

def e = 10
e %= 3

assert e == 1

def f = 3
f **= 2

assert f == 9</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relational_operators"><a class="anchor" href="#_relational_operators"></a><a class="link" href="#_relational_operators">1.2.2. Relational operators</a></h4>
<div class="paragraph">
<p>Relational operators allow comparisons between objects, to know if two objects are the same or different,
or if one is greater than, less than, or equal to the other.</p>
</div>
<div class="paragraph">
<p>The following operators are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">different</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>===</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identical (Since Groovy 3.0.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not identical (Since Groovy 3.0.0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some examples of simple number comparisons using these operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 1 + 2 == 3
assert 3 != 4

assert -2 &lt; 3
assert 2 &lt;= 2
assert 3 &lt;= 4

assert 5 &gt; 1
assert 5 &gt;= -2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>===</code> and <code>!==</code> are supported which are the same as calling the <code>is()</code> method,
and negating a call to the <code>is()</code> method respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
class Creature { String type }

def cat = new Creature(type: 'cat')
def copyCat = cat
def lion = new Creature(type: 'cat')

assert cat.equals(lion) // Java logical equality
assert cat == lion      // Groovy shorthand operator

assert cat.is(copyCat)  // Groovy identity
assert cat === copyCat  // operator shorthand
assert cat !== lion     // negated operator shorthand</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operators"><a class="anchor" href="#_logical_operators"></a><a class="link" href="#_logical_operators">1.2.3. Logical operators</a></h4>
<div class="paragraph">
<p>Groovy offers three logical operators for boolean expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;&amp;</code>: logical "and"</p>
</li>
<li>
<p><code>||</code>: logical "or"</p>
</li>
<li>
<p><code>!</code>: logical "not"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate them with the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert !false           <i class="conum" data-value="1"></i><b>(1)</b>
assert true &amp;&amp; true     <i class="conum" data-value="2"></i><b>(2)</b>
assert true || false    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>"not" false is true</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>true "and" true is true</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>true "or" false is true</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_precedence"><a class="anchor" href="#_precedence"></a><a class="link" href="#_precedence">Precedence</a></h5>
<div class="paragraph">
<p>The logical "not" has a higher priority than the logical "and".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (!false &amp;&amp; false) == false   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true (as the expression in parentheses is false), because "not" has a higher precedence than "and", so it only applies to the first "false" term; otherwise, it would have applied to the result of the "and", turned it into true, and the assertion would have failed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The logical "and" has a higher priority than the logical "or".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert true || true &amp;&amp; false        <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true, because "and" has a higher precedence than "or", therefore the "or" is executed last and returns true, having one true argument; otherwise, the "and" would have executed last and returned false, having one false argument, and the assertion would have failed</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_short_circuiting"><a class="anchor" href="#_short_circuiting"></a><a class="link" href="#_short_circuiting">Short-circuiting</a></h5>
<div class="paragraph">
<p>The logical <code>||</code> operator supports short-circuiting: if the left operand is true, it knows that the result will be true in any case, so it won&#8217;t evaluate the right operand.
The right operand will be evaluated only if the left operand is false.</p>
</div>
<div class="paragraph">
<p>Likewise for the logical <code>&amp;&amp;</code> operator: if the left operand is false, it knows that the result will be false in any case, so it won&#8217;t evaluate the right operand.
The right operand will be evaluated only if the left operand is true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">boolean checkIfCalled() {   <i class="conum" data-value="1"></i><b>(1)</b>
    called = true
}

called = false
true || checkIfCalled()
assert !called              <i class="conum" data-value="2"></i><b>(2)</b>

called = false
false || checkIfCalled()
assert called               <i class="conum" data-value="3"></i><b>(3)</b>

called = false
false &amp;&amp; checkIfCalled()
assert !called              <i class="conum" data-value="4"></i><b>(4)</b>

called = false
true &amp;&amp; checkIfCalled()
assert called               <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create a function that sets the <code>called</code> flag to true whenever it&#8217;s called</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In the first case, after resetting the called flag, we confirm that if the left operand to <code>||</code> is true, the function is not called, as <code>||</code> short-circuits the evaluation of the right operand</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In the second case, the left operand is false and so the function is called, as indicated by the fact our flag is now true</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Likewise for <code>&amp;&amp;</code>, we confirm that the function is not called with a false left operand</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>But the function is called with a true left operand</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bitwise_and_bit_shift_operators"><a class="anchor" href="#_bitwise_and_bit_shift_operators"></a><a class="link" href="#_bitwise_and_bit_shift_operators">1.2.4. Bitwise and bit shift operators</a></h4>
<div class="sect4">
<h5 id="_bitwise_operators"><a class="anchor" href="#_bitwise_operators"></a><a class="link" href="#_bitwise_operators">Bitwise operators</a></h5>
<div class="paragraph">
<p>Groovy offers four bitwise operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;</code>: bitwise "and"</p>
</li>
<li>
<p><code>|</code>: bitwise "or"</p>
</li>
<li>
<p><code>^</code>: bitwise "xor" (exclusive "or")</p>
</li>
<li>
<p><code>~</code>: bitwise negation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bitwise operators can be applied on arguments which are of type <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, or <code>BigInteger</code>.
If one of the arguments is a <code>BigInteger</code>, the result will be of type <code>BigInteger</code>;
otherwise, if one of the arguments is a <code>long</code>, the result will be of type <code>long</code>;
otherwise, the result will be of type <code>int</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int a = 0b00101010
assert a == 42
int b = 0b00001000
assert b == 8
assert (a &amp; a) == a                     <i class="conum" data-value="1"></i><b>(1)</b>
assert (a &amp; b) == b                     <i class="conum" data-value="2"></i><b>(2)</b>
assert (a | a) == a                     <i class="conum" data-value="3"></i><b>(3)</b>
assert (a | b) == a                     <i class="conum" data-value="4"></i><b>(4)</b>

int mask = 0b11111111                   <i class="conum" data-value="5"></i><b>(5)</b>
assert ((a ^ a) &amp; mask) == 0b00000000   <i class="conum" data-value="6"></i><b>(6)</b>
assert ((a ^ b) &amp; mask) == 0b00100010   <i class="conum" data-value="7"></i><b>(7)</b>
assert ((~a) &amp; mask)    == 0b11010101   <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>bitwise and</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>bitwise and returns common bits</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>bitwise or</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>bitwise or returns all '1' bits</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>setting a mask to check only the last 8 bits</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>bitwise exclusive or on self returns 0</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>bitwise exclusive or</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>bitwise negation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that the internal representation of primitive types follow the <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html">Java Language Specification</a>. In particular,
primitive types are signed, meaning that for a bitwise negation, it is always good to use a mask to retrieve only the necessary bits.</p>
</div>
<div class="paragraph">
<p>In Groovy, bitwise operators are <a href="#Operator-Overloading">overloadable</a>, meaning that you can define the behavior of those operators for any kind of object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bit_shift_operators"><a class="anchor" href="#_bit_shift_operators"></a><a class="link" href="#_bit_shift_operators">Bit shift operators</a></h5>
<div class="paragraph">
<p>Groovy offers three bit shift operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;&lt;</code>: left shift</p>
</li>
<li>
<p><code>&gt;&gt;</code>: right shift</p>
</li>
<li>
<p><code>&gt;&gt;&gt;</code>: right shift unsigned</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three operators are applicable where the left argument is of type <code>byte</code>, <code>short</code>, <code>int</code>, or <code>long</code>.
The first two operators can also be applied where the left argument is of type <code>BigInteger</code>.
If the left argument is a <code>BigInteger</code>, the result will be of type <code>BigInteger</code>;
otherwise, if the left argument is a <code>long</code>, the result will be of type <code>long</code>;
otherwise, the result will be of type <code>int</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 12.equals(3 &lt;&lt; 2)           <i class="conum" data-value="1"></i><b>(1)</b>
assert 24L.equals(3L &lt;&lt; 3)         <i class="conum" data-value="1"></i><b>(1)</b>
assert 48G.equals(3G &lt;&lt; 4)         <i class="conum" data-value="1"></i><b>(1)</b>

assert 4095 == -200 &gt;&gt;&gt; 20
assert -1 == -200 &gt;&gt; 20
assert 2G == 5G &gt;&gt; 1
assert -3G == -5G &gt;&gt; 1</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>equals</code> method used instead of <code>==</code> to confirm result type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Groovy, bit shift operators are <a href="#Operator-Overloading">overloadable</a>, meaning that you can define the behavior of those operators for any kind of object.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_operators"><a class="anchor" href="#_conditional_operators"></a><a class="link" href="#_conditional_operators">1.2.5. Conditional operators</a></h4>
<div class="sect4">
<h5 id="_not_operator"><a class="anchor" href="#_not_operator"></a><a class="link" href="#_not_operator">Not operator</a></h5>
<div class="paragraph">
<p>The "not" operator is represented with an exclamation mark (<code>!</code>) and inverts the result of the underlying boolean expression. In
particular, it is possible to combine the <code>not</code> operator with the <a href="#the-groovy-truth">Groovy truth</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (!true)    == false                      <i class="conum" data-value="1"></i><b>(1)</b>
assert (!'foo')   == false                      <i class="conum" data-value="2"></i><b>(2)</b>
assert (!'')      == true                       <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the negation of <code>true</code> is <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>'foo' is a non-empty string, evaluating to <code>true</code>, so negation returns <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>'' is an empty string, evaluating to <code>false</code>, so negation returns <code>true</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ternary_operator"><a class="anchor" href="#_ternary_operator"></a><a class="link" href="#_ternary_operator">Ternary operator</a></h5>
<div class="paragraph">
<p>The ternary operator is a shortcut expression that is equivalent to an if/else branch assigning some value to a variable.</p>
</div>
<div class="paragraph">
<p>Instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (string!=null &amp;&amp; string.length()&gt;0) {
    result = 'Found'
} else {
    result = 'Not found'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">result = (string!=null &amp;&amp; string.length()&gt;0) ? 'Found' : 'Not found'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ternary operator is also compatible with the <a href="#the-groovy-truth">Groovy truth</a>, so you can make it even simpler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">result = string ? 'Found' : 'Not found'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_elvis_operator"><a class="anchor" href="#_elvis_operator"></a><a class="link" href="#_elvis_operator">Elvis operator</a></h5>
<div class="paragraph">
<p>The "Elvis operator" is a shortening of the ternary operator. One instance of where this is handy is for returning
a 'sensible default' value if an expression resolves to <code>false</code>-ish (as in
<a href="#the-groovy-truth">Groovy truth</a>). A simple example might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">displayName = user.name ? user.name : 'Anonymous'   <i class="conum" data-value="1"></i><b>(1)</b>
displayName = user.name ?: 'Anonymous'              <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>with the ternary operator, you have to repeat the value you want to assign</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>with the Elvis operator, the value, which is tested, is used if it is not <code>false</code>-ish</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Usage of the Elvis operator reduces the verbosity of your code and reduces the risks of errors in case of refactorings,
by removing the need to duplicate the expression which is tested in both the condition and the positive return value.</p>
</div>
</div>
<div class="sect4">
<h5 id="_elvis_assignment_operator"><a class="anchor" href="#_elvis_assignment_operator"></a><a class="link" href="#_elvis_assignment_operator">Elvis assignment operator</a></h5>
<div class="paragraph">
<p>Groovy 3.0.0 introduces the Elvis operator, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ToString

@ToString(includePackage = false)
class Element {
    String name
    int atomicNumber
}

def he = new Element(name: 'Helium')
he.with {
    name = name ?: 'Hydrogen'   // existing Elvis operator
    atomicNumber ?= 2           // new Elvis assignment shorthand
}
assert he.toString() == 'Element(Helium, 2)'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_object_operators"><a class="anchor" href="#_object_operators"></a><a class="link" href="#_object_operators">1.2.6. Object operators</a></h4>
<div class="sect4">
<h5 id="_safe_navigation_operator"><a class="anchor" href="#_safe_navigation_operator"></a><a class="link" href="#_safe_navigation_operator">Safe navigation operator</a></h5>
<div class="paragraph">
<p>The Safe Navigation operator is used to avoid a <code>NullPointerException</code>. Typically when you have a reference to an object
you might need to verify that it is not <code>null</code> before accessing methods or properties of the object. To avoid this, the safe
navigation operator will simply return <code>null</code> instead of throwing an exception, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def person = Person.find { it.id == 123 }    <i class="conum" data-value="1"></i><b>(1)</b>
def name = person?.name                      <i class="conum" data-value="2"></i><b>(2)</b>
assert name == null                          <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>find</code> will return a <code>null</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use of the null-safe operator prevents from a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>result is <code>null</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_direct_field_access_operator"><a class="anchor" href="#_direct_field_access_operator"></a><a class="link" href="#_direct_field_access_operator">Direct field access operator</a></h5>
<div class="paragraph">
<p>Normally in Groovy, when you write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class User {
    public final String name                 <i class="conum" data-value="1"></i><b>(1)</b>
    User(String name) { this.name = name}
    String getName() { "Name: $name" }       <i class="conum" data-value="2"></i><b>(2)</b>
}
def user = new User('Bob')
assert user.name == 'Name: Bob'              <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>public field <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a getter for <code>name</code> that returns a custom string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calls the getter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>user.name</code> call triggers a call to the property of the same name, that is to say, here, to the getter for <code>name</code>. If
you want to retrieve the field instead of calling the getter, you can use the direct field access operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert user.@name == 'Bob'                   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of <code>.@</code> forces usage of the field instead of the getter</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="method-pointer-operator"><a class="anchor" href="#method-pointer-operator"></a><a class="link" href="#method-pointer-operator">Method pointer operator</a></h5>
<div class="paragraph">
<p>The method pointer operator (<code>.&amp;</code>) can be used to store a reference to a method in a variable,
in order to call it later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def str = 'example of method reference'            <i class="conum" data-value="1"></i><b>(1)</b>
def fun = str.&amp;toUpperCase                         <i class="conum" data-value="2"></i><b>(2)</b>
def upper = fun()                                  <i class="conum" data-value="3"></i><b>(3)</b>
assert upper == str.toUpperCase()                  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>str</code> variable contains a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we store a reference to the <code>toUpperCase</code> method on the <code>str</code> instance inside a variable named <code>fun</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>fun</code> can be called like a regular method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can check that the result is the same as if we had called it directly on <code>str</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are multiple advantages in using method pointers. First of all, the type of such a method pointer is
a <code>groovy.lang.Closure</code>, so it can be used in any place a closure would be used. In particular, it is suitable to
convert an existing method for the needs of the strategy pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def transform(List elements, Closure action) {                    <i class="conum" data-value="1"></i><b>(1)</b>
    def result = []
    elements.each {
        result &lt;&lt; action(it)
    }
    result
}
String describe(Person p) {                                       <i class="conum" data-value="2"></i><b>(2)</b>
    "$p.name is $p.age"
}
def action = this.&amp;describe                                       <i class="conum" data-value="3"></i><b>(3)</b>
def list = [
    new Person(name: 'Bob',   age: 42),
    new Person(name: 'Julia', age: 35)]                           <i class="conum" data-value="4"></i><b>(4)</b>
assert transform(list, action) == ['Bob is 42', 'Julia is 35']    <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>transform</code> method takes each element of the list and calls the <code>action</code> closure on them, returning a new list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define a function that takes a <code>Person</code> and returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we create a method pointer on that function</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we create the list of elements we want to collect the descriptors</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the method pointer can be used where a <code>Closure</code> was expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Method pointers are bound by the receiver and a method name. Arguments are resolved at runtime, meaning that if you have
multiple methods with the same name, the syntax is not different, only resolution of the appropriate method to be called
will be done at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def doSomething(String str) { str.toUpperCase() }    <i class="conum" data-value="1"></i><b>(1)</b>
def doSomething(Integer x) { 2*x }                   <i class="conum" data-value="2"></i><b>(2)</b>
def reference = this.&amp;doSomething                    <i class="conum" data-value="3"></i><b>(3)</b>
assert reference('foo') == 'FOO'                     <i class="conum" data-value="4"></i><b>(4)</b>
assert reference(123)   == 246                       <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an overloaded <code>doSomething</code> method accepting a <code>String</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>define an overloaded <code>doSomething</code> method accepting an <code>Integer</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a single method pointer on <code>doSomething</code>, without specifying argument types</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the method pointer with a <code>String</code> calls the <code>String</code> version of <code>doSomething</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the method pointer with an <code>Integer</code> calls the <code>Integer</code> version of <code>doSomething</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To align with Java 8 method reference expectations, in Groovy 3 and above, you can use <code>new</code> as the
method name to obtain a method pointer to the constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo  = BigInteger.&amp;new
def fortyTwo = foo('42')
assert fortyTwo == 42G</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also in Groovy 3 and above, you can obtain a method pointer to an instance method of a class.
This method pointer takes an additional parameter being the receiver instance to
invoke the method on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def instanceMethod = String.&amp;toUpperCase
assert instanceMethod('foo') == 'FOO'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For backwards compatibility, any static methods that happen to have the correct
parameters for the call will be given precedence over instance methods for this case.</p>
</div>
</div>
<div class="sect4">
<h5 id="method-reference-operator"><a class="anchor" href="#method-reference-operator"></a><a class="link" href="#method-reference-operator">Method reference operator</a></h5>
<div class="paragraph">
<p>The Parrot parser in Groovy 3+ supports the Java 8+ method reference operator.
The method reference operator (<code>::</code>) can be used to reference a method or constructor
in contexts expecting a functional interface. This overlaps somewhat with the functionality
provided by Groovy&#8217;s method pointer operator. Indeed, for dynamic Groovy, the method
reference operator is just an alias for the method pointer operator.
For static Groovy, the operator results in bytecode similar to the bytecode
that Java would produce for the same context.</p>
</div>
<div class="paragraph">
<p>Some examples highlighting various supported method reference cases are shown in the following script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.CompileStatic
import static java.util.stream.Collectors.toList

@CompileStatic
void methodRefs() {
    assert 6G == [1G, 2G, 3G].stream().reduce(0G, BigInteger::add)                           <i class="conum" data-value="1"></i><b>(1)</b>

    assert [4G, 5G, 6G] == [1G, 2G, 3G].stream().map(3G::add).collect(toList())              <i class="conum" data-value="2"></i><b>(2)</b>

    assert [1G, 2G, 3G] == [1L, 2L, 3L].stream().map(BigInteger::valueOf).collect(toList())  <i class="conum" data-value="3"></i><b>(3)</b>

    assert [1G, 2G, 3G] == [1L, 2L, 3L].stream().map(3G::valueOf).collect(toList())          <i class="conum" data-value="4"></i><b>(4)</b>
}

methodRefs()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class instance method reference: add(BigInteger val) is an instance method in BigInteger</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>object instance method reference: add(BigInteger val) is an instance method for object 3G</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class static method reference: valueOf(long val) is a static method for class BigInteger</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>object static method reference: valueOf(long val) is a static method for object 3G (some consider this bad style in normal circumstances)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some examples highlighting various supported constructor reference cases are shown in the following script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic
void constructorRefs() {
    assert [1, 2, 3] == ['1', '2', '3'].stream().map(Integer::valueOf).collect(toList())  <i class="conum" data-value="1"></i><b>(1)</b>

    def result = [1, 2, 3].stream().toArray(Integer[]::new)                           <i class="conum" data-value="2"></i><b>(2)</b>
    assert result instanceof Integer[]
    assert result.toString() == '[1, 2, 3]'
}

constructorRefs()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class constructor reference</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>array constructor reference</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression_operators"><a class="anchor" href="#_regular_expression_operators"></a><a class="link" href="#_regular_expression_operators">1.2.7. Regular expression operators</a></h4>
<div class="sect4">
<h5 id="_pattern_operator"><a class="anchor" href="#_pattern_operator"></a><a class="link" href="#_pattern_operator">Pattern operator</a></h5>
<div class="paragraph">
<p>The pattern operator (<code>~</code>) provides a simple way to create a <code>java.util.regex.Pattern</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p = ~/foo/
assert p instanceof Pattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>while in general, you find the pattern operator with an expression in a slashy-string, it can be used with any kind of
<code>String</code> in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p = ~'foo'                                                        <i class="conum" data-value="1"></i><b>(1)</b>
p = ~"foo"                                                        <i class="conum" data-value="2"></i><b>(2)</b>
p = ~$/dollar/slashy $ string/$                                   <i class="conum" data-value="3"></i><b>(3)</b>
p = ~"${pattern}"                                                 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using single quote strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using double quotes strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the dollar-slashy string lets you use slashes and the dollar sign without having to escape them</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>you can also use a GString!</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While you can use most String forms with the Pattern, Find and Match operators,
we recommend using the slashy string most of the time to save having to
remember the otherwise needed escaping requirements.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_find_operator"><a class="anchor" href="#_find_operator"></a><a class="link" href="#_find_operator">Find operator</a></h5>
<div class="paragraph">
<p>Alternatively to building a pattern, you can use the find operator <code>=~</code> to directly create a <code>java.util.regex.Matcher</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = "some text to match"
def m = text =~ /match/                                           <i class="conum" data-value="1"></i><b>(1)</b>
assert m instanceof Matcher                                       <i class="conum" data-value="2"></i><b>(2)</b>
if (!m) {                                                         <i class="conum" data-value="3"></i><b>(3)</b>
    throw new RuntimeException("Oops, text not found!")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>=~</code> creates a matcher against the <code>text</code> variable, using the pattern on the right hand side</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>=~</code> is a <code>Matcher</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (!m.find(0))</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since a <code>Matcher</code> coerces to a <code>boolean</code> by calling its <code>find</code> method, the <code>=~</code> operator is consistent with the simple
use of Perl&#8217;s <code>=~</code> operator, when it appears as a predicate (in <code>if</code>, <code>?:</code>, etc.). When the intent is to iterate over
matches of the specified pattern (in <code>while</code>, etc.) call <code>find()</code> directly on the matcher or use the <code>iterator</code> DGM.</p>
</div>
</div>
<div class="sect4">
<h5 id="_match_operator"><a class="anchor" href="#_match_operator"></a><a class="link" href="#_match_operator">Match operator</a></h5>
<div class="paragraph">
<p>The match operator (<code>==~</code>) is a slight variation of the find operator, that does not return a <code>Matcher</code> but a boolean
and requires a strict match of the input string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">m = text ==~ /match/                                              <i class="conum" data-value="1"></i><b>(1)</b>
assert m instanceof Boolean                                       <i class="conum" data-value="2"></i><b>(2)</b>
if (m) {                                                          <i class="conum" data-value="3"></i><b>(3)</b>
    throw new RuntimeException("Should not reach that point!")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>==~</code> matches the subject with the regular expression, but match must be strict</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>==~</code> is therefore a <code>boolean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (text ==~ /match/)</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_comparing_find_vs_match_operators"><a class="anchor" href="#_comparing_find_vs_match_operators"></a><a class="link" href="#_comparing_find_vs_match_operators">Comparing Find vs Match operators</a></h5>
<div class="paragraph">
<p>Typically, the match operator is used when the pattern involves a single exact match, otherwise
the find operator might be more useful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'two words' ==~ /\S+\s+\S+/
assert 'two words' ==~ /^\S+\s+\S+$/         <i class="conum" data-value="1"></i><b>(1)</b>
assert !(' leading space' ==~ /\S+\s+\S+/)   <i class="conum" data-value="2"></i><b>(2)</b>

def m1 = 'two words' =~ /^\S+\s+\S+$/
assert m1.size() == 1                          <i class="conum" data-value="3"></i><b>(3)</b>
def m2 = 'now three words' =~ /^\S+\s+\S+$/    <i class="conum" data-value="4"></i><b>(4)</b>
assert m2.size() == 0                          <i class="conum" data-value="5"></i><b>(5)</b>
def m3 = 'now three words' =~ /\S+\s+\S+/
assert m3.size() == 1                          <i class="conum" data-value="6"></i><b>(6)</b>
assert m3[0] == 'now three'
def m4 = ' leading space' =~ /\S+\s+\S+/
assert m4.size() == 1                          <i class="conum" data-value="7"></i><b>(7)</b>
assert m4[0] == 'leading space'
def m5 = 'and with four words' =~ /\S+\s+\S+/
assert m5.size() == 2                          <i class="conum" data-value="8"></i><b>(8)</b>
assert m5[0] == 'and with'
assert m5[1] == 'four words'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>equivalent, but explicit ^ and $ are discouraged since they aren&#8217;t needed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no match because of leading space</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>one match</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>^ and $ indicate exact match required</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>zero matches</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>one match, greedily starting at first word</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>one match, ignores leading space</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>two matches</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_operators"><a class="anchor" href="#_other_operators"></a><a class="link" href="#_other_operators">1.2.8. Other operators</a></h4>
<div class="sect4">
<h5 id="_spread_operator"><a class="anchor" href="#_spread_operator"></a><a class="link" href="#_spread_operator">Spread operator</a></h5>
<div class="paragraph">
<p>The Spread-dot Operator (<code>*.</code>), often abbreviated to just Spread Operator, is used to invoke an action on all items
of an aggregate object. It is equivalent to calling the action on each item and collecting the result into a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Car {
    String make
    String model
}
def cars = [
       new Car(make: 'Peugeot', model: '508'),
       new Car(make: 'Renault', model: 'Clio')]       <i class="conum" data-value="1"></i><b>(1)</b>
def makes = cars*.make                                <i class="conum" data-value="2"></i><b>(2)</b>
assert makes == ['Peugeot', 'Renault']                <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list of <code>Car</code> items. The list is an aggregate of objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call the spread operator on the list, accessing the <code>make</code> property of each item</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>returns a list of strings corresponding to the collection of <code>make</code> items</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The expression <code>cars*.make</code> is equivalent to <code>cars.collect{ it.make }</code>.
Groovy&#8217;s GPath notation allows a short-cut when the referenced property
isn&#8217;t a property of the containing list, in that case it is automatically
spread. In the previously mentioned case, the expression <code>cars.make</code> can
be used, though retaining the explicit spread-dot operator is often recommended.</p>
</div>
<div class="paragraph">
<p>The spread operator is null-safe, meaning that if an element of the collection is null,
it will return null instead of throwing a <code>NullPointerException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">cars = [
   new Car(make: 'Peugeot', model: '508'),
   null,                                              <i class="conum" data-value="1"></i><b>(1)</b>
   new Car(make: 'Renault', model: 'Clio')]
assert cars*.make == ['Peugeot', null, 'Renault']     <i class="conum" data-value="2"></i><b>(2)</b>
assert null*.make == null                             <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list for which one of the elements is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using the spread operator will <strong>not</strong> throw a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the receiver might also be null, in which case the return value is <code>null</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The spread operator can be used on any class which implements the <code>Iterable</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Component {
    Integer id
    String name
}
class CompositeObject implements Iterable&lt;Component&gt; {
    def components = [
        new Component(id: 1, name: 'Foo'),
        new Component(id: 2, name: 'Bar')]

    @Override
    Iterator&lt;Component&gt; iterator() {
        components.iterator()
    }
}
def composite = new CompositeObject()
assert composite*.id == [1,2]
assert composite*.name == ['Foo','Bar']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use multiple invocations of the spread-dot operator (here <code>cars*.models*.name</code>) when
working with aggregates of data structures which themselves contain aggregates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Make {
    String name
    List&lt;Model&gt; models
}

@Canonical
class Model {
    String name
}

def cars = [
    new Make(name: 'Peugeot',
             models: [new Model('408'), new Model('508')]),
    new Make(name: 'Renault',
             models: [new Model('Clio'), new Model('Captur')])
]

def makes = cars*.name
assert makes == ['Peugeot', 'Renault']

def models = cars*.models*.name
assert models == [['408', '508'], ['Clio', 'Captur']]
assert models.sum() == ['408', '508', 'Clio', 'Captur'] // flatten one level
assert models.flatten() == ['408', '508', 'Clio', 'Captur'] // flatten all levels (one in this case)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consider using the <code>collectNested</code> DGM method instead of the spread-dot operator for collections of collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Car {
    String make
    String model
}
def cars = [
   [
       new Car(make: 'Peugeot', model: '408'),
       new Car(make: 'Peugeot', model: '508')
   ], [
       new Car(make: 'Renault', model: 'Clio'),
       new Car(make: 'Renault', model: 'Captur')
   ]
]
def models = cars.collectNested{ it.model }
assert models == [['408', '508'], ['Clio', 'Captur']]</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_spreading_method_arguments"><a class="anchor" href="#_spreading_method_arguments"></a><a class="link" href="#_spreading_method_arguments">Spreading method arguments</a></h6>
<div class="paragraph">
<p>There may be situations when the arguments of a method call can be found in a list that you need to adapt to the method
arguments. In such situations, you can use the spread operator to call the method. For example, imagine you have the
following method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int function(int x, int y, int z) {
    x*y+z
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then if you have the following list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def args = [4,5,6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can call the method without having to define intermediate variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert function(*args) == 26</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is even possible to mix normal arguments with spread ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">args = [4]
assert function(*args,5,6) == 26</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spread_list_elements"><a class="anchor" href="#_spread_list_elements"></a><a class="link" href="#_spread_list_elements">Spread list elements</a></h6>
<div class="paragraph">
<p>When used inside a list literal, the spread operator acts as if the spread element contents were inlined into the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def items = [4,5]                      <i class="conum" data-value="1"></i><b>(1)</b>
def list = [1,2,3,*items,6]            <i class="conum" data-value="2"></i><b>(2)</b>
assert list == [1,2,3,4,5,6]           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>items</code> is a list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we want to insert the contents of the <code>items</code> list directly into <code>list</code> without having to call <code>addAll</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the contents of <code>items</code> has been inlined into <code>list</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_spread_map_elements"><a class="anchor" href="#_spread_map_elements"></a><a class="link" href="#_spread_map_elements">Spread map elements</a></h6>
<div class="paragraph">
<p>The spread map operator works in a similar manner as the spread list operator, but for maps. It allows you to inline
the contents of a map into another map literal, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def m1 = [c:3, d:4]                   <i class="conum" data-value="1"></i><b>(1)</b>
def map = [a:1, b:2, *:m1]            <i class="conum" data-value="2"></i><b>(2)</b>
assert map == [a:1, b:2, c:3, d:4]    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the elements of <code>m1</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The position of the spread map operator is relevant, like illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def m1 = [c:3, d:4]                   <i class="conum" data-value="1"></i><b>(1)</b>
def map = [a:1, b:2, *:m1, d: 8]      <i class="conum" data-value="2"></i><b>(2)</b>
assert map == [a:1, b:2, c:3, d:8]    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code>, but redefine the key <code>d</code> <strong>after</strong> spreading</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the expected keys, but <code>d</code> was redefined</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_range_operator"><a class="anchor" href="#_range_operator"></a><a class="link" href="#_range_operator">Range operator</a></h5>
<div class="paragraph">
<p>Groovy supports the concept of ranges and provides a notation (<code>..</code>) to create ranges of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def range = 0..5                                    <i class="conum" data-value="1"></i><b>(1)</b>
assert (0..5).collect() == [0, 1, 2, 3, 4, 5]       <i class="conum" data-value="2"></i><b>(2)</b>
assert (0..&lt;5).collect() == [0, 1, 2, 3, 4]         <i class="conum" data-value="3"></i><b>(3)</b>
assert (0&lt;..5).collect() == [1, 2, 3, 4, 5]         <i class="conum" data-value="4"></i><b>(4)</b>
assert (0&lt;..&lt;5).collect() == [1, 2, 3, 4]           <i class="conum" data-value="5"></i><b>(5)</b>
assert (0..5) instanceof List                       <i class="conum" data-value="6"></i><b>(6)</b>
assert (0..5).size() == 6                           <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a simple range of integers, stored into a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an <code>IntRange</code>, with inclusive bounds</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>an <code>IntRange</code>, with exclusive upper bound</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>an <code>IntRange</code>, with exclusive lower bound</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>an <code>IntRange</code>, with exclusive lower and upper bounds</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>a <code>groovy.lang.Range</code> implements the <code>List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>meaning that you can call the <code>size</code> method on it</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ranges implementation is lightweight, meaning that only the lower and upper bounds are stored. You can create a range
from any <code>Comparable</code> object that has <code>next()</code> and <code>previous()</code> methods to determine the next / previous item in the range.
For example, you can create a range of characters this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ('a'..'d').collect() == ['a','b','c','d']</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spaceship_operator"><a class="anchor" href="#_spaceship_operator"></a><a class="link" href="#_spaceship_operator">Spaceship operator</a></h5>
<div class="paragraph">
<p>The spaceship operator (<code>&lt;=&gt;</code>) delegates to the <code>compareTo</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (1 &lt;=&gt; 1) == 0
assert (1 &lt;=&gt; 2) == -1
assert (2 &lt;=&gt; 1) == 1
assert ('a' &lt;=&gt; 'z') == -1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="subscript-operator"><a class="anchor" href="#subscript-operator"></a><a class="link" href="#subscript-operator">Subscript operator</a></h5>
<div class="paragraph">
<p>The subscript operator is a shorthand notation for <code>getAt</code> or <code>putAt</code>, depending on whether you find it on
the left hand side or the right hand side of an assignment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = [0,1,2,3,4]
assert list[2] == 2                         <i class="conum" data-value="1"></i><b>(1)</b>
list[2] = 4                                 <i class="conum" data-value="2"></i><b>(2)</b>
assert list[0..2] == [0,1,4]                <i class="conum" data-value="3"></i><b>(3)</b>
list[0..2] = [6,6,6]                        <i class="conum" data-value="4"></i><b>(4)</b>
assert list == [6,6,6,3,4]                  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>[2]</code> can be used instead of <code>getAt(2)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if on left hand side of an assignment, will call <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>getAt</code> also supports ranges</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>so does <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the list is mutated</td>
</tr>
</table>
</div>
<div id="custom-subscript-operator" class="paragraph">
<p>The subscript operator, in combination with a custom implementation of <code>getAt</code>/<code>putAt</code> is a convenient way for destructuring
objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class User {
    Long id
    String name
    def getAt(int i) {                                             <i class="conum" data-value="1"></i><b>(1)</b>
        switch (i) {
            case 0: return id
            case 1: return name
        }
        throw new IllegalArgumentException("No such element $i")
    }
    void putAt(int i, def value) {                                 <i class="conum" data-value="2"></i><b>(2)</b>
        switch (i) {
            case 0: id = value; return
            case 1: name = value; return
        }
        throw new IllegalArgumentException("No such element $i")
    }
}
def user = new User(id: 1, name: 'Alex')                           <i class="conum" data-value="3"></i><b>(3)</b>
assert user[0] == 1                                                <i class="conum" data-value="4"></i><b>(4)</b>
assert user[1] == 'Alex'                                           <i class="conum" data-value="5"></i><b>(5)</b>
user[1] = 'Bob'                                                    <i class="conum" data-value="6"></i><b>(6)</b>
assert user.name == 'Bob'                                          <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom <code>getAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>User</code> class defines a custom <code>putAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a sample user</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the subscript operator with index 0 allows retrieving the user id</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the subscript operator with index 1 allows retrieving the user name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>we can use the subscript operator to write to a property thanks to the delegation to <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>and check that it&#8217;s really the property <code>name</code> which was changed</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_safe_index_operator"><a class="anchor" href="#_safe_index_operator"></a><a class="link" href="#_safe_index_operator">Safe index operator</a></h5>
<div class="paragraph">
<p>Groovy 3.0.0 introduces safe indexing operator, i.e. <code>?[]</code>, which is similar to <code>?.</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String[] array = ['a', 'b']
assert 'b' == array?[1]      // get using normal array index
array?[1] = 'c'              // set using normal array index
assert 'c' == array?[1]

array = null
assert null == array?[1]     // return null for all index values
array?[1] = 'c'              // quietly ignore attempt to set value
assert null == array?[1]

def personInfo = [name: 'Daniel.Sun', location: 'Shanghai']
assert 'Daniel.Sun' == personInfo?['name']      // get using normal map index
personInfo?['name'] = 'sunlan'                  // set using normal map index
assert 'sunlan' == personInfo?['name']

personInfo = null
assert null == personInfo?['name']              // return null for all map values
personInfo?['name'] = 'sunlan'                  // quietly ignore attempt to set value
assert null == personInfo?['name']</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_membership_operator"><a class="anchor" href="#_membership_operator"></a><a class="link" href="#_membership_operator">Membership operator</a></h5>
<div class="paragraph">
<p>The membership operator (<code>in</code>) is equivalent to calling the <code>isCase</code> method. In the context of a <code>List</code>, it is equivalent
to calling <code>contains</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = ['Grace','Rob','Emmy']
assert ('Emmy' in list)                     <i class="conum" data-value="1"></i><b>(1)</b>
assert ('Alex' !in list)                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>equivalent to calling <code>list.contains('Emmy')</code> or <code>list.isCase('Emmy')</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>membership negation equivalent to calling <code>!list.contains('Emmy')</code> or <code>!list.isCase('Emmy')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_identity_operator"><a class="anchor" href="#_identity_operator"></a><a class="link" href="#_identity_operator">Identity operator</a></h5>
<div class="paragraph">
<p>In Groovy, using <code>==</code> to test equality is different from using the same operator in Java. In Groovy, it is calling <code>equals</code>.
If you want to compare reference equality, you should use <code>is</code> like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list1 = ['Groovy 1.8','Groovy 2.0','Groovy 2.3']        <i class="conum" data-value="1"></i><b>(1)</b>
def list2 = ['Groovy 1.8','Groovy 2.0','Groovy 2.3']        <i class="conum" data-value="2"></i><b>(2)</b>
assert list1 == list2                                       <i class="conum" data-value="3"></i><b>(3)</b>
assert !list1.is(list2)                                     <i class="conum" data-value="4"></i><b>(4)</b>
assert list1 !== list2                                      <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a list of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create another list of strings containing the same elements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>using <code>==</code>, we test object equality, equivalent to <code>list1.equals(list2)</code> in Java</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using <code>is</code>, we can check that references are distinct,  equivalent to <code>list1 == list2</code> in Java</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using <code>===</code> or <code>!==</code> (supported and recommended since Groovy 3.0.0), we can also check whether references are distinct or not, equivalent to <code>list1 == list2</code> and <code>list1 != list2</code> in Java</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_coercion_operator"><a class="anchor" href="#_coercion_operator"></a><a class="link" href="#_coercion_operator">Coercion operator</a></h5>
<div class="paragraph">
<p>The coercion operator (<code>as</code>) is a variant of casting. Coercion converts object from one type to another <strong>without</strong> them
being compatible for assignment. Let&#8217;s take an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String input = '42'
Integer num = (Integer) input                      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>String</code> is not assignable to an <code>Integer</code>, so it will produce a <code>ClassCastException</code> at runtime</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be fixed by using <em>coercion</em> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String input = '42'
Integer num = input as Integer                      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>String</code> is not assignable to an <code>Integer</code>, but use of <code>as</code> will <em>coerce</em> it to an <code>Integer</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an object is coerced into another, unless the target type is the same as the source type, coercion will return a
<strong>new</strong> object. The rules of coercion differ depending on the source and target types, and coercion may fail if no conversion
rules are found. Custom conversion rules may be implemented thanks to the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Identifiable {
    String name
}
class User {
    Long id
    String name
    def asType(Class target) {                                              <i class="conum" data-value="1"></i><b>(1)</b>
        if (target == Identifiable) {
            return new Identifiable(name: name)
        }
        throw new ClassCastException("User cannot be coerced into $target")
    }
}
def u = new User(name: 'Xavier')                                            <i class="conum" data-value="2"></i><b>(2)</b>
def p = u as Identifiable                                                   <i class="conum" data-value="3"></i><b>(3)</b>
assert p instanceof Identifiable                                            <i class="conum" data-value="4"></i><b>(4)</b>
assert !(p instanceof User)                                                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom conversion rule from <code>User</code> to <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we create an instance of <code>User</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we coerce the <code>User</code> instance into an <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the target is an instance of <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the target is not an instance of <code>User</code> anymore</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_diamond_operator"><a class="anchor" href="#_diamond_operator"></a><a class="link" href="#_diamond_operator">Diamond operator</a></h5>
<div class="paragraph">
<p>The diamond operator (<code>&lt;&gt;</code>) is a syntactic sugar only operator added to support compatibility with the operator of the
same name in Java 7. It is used to indicate that generic types should be inferred from the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List&lt;String&gt; strings = new LinkedList&lt;&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In dynamic Groovy, this is totally unused. In statically type checked Groovy, it is also optional since the Groovy
type checker performs type inference whether this operator is present or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="_call_operator"><a class="anchor" href="#_call_operator"></a><a class="link" href="#_call_operator">Call operator</a></h5>
<div class="paragraph">
<p>The call operator <code>()</code> is used to call a method named <code>call</code> implicitly. For any object which defines a <code>call</code> method,
 you can omit the <code>.call</code> part and use the call operator instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyCallable {
    int call(int x) {           <i class="conum" data-value="1"></i><b>(1)</b>
        2*x
    }
}

def mc = new MyCallable()
assert mc.call(2) == 4          <i class="conum" data-value="2"></i><b>(2)</b>
assert mc(2) == 4               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>MyCallable</code> defines a method named <code>call</code>. Note that it doesn&#8217;t need to implement <code>java.util.concurrent.Callable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the method using the classic method call syntax</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or we can omit <code>.call</code> thanks to the call operator</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_precedence"><a class="anchor" href="#_operator_precedence"></a><a class="link" href="#_operator_precedence">1.2.9. Operator precedence</a></h4>
<div class="paragraph">
<p>The table below lists all groovy operators in order of precedence.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Level</th>
<th class="tableblock halign-left valign-top">Operator(s)</th>
<th class="tableblock halign-left valign-top">Name(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>new</code> &#160; <code>()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object creation, explicit parentheses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>()</code> &#160; <code>{}</code> &#160; <code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">method call, closure, literal list/map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code> &#160; <code>.&amp;</code> &#160; <code>.@</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">member access, method closure, field/attribute access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?.</code> &#160; <code>*</code> &#160; <code>*.</code> &#160; <code>*:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">safe dereferencing, spread, spread-dot, spread-map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~</code> &#160; <code>!</code> &#160; <code>(type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitwise negate/pattern, not, typecast</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code> &#160; <code>?[]</code> &#160; <code>++</code> &#160; <code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list/map/array (safe) index, post inc/decrement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">power</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+` {nbsp} `--` {nbsp} `</code> &#160; <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre inc/decrement, unary plus, unary minus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code> &#160; <code>/</code> &#160; <code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiply, div, remainder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code> &#160; <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition, subtraction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code> &#160; <code>&gt;&gt;</code> &#160; <code>&gt;&gt;&gt;</code> &#160; <code>..</code> &#160; <code>..&lt;</code> &#160; <code>&lt;..&lt;</code> &#160; <code>&lt;..</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left/right (unsigned) shift, inclusive/exclusive ranges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code> &#160; <code>&lt;=</code> &#160; <code>&gt;</code> &#160; <code>&gt;=</code> &#160; <code>in</code> &#160; <code>!in</code> &#160; <code>instanceof</code> &#160; <code>!instanceof</code> &#160; <code>as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less/greater than/or equal, in, not in, instanceof, not instanceof, type coercion</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code> &#160; <code>!=</code> &#160; <code>&lt;=&gt;</code> &#160; <code>===</code> &#160; <code>!==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equals, not equals, compare to, identical to, not identical to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=~</code> &#160; <code>==~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex find, regex match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise and</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise xor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise or</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical and</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical or</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ternary conditional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elvis operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code> &#160; <code>**=</code> &#160; <code>*=</code> &#160; <code>/=</code> &#160; <code>%=</code> &#160; <code>+=</code> &#160; <code>-=</code> &#160;<br>
<code>&lt;&lt;=</code> &#160; <code>&gt;&gt;=</code> &#160; <code>&gt;&gt;&gt;=</code> &#160; <code>&amp;=</code> &#160; <code>^=</code> &#160; <code>|=</code> &#160; &#160; <code>?=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">various assignments</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Operator-Overloading"><a class="anchor" href="#Operator-Overloading"></a><a class="link" href="#Operator-Overloading">1.2.10. Operator overloading</a></h4>
<div class="paragraph">
<p>Groovy allows you to overload the various operators so that they can be used with your own classes. Consider this simple
class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Bucket {
    int size

    Bucket(int size) { this.size = size }

    Bucket plus(Bucket other) {                     <i class="conum" data-value="1"></i><b>(1)</b>
        return new Bucket(this.size + other.size)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Bucket</code> implements a special method called <code>plus()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just by implementing the <code>plus()</code> method, the <code>Bucket</code> class can now be used with the <code>+</code> operator like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def b1 = new Bucket(4)
def b2 = new Bucket(11)
assert (b1 + b2).size == 15                         <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The two <code>Bucket</code> objects can be added together with the <code>+</code> operator</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All (non-comparator) Groovy operators have a corresponding method that you can implement in your own classes. The only
requirements are that your method is public, has the correct name, and has the correct number of arguments. The argument
types depend on what types you want to support on the right hand side of the operator. For example, you could support
the statement</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (b1 + 11).size == 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>by implementing the <code>plus()</code> method with this signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Bucket plus(int capacity) {
    return new Bucket(this.size + capacity)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a complete list of the operators and their corresponding methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a in b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b.isCase(a)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShiftUnsigned(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asType(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.call()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegate()</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_program_structure"><a class="anchor" href="#_program_structure"></a><a class="link" href="#_program_structure">1.3. Program structure</a></h3>
<div class="paragraph">
<p>This chapter covers the program structure of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_package_names"><a class="anchor" href="#_package_names"></a><a class="link" href="#_package_names">1.3.1. Package names</a></h4>
<div class="paragraph">
<p>Package names play exactly the same role as in Java. They allow us to separate the code base without any conflicts. Groovy classes must specify their package before the class definition, else the default package is assumed.</p>
</div>
<div class="paragraph">
<p>Defining a package is very similar to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// defining a package named com.yoursite
package com.yoursite</code></pre>
</div>
</div>
<div class="paragraph">
<p>To refer to some class <code>Foo</code> in the <code>com.yoursite.com</code> package you will need to use the fully qualified name <code>com.yoursite.com.Foo</code>, or else you can use an <code>import</code> statement as we&#8217;ll see below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imports"><a class="anchor" href="#_imports"></a><a class="link" href="#_imports">1.3.2. Imports</a></h4>
<div class="paragraph">
<p>In order to refer to any class you need a qualified reference to its package. Groovy follows Java&#8217;s notion of allowing <code>import</code> statement to resolve class references.</p>
</div>
<div class="paragraph">
<p>For example, Groovy provides several builder classes, such as <code>MarkupBuilder</code>. <code>MarkupBuilder</code> is inside the package <code>groovy.xml</code> so in order to use this class, you need to <code>import</code> it as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// importing the class MarkupBuilder
import groovy.xml.MarkupBuilder

// using the imported class to create an object
def xml = new MarkupBuilder()

assert xml != null</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_default_imports"><a class="anchor" href="#_default_imports"></a><a class="link" href="#_default_imports">Default imports</a></h5>
<div class="paragraph">
<p>Default imports are the imports that Groovy language provides by default. For example look at the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new Date()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same code in Java needs an import statement to <code>Date</code> class like this: import java.util.Date. Groovy by default imports these classes for you.</p>
</div>
<div class="paragraph">
<p>The below imports are added by groovy for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.lang.*
import java.util.*
import java.io.*
import java.net.*
import groovy.lang.*
import groovy.util.*
import java.math.BigInteger
import java.math.BigDecimal</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is done because the classes from these packages are most commonly used. By importing these boilerplate code is reduced.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_import"><a class="anchor" href="#_simple_import"></a><a class="link" href="#_simple_import">Simple import</a></h5>
<div class="paragraph">
<p>A simple import is an import statement where you fully define the class name along with the package. For example the import statement import groovy.xml.MarkupBuilder in the code below is a simple import which directly refers to a class inside a package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// importing the class MarkupBuilder
import groovy.xml.MarkupBuilder

// using the imported class to create an object
def xml = new MarkupBuilder()

assert xml != null</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_star_import"><a class="anchor" href="#_star_import"></a><a class="link" href="#_star_import">Star import</a></h5>
<div class="paragraph">
<p>Groovy, like Java, provides a special way to import all classes from a package using <code>*</code>, the so-called star import. <code>MarkupBuilder</code> is a class which is in package <code>groovy.xml</code>, alongside another class called <code>StreamingMarkupBuilder</code>. In case you need to use both classes, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.xml.MarkupBuilder
import groovy.xml.StreamingMarkupBuilder

def markupBuilder = new MarkupBuilder()

assert markupBuilder != null

assert new StreamingMarkupBuilder() != null </code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s perfectly valid code. But with a <code>*</code> import, we can achieve the same effect with just one line. The star imports all the classes under package <code>groovy.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.xml.*

def markupBuilder = new MarkupBuilder()

assert markupBuilder != null

assert new StreamingMarkupBuilder() != null</code></pre>
</div>
</div>
<div class="paragraph">
<p>One problem with <code>*</code> imports is that they can clutter your local namespace. But with the kinds of aliasing provided by Groovy, this can be solved easily.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_import"><a class="anchor" href="#_static_import"></a><a class="link" href="#_static_import">Static import</a></h5>
<div class="paragraph">
<p>Groovy&#8217;s static import capability allows you to reference imported classes as if they were static methods in your own class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static Boolean.FALSE

assert !FALSE //use directly, without Boolean prefix!</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is similar to Java&#8217;s static import capability but is a more dynamic than Java in that it allows you to define methods with the same name as an imported method as long as you have different types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static java.lang.String.format <i class="conum" data-value="1"></i><b>(1)</b>

class SomeClass {

    String format(Integer i) { <i class="conum" data-value="2"></i><b>(2)</b>
        i.toString()
    }

    static void main(String[] args) {
        assert format('String') == 'String' <i class="conum" data-value="3"></i><b>(3)</b>
        assert new SomeClass().format(Integer.valueOf(1)) == '1'
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>static import of method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of method with same name as method statically imported above, but with a different parameter type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>compile error in java, but is valid groovy code</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have the same types, the imported class takes precedence.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_import_aliasing"><a class="anchor" href="#_static_import_aliasing"></a><a class="link" href="#_static_import_aliasing">Static import aliasing</a></h5>
<div class="paragraph">
<p>Static imports with the <code>as</code> keyword provide an elegant solution to namespace problems. Suppose you want to get a <code>Calendar</code> instance, using its <code>getInstance()</code> method. It&#8217;s a static method, so we can use a static import. But instead of calling <code>getInstance()</code> every time, which can be misleading when separated from its class name, we can import it with an alias, to increase code readability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static Calendar.getInstance as now

assert now().class == Calendar.getInstance().class</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, that&#8217;s clean!</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_star_import"><a class="anchor" href="#_static_star_import"></a><a class="link" href="#_static_star_import">Static star import</a></h5>
<div class="paragraph">
<p>A static star import is very similar to the regular star import. It will import all the static methods from the given class.</p>
</div>
<div class="paragraph">
<p>For example, lets say we need to calculate sines and cosines for our application.
The class <code>java.lang.Math</code> has static methods named <code>sin</code> and <code>cos</code> which fit our need. With the help of a static star import, we can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static java.lang.Math.*

assert sin(0) == 0.0
assert cos(0) == 1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we were able to access the methods <code>sin</code> and <code>cos</code> directly, without the <code>Math.</code> prefix.</p>
</div>
</div>
<div class="sect4">
<h5 id="_import_aliasing"><a class="anchor" href="#_import_aliasing"></a><a class="link" href="#_import_aliasing">Import aliasing</a></h5>
<div class="paragraph">
<p>With type aliasing, we can refer to a fully qualified class name using a name of our choice. This can be done with the <code>as</code> keyword, as before.</p>
</div>
<div class="paragraph">
<p>For example we can import <code>java.sql.Date</code> as <code>SQLDate</code> and use it in the same file as <code>java.util.Date</code> without having to use the fully qualified name of either class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.Date
import java.sql.Date as SQLDate

Date utilDate = new Date(1000L)
SQLDate sqlDate = new SQLDate(1000L)

assert utilDate instanceof java.util.Date
assert sqlDate instanceof java.sql.Date</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scripts_versus_classes"><a class="anchor" href="#_scripts_versus_classes"></a><a class="link" href="#_scripts_versus_classes">1.3.3. Scripts versus classes</a></h4>
<div class="sect4">
<h5 id="_public_static_void_main_vs_script"><a class="anchor" href="#_public_static_void_main_vs_script"></a><a class="link" href="#_public_static_void_main_vs_script">public static void main vs script</a></h5>
<div class="paragraph">
<p>Groovy supports both scripts and classes. Take the following code for example:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Main {                                    <i class="conum" data-value="1"></i><b>(1)</b>
    static void main(String... args) {          <i class="conum" data-value="2"></i><b>(2)</b>
        println 'Groovy world!'                 <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a <code>Main</code> class, the name is arbitrary</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>public static void main(String[])</code> method is usable as the main method of the class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the main body of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is typical code that you would find coming from Java, where code <strong>has</strong> to be embedded into a class to be executable.
Groovy makes it easier, the following code is equivalent:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println 'Groovy world!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A script can be considered as a class without needing to declare it, with some differences.</p>
</div>
</div>
<div class="sect4">
<h5 id="_script_class"><a class="anchor" href="#_script_class"></a><a class="link" href="#_script_class">Script class</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/Script.html">groovy.lang.Script</a> is always compiled into a class. The Groovy compiler will compile the class for you,
with the body of the script copied into a <code>run</code> method. The previous example is therefore compiled as if it was the
following:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.runtime.InvokerHelper
class Main extends Script {                     <i class="conum" data-value="1"></i><b>(1)</b>
    def run() {                                 <i class="conum" data-value="2"></i><b>(2)</b>
        println 'Groovy world!'                 <i class="conum" data-value="3"></i><b>(3)</b>
    }
    static void main(String[] args) {           <i class="conum" data-value="4"></i><b>(4)</b>
        InvokerHelper.runScript(Main, args)     <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Main</code> class extends the <code>groovy.lang.Script</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>groovy.lang.Script</code> requires a <code>run</code> method returning a value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the script body goes into the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>main</code> method is automatically generated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and delegates the execution of the script on the <code>run</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the script is in a file, then the base name of the file is used to determine the name of the generated script class.
In this example, if the name of the file is <code>Main.groovy</code>, then the script class is going to be <code>Main</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_methods"><a class="anchor" href="#_methods"></a><a class="link" href="#_methods">Methods</a></h5>
<div class="paragraph">
<p>It is possible to define methods into a script, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int fib(int n) {
    n &lt; 2 ? 1 : fib(n-1) + fib(n-2)
}
assert fib(10)==89</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mix methods and code. The generated script class will carry all methods into the script class, and
assemble all script bodies into the <code>run</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println 'Hello'                                 <i class="conum" data-value="1"></i><b>(1)</b>

int power(int n) { 2**n }                       <i class="conum" data-value="2"></i><b>(2)</b>

println "2^6==${power(6)}"                      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>script begins</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a method is defined within the script body</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and script continues</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This code is internally converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.runtime.InvokerHelper
class Main extends Script {
    int power(int n) { 2** n}                   <i class="conum" data-value="1"></i><b>(1)</b>
    def run() {
        println 'Hello'                         <i class="conum" data-value="2"></i><b>(2)</b>
        println "2^6==${power(6)}"              <i class="conum" data-value="3"></i><b>(3)</b>
    }
    static void main(String[] args) {
        InvokerHelper.runScript(Main, args)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>power</code> method is copied as is into the generated script class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>first statement is copied into the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>second statement is copied into the <code>run</code> method</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Even if Groovy creates a class from your script, it is totally transparent for the user. In particular, scripts
are compiled to bytecode, and line numbers are preserved. This implies that if an exception is thrown in a script,
the stack trace will show line numbers corresponding to the original script, not the generated code that we have shown.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_variables"><a class="anchor" href="#_variables"></a><a class="link" href="#_variables">Variables</a></h5>
<div class="paragraph">
<p>Variables in a script do not require a type definition. This means that this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int x = 1
int y = 2
assert x+y == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>will behave the same as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">x = 1
y = 2
assert x+y == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there is a semantic difference between the two:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the variable is declared as in the first example, it is a <em>local variable</em>. It will be declared in the <code>run</code>
method that the compiler will generate and will <strong>not</strong> be visible outside of the script main body. In particular, such
a variable will <strong>not</strong> be visible in other methods of the script</p>
</li>
<li>
<p>if the variable is undeclared, it goes into the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/Script.html#getBinding()">groovy.lang.Script#getBinding()</a>. The binding is
visible from the methods, and is especially important if you use a script to interact with an application and need to
share data between the script and the application. Readers might refer to the
<a href="#_integrating_groovy_in_a_java_application">integration guide</a> for more information.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Another approach to making a variable visible to all methods, is to use the
<a href="#xform-Field">@Field annotation</a>.
A variable annotated this way will become a field of the generated script class and,
as for local variables, access won&#8217;t involve the script <code>Binding</code>.
While not recommended, if you have a local variable or script field with the same name as a binding variable,
you can use <code>binding.varName</code> to access the binding variable.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_orientation"><a class="anchor" href="#_object_orientation"></a><a class="link" href="#_object_orientation">1.4. Object orientation</a></h3>
<div class="paragraph">
<p>This chapter covers the object-oriented aspects of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_types"><a class="anchor" href="#_types"></a><a class="link" href="#_types">1.4.1. Types</a></h4>
<div class="sect4">
<h5 id="_primitive_types"><a class="anchor" href="#_primitive_types"></a><a class="link" href="#_primitive_types">Primitive types</a></h5>
<div class="paragraph">
<p>Groovy supports the same primitive types as defined by the <a href="https://docs.oracle.com/javase/specs/jls/se14/html/">Java Language Specification</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>integral types: <code>byte</code> (8 bit), <code>short</code> (16 bit), <code>int</code> (32 bit) and <code>long</code> (64 bit)</p>
</li>
<li>
<p>floating-point types: <code>float</code> (32 bit) and <code>double</code> (64 bit)</p>
</li>
<li>
<p>the <code>boolean</code> type (one of <code>true</code> or <code>false</code>)</p>
</li>
<li>
<p>the <code>char</code> type (16 bit, usable as a numeric type, representing a UTF-16 code)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also like Java, Groovy uses the respective wrapper classes when objects corresponding to any
of the primitive types are required:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. primitive wrappers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Primitive type</th>
<th class="tableblock halign-left valign-top">Wrapper class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Automatic boxing and unboxing occur when, for instance, calling a method requiring
the wrapper class and passing it a primitive variable as the parameter, or vice-versa.
This is similar to Java but Groovy takes the idea further.</p>
</div>
<div class="paragraph">
<p>In most scenarios, you can treat a primitive just like it was the full object wrapper equivalent.
For instance, you can call <code>.toString()</code> or <code>.equals(other)</code> on a primitive.
Groovy autowraps and unwraps between references and primitives as needed.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example using <code>int</code> which is declared as a static field in a class (discussed shortly):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
    static int i
}

assert Foo.class.getDeclaredField('i').type == int.class           <i class="conum" data-value="1"></i><b>(1)</b>
assert Foo.i.class != int.class &amp;&amp; Foo.i.class == Integer.class    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Primitive type is respected in the bytecode</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Looking at the field at runtime shows it has been autowrapped</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you may be concerned that this means every time you use a mathematical operator on a reference to a primitive
that you&#8217;ll incur the cost of unboxing and reboxing the primitive. But this is not the case, as Groovy will compile
your operators into their <a href="core-operators.html#_operator-overloading">method equivalents</a> and uses those instead.
Additionally, Groovy will automatically unbox to a primitive when calling a Java method that takes a primitive
parameter and automatically box primitive method return values from Java. However, be aware there are some
<a href="core-differences-java.html#_primitives_and_wrappers">differences</a> from Java&#8217;s method resolution.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reference_types"><a class="anchor" href="#_reference_types"></a><a class="link" href="#_reference_types">Reference Types</a></h5>
<div class="paragraph">
<p>Apart from primitives, everything else is an object and has an associated class defining its type.
We&#8217;ll discuss classes, and class-related or class-like things like interfaces, traits and records shortly.</p>
</div>
<div class="paragraph">
<p>We might declare two variables, of type String and List, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String movie = 'The Matrix'
List actors = ['Keanu Reeves', 'Hugo Weaving']</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generics"><a class="anchor" href="#generics"></a><a class="link" href="#generics">Generics</a></h5>
<div class="paragraph">
<p>Groovy carries across the same concepts with regard to generics as Java.
When defining classes and methods, it is possible to use a type parameter and create
a generic class, interface, method or constructor.</p>
</div>
<div class="paragraph">
<p>Usage of generic classes and methods, regardless of whether they are defined in Java
or Groovy, may involve supplying a type argument.</p>
</div>
<div class="paragraph">
<p>We might declare a variable, of type <em>"list of string"</em>, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List&lt;String&gt; roles = ['Trinity', 'Morpheus']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java employs type erasure for backwards compatibility with earlier versions of Java.
Dynamic Groovy can be thought of as more aggressively applying type erasure.
In general,  less generics type information will be checked at compile time.
Groovy&#8217;s static nature employs similar checks to Java with regard to generics information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_classes"><a class="anchor" href="#_classes"></a><a class="link" href="#_classes">1.4.2. Classes</a></h4>
<div class="paragraph">
<p>Groovy classes are very similar to Java classes, and are compatible with Java ones at JVM level.
They may have methods, fields and properties (think JavaBeans properties but with less boilerplate).
Classes and class members can have the same modifiers (public, protected, private, static, etc.) as in Java
with some minor differences at the source level which are explained shortly.</p>
</div>
<div class="paragraph">
<p>The key differences between Groovy classes and their Java counterparts are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Classes or methods with no visibility modifier are automatically public (a special annotation can be used to achieve package private visibility).</p>
</li>
<li>
<p>Fields with no visibility modifier are turned into properties automatically, which results in less verbose code,
since explicit getter and setter methods aren&#8217;t needed. More on this aspect will be covered in the <a href="#fields">fields and properties section</a>.</p>
</li>
<li>
<p>Classes do not need to have the same base name as their source file definitions but it is highly recommended in most scenarios (see also the next point about scripts).</p>
</li>
<li>
<p>One source file may contain one or more classes (but if a file contains any code not in a class, it is considered a script). Scripts are just classes with some
special conventions and will have the same name as their source file (so don&#8217;t include a class definition within a script having the same name as the script source file).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code presents an example class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {                       <i class="conum" data-value="1"></i><b>(1)</b>

    String name                      <i class="conum" data-value="2"></i><b>(2)</b>
    Integer age

    def increaseAge(Integer years) { <i class="conum" data-value="3"></i><b>(3)</b>
        this.age += years
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class beginning, with the name <code>Person</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>string field and property named <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>method definition</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_normal_class"><a class="anchor" href="#_normal_class"></a><a class="link" href="#_normal_class">Normal class</a></h5>
<div class="paragraph">
<p>Normal classes refer to classes which are top level and concrete. This means they can be instantiated without restrictions from any other classes or scripts. This way, they can only be public (even though the <code>public</code> keyword may be suppressed). Classes are instantiated by calling their constructors, using the <code>new</code> keyword, as in the following snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p = new Person()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inner_class"><a class="anchor" href="#_inner_class"></a><a class="link" href="#_inner_class">Inner class</a></h5>
<div class="paragraph">
<p>Inner classes are defined within another classes. The enclosing class can use the inner class as usual. On the other side, an inner class can access members of its enclosing class, even if they are private. Classes other than the enclosing class are not allowed to access inner classes. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Outer {
    private String privateStr

    def callInnerMethod() {
        new Inner().methodA()       <i class="conum" data-value="1"></i><b>(1)</b>
    }

    class Inner {                   <i class="conum" data-value="2"></i><b>(2)</b>
        def methodA() {
            println "${privateStr}." <i class="conum" data-value="3"></i><b>(3)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the inner class is instantiated and its method gets called</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inner class definition, inside its enclosing class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>even being private, a field of the enclosing class is accessed by the inner class</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are some reasons for using inner classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They increase encapsulation by hiding the inner class from other classes, which do not need to know about it. This also leads to cleaner packages and workspaces.</p>
</li>
<li>
<p>They provide a good organization, by grouping classes that are used by only one class.</p>
</li>
<li>
<p>They lead to more maintainable codes, since inner classes are near the classes that use them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is common for an inner class to be an implementation of some interface whose method(s) are needed by the outer class.
The code below illustrates this typical usage pattern, here being used with threads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Outer2 {
    private String privateStr = 'some string'

    def startThread() {
       new Thread(new Inner2()).start()
    }

    class Inner2 implements Runnable {
        void run() {
            println "${privateStr}."
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the class <code>Inner2</code> is defined only to provide an implementation of the method <code>run</code> to class <code>Outer2</code>.
Anonymous inner classes help to eliminate verbosity in this case.
That topic is covered shortly.</p>
</div>
<div class="paragraph">
<p>Groovy 3+ also supports Java syntax for non-static inner class instantiation, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Computer {
    class Cpu {
        int coreNumber

        Cpu(int coreNumber) {
            this.coreNumber = coreNumber
        }
    }
}

assert 4 == new Computer().new Cpu(4).coreNumber</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_anonymous_inner_class"><a class="anchor" href="#_anonymous_inner_class"></a><a class="link" href="#_anonymous_inner_class">Anonymous inner class</a></h6>
<div class="paragraph">
<p>The earlier example of an inner class (<code>Inner2</code>) can be simplified with an anonymous inner class.
The same functionality can be achieved with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Outer3 {
    private String privateStr = 'some string'

    def startThread() {
        new Thread(new Runnable() {      <i class="conum" data-value="1"></i><b>(1)</b>
            void run() {
                println "${privateStr}."
            }
        }).start()                       <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>comparing with the last example of previous section, the <code>new Inner2()</code> was replaced by <code>new Runnable()</code> along with all its implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the method <code>start</code> is invoked normally</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thus, there was no need to define a new class to be used just once.</p>
</div>
</div>
<div class="sect5">
<h6 id="_abstract_class"><a class="anchor" href="#_abstract_class"></a><a class="link" href="#_abstract_class">Abstract class</a></h6>
<div class="paragraph">
<p>Abstract classes represent generic concepts, thus, they cannot be instantiated, being created to be subclassed.
Their members include fields/properties and abstract or concrete methods.
Abstract methods do not have implementation, and must be implemented by concrete subclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Abstract {         <i class="conum" data-value="1"></i><b>(1)</b>
    String name

    abstract def abstractMethod() <i class="conum" data-value="2"></i><b>(2)</b>

    def concreteMethod() {
        println 'concrete'
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>abstract classes must be declared with <code>abstract</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>abstract methods must also be declared with <code>abstract</code> keyword</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Abstract classes are commonly compared to interfaces.
There are at least two important differences of choosing one or another.
First, while abstract classes may contain fields/properties and concrete methods, interfaces may contain only abstract methods (method signatures).
Moreover, one class can implement several interfaces, whereas it can extend just one class, abstract or not.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance"><a class="anchor" href="#_inheritance"></a><a class="link" href="#_inheritance">Inheritance</a></h5>
<div class="paragraph">
<p>Inheritance in Groovy resembles inheritance in Java.
It provides a mechanism for a child class (or subclass) to reuse
code or properties from a parent (or super class).
Classes related through inheritance form an inheritance hierarchy.
Common behavior and members are pushed up the hierarchy to reduce duplication.
Specializations occur in child classes.</p>
</div>
<div class="paragraph">
<p>Different forms of inheritance are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>implementation</em> inheritance where code (methods, fields or properties) from a <a href="#superclass">superclass</a> or from
one or more <a href="#_traits">traits</a> is reused by a child class</p>
</li>
<li>
<p><em>contract</em> inheritance where a class promises to provide particular abstract methods defined in a <a href="#superclass">superclass</a>,
or defined in one or more <a href="#_traits">traits</a> or <a href="#interfaces">interfaces</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="superclass"><a class="anchor" href="#superclass"></a><a class="link" href="#superclass">Superclasses</a></h5>
<div class="paragraph">
<p>Parent classes share visible fields, properties or methods with child classes.
A child class may have at most one parent class.
The <code>extends</code> keyword is used immediately prior to giving the superclass type.</p>
</div>
</div>
<div class="sect4">
<h5 id="interfaces"><a class="anchor" href="#interfaces"></a><a class="link" href="#interfaces">Interfaces</a></h5>
<div class="paragraph">
<p>An interface defines a contract that a class needs to conform to.
An interface only defines a list of methods that need
to be implemented, but does not define the method&#8217;s implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Greeter {                                         <i class="conum" data-value="1"></i><b>(1)</b>
    void greet(String name)                                 <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an interface needs to be declared using the <code>interface</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an interface only defines method signatures</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Methods of an interface are always <strong>public</strong>. It is an error to use <code>protected</code> or <code>private</code> methods in interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Greeter {
    protected void greet(String name)           <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>protected</code> is a compile-time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A class <em>implements</em> an interface if it defines the interface in its <code>implements</code> list or if any of its superclasses
does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SystemGreeter implements Greeter {                    <i class="conum" data-value="1"></i><b>(1)</b>
    void greet(String name) {                               <i class="conum" data-value="2"></i><b>(2)</b>
        println "Hello $name"
    }
}

def greeter = new SystemGreeter()
assert greeter instanceof Greeter                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>SystemGreeter</code> declares the <code>Greeter</code> interface using the <code>implements</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then implements the required <code>greet</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Any instance of <code>SystemGreeter</code> is also an instance of the <code>Greeter</code> interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An interface can extend another interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface ExtendedGreeter extends Greeter {                 <i class="conum" data-value="1"></i><b>(1)</b>
    void sayBye(String name)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>ExtendedGreeter</code> interface extends the <code>Greeter</code> interface using the <code>extends</code> keyword</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth noting that for a class to be an instance of an interface, it has to be explicit. For example, the following
class defines the <code>greet</code> method as it is declared in the <code>Greeter</code> interface, but does not declare <code>Greeter</code> in its
interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class DefaultGreeter {
    void greet(String name) { println "Hello" }
}

greeter = new DefaultGreeter()
assert !(greeter instanceof Greeter)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, Groovy does not define structural typing. It is however possible to make an instance of an object
implement an interface at runtime, using the <code>as</code> coercion operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">greeter = new DefaultGreeter()                              <i class="conum" data-value="1"></i><b>(1)</b>
coerced = greeter as Greeter                                <i class="conum" data-value="2"></i><b>(2)</b>
assert coerced instanceof Greeter                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create an instance of <code>DefaultGreeter</code> that does not implement the interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>coerce the instance into a <code>Greeter</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the coerced instance implements the <code>Greeter</code> interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can see that there are two distinct objects: one is the source object, a <code>DefaultGreeter</code> instance, which does not
implement the interface. The other is an instance of <code>Greeter</code> that delegates to the coerced object.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Groovy interfaces do not support default implementation like Java 8 interfaces. If you are looking for something
similar (but not equal), <a href="#_traits">traits</a> are close to interfaces, but allow default implementation as well as other
important features described in this manual.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_class_members"><a class="anchor" href="#_class_members"></a><a class="link" href="#_class_members">1.4.3. Class members</a></h4>
<div class="sect4">
<h5 id="_constructors"><a class="anchor" href="#_constructors"></a><a class="link" href="#_constructors">Constructors</a></h5>
<div class="paragraph">
<p>Constructors are special methods used to initialize an object with a specific state. As with normal methods,
it is possible for a class to declare more than one constructor, so long as each constructor has a unique
type signature. If an object doesn&#8217;t require any parameters during construction, it may use a <em>no-arg</em> constructor.
If no constructors are supplied, an empty no-arg constructor will be provided by the Groovy compiler.</p>
</div>
<div class="paragraph">
<p>Groovy supports two invocation styles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>positional parameters</em> are used in a similar to how you would use Java constructors</p>
</li>
<li>
<p><em>named parameters</em> allow you to specify parameter names when invoking the constructor.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_positional_parameters"><a class="anchor" href="#_positional_parameters"></a><a class="link" href="#_positional_parameters">Positional parameters</a></h6>
<div class="paragraph">
<p>To create an object by using positional parameters, the respective class needs to declare one or more
constructors. In the case of multiple constructors, each must have a unique type signature. The constructors can also
be added to the class using the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/TupleConstructor.html">groovy.transform.TupleConstructor</a> annotation.</p>
</div>
<div class="paragraph">
<p>Typically, once at least one constructor is declared, the class can only be instantiated by having one of its
constructors called. It is worth noting that, in this case, you can&#8217;t normally create the class with named parameters.
Groovy does support named parameters so long as the class contains a no-arg constructor or provides a constructor which
takes a <code>Map</code> argument as the first (and potentially only) argument - see the next section for details.</p>
</div>
<div class="paragraph">
<p>There are three forms of using a declared constructor. The first one is the normal Java way, with the <code>new</code> keyword.
The others rely on coercion of lists into the desired types. In this case, it is possible to coerce with the <code>as</code>
keyword and by statically typing the variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class PersonConstructor {
    String name
    Integer age

    PersonConstructor(name, age) {          <i class="conum" data-value="1"></i><b>(1)</b>
        this.name = name
        this.age = age
    }
}

def person1 = new PersonConstructor('Marie', 1)  <i class="conum" data-value="2"></i><b>(2)</b>
def person2 = ['Marie', 2] as PersonConstructor  <i class="conum" data-value="3"></i><b>(3)</b>
PersonConstructor person3 = ['Marie', 3]         <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Constructor declaration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor invocation, classic Java way</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor usage, using coercion with <code>as</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Constructor usage, using coercion in assignment</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_named_parameters"><a class="anchor" href="#_named_parameters"></a><a class="link" href="#_named_parameters">Named parameters</a></h6>
<div class="paragraph">
<p>If no (or a no-arg) constructor is declared, it is possible to create objects by passing parameters in the form of a
map (property/value pairs). This can be in handy in cases where one wants to allow several combinations of parameters.
Otherwise, by using traditional positional parameters it would be necessary to declare all possible constructors.
Having a constructor where the first (and perhaps only) argument is a <code>Map</code> argument is also supported - such a
constructor may also be added using the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/MapConstructor.html">groovy.transform.MapConstructor</a> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class PersonWOConstructor {                                  <i class="conum" data-value="1"></i><b>(1)</b>
    String name
    Integer age
}

def person4 = new PersonWOConstructor()                      <i class="conum" data-value="2"></i><b>(2)</b>
def person5 = new PersonWOConstructor(name: 'Marie')         <i class="conum" data-value="3"></i><b>(3)</b>
def person6 = new PersonWOConstructor(age: 1)                <i class="conum" data-value="4"></i><b>(4)</b>
def person7 = new PersonWOConstructor(name: 'Marie', age: 2) <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No constructor declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No parameters given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>name</code> parameter given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>age</code> parameter given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>name</code> and <code>age</code> parameters given in the instantiation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to highlight, however, that this approach gives more power to the constructor caller,
while imposing an increased responsibility on the caller to get the names and value types correct.
Thus, if greater control is desired, declaring constructors using positional parameters might be preferred.</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While the example above supplied no constructor, you can also supply a no-arg constructor
or a constructor where the first argument is a <code>Map</code>, most typically it&#8217;s the only argument.</p>
</li>
<li>
<p>When no (or a no-arg) constructor is declared, Groovy replaces the named constructor call by a call
to the no-arg constructor followed by calls to the setter for each supplied named property.</p>
</li>
<li>
<p>When the first argument is a Map, Groovy combines all named parameters into a Map (regardless of ordering)
and supplies the map as the first parameter. This can be a good approach if your properties are declared as
<code>final</code> (since they will be set in the constructor rather than after the fact with setters).</p>
</li>
<li>
<p>You can support both named and positional construction
by supply both positional constructors as well as a no-arg or Map constructor.</p>
</li>
<li>
<p>You can support hybrid construction by having a constructor where the first argument
is a Map but there are also additional positional parameters. Use this style with caution.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_methods_2"><a class="anchor" href="#_methods_2"></a><a class="link" href="#_methods_2">Methods</a></h5>
<div class="paragraph">
<p>Groovy methods are quite similar to other languages. Some peculiarities will be shown in the next subsections.</p>
</div>
<div class="sect5">
<h6 id="_method_definition"><a class="anchor" href="#_method_definition"></a><a class="link" href="#_method_definition">Method definition</a></h6>
<div class="paragraph">
<p>A method is defined with a return type or with the <code>def</code> keyword, to make the return type untyped. A method can also receive any number of arguments, which may not have their types explicitly declared. Java modifiers can be used normally, and if no visibility modifier is provided, the method is public.</p>
</div>
<div class="paragraph">
<p>Methods in Groovy always return some value. If no <code>return</code> statement is provided, the value evaluated in the last line executed will be returned. For instance, note that none of the following methods uses the <code>return</code> keyword.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def someMethod() { 'method called' }                           <i class="conum" data-value="1"></i><b>(1)</b>
String anotherMethod() { 'another method called' }             <i class="conum" data-value="2"></i><b>(2)</b>
def thirdMethod(param1) { "$param1 passed" }                   <i class="conum" data-value="3"></i><b>(3)</b>
static String fourthMethod(String param1) { "$param1 passed" } <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method with no return type declared and no parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method with explicit return type and no parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method with a parameter with no type defined</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static method with a String parameter</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_named_parameters_2"><a class="anchor" href="#_named_parameters_2"></a><a class="link" href="#_named_parameters_2">Named parameters</a></h6>
<div class="paragraph">
<p>Like constructors, normal methods can also be called with named parameters.
To support this notation, a convention is used where the first argument to the method is a <code>Map</code>.
In the method body, the parameter values can be accessed as in normal maps (<code>map.key</code>).
If the method has just a single Map argument, all supplied parameters must be named.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Map args) { "${args.name}: ${args.age}" }
foo(name: 'Marie', age: 1)</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_mixing_named_and_positional_parameters"><a class="anchor" href="#_mixing_named_and_positional_parameters"></a><a class="link" href="#_mixing_named_and_positional_parameters">Mixing named and positional parameters</a></h7>
<div class="paragraph">
<p>Named parameters can be mixed with positional parameters.
The same convention applies, in this case, in addition to the <code>Map</code> argument as the first argument,
the method in question will have additional positional arguments as needed.
Supplied positional parameters when calling the method must be in order.
The named parameters can be in any position. They are grouped into the map and supplied as
the first parameter automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Map args, Integer number) { "${args.name}: ${args.age}, and the number is ${number}" }
foo(name: 'Marie', age: 1, 23)  <i class="conum" data-value="1"></i><b>(1)</b>
foo(23, name: 'Marie', age: 1)  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method call with additional <code>number</code> argument of <code>Integer</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method call with changed order of arguments</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we don&#8217;t have the Map as the first argument, then a Map must be supplied for that argument instead of named parameters.
Failure to do so will lead to <code>groovy.lang.MissingMethodException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Integer number, Map args) { "${args.name}: ${args.age}, and the number is ${number}" }
foo(name: 'Marie', age: 1, 23)  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method call throws <code>groovy.lang.MissingMethodException: No signature of method: foo() is applicable for argument types: (LinkedHashMap, Integer) values: [[name:Marie, age:1], 23]</code>, because the named argument <code>Map</code> parameter is not defined as the first argument</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Above exception can be avoided if we replace named arguments with an explicit <code>Map</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Integer number, Map args) { "${args.name}: ${args.age}, and the number is ${number}" }
foo(23, [name: 'Marie', age: 1])  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Explicit <code>Map</code> argument in place of named arguments makes invocation valid</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Although Groovy allows you to mix named and positional parameters, it can lead to unnecessary confusion.
Mix named and positional arguments with caution.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_default_arguments"><a class="anchor" href="#_default_arguments"></a><a class="link" href="#_default_arguments">Default arguments</a></h6>
<div class="paragraph">
<p>Default arguments make parameters optional.
If the argument is not supplied, the method assumes a default value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(String par1, Integer par2 = 1) { [name: par1, age: par2] }
assert foo('Marie').age == 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameters are dropped from the right, however mandatory parameters are never dropped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def baz(a = 'a', int b, c = 'c', boolean d, e = 'e') { "$a $b $c $d $e" }

assert baz(42, true) == 'a 42 c true e'
assert baz('A', 42, true) == 'A 42 c true e'
assert baz('A', 42, 'C', true) == 'A 42 C true e'
assert baz('A', 42, 'C', true, 'E') == 'A 42 C true E'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same rule applies to constructors as well as methods.
If using <code>@TupleConstructor</code>, additional configuration options apply.</p>
</div>
</div>
<div class="sect5">
<h6 id="_varargs"><a class="anchor" href="#_varargs"></a><a class="link" href="#_varargs">Varargs</a></h6>
<div class="paragraph">
<p>Groovy supports methods with a variable number of arguments. They are defined like this: <code>def foo(p1, &#8230;&#8203;, pn, T&#8230;&#8203; args)</code>.
Here <code>foo</code> supports <code>n</code> arguments by default, but also an unspecified number of further arguments exceeding <code>n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Object... args) { args.length }
assert foo() == 0
assert foo(1) == 1
assert foo(1, 2) == 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a method <code>foo</code>, that can take any number of arguments, including no arguments at all.
<code>args.length</code> will return the number of arguments given. Groovy allows <code>T[]</code> as an alternative notation to <code>T&#8230;&#8203;</code>.
That means any method with an array as last parameter is seen by Groovy as a method that can take a variable number of arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Object[] args) { args.length }
assert foo() == 0
assert foo(1) == 1
assert foo(1, 2) == 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a method with varargs is called with <code>null</code> as the vararg parameter, then the argument will be <code>null</code> and not an array of length one with <code>null</code> as the only element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Object... args) { args }
assert foo(null) == null</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a varargs method is called with an array as an argument, then the argument will be that array instead of an array of length one containing the given array as the only element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Object... args) { args }
Integer[] ints = [1, 2]
assert foo(ints) == [1, 2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important point are varargs in combination with method overloading. In case of method overloading Groovy will select the most specific method.
For example if a method <code>foo</code> takes a varargs argument of type <code>T</code> and another method <code>foo</code> also takes one argument of type <code>T</code>, the second method is preferred.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo(Object... args) { 1 }
def foo(Object x) { 2 }
assert foo() == 1
assert foo(1) == 2
assert foo(1, 2) == 1</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_method_selection_algorithm"><a class="anchor" href="#_method_selection_algorithm"></a><a class="link" href="#_method_selection_algorithm">Method selection algorithm</a></h6>
<div class="paragraph">
<p>Dynamic Groovy supports <a href="https://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatch</a> (aka multimethods).
When calling a method, the actual method invoked is determined
dynamically based on the run-time type of methods arguments.
First the method name and number of arguments will be considered (including allowance for varargs),
and then the type of each argument.
Consider the following method definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(Object o1, Object o2) { 'o/o' }
def method(Integer i, String  s) { 'i/s' }
def method(String  s, Integer i) { 's/i' }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps as expected, calling <code>method</code> with <code>String</code> and <code>Integer</code> parameters,
invokes our third method definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert method('foo', 42) == 's/i'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of more interest here is when the types are not known at compile time.
Perhaps the arguments are declared to be of type <code>Object</code> (a list of such objects in our case).
Java would determine that the <code>method(Object, Object)</code> variant would be selected in all
cases (unless casts were used) but as can be seen in the following example, Groovy uses the runtime type
and will invoke each of our methods once (and normally, no casting is needed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List&lt;List&lt;Object&gt;&gt; pairs = [['foo', 1], [2, 'bar'], [3, 4]]
assert pairs.collect { a, b -&gt; method(a, b) } == ['s/i', 'i/s', 'o/o']</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each of the first two of our three method invocations an exact match of argument types was found.
For the third invocation, an exact match of <code>method(Integer, Integer)</code> wasn&#8217;t found but <code>method(Object, Object)</code>
is still valid and will be selected.</p>
</div>
<div class="paragraph">
<p>Method selection then is about finding the <em>closest fit</em> from valid method candidates which have compatible
parameter types.
So, <code>method(Object, Object)</code> is also valid for the first two invocations but is not as close a match
as the variants where types exactly match.
To determine the closest fit, the runtime has a notion of the <em>distance</em> an actual argument
type is away from the declared parameter type and tries to minimise the total distance across all parameters.</p>
</div>
<div class="paragraph">
<p>The following table illustrates some factors which affect the distance calculation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspect</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directly implemented interfaces match more closely than ones from further up the inheritance hierarchy.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Given these interface and method definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface I1 {}
interface I2 extends I1 {}
interface I3 {}
class Clazz implements I3, I2 {}

def method(I1 i1) { 'I1' }
def method(I3 i3) { 'I3' }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The directly implemented interface will match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert method(new Clazz()) == 'I3'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">An Object array is preferred over an Object.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(Object[] arg) { 'array' }
def method(Object arg) { 'object' }

assert method([] as Object[]) == 'array'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-vararg variants are favored over vararg variants.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(String s, Object... vargs) { 'vararg' }
def method(String s) { 'non-vararg' }

assert method('foo') == 'non-vararg'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">If two vararg variants are applicable, the one which uses the minimum number of vararg arguments is preferred.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(String s, Object... vargs) { 'two vargs' }
def method(String s, Integer i, Object... vargs) { 'one varg' }

assert method('foo', 35, new Date()) == 'one varg'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interfaces are preferred over super classes.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface I {}
class Base {}
class Child extends Base implements I {}

def method(Base b) { 'superclass' }
def method(I i) { 'interface' }

assert method(new Child()) == 'interface'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For a primitive argument type, a declared parameter type which is the same or slightly larger is preferred.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(Long l) { 'Long' }
def method(Short s) { 'Short' }
def method(BigInteger bi) { 'BigInteger' }

assert method(35) == 'Long'</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the case where two variants have exactly the same distance, this is deemed ambiguous and will cause a runtime exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def method(Date d, Object o) { 'd/o' }
def method(Object o, String s) { 'o/s' }

def ex = shouldFail {
    println method(new Date(), 'baz')
}
assert ex.message.contains('Ambiguous method overloading')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Casting can be used to select the desired method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert method(new Date(), (Object)'baz') == 'd/o'
assert method((Object)new Date(), 'baz') == 'o/s'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exception_declaration"><a class="anchor" href="#_exception_declaration"></a><a class="link" href="#_exception_declaration">Exception declaration</a></h6>
<div class="paragraph">
<p>Groovy automatically allows you to treat checked exceptions like unchecked exceptions.
This means that you don&#8217;t need to declare any checked exceptions that a method may throw
as shown in the following example which can throw a <code>FileNotFoundException</code> if the file isn&#8217;t found:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def badRead() {
    new File('doesNotExist.txt').text
}

shouldFail(FileNotFoundException) {
    badRead()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nor will you be required to surround the call to the <code>badRead</code> method in the previous example within a try/catch
block - though you are free to do so if you wish.</p>
</div>
<div class="paragraph">
<p>If you wish to declare any exceptions that your code might throw (checked or otherwise) you are free to do so.
Adding exceptions won&#8217;t change how the code is used from any other Groovy code but can be seen as documentation
for the human reader of your code. The exceptions will become part of the method declaration in the bytecode,
so if your code might be called from Java, it might be useful to include them.
Using an explicit checked exception declaration is illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def badRead() throws FileNotFoundException {
    new File('doesNotExist.txt').text
}

shouldFail(FileNotFoundException) {
    badRead()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fields_and_properties"><a class="anchor" href="#_fields_and_properties"></a><a class="link" href="#_fields_and_properties">Fields and Properties</a></h5>
<div class="sect5">
<h6 id="fields"><a class="anchor" href="#fields"></a><a class="link" href="#fields">Fields</a></h6>
<div class="paragraph">
<p>A field is a member of a class, interface or trait which stores data.
A field defined in a Groovy source file has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a mandatory <em>access modifier</em> (<code>public</code>, <code>protected</code>, or <code>private</code>)</p>
</li>
<li>
<p>one or more optional <em>modifiers</em> (<code>static</code>, <code>final</code>, <code>synchronized</code>)</p>
</li>
<li>
<p>an optional <em>type</em></p>
</li>
<li>
<p>a mandatory <em>name</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Data {
    private int id                                  <i class="conum" data-value="1"></i><b>(1)</b>
    protected String description                    <i class="conum" data-value="2"></i><b>(2)</b>
    public static final boolean DEBUG = false       <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a <code>private</code> field named <code>id</code>, of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>protected</code> field named <code>description</code>, of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a <code>public static final</code> field named <em>DEBUG</em> of type <code>boolean</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A field may be initialized directly at declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Data {
    private String id = IDGenerator.next() <i class="conum" data-value="1"></i><b>(1)</b>
    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the private field <code>id</code> is initialized with <code>IDGenerator.next()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to omit the type declaration of a field. This is however considered a bad practice and in general it
is a good idea to use strong typing for fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class BadPractice {
    private mapping                         <i class="conum" data-value="1"></i><b>(1)</b>
}
class GoodPractice {
    private Map&lt;String,String&gt; mapping      <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the field <code>mapping</code> doesn&#8217;t declare a type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the field <code>mapping</code> has a strong type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The difference between the two is important if you want to use optional type checking later.
It is also important as a way to document the class design.
However, in some cases like scripting or if you want to rely on duck typing it may be useful
to omit the type.</p>
</div>
</div>
<div class="sect5">
<h6 id="properties"><a class="anchor" href="#properties"></a><a class="link" href="#properties">Properties</a></h6>
<div class="paragraph">
<p>A property is an externally visible feature of a class. Rather than just using a public field to represent
such features (which provides a more limited abstraction and would restrict refactoring possibilities),
the typical approach in Java is to follow the conventions outlined in the
<a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification</a>, i.e. represent the property using a
combination of a private backing field and getters/setters. Groovy follows these same conventions
but provides a simpler way to define the property. You can define a property with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <strong>absent</strong> access modifier (no <code>public</code>, <code>protected</code> or <code>private</code>)</p>
</li>
<li>
<p>one or more optional <em>modifiers</em> (<code>static</code>, <code>final</code>, <code>synchronized</code>)</p>
</li>
<li>
<p>an optional <em>type</em></p>
</li>
<li>
<p>a mandatory <em>name</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy will then generate the getters/setters appropriately. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name                             <i class="conum" data-value="1"></i><b>(1)</b>
    int age                                 <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a backing <code>private String name</code> field, a <code>getName</code> and a <code>setName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a backing <code>private int age</code> field, a <code>getAge</code> and a <code>setAge</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a property is declared <code>final</code>, no setter is generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    final String name                   <i class="conum" data-value="1"></i><b>(1)</b>
    final int age                       <i class="conum" data-value="2"></i><b>(2)</b>
    Person(String name, int age) {
        this.name = name                <i class="conum" data-value="3"></i><b>(3)</b>
        this.age = age                  <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>defines a read-only property of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>defines a read-only property of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>assigns the <code>name</code> parameter to the <code>name</code> field</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>assigns the <code>age</code> parameter to the <code>age</code> field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Properties are accessed by name and will call the getter or setter transparently, unless the code is in the class
which defines the property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    void name(String name) {
        this.name = "Wonder $name"      <i class="conum" data-value="1"></i><b>(1)</b>
    }
    String title() {
        this.name                       <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
def p = new Person()
p.name = 'Diana'                        <i class="conum" data-value="3"></i><b>(3)</b>
assert p.name == 'Diana'                <i class="conum" data-value="4"></i><b>(4)</b>
p.name('Woman')                         <i class="conum" data-value="5"></i><b>(5)</b>
assert p.title() == 'Wonder Woman'      <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>this.name</code> will directly access the field because the property is accessed from within the class that defines it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>similarly a read access is done directly on the <code>name</code> field</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>write access to the property is done outside of the <code>Person</code> class so it will implicitly call <code>setName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>read access to the property is done outside of the <code>Person</code> class so it will implicitly call <code>getName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>this will call the <code>name</code> method on <code>Person</code> which performs a direct access to the field</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>this will call the <code>title</code> method on <code>Person</code> which performs a direct read access to the field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth noting that this behavior of accessing the backing field directly is done in order to prevent a stack
overflow when using the property access syntax within a class that defines the property.</p>
</div>
<div class="paragraph">
<p>It is possible to list the properties of a class thanks to the meta <code>properties</code> field of an instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    int age
}
def p = new Person()
assert p.properties.keySet().containsAll(['name','age'])</code></pre>
</div>
</div>
<div class="paragraph">
<p>By convention, Groovy will recognize properties even if there is no backing field
provided there are getters or setters
that follow the Java Beans specification. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class PseudoProperties {
    // a pseudo property "name"
    void setName(String name) {}
    String getName() {}

    // a pseudo read-only property "age"
    int getAge() { 42 }

    // a pseudo write-only property "groovy"
    void setGroovy(boolean groovy) {  }
}
def p = new PseudoProperties()
p.name = 'Foo'                      <i class="conum" data-value="1"></i><b>(1)</b>
assert p.age == 42                  <i class="conum" data-value="2"></i><b>(2)</b>
p.groovy = true                     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>writing <code>p.name</code> is allowed because there is a pseudo-property <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>reading <code>p.age</code> is allowed because there is a pseudo-readonly property <code>age</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>writing <code>p.groovy</code> is allowed because there is a pseudo-write-only property <code>groovy</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This syntactic sugar is at the core of many DSLs written in Groovy.</p>
</div>
<div class="sect6">
<h7 id="_property_naming_conventions"><a class="anchor" href="#_property_naming_conventions"></a><a class="link" href="#_property_naming_conventions">Property naming conventions</a></h7>
<div class="paragraph">
<p>It is generally recommended that the first two letters of a property name are
lowercase and for multi-word properties that camel case is used.
In those cases, generated getters and setters will have a name formed by capitalizing the
property name and adding a <code>get</code> or <code>set</code> prefix (or optionally "is" for a boolean getter).
So, <code>getLength</code> would be a getter  for a <code>length</code> property and <code>setFirstName</code> a setter for a <code>firstName</code> property.
<code>isEmpty</code> might be the getter method name for a property named <code>empty</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Property names starting with a capital letter would have getters/setters with just the prefix added.
So, the property <code>Foo</code> is allowed even though it isn&#8217;t following the recommended naming conventions.
For this property, the accessor methods would be <code>setFoo</code> and <code>getFoo</code>.
A consequence of this is that you aren&#8217;t allowed to have both a <code>foo</code> and a <code>Foo</code> property,
since they would have the same named accessor methods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The JavaBeans specification makes a special case for properties which typically might be acronyms.
If the first two letters of a property name are uppercase, no capitalization is performed
(or more importantly, no decapitalization is done if generating the property name from the accessor method name).
So, <code>getURL</code> would be the getter for a <code>URL</code> property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because of the special "acronym handling" property naming logic in the JavaBeans specification, the
conversion to and from a property name are non-symmetrical. This leads to some strange edge cases.
Groovy adopts a naming convention that avoids one ambiguity that might seem a little strange but
was popular at the time of Groovy&#8217;s design and has remained (so far) for historical reasons.
Groovy looks at the second letter of a property name. If that is a capital, the property is deemed to be
one of the acronym style properties and no capitalization is done, otherwise normal capitalization is done.
Although we <em>never</em> recommend it, it does allow you to have what might seem like "duplicate named" properties,
e.g. you can have <code>aProp</code> and <code>AProp</code>, or <code>pNAME</code> and <code>PNAME</code>. The getters would be <code>getaProp</code> and <code>getAProp</code>,
and <code>getpNAME</code> and <code>getPNAME</code> respectively.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_modifiers_on_a_property"><a class="anchor" href="#_modifiers_on_a_property"></a><a class="link" href="#_modifiers_on_a_property">Modifiers on a property</a></h7>
<div class="paragraph">
<p>We have already seen that properties are defined by omitting the visibility modifier.
In general, any other modifiers, e.g. <code>transient</code> would be copied across to the field.
Two special cases are worth noting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>final</code>, which we saw earlier is for read-only properties, is copied onto the backing field but also causes no setter to be defined</p>
</li>
<li>
<p><code>static</code> is copied onto the backing field but also causes the accessor methods to be static</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you wish to have a modifier like <code>final</code> also carried over to the accessor methods,
you can write your properties long hand or consider using a <a href="#split-properties">split property definition</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_annotations_on_a_property"><a class="anchor" href="#_annotations_on_a_property"></a><a class="link" href="#_annotations_on_a_property">Annotations on a property</a></h7>
<div class="paragraph">
<p>Annotations, including those associated with AST transforms,
are copied on to the backing field for the property.
This allows AST transforms which are applicable to fields to
be applied to properties, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Animal {
    int lowerCount = 0
    @Lazy String name = { lower().toUpperCase() }()
    String lower() { lowerCount++; 'sloth' }
}

def a = new Animal()
assert a.lowerCount == 0  <i class="conum" data-value="1"></i><b>(1)</b>
assert a.name == 'SLOTH'  <i class="conum" data-value="2"></i><b>(2)</b>
assert a.lowerCount == 1  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Confirms no eager initialization</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Normal property access</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Confirms initialization upon property access</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="split-properties"><a class="anchor" href="#split-properties"></a><a class="link" href="#split-properties">Split property definition with an explicit backing field</a></h7>
<div class="paragraph">
<p>Groovy&#8217;s property syntax is a convenient shorthand when your class design
follows certain conventions which align with common JavaBean practice.
If your class doesn&#8217;t exactly fit these conventions,
you can certainly write the getter, setter and backing field long hand like you would in Java.
However, Groovy does provide a split definition capability which still provides
a shortened syntax while allowing slight adjustments to the conventions.
For a split definition, you write a field and a property with the same name and type.
Only one of the field or property may have an initial value.</p>
</div>
<div class="paragraph">
<p>For split properties, annotations on the field remain on the backing field for the property.
Annotations on the property part of the definition are copied onto the getter and setter methods.</p>
</div>
<div class="paragraph">
<p>This mechanism allows a number of common variations that property users may wish
to use if the standard property definition doesn&#8217;t exactly fit their needs.
For example, if the backing field should be <code>protected</code> rather than <code>private</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class HasPropertyWithProtectedField {
    protected String name  <i class="conum" data-value="1"></i><b>(1)</b>
    String name            <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Protected backing field for name property instead of normal private one</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare name property</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or, the same example but with a package-private backing field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class HasPropertyWithPackagePrivateField {
    String name                <i class="conum" data-value="1"></i><b>(1)</b>
    @PackageScope String name  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare name property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Package-private backing field for name property instead of normal private one</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a final example, we may wish to apply method-related AST transforms,
or in general, any annotation to the setters/getters,
e.g. to have the accessors be synchronized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class HasPropertyWithSynchronizedAccessorMethods {
    private String name        <i class="conum" data-value="1"></i><b>(1)</b>
    @Synchronized String name  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Backing field for name property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare name property with annotation for setter/getter</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_explicit_accessor_methods"><a class="anchor" href="#_explicit_accessor_methods"></a><a class="link" href="#_explicit_accessor_methods">Explicit accessor methods</a></h7>
<div class="paragraph">
<p>The automatic generation of accessor methods doesn&#8217;t occur if there
is an explicit definition of the getter or setter in the class.
This allows you to modify the normal behavior of such a getter or setter if needed.
Inherited accessor methods aren&#8217;t normally considered but if an inherited
accessor method is marked final, that will also cause no generation of an
additional accessor method to honor the <code>final</code> requirement of no subclassing of such methods.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotations"><a class="anchor" href="#_annotations"></a><a class="link" href="#_annotations">1.4.4. Annotations</a></h4>
<div class="sect4">
<h5 id="ann-definition"><a class="anchor" href="#ann-definition"></a><a class="link" href="#ann-definition">Annotation definition</a></h5>
<div class="paragraph">
<p>An annotation is a kind of special interface dedicated at annotating elements of the code. An annotation is a type which
superinterface is the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/Annotation.html">java.lang.annotation.Annotation</a> interface. Annotations are declared in a very
similar way to interfaces, using the <code>@interface</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@interface SomeAnnotation {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An annotation may define members in the form of methods without bodies and an optional default value. The possible
member types are limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>primitive types</p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/String.html">java.lang.String</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/Class.html">java.lang.Class</a></p>
</li>
<li>
<p>an <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/Enum.html">java.lang.Enum</a></p>
</li>
<li>
<p>another <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/Annotation.html">java.lang.annotation.Annotation</a></p>
</li>
<li>
<p>or any array of the above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@interface SomeAnnotation {
    String value()                          <i class="conum" data-value="1"></i><b>(1)</b>
}
@interface SomeAnnotation {
    String value() default 'something'      <i class="conum" data-value="2"></i><b>(2)</b>
}
@interface SomeAnnotation {
    int step()                              <i class="conum" data-value="3"></i><b>(3)</b>
}
@interface SomeAnnotation {
    Class appliesTo()                       <i class="conum" data-value="4"></i><b>(4)</b>
}
@interface SomeAnnotation {}
@interface SomeAnnotations {
    SomeAnnotation[] value()                <i class="conum" data-value="5"></i><b>(5)</b>
}
enum DayOfWeek { mon, tue, wed, thu, fri, sat, sun }
@interface Scheduled {
    DayOfWeek dayOfWeek()                   <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an annotation defining a <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an annotation defining a <code>value</code> member of type <code>String</code> with a default value of <code>something</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>an annotation defining a <code>step</code> member of type the primitive type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>an annotation defining a <code>appliesTo</code> member of type <code>Class</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>an annotation defining a <code>value</code> member which type is an array of another annotation type</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>an annotation defining a <code>dayOfWeek</code> member which type is the enumeration type <code>DayOfWeek</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unlike in the Java language, in Groovy, an annotation can be used to alter the semantics of the language. It is especially
true of AST transformations which will generate code based on annotations.</p>
</div>
<div class="sect5">
<h6 id="ann-placement"><a class="anchor" href="#ann-placement"></a><a class="link" href="#ann-placement">Annotation placement</a></h6>
<div class="paragraph">
<p>An annotation can be applied on various elements of the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@SomeAnnotation                 <i class="conum" data-value="1"></i><b>(1)</b>
void someMethod() {
    // ...
}

@SomeAnnotation                 <i class="conum" data-value="2"></i><b>(2)</b>
class SomeClass {}

@SomeAnnotation String var      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>someMethod</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>SomeClass</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>var</code> variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to limit the scope where an annotation can be applied, it is necessary to declare it on the annotation
definition, using the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/Target.html">java.lang.annotation.Target</a> annotation. For example, here is how you would
declare that an annotation can be applied to a class or a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.lang.annotation.ElementType
import java.lang.annotation.Target

@Target([ElementType.METHOD, ElementType.TYPE])     <i class="conum" data-value="1"></i><b>(1)</b>
@interface SomeAnnotation {}                        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Target</code> annotation is meant to annotate an annotation with a scope.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@SomeAnnotation</code> will therefore only be allowed on <code>TYPE</code> or <code>METHOD</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The list of possible targets is available in the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/ElementType.html">java.lang.annotation.ElementType</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Groovy does not support the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/ElementType.html#TYPE_PARAMETER">java.lang.annotation.ElementType#TYPE_PARAMETER</a> and
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/ElementType.html#TYPE_PARAMETER">java.lang.annotation.ElementType#TYPE_PARAMETER</a> element types which were introduced in Java 8.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_annotation_member_values"><a class="anchor" href="#_annotation_member_values"></a><a class="link" href="#_annotation_member_values">Annotation member values</a></h6>
<div class="paragraph">
<p>When an annotation is used, it is required to set at least all members that do not have a default value. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@interface Page {
    int statusCode()
}

@Page(statusCode=404)
void notFound() {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However it is possible to omit <code>value=</code> in the declaration of the value of an annotation if the member <code>value</code> is the
only one being set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@interface Page {
    String value()
    int statusCode() default 200
}

@Page(value='/home')                    <i class="conum" data-value="1"></i><b>(1)</b>
void home() {
    // ...
}

@Page('/users')                         <i class="conum" data-value="2"></i><b>(2)</b>
void userList() {
    // ...
}

@Page(value='error',statusCode=404)     <i class="conum" data-value="3"></i><b>(3)</b>
void notFound() {
    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we can omit the <code>statusCode</code> because it has a default value, but <code>value</code> needs to be set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since <code>value</code> is the only mandatory member without a default, we can omit <code>value=</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if both <code>value</code> and <code>statusCode</code> need to be set, it is required to use <code>value=</code> for the default <code>value</code> member</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_retention_policy"><a class="anchor" href="#_retention_policy"></a><a class="link" href="#_retention_policy">Retention policy</a></h6>
<div class="paragraph">
<p>The visibility of an annotation depends on its retention policy. The retention policy of an annotation is set using
the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/Retention.html">java.lang.annotation.Retention</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy

@Retention(RetentionPolicy.SOURCE)                   <i class="conum" data-value="1"></i><b>(1)</b>
@interface SomeAnnotation {}                         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Retention</code> annotation annotates the <code>@SomeAnnotation</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so <code>@SomeAnnotation</code> will have a <code>SOURCE</code> retention</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The list of possible retention targets and description is available in the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/lang/annotation/RetentionPolicy.html">java.lang.annotation.RetentionPolicy</a> enumeration. The
choice usually depends on whether you want an annotation to be visible at
compile time or runtime.</p>
</div>
</div>
<div class="sect5">
<h6 id="_closure_annotation_parameters"><a class="anchor" href="#_closure_annotation_parameters"></a><a class="link" href="#_closure_annotation_parameters">Closure annotation parameters</a></h6>
<div class="paragraph">
<p>An interesting feature of annotations in Groovy is that you can use a closure as an annotation value. Therefore
annotations may be used with a wide variety of expressions and still have IDE support. For example, imagine a
framework where you want to execute some methods based on environmental constraints like the JDK version or the OS.
One could write the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Tasks {
    Set result = []
    void alwaysExecuted() {
        result &lt;&lt; 1
    }
    @OnlyIf({ jdk&gt;=6 })
    void supportedOnlyInJDK6() {
        result &lt;&lt; 'JDK 6'
    }
    @OnlyIf({ jdk&gt;=7 &amp;&amp; windows })
    void requiresJDK7AndWindows() {
        result &lt;&lt; 'JDK 7 Windows'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>@OnlyIf</code> annotation to accept a <code>Closure</code> as an argument, you only have to declare the <code>value</code> as a <code>Class</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.RUNTIME)
@interface OnlyIf {
    Class value()                    <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the example, let&#8217;s write a sample runner that would use that information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Runner {
    static &lt;T&gt; T run(Class&lt;T&gt; taskClass) {
        def tasks = taskClass.newInstance()                                         <i class="conum" data-value="1"></i><b>(1)</b>
        def params = [jdk: 6, windows: false]                                       <i class="conum" data-value="2"></i><b>(2)</b>
        tasks.class.declaredMethods.each { m -&gt;                                     <i class="conum" data-value="3"></i><b>(3)</b>
            if (Modifier.isPublic(m.modifiers) &amp;&amp; m.parameterTypes.length == 0) {   <i class="conum" data-value="4"></i><b>(4)</b>
                def onlyIf = m.getAnnotation(OnlyIf)                                <i class="conum" data-value="5"></i><b>(5)</b>
                if (onlyIf) {
                    Closure cl = onlyIf.value().newInstance(tasks,tasks)            <i class="conum" data-value="6"></i><b>(6)</b>
                    cl.delegate = params                                            <i class="conum" data-value="7"></i><b>(7)</b>
                    if (cl()) {                                                     <i class="conum" data-value="8"></i><b>(8)</b>
                        m.invoke(tasks)                                             <i class="conum" data-value="9"></i><b>(9)</b>
                    }
                } else {
                    m.invoke(tasks)                                                 <i class="conum" data-value="10"></i><b>(10)</b>
                }
            }
        }
        tasks                                                                       <i class="conum" data-value="11"></i><b>(11)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new instance of the class passed as an argument (the task class)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>emulate an environment which is JDK 6 and not Windows</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>iterate on all declared methods of the task class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>if the method is public and takes no-argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>try to find the <code>@OnlyIf</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>if it is found get the <code>value</code> and create a new <code>Closure</code> out of it</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>set the <code>delegate</code> of the closure to our environment variable</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>call the closure, which is the annotation closure. It will return a <code>boolean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>if it is <code>true</code>, call the method</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>if the method is not annotated with <code>@OnlyIf</code>, execute the method anyway</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>after that, return the task object</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the runner can be used this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def tasks = Runner.run(Tasks)
assert tasks.result == [1, 'JDK 6'] as Set</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_meta_annotations"><a class="anchor" href="#_meta_annotations"></a><a class="link" href="#_meta_annotations">Meta-annotations</a></h5>
<div class="sect5">
<h6 id="_declaring_meta_annotations"><a class="anchor" href="#_declaring_meta_annotations"></a><a class="link" href="#_declaring_meta_annotations">Declaring meta-annotations</a></h6>
<div class="paragraph">
<p>Meta-annotations, also known as annotation aliases are annotations that
are replaced at compile time by other annotations (one meta-annotation
is an alias for one or more annotations). Meta-annotations can be used to
reduce the size of code involving multiple annotations.</p>
</div>
<div class="paragraph">
<p>Let’s start with a simple example. Imagine you have the <code>@Service</code>
and <code>@Transactional</code> annotations and that you want to annotate a class
with both:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Service
@Transactional
class MyTransactionalService {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the multiplication of annotations that you could add to the same class, a meta-annotation
could help by reducing the two annotations with a single one having the very same semantics. For example,
we might want to write this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TransactionalService                           <i class="conum" data-value="1"></i><b>(1)</b>
class MyTransactionalService {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@TransactionalService</code> is a meta-annotation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A meta-annotation is declared as a regular annotation but annotated with <code>@AnnotationCollector</code> and the
list of annotations it is collecting. In our case, the <code>@TransactionalService</code> annotation can be written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AnnotationCollector

@Service                                        <i class="conum" data-value="1"></i><b>(1)</b>
@Transactional                                  <i class="conum" data-value="2"></i><b>(2)</b>
@AnnotationCollector                            <i class="conum" data-value="3"></i><b>(3)</b>
@interface TransactionalService {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>annotate the meta-annotation with <code>@Service</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate the meta-annotation with <code>@Transactional</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>annotate the meta-annotation with <code>@AnnotationCollector</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="meta-ann-behavior"><a class="anchor" href="#meta-ann-behavior"></a><a class="link" href="#meta-ann-behavior">Behavior of meta-annotations</a></h6>
<div class="paragraph">
<p>Groovy supports both <em>precompiled</em> and <em>source form</em>
meta-annotations. This means that your meta-annotation <em>may</em> be
precompiled, or you can have it in the same source tree as the one you
are currently compiling.</p>
</div>
<div class="paragraph">
<p>INFO: Meta-annotations are a Groovy-only feature. There is
no chance for you to annotate a Java class with a meta-annotation and
hope it will do the same as in Groovy. Likewise, you cannot write a
meta-annotation in Java: both the meta-annotation definition <strong>and</strong> usage
have to be Groovy code. But you can happily collect Java annotations
and Groovy annotations within your meta-annotation.</p>
</div>
<div class="paragraph">
<p>When the Groovy compiler encounters a class annotated with a
meta-annotation, it <strong>replaces</strong> it with the collected annotations. So,
in our previous example, it will
replace <code>@TransactionalService</code> with <code>@Transactional</code> and <code>@Service</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def annotations = MyTransactionalService.annotations*.annotationType()
assert (Service in annotations)
assert (Transactional in annotations)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The conversion from a meta-annotation to the collected annotations is performed during the
<em>semantic analysis</em> compilation phase. </p>
</div>
<div class="paragraph">
<p>In addition to replacing the alias with the collected annotations, a meta-annotation is capable of
processing them, including arguments.</p>
</div>
</div>
<div class="sect5">
<h6 id="meta-ann-members"><a class="anchor" href="#meta-ann-members"></a><a class="link" href="#meta-ann-members">Meta-annotation parameters</a></h6>
<div class="paragraph">
<p>Meta-annotations can collect annotations which have parameters. To illustrate this,
we will imagine two annotations, each of them accepting one argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Timeout(after=3600)
@Dangerous(type='explosive')</code></pre>
</div>
</div>
<div class="paragraph">
<p>And suppose that you want to create a meta-annotation named <code>@Explosive</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Timeout(after=3600)
@Dangerous(type='explosive')
@AnnotationCollector
public @interface Explosive {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, when the annotations are replaced, they will get the
annotation parameter values <strong>as they were defined in the alias</strong>. More interesting,
the meta-annotation supports overriding specific values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Explosive(after=0)                 <i class="conum" data-value="1"></i><b>(1)</b>
class Bomb {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>after</code> value provided as a parameter to <code>@Explosive</code> overrides the one defined in the <code>@Timeout</code> annotation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If two annotations define the same parameter name, the default processor
will copy the annotation value to all annotations that accept this parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.RUNTIME)
public @interface Foo {
   String value()                                   <i class="conum" data-value="1"></i><b>(1)</b>
}
@Retention(RetentionPolicy.RUNTIME)
public @interface Bar {
    String value()                                  <i class="conum" data-value="2"></i><b>(2)</b>
}

@Foo
@Bar
@AnnotationCollector
public @interface FooBar {}                         <i class="conum" data-value="3"></i><b>(3)</b>

@Foo('a')
@Bar('b')
class Bob {}                                        <i class="conum" data-value="4"></i><b>(4)</b>

assert Bob.getAnnotation(Foo).value() == 'a'        <i class="conum" data-value="5"></i><b>(5)</b>
println Bob.getAnnotation(Bar).value() == 'b'       <i class="conum" data-value="6"></i><b>(6)</b>

@FooBar('a')
class Joe {}                                        <i class="conum" data-value="7"></i><b>(7)</b>
assert Joe.getAnnotation(Foo).value() == 'a'        <i class="conum" data-value="8"></i><b>(8)</b>
println Joe.getAnnotation(Bar).value() == 'a'       <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Foo</code> annotation defines the <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>@Bar</code> annotation also defines the <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>@FooBar</code> meta-annotation aggregates <code>@Foo</code> and <code>@Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>class <code>Bob</code> is annotated with <code>@Foo</code> and <code>@Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the value of the <code>@Foo</code> annotation on <code>Bob</code> is <code>a</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>while the value of the <code>@Bar</code> annotation on <code>Bob</code> is <code>b</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>class <code>Joe</code> is annotated with <code>@FooBar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then the value of the <code>@Foo</code> annotation on <code>Joe</code> is <code>a</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>and the value of the <code>@Bar</code> annotation on <code>Joe</code> is also <code>a</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the second case, the meta-annotation value was copied in
both <code>@Foo</code> and <code>@Bar</code> annotations.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is a compile time error if the collected annotations define the same members
with incompatible types. For example if on the previous example <code>@Foo</code> defined a value of
type <code>String</code> but <code>@Bar</code> defined a value of type <code>int</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is however possible to customize the behavior of meta-annotations and describe how collected
annotations are expanded. We&#8217;ll look at how to do that shortly but first there is an advanced
processing option to cover.</p>
</div>
</div>
<div class="sect5">
<h6 id="handling_duplicate_annotations"><a class="anchor" href="#handling_duplicate_annotations"></a><a class="link" href="#handling_duplicate_annotations">Handling duplicate annotations in meta-annotations</a></h6>
<div class="paragraph">
<p>The <code>@AnnotationCollector</code> annotation supports a <code>mode</code> parameter which can be used to
alter how the default processor handles annotation replacement in the presence of
duplicate annotations.</p>
</div>
<div class="paragraph">
<p>INFO: Custom processors (discussed next) may or may not support this parameter.</p>
</div>
<div class="paragraph">
<p>As an example, suppose you create a meta-annotation containing the <code>@ToString</code> annotation
and then place your meta-annotation on a class that already has an explicit <code>@ToString</code>
annotation. Should this be an error? Should both annotations be applied? Does one take
priority over the other? There is no correct answer. In some scenarios it might be
quite appropriate for any of these answers to be correct. So, rather than trying to
preempt one correct way to handle the duplicate annotation issue, Groovy lets you
write your own custom meta-annotation processors (covered next) and lets you write
whatever checking logic you like within AST transforms - which are a frequent target for
aggregating. Having said that, by simply setting the <code>mode</code>, a number of commonly
expected scenarios are handled automatically for you within any extra coding.
The behavior of the <code>mode</code> parameter is determined by the <code>AnnotationCollectorMode</code>
enum value chosen and is summarized in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DUPLICATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotations from the annotation collection will always be inserted. After all transforms have been run, it will be an error if multiple annotations (excluding those with SOURCE retention) exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PREFER_COLLECTOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotations from the collector will be added and any existing annotations with the same name will be removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PREFER_COLLECTOR_MERGED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotations from the collector will be added and any existing annotations with the same name will be removed but any new parameters found within existing annotations will be merged into the added annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PREFER_EXPLICIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotations from the collector will be ignored if any existing annotations with the same name are found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PREFER_EXPLICIT_MERGED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotations from the collector will be ignored if any existing annotations with the same name are found but any new parameters on the collector annotation will be added to existing annotations.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="meta-ann-processor"><a class="anchor" href="#meta-ann-processor"></a><a class="link" href="#meta-ann-processor">Custom meta-annotation processors</a></h6>
<div class="paragraph">
<p>A custom annotation processor will let you choose how to expand a
meta-annotation into collected annotations. The behaviour of the meta-annotation is,
in this case, totally up to you. To do this, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a meta-annotation processor, extending <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/AnnotationCollectorTransform.html">org.codehaus.groovy.transform.AnnotationCollectorTransform</a></p>
</li>
<li>
<p>declare the processor to be used in the meta-annotation declaration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, we are going to explore how the meta-annotation <code>@CompileDynamic</code> is implemented.</p>
</div>
<div class="paragraph">
<p><code>@CompileDynamic</code> is a meta-annotation that expands itself
to <code>@CompileStatic(TypeCheckingMode.SKIP)</code>. The problem is that the
default meta annotation processor doesn’t support enums and the
annotation value <code>TypeCheckingMode.SKIP</code> is one.</p>
</div>
<div class="paragraph">
<p>The naive implementation here would not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic(TypeCheckingMode.SKIP)
@AnnotationCollector
public @interface CompileDynamic {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, we will define it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@AnnotationCollector(processor = "org.codehaus.groovy.transform.CompileDynamicProcessor")
public @interface CompileDynamic {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing you may notice is that our interface is no longer
annotated with <code>@CompileStatic</code>. The reason for this is that we rely on
the <code>processor</code> parameter instead, that references a class which
will <strong>generate</strong> the annotation.</p>
</div>
<div class="paragraph">
<p>Here is how the custom processor is implemented:</p>
</div>
<div class="listingblock">
<div class="title">CompileDynamicProcessor.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
class CompileDynamicProcessor extends AnnotationCollectorTransform {            <i class="conum" data-value="2"></i><b>(2)</b>
    private static final ClassNode CS_NODE = ClassHelper.make(CompileStatic)    <i class="conum" data-value="3"></i><b>(3)</b>
    private static final ClassNode TC_NODE = ClassHelper.make(TypeCheckingMode) <i class="conum" data-value="4"></i><b>(4)</b>

    List&lt;AnnotationNode&gt; visit(AnnotationNode collector,                        <i class="conum" data-value="5"></i><b>(5)</b>
                               AnnotationNode aliasAnnotationUsage,             <i class="conum" data-value="6"></i><b>(6)</b>
                               AnnotatedNode aliasAnnotated,                    <i class="conum" data-value="7"></i><b>(7)</b>
                               SourceUnit source) {                             <i class="conum" data-value="8"></i><b>(8)</b>
        def node = new AnnotationNode(CS_NODE)                                  <i class="conum" data-value="9"></i><b>(9)</b>
        def enumRef = new PropertyExpression(
            new ClassExpression(TC_NODE), "SKIP")                               <i class="conum" data-value="10"></i><b>(10)</b>
        node.addMember("value", enumRef)                                        <i class="conum" data-value="11"></i><b>(11)</b>
        Collections.singletonList(node)                                         <i class="conum" data-value="12"></i><b>(12)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>our custom processor is written in Groovy, and for better compilation performance, we use static compilation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the custom processor has to extend <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/AnnotationCollectorTransform.html">org.codehaus.groovy.transform.AnnotationCollectorTransform</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a class node representing the <code>@CompileStatic</code> annotation type</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>create a class node representing the <code>TypeCheckingMode</code> enum type</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>collector</code> is the <code>@AnnotationCollector</code> node found in the meta-annotation. Usually unused.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>aliasAnnotationUsage</code> is the meta-annotation being expanded, here it is <code>@CompileDynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>aliasAnnotated</code> is the node being annotated with the meta-annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>sourceUnit</code> is the <code>SourceUnit</code> being compiled</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>we create a new annotation node for <code>@CompileStatic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>we create an expression equivalent to <code>TypeCheckingMode.SKIP</code></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>we add that expression to the annotation node, which is now <code>@CompileStatic(TypeCheckingMode.SKIP)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>return the generated annotation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example, the <code>visit</code> method is the only method which has to be overridden. It is meant to return a list of
annotation nodes that will be added to the node annotated with the meta-annotation. In this example, we return a
single one corresponding to <code>@CompileStatic(TypeCheckingMode.SKIP)</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_traits"><a class="anchor" href="#_traits"></a><a class="link" href="#_traits">1.4.5. Traits</a></h4>
<div class="paragraph">
<p>Traits are a structural construct of the language which allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>composition of behaviors</p>
</li>
<li>
<p>runtime implementation of interfaces</p>
</li>
<li>
<p>behavior overriding</p>
</li>
<li>
<p>compatibility with static type checking/compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be seen as <strong>interfaces</strong> carrying both <strong>default implementations</strong> and <strong>state</strong>. A trait is defined using the
<code>trait</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then it can be used like a normal interface using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Bird implements FlyingAbility {}          <i class="conum" data-value="1"></i><b>(1)</b>
def b = new Bird()                              <i class="conum" data-value="2"></i><b>(2)</b>
assert b.fly() == "I'm flying!"                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds the trait <code>FlyingAbility</code> to the <code>Bird</code> class capabilities</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instantiate a new <code>Bird</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Bird</code> class automatically gets the behavior of the <code>FlyingAbility</code> trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Traits allow a wide range of capabilities, from simple composition to testing, which are described thoroughly in this section.</p>
</div>
<div class="sect4">
<h5 id="_methods_3"><a class="anchor" href="#_methods_3"></a><a class="link" href="#_methods_3">Methods</a></h5>
<div class="sect5">
<h6 id="_public_methods"><a class="anchor" href="#_public_methods"></a><a class="link" href="#_public_methods">Public methods</a></h6>
<div class="paragraph">
<p>Declaring a method in a trait can be done like any regular method in a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_abstract_methods"><a class="anchor" href="#_abstract_methods"></a><a class="link" href="#_abstract_methods">Abstract methods</a></h6>
<div class="paragraph">
<p>In addition, traits may declare <em>abstract</em> methods too, which therefore need to be implemented in the class implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Greetable {
    abstract String name()                              <i class="conum" data-value="1"></i><b>(1)</b>
    String greeting() { "Hello, ${name()}!" }           <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implementing class will have to declare the <code>name</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be mixed with a concrete method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the trait can be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person implements Greetable {                     <i class="conum" data-value="1"></i><b>(1)</b>
    String name() { 'Bob' }                             <i class="conum" data-value="2"></i><b>(2)</b>
}

def p = new Person()
assert p.greeting() == 'Hello, Bob!'                    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implement the trait <code>Greetable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since <code>name</code> was abstract, it is required to implement it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>greeting</code> can be called</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_private_methods"><a class="anchor" href="#_private_methods"></a><a class="link" href="#_private_methods">Private methods</a></h6>
<div class="paragraph">
<p>Traits may also define private methods. Those methods will not appear in the trait contract interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Greeter {
    private String greetingMessage() {                      <i class="conum" data-value="1"></i><b>(1)</b>
        'Hello from a private method!'
    }
    String greet() {
        def m = greetingMessage()                           <i class="conum" data-value="2"></i><b>(2)</b>
        println m
        m
    }
}
class GreetingMachine implements Greeter {}                 <i class="conum" data-value="3"></i><b>(3)</b>
def g = new GreetingMachine()
assert g.greet() == "Hello from a private method!"          <i class="conum" data-value="4"></i><b>(4)</b>
try {
    assert g.greetingMessage()                              <i class="conum" data-value="5"></i><b>(5)</b>
} catch (MissingMethodException e) {
    println "greetingMessage is private in trait"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a private method <code>greetingMessage</code> in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the public <code>greet</code> message calls <code>greetingMessage</code> by default</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>greet</code> can be called</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but not <code>greetingMessage</code></td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Traits only support <code>public</code> and <code>private</code> methods. Neither <code>protected</code> nor <code>package private</code> scopes are
supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_final_methods"><a class="anchor" href="#_final_methods"></a><a class="link" href="#_final_methods">Final methods</a></h6>
<div class="paragraph">
<p>If we have a class implementing a trait, conceptually implementations from the trait methods
are "inherited" into the class. But, in reality, there is no base class containing such
implementations. Rather, they are woven directly into the class. A final modifier on a method
just indicates what the modifier will be for the woven method. While it would likely be
considered bad style to inherit and override or multiply inherit methods with the same
signature but a mix of final and non-final variants, Groovy doesn&#8217;t prohibit this scenario.
Normal method selection applies and the modifier used will be determined from the resulting method.
You might consider creating a base class which implements the desired trait(s) if you
want trait implementation methods that can&#8217;t be overridden.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_meaning_of_this"><a class="anchor" href="#_the_meaning_of_this"></a><a class="link" href="#_the_meaning_of_this">The meaning of this</a></h5>
<div class="paragraph">
<p><code>this</code> represents the implementing instance. Think of a trait as a superclass. This means that when you write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Introspector {
    def whoAmI() { this }
}
class Foo implements Introspector {}
def foo = new Foo()</code></pre>
</div>
</div>
<div class="paragraph">
<p>then calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">foo.whoAmI()</code></pre>
</div>
</div>
<div class="paragraph">
<p>will return the same instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert foo.whoAmI().is(foo)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interfaces"><a class="anchor" href="#_interfaces"></a><a class="link" href="#_interfaces">Interfaces</a></h5>
<div class="paragraph">
<p>Traits may implement interfaces, in which case the interfaces are declared using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Named {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    String name()
}
trait Greetable implements Named {                      <i class="conum" data-value="2"></i><b>(2)</b>
    String greeting() { "Hello, ${name()}!" }
}
class Person implements Greetable {                     <i class="conum" data-value="3"></i><b>(3)</b>
    String name() { 'Bob' }                             <i class="conum" data-value="4"></i><b>(4)</b>
}

def p = new Person()
assert p.greeting() == 'Hello, Bob!'                    <i class="conum" data-value="5"></i><b>(5)</b>
assert p instanceof Named                               <i class="conum" data-value="6"></i><b>(6)</b>
assert p instanceof Greetable                           <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a normal interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>add <code>Named</code> to the list of implemented interfaces</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>declare a class that implements the <code>Greetable</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>implement the missing <code>name</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>greeting</code> implementation comes from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>make sure <code>Person</code> implements the <code>Named</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>make sure <code>Person</code> implements the <code>Greetable</code> trait</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_properties"><a class="anchor" href="#_properties"></a><a class="link" href="#_properties">Properties</a></h5>
<div class="paragraph">
<p>A trait may define properties, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Named {
    String name                             <i class="conum" data-value="1"></i><b>(1)</b>
}
class Person implements Named {}            <i class="conum" data-value="2"></i><b>(2)</b>
def p = new Person(name: 'Bob')             <i class="conum" data-value="3"></i><b>(3)</b>
assert p.name == 'Bob'                      <i class="conum" data-value="4"></i><b>(4)</b>
assert p.getName() == 'Bob'                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a property <code>name</code> inside a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class which implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the property is automatically made visible</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>it can be accessed using the regular property accessor</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>or using the regular getter syntax</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_fields"><a class="anchor" href="#_fields"></a><a class="link" href="#_fields">Fields</a></h5>
<div class="sect5">
<h6 id="_private_fields"><a class="anchor" href="#_private_fields"></a><a class="link" href="#_private_fields">Private fields</a></h6>
<div class="paragraph">
<p>Since traits allow the use of private methods, it can also be interesting to use private fields to store state. Traits
will let you do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Counter {
    private int count = 0                   <i class="conum" data-value="1"></i><b>(1)</b>
    int count() { count += 1; count }       <i class="conum" data-value="2"></i><b>(2)</b>
}
class Foo implements Counter {}             <i class="conum" data-value="3"></i><b>(3)</b>
def f = new Foo()
assert f.count() == 1                       <i class="conum" data-value="4"></i><b>(4)</b>
assert f.count() == 2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a private field <code>count</code> inside a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a public method <code>count</code> that increments the counter and returns it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>declare a class that implements the <code>Counter</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>count</code> method can use the private field to keep state</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a major difference with <a href="http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">Java 8 virtual extension methods</a>. While virtual extension methods
do not carry state, traits can. Moreover, traits in Groovy are supported starting with Java 6, because their implementation does not rely on virtual extension methods. This
means that even if a trait can be seen from a Java class as a regular interface, that interface will <strong>not</strong> have default methods, only abstract ones.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_public_fields"><a class="anchor" href="#_public_fields"></a><a class="link" href="#_public_fields">Public fields</a></h6>
<div class="paragraph">
<p>Public fields work the same way as private fields, but in order to avoid the <a href="http://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">diamond problem</a>,
field names are remapped in the implementing class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Named {
    public String name                      <i class="conum" data-value="1"></i><b>(1)</b>
}
class Person implements Named {}            <i class="conum" data-value="2"></i><b>(2)</b>
def p = new Person()                        <i class="conum" data-value="3"></i><b>(3)</b>
p.Named__name = 'Bob'                       <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a public <strong>field</strong> inside the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create an instance of that class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the public field is available, but renamed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The name of the field depends on the fully qualified name of the trait. All dots (<code>.</code>) in package are replaced with an underscore (<code>_</code>), and the final name includes a double underscore.
So if the type of the field is <code>String</code>, the name of the package is <code>my.package</code>, the name of the trait is <code>Foo</code> and the name of the field is <code>bar</code>,
in the implementing class, the public field will appear as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String my_package_Foo__bar</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
While traits support public fields, it is not recommended to use them and considered as a bad practice.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composition_of_behaviors"><a class="anchor" href="#_composition_of_behaviors"></a><a class="link" href="#_composition_of_behaviors">Composition of behaviors</a></h5>
<div class="paragraph">
<p>Traits can be used to implement multiple inheritance in a controlled way. For example, we can have the following traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}
trait SpeakingAbility {
    String speak() { "I'm speaking!" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And a class implementing both traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Duck implements FlyingAbility, SpeakingAbility {} <i class="conum" data-value="1"></i><b>(1)</b>

def d = new Duck()                                      <i class="conum" data-value="2"></i><b>(2)</b>
assert d.fly() == "I'm flying!"                         <i class="conum" data-value="3"></i><b>(3)</b>
assert d.speak() == "I'm speaking!"                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Duck</code> class implements both <code>FlyingAbility</code> and <code>SpeakingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a new instance of <code>Duck</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can call the method <code>fly</code> from <code>FlyingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but also the method <code>speak</code> from <code>SpeakingAbility</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Traits encourage the reuse of capabilities among objects, and the creation of new classes by the composition of existing behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="_overriding_default_methods"><a class="anchor" href="#_overriding_default_methods"></a><a class="link" href="#_overriding_default_methods">Overriding default methods</a></h5>
<div class="paragraph">
<p>Traits provide default implementations for methods, but it is possible to override them in the implementing class. For example, we
can slightly change the example above, by having a duck which quacks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Duck implements FlyingAbility, SpeakingAbility {
    String quack() { "Quack!" }                         <i class="conum" data-value="1"></i><b>(1)</b>
    String speak() { quack() }                          <i class="conum" data-value="2"></i><b>(2)</b>
}

def d = new Duck()
assert d.fly() == "I'm flying!"                         <i class="conum" data-value="3"></i><b>(3)</b>
assert d.quack() == "Quack!"                            <i class="conum" data-value="4"></i><b>(4)</b>
assert d.speak() == "Quack!"                            <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a method specific to <code>Duck</code>, named <code>quack</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>override the default implementation of <code>speak</code> so that we use <code>quack</code> instead</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the duck is still flying, from the default implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>quack</code> comes from the <code>Duck</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>speak</code> no longer uses the default implementation from <code>SpeakingAbility</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_extending_traits"><a class="anchor" href="#_extending_traits"></a><a class="link" href="#_extending_traits">Extending traits</a></h5>
<div class="sect5">
<h6 id="_simple_inheritance"><a class="anchor" href="#_simple_inheritance"></a><a class="link" href="#_simple_inheritance">Simple inheritance</a></h6>
<div class="paragraph">
<p>Traits may extend another trait, in which case you must use the <code>extends</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Named {
    String name                                     <i class="conum" data-value="1"></i><b>(1)</b>
}
trait Polite extends Named {                        <i class="conum" data-value="2"></i><b>(2)</b>
    String introduce() { "Hello, I am $name" }      <i class="conum" data-value="3"></i><b>(3)</b>
}
class Person implements Polite {}
def p = new Person(name: 'Alice')                   <i class="conum" data-value="4"></i><b>(4)</b>
assert p.introduce() == 'Hello, I am Alice'         <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Named</code> trait defines a single <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Polite</code> trait <strong>extends</strong> the <code>Named</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Polite</code> adds a new method which has access to the <code>name</code> property of the super-trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>name</code> property is visible from the <code>Person</code> class implementing <code>Polite</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>as is the <code>introduce</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_inheritance"><a class="anchor" href="#_multiple_inheritance"></a><a class="link" href="#_multiple_inheritance">Multiple inheritance</a></h6>
<div class="paragraph">
<p>Alternatively, a trait may extend multiple traits. In that case, all super traits must be declared in the <code>implements</code>
clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait WithId {                                      <i class="conum" data-value="1"></i><b>(1)</b>
    Long id
}
trait WithName {                                    <i class="conum" data-value="2"></i><b>(2)</b>
    String name
}
trait Identified implements WithId, WithName {}     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>WithId</code> trait defines the <code>id</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>WithName</code> trait defines the <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Identified</code> is a trait which inherits both <code>WithId</code> and <code>WithName</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duck_typing_and_traits"><a class="anchor" href="#_duck_typing_and_traits"></a><a class="link" href="#_duck_typing_and_traits">Duck typing and traits</a></h5>
<div class="sect5">
<h6 id="_dynamic_code"><a class="anchor" href="#_dynamic_code"></a><a class="link" href="#_dynamic_code">Dynamic code</a></h6>
<div class="paragraph">
<p>Traits can call any dynamic code, like a normal Groovy class. This means that you can, in the body of a method, call
methods which are supposed to exist in an implementing class, without having to explicitly declare them in an interface.
This means that traits are fully compatible with duck typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait SpeakingDuck {
    String speak() { quack() }                      <i class="conum" data-value="1"></i><b>(1)</b>
}
class Duck implements SpeakingDuck {
    String methodMissing(String name, args) {
        "${name.capitalize()}!"                     <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
def d = new Duck()
assert d.speak() == 'Quack!'                        <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>SpeakingDuck</code> expects the <code>quack</code> method to be defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Duck</code> class does implement the method using <em>methodMissing</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling the <code>speak</code> method triggers a call to <code>quack</code> which is handled by <code>methodMissing</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_dynamic_methods_in_a_trait"><a class="anchor" href="#_dynamic_methods_in_a_trait"></a><a class="link" href="#_dynamic_methods_in_a_trait">Dynamic methods in a trait</a></h6>
<div class="paragraph">
<p>It is also possible for a trait to implement MOP methods like <code>methodMissing</code> or <code>propertyMissing</code>, in which case implementing classes
will inherit the behavior from the trait, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait DynamicObject {                               <i class="conum" data-value="1"></i><b>(1)</b>
    private Map props = [:]
    def methodMissing(String name, args) {
        name.toUpperCase()
    }
    def propertyMissing(String name) {
        props.get(name)
    }
    void setProperty(String name, Object value) {
        props.put(name, value)
    }
}

class Dynamic implements DynamicObject {
    String existingProperty = 'ok'                  <i class="conum" data-value="2"></i><b>(2)</b>
    String existingMethod() { 'ok' }                <i class="conum" data-value="3"></i><b>(3)</b>
}
def d = new Dynamic()
assert d.existingProperty == 'ok'                   <i class="conum" data-value="4"></i><b>(4)</b>
assert d.foo == null                                <i class="conum" data-value="5"></i><b>(5)</b>
d.foo = 'bar'                                       <i class="conum" data-value="6"></i><b>(6)</b>
assert d.foo == 'bar'                               <i class="conum" data-value="7"></i><b>(7)</b>
assert d.existingMethod() == 'ok'                   <i class="conum" data-value="8"></i><b>(8)</b>
assert d.someMethod() == 'SOMEMETHOD'               <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a trait implementing several MOP methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Dynamic</code> class defines a property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Dynamic</code> class defines a method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling an existing property will call the method from <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>calling a non-existing property will call the method from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>will call <code>setProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>will call <code>getProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>calling an existing method on <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>but calling a non-existing method thanks to the trait <code>methodMissing</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_inheritance_conflicts"><a class="anchor" href="#_multiple_inheritance_conflicts"></a><a class="link" href="#_multiple_inheritance_conflicts">Multiple inheritance conflicts</a></h5>
<div class="sect5">
<h6 id="_default_conflict_resolution"><a class="anchor" href="#_default_conflict_resolution"></a><a class="link" href="#_default_conflict_resolution">Default conflict resolution</a></h6>
<div class="paragraph">
<p>It is possible for a class to implement multiple traits. If some trait defines a method with the same signature as a
method in another trait, we have a conflict:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait A {
    String exec() { 'A' }               <i class="conum" data-value="1"></i><b>(1)</b>
}
trait B {
    String exec() { 'B' }               <i class="conum" data-value="2"></i><b>(2)</b>
}
class C implements A,B {}               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>trait <code>A</code> defines a method named <code>exec</code> returning a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>trait <code>B</code> defines the very same method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>C</code> implements both traits</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case, the default behavior is that the method from the <strong>last declared trait</strong> in the <code>implements</code> clause wins.
Here, <code>B</code> is declared after <code>A</code> so the method from <code>B</code> will be picked up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def c = new C()
assert c.exec() == 'B'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_user_conflict_resolution"><a class="anchor" href="#_user_conflict_resolution"></a><a class="link" href="#_user_conflict_resolution">User conflict resolution</a></h6>
<div class="paragraph">
<p>In case this behavior is not the one you want, you can explicitly choose which method to call using the <code>Trait.super.foo</code> syntax.
In the example above, we can ensure the method from trait A is invoked by writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class C implements A,B {
    String exec() { A.super.exec() }    <i class="conum" data-value="1"></i><b>(1)</b>
}
def c = new C()
assert c.exec() == 'A'                  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicit call of <code>exec</code> from the trait <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calls the version from <code>A</code> instead of using the default resolution, which would be the one from <code>B</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_runtime_implementation_of_traits"><a class="anchor" href="#_runtime_implementation_of_traits"></a><a class="link" href="#_runtime_implementation_of_traits">Runtime implementation of traits</a></h5>
<div class="sect5">
<h6 id="_implementing_a_trait_at_runtime"><a class="anchor" href="#_implementing_a_trait_at_runtime"></a><a class="link" href="#_implementing_a_trait_at_runtime">Implementing a trait at runtime</a></h6>
<div class="paragraph">
<p>Groovy also supports implementing traits dynamically at runtime. It allows you to "decorate" an existing object using a
trait. As an example, let&#8217;s start with this trait and the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Extra {
    String extra() { "I'm an extra method" }            <i class="conum" data-value="1"></i><b>(1)</b>
}
class Something {                                       <i class="conum" data-value="2"></i><b>(2)</b>
    String doSomething() { 'Something' }                <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Extra</code> trait defines an <code>extra</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Something</code> class does <strong>not</strong> implement the <code>Extra</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Something</code> only defines a method <code>doSomething</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then if we do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def s = new Something()
s.extra()</code></pre>
</div>
</div>
<div class="paragraph">
<p>the call to extra would fail because <code>Something</code> is not implementing <code>Extra</code>. It is possible to do it at runtime with
the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def s = new Something() as Extra                        <i class="conum" data-value="1"></i><b>(1)</b>
s.extra()                                               <i class="conum" data-value="2"></i><b>(2)</b>
s.doSomething()                                         <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of the <strong>as</strong> keyword to coerce an object to a trait <strong>at runtime</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then <code>extra</code> can be called on the object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and <code>doSomething</code> is still callable</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to a trait, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the trait <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_implementing_multiple_traits_at_once"><a class="anchor" href="#_implementing_multiple_traits_at_once"></a><a class="link" href="#_implementing_multiple_traits_at_once">Implementing multiple traits at once</a></h6>
<div class="paragraph">
<p>Should you need to implement several traits at once, you can use the <code>withTraits</code> method instead of the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait A { void methodFromA() {} }
trait B { void methodFromB() {} }

class C {}

def c = new C()
c.methodFromA()                     <i class="conum" data-value="1"></i><b>(1)</b>
c.methodFromB()                     <i class="conum" data-value="2"></i><b>(2)</b>
def d = c.withTraits A, B           <i class="conum" data-value="3"></i><b>(3)</b>
d.methodFromA()                     <i class="conum" data-value="4"></i><b>(4)</b>
d.methodFromB()                     <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>call to <code>methodFromA</code> will fail because <code>C</code> doesn&#8217;t implement <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call to <code>methodFromB</code> will fail because <code>C</code> doesn&#8217;t implement <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>withTrait</code> will wrap <code>c</code> into something which implements <code>A</code> and <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromA</code> will now pass because <code>d</code> implements <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>methodFromB</code> will now pass because <code>d</code> also implements <code>B</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to multiple traits, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the traits <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chaining_behavior"><a class="anchor" href="#_chaining_behavior"></a><a class="link" href="#_chaining_behavior">Chaining behavior</a></h5>
<div class="paragraph">
<p>Groovy supports the concept of <em>stackable traits</em>. The idea is to delegate from one trait to the other if the current trait
is not capable of handling a message. To illustrate this, let&#8217;s imagine a message handler interface like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface MessageHandler {
    void on(String message, Map payload)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can compose a message handler by applying small behaviors. For example, let&#8217;s define a default handler in the
form of a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait DefaultHandler implements MessageHandler {
    void on(String message, Map payload) {
        println "Received $message with payload $payload"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then any class can inherit the behavior of the default handler by implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SimpleHandler implements DefaultHandler {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what if you want to log all messages, in addition to the default handler? One option is to write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SimpleHandlerWithLogging implements DefaultHandler {
    void on(String message, Map payload) {                                  <i class="conum" data-value="1"></i><b>(1)</b>
        println "Seeing $message with payload $payload"                     <i class="conum" data-value="2"></i><b>(2)</b>
        DefaultHandler.super.on(message, payload)                           <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicitly implement the <code>on</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform logging</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>continue by delegating to the <code>DefaultHandler</code> trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This works but this approach has drawbacks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the logging logic is bound to a "concrete" handler</p>
</li>
<li>
<p>we have an explicit reference to <code>DefaultHandler</code> in the <code>on</code> method, meaning that if we happen to change the trait that our class implements, code will be broken</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As an alternative, we can write another trait which responsibility is limited to logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait LoggingHandler implements MessageHandler {                            <i class="conum" data-value="1"></i><b>(1)</b>
    void on(String message, Map payload) {
        println "Seeing $message with payload $payload"                     <i class="conum" data-value="2"></i><b>(2)</b>
        super.on(message, payload)                                          <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the logging handler is itself a handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the message it receives</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>super</code> makes it delegate the call to the next trait in the chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then our class can be rewritten as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class HandlerWithLogger implements DefaultHandler, LoggingHandler {}
def loggingHandler = new HandlerWithLogger()
loggingHandler.on('test logging', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing test logging with payload [:]
Received test logging with payload [:]</pre>
</div>
</div>
<div class="paragraph">
<p>As the priority rules imply that <code>LoggerHandler</code> wins because it is declared last, then a call to <code>on</code> will use
the implementation from <code>LoggingHandler</code>. But the latter has a call to <code>super</code>, which means the next trait in the
chain. Here, the next trait is <code>DefaultHandler</code> so <strong>both</strong> will be called:</p>
</div>
<div class="paragraph">
<p>The interest of this approach becomes more evident if we add a third handler, which is responsible for handling messages
that start with <code>say</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait SayHandler implements MessageHandler {
    void on(String message, Map payload) {
        if (message.startsWith("say")) {                                    <i class="conum" data-value="1"></i><b>(1)</b>
            println "I say ${message - 'say'}!"
        } else {
            super.on(message, payload)                                      <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler specific precondition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if the precondition is not met, pass the message to the next handler in the chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then our final handler looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Handler implements DefaultHandler, SayHandler, LoggingHandler {}
def h = new Handler()
h.on('foo', [:])
h.on('sayHello', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>messages will first go through the logging handler</p>
</li>
<li>
<p>the logging handler calls <code>super</code> which will delegate to the next handler, which is the <code>SayHandler</code></p>
</li>
<li>
<p>if the message starts with <code>say</code>, then the handler consumes the message</p>
</li>
<li>
<p>if not, the <code>say</code> handler delegates to the next handler in the chain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach is very powerful because it allows you to write handlers that do not know each other and yet let you
combine them in the order you want. For example, if we execute the code, it will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
Seeing sayHello with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>but if we move the logging handler to be the second one in the chain, the output is different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class AlternateHandler implements DefaultHandler, LoggingHandler, SayHandler {}
h = new AlternateHandler()
h.on('foo', [:])
h.on('sayHello', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that now, since the <code>SayHandler</code> consumes the message without calling <code>super</code>, the logging handler is
not called anymore.</p>
</div>
<div class="sect5">
<h6 id="_semantics_of_super_inside_a_trait"><a class="anchor" href="#_semantics_of_super_inside_a_trait"></a><a class="link" href="#_semantics_of_super_inside_a_trait">Semantics of super inside a trait</a></h6>
<div class="paragraph">
<p>If a class implements multiple traits and a call to an unqualified <code>super</code> is found, then:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the class implements another trait, the call delegates to the next trait in the chain</p>
</li>
<li>
<p>if there isn&#8217;t any trait left in the chain, <code>super</code> refers to the super class of the implementing class (<em>this</em>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, it is possible to decorate final classes thanks to this behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Filtering {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    StringBuilder append(String str) {                  <i class="conum" data-value="2"></i><b>(2)</b>
        def subst = str.replace('o','')                 <i class="conum" data-value="3"></i><b>(3)</b>
        super.append(subst)                             <i class="conum" data-value="4"></i><b>(4)</b>
    }
    String toString() { super.toString() }              <i class="conum" data-value="5"></i><b>(5)</b>
}
def sb = new StringBuilder().withTraits Filtering       <i class="conum" data-value="6"></i><b>(6)</b>
sb.append('Groovy')
assert sb.toString() == 'Grvy'                          <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a trait named <code>Filtering</code>, supposed to be applied on a <code>StringBuilder</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>redefine the <code>append</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>remove all 'o&#8217;s from the string</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then delegate to <code>super</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>in case <code>toString</code> is called, delegate to <code>super.toString</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>runtime implementation of the <code>Filtering</code> trait on a <code>StringBuilder</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the string which has been appended no longer contains the letter <code>o</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, when <code>super.append</code> is encountered, there is no other trait implemented by the target object, so the
method which is called is the original <code>append</code> method, that is to say the one from <code>StringBuilder</code>. The same trick
is used for <code>toString</code>, so that the string representation of the proxy object which is generated delegates to the
<code>toString</code> of the <code>StringBuilder</code> instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_features"><a class="anchor" href="#_advanced_features"></a><a class="link" href="#_advanced_features">Advanced features</a></h5>
<div class="sect5">
<h6 id="_sam_type_coercion"><a class="anchor" href="#_sam_type_coercion"></a><a class="link" href="#_sam_type_coercion">SAM type coercion</a></h6>
<div class="paragraph">
<p>If a trait defines a single abstract method, it is candidate for SAM (Single Abstract Method) type coercion. For example,
imagine the following trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Greeter {
    String greet() { "Hello $name" }        <i class="conum" data-value="1"></i><b>(1)</b>
    abstract String getName()               <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>greet</code> method is not abstract and calls the abstract method <code>getName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>getName</code> is an abstract method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since <code>getName</code> is the <em>single abstract method</em> in the <code>Greeter</code> trait, you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Greeter greeter = { 'Alice' }               <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure "becomes" the implementation of the <code>getName</code> single abstract method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>or even:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void greet(Greeter g) { println g.greet() } <i class="conum" data-value="1"></i><b>(1)</b>
greet { 'Alice' }                           <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the greet method accepts the SAM type Greeter as parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call it directly with a closure</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_differences_with_java_8_default_methods"><a class="anchor" href="#_differences_with_java_8_default_methods"></a><a class="link" href="#_differences_with_java_8_default_methods">Differences with Java 8 default methods</a></h6>
<div class="paragraph">
<p>In Java 8, interfaces can have default implementations of methods. If a class implements an interface and does not provide
an implementation for a default method, then the implementation from the interface is chosen. Traits behave the same but
with a major difference: the implementation from the trait is <strong>always</strong> used if the class declares the trait in its interface
list <strong>and</strong> that it doesn&#8217;t provide an implementation <strong>even</strong> if a super class does.</p>
</div>
<div class="paragraph">
<p>This feature can be used to compose behaviors in a very precise way, in case you want to override the behavior of an
already implemented method.</p>
</div>
<div class="paragraph">
<p>To illustrate the concept, let&#8217;s start with this simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.test.GroovyTestCase
import groovy.transform.CompileStatic
import org.codehaus.groovy.control.CompilerConfiguration
import org.codehaus.groovy.control.customizers.ASTTransformationCustomizer
import org.codehaus.groovy.control.customizers.ImportCustomizer

class SomeTest extends GroovyTestCase {
    def config
    def shell

    void setup() {
        config = new CompilerConfiguration()
        shell = new GroovyShell(config)
    }
    void testSomething() {
        assert shell.evaluate('1+1') == 2
    }
    void otherTest() { /* ... */ }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we create a simple test case which uses two properties (<em>config</em> and <em>shell</em>) and uses those in
multiple test methods. Now imagine that you want to test the same, but with another distinct compiler configuration.
One option is to create a subclass of <code>SomeTest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class AnotherTest extends SomeTest {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( ... )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It works, but what if you have actually multiple test classes, and that you want to test the new configuration for all
those test classes? Then you would have to create a distinct subclass for each test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class YetAnotherTest extends SomeTest {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( ... )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then what you see is that the <code>setup</code> method of both tests is the same. The idea, then, is to create a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait MyTestSupport {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( new ASTTransformationCustomizer(CompileStatic) )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use it in the subclasses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class AnotherTest extends SomeTest implements MyTestSupport {}
class YetAnotherTest extends SomeTest2 implements MyTestSupport {}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would allow us to dramatically reduce the boilerplate code, and reduces the risk of forgetting to change the setup
code in case we decide to change it. Even if <code>setup</code> is already implemented in the super class, since the test class declares
the trait in its interface list, the behavior will be borrowed from the trait implementation!</p>
</div>
<div class="paragraph">
<p>This feature is in particular useful when you don&#8217;t have access to the super class source code. It can be used to
mock methods or force a particular implementation of a method in a subclass. It lets you refactor your code to keep
the overridden logic in a single trait and inherit a new behavior just by implementing it. The alternative, of course,
is to override the method in <strong>every</strong> place you would have used the new code.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It&#8217;s worth noting that if you use runtime traits, the methods from the trait are <strong>always</strong> preferred to those of the proxied
object:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name                                         <i class="conum" data-value="1"></i><b>(1)</b>
}
trait Bob {
    String getName() { 'Bob' }                          <i class="conum" data-value="2"></i><b>(2)</b>
}

def p = new Person(name: 'Alice')
assert p.name == 'Alice'                                <i class="conum" data-value="3"></i><b>(3)</b>
def p2 = p as Bob                                       <i class="conum" data-value="4"></i><b>(4)</b>
assert p2.name == 'Bob'                                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class defines a <code>name</code> property which results in a <code>getName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Bob</code> is a trait which defines <code>getName</code> as returning <code>Bob</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the default object will return <em>Alice</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>p2</code> coerces <code>p</code> into <code>Bob</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>getName</code> returns <em>Bob</em> because <code>getName</code> is taken from the <strong>trait</strong></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Again, don&#8217;t forget that dynamic trait coercion returns a distinct object which only implements the original
interfaces, as well as the traits.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_differences_with_mixins"><a class="anchor" href="#_differences_with_mixins"></a><a class="link" href="#_differences_with_mixins">Differences with mixins</a></h5>
<div class="paragraph">
<p>There are several conceptual differences with mixins, as they are available in Groovy. Note that we are talking about
runtime mixins, not the @Mixin annotation which is deprecated in favour of traits.</p>
</div>
<div class="paragraph">
<p>First of all, methods defined in a trait are visible in bytecode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>internally, the trait is represented as an interface (without default or static methods) and several helper classes</p>
</li>
<li>
<p>this means that an object implementing a trait effectively implements an <em>interface</em></p>
</li>
<li>
<p>those methods are visible from Java</p>
</li>
<li>
<p>they are compatible with type checking and static compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods added through a mixin are, on the contrary, only visible at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class A { String methodFromA() { 'A' } }        <i class="conum" data-value="1"></i><b>(1)</b>
class B { String methodFromB() { 'B' } }        <i class="conum" data-value="2"></i><b>(2)</b>
A.metaClass.mixin B                             <i class="conum" data-value="3"></i><b>(3)</b>
def o = new A()
assert o.methodFromA() == 'A'                   <i class="conum" data-value="4"></i><b>(4)</b>
assert o.methodFromB() == 'B'                   <i class="conum" data-value="5"></i><b>(5)</b>
assert o instanceof A                           <i class="conum" data-value="6"></i><b>(6)</b>
assert !(o instanceof B)                        <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>B</code> defines <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>mixin B into A</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can call <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can also call <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the object is an instance of <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>but it&#8217;s <strong>not</strong> an instanceof <code>B</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The last point is actually a very important and illustrates a place where mixins have an advantage over traits: the instances
are <strong>not</strong> modified, so if you mixin some class into another, there isn&#8217;t a third class generated, and methods which respond to
A will continue responding to A even if mixed in.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_methods_properties_and_fields"><a class="anchor" href="#_static_methods_properties_and_fields"></a><a class="link" href="#_static_methods_properties_and_fields">Static methods, properties and fields</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The following instructions are subject to caution. Static member support is work in progress and still experimental. The
information below is valid for 4.0.15 only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to define static methods in a trait, but it comes with numerous limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traits with static methods cannot be compiled statically or type checked. All static methods,
properties and field are accessed dynamically (it&#8217;s a limitation from the JVM).</p>
</li>
<li>
<p>Static methods do not appear within the generated interfaces for each trait.</p>
</li>
<li>
<p>The trait is interpreted as a <em>template</em> for the implementing class, which means that each
implementing class will get its own static methods, properties and fields. So a static member
declared on a trait doesn&#8217;t belong to the <code>Trait</code>, but to its implementing class.</p>
</li>
<li>
<p>You should typically not mix static and instance methods of the same signature. The normal
rules for applying traits apply (including multiple inheritance conflict resolution). If the
method chosen is static but some implemented trait has an instance variant, a compilation error
will occur. If the method chosen is the instance variant, the static variant will be ignored
(the behavior is similar to static methods in Java interfaces for this case).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait TestHelper {
    public static boolean CALLED = false        <i class="conum" data-value="1"></i><b>(1)</b>
    static void init() {                        <i class="conum" data-value="2"></i><b>(2)</b>
        CALLED = true                           <i class="conum" data-value="3"></i><b>(3)</b>
    }
}
class Foo implements TestHelper {}
Foo.init()                                      <i class="conum" data-value="4"></i><b>(4)</b>
assert Foo.TestHelper__CALLED                   <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the static field is declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a static method is also declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the static field is updated <em>within</em> the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a static method <em>init</em> is made available to the implementing class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the static field is <em>remapped</em> to avoid the diamond issue</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As usual, it is not recommended to use public fields. Anyway, should you want this, you must understand that the following code would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Foo.CALLED = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>because there is <em>no</em> static field <em>CALLED</em> defined on the trait itself. Likewise, if you have two distinct implementing classes, each one gets a distinct static field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Bar implements TestHelper {}              <i class="conum" data-value="1"></i><b>(1)</b>
class Baz implements TestHelper {}              <i class="conum" data-value="2"></i><b>(2)</b>
Bar.init()                                      <i class="conum" data-value="3"></i><b>(3)</b>
assert Bar.TestHelper__CALLED                   <i class="conum" data-value="4"></i><b>(4)</b>
assert !Baz.TestHelper__CALLED                  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>Bar</code> implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>Baz</code> also implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>init</code> is only called on <code>Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the static field <code>CALLED</code> on <code>Bar</code> is updated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but the static field <code>CALLED</code> on <code>Baz</code> is not, because it is <strong>distinct</strong></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance_of_state_gotchas"><a class="anchor" href="#_inheritance_of_state_gotchas"></a><a class="link" href="#_inheritance_of_state_gotchas">Inheritance of state gotchas</a></h5>
<div class="paragraph">
<p>We have seen that traits are stateful. It is possible for a trait to define fields or properties, but when a class implements a trait, it gets those fields/properties on
a per-trait basis. So consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait IntCouple {
    int x = 1
    int y = 2
    int sum() { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The trait defines two properties, <code>x</code> and <code>y</code>, as well as a <code>sum</code> method. Now let&#8217;s create a class which implements the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class BaseElem implements IntCouple {
    int f() { sum() }
}
def base = new BaseElem()
assert base.f() == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of calling <code>f</code> is <code>3</code>, because <code>f</code> delegates to <code>sum</code> in the trait, which has state. But what if we write this instead?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Elem implements IntCouple {
    int x = 3                                       <i class="conum" data-value="1"></i><b>(1)</b>
    int y = 4                                       <i class="conum" data-value="2"></i><b>(2)</b>
    int f() { sum() }                               <i class="conum" data-value="3"></i><b>(3)</b>
}
def elem = new Elem()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override property <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Override property <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call <code>sum</code> from trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you call <code>elem.f()</code>, what is the expected output? Actually it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert elem.f() == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that the <code>sum</code> method accesses the <em>fields</em> of the trait. So it is using the <code>x</code> and <code>y</code> values defined
in the trait. If you want to use the values from the implementing class, then you need to dereference fields by using
getters and setters, like in this last example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait IntCouple {
    int x = 1
    int y = 2
    int sum() { getX()+getY() }
}

class Elem implements IntCouple {
    int x = 3
    int y = 4
    int f() { sum() }
}
def elem = new Elem()
assert elem.f() == 7</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_self_types"><a class="anchor" href="#_self_types"></a><a class="link" href="#_self_types">Self types</a></h5>
<div class="sect5">
<h6 id="_type_constraints_on_traits"><a class="anchor" href="#_type_constraints_on_traits"></a><a class="link" href="#_type_constraints_on_traits">Type constraints on traits</a></h6>
<div class="paragraph">
<p>Sometimes you will want to write a trait that can only be applied to some type. For example, you may want to apply a
trait on a class that extends another class which is beyond your control, and still be able to call those methods.
To illustrate this, let&#8217;s start with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class CommunicationService {
    static void sendMessage(String from, String to, String message) {       <i class="conum" data-value="1"></i><b>(1)</b>
        println "$from sent [$message] to $to"
    }
}

class Device { String id }                                                  <i class="conum" data-value="2"></i><b>(2)</b>

trait Communicating {
    void sendMessage(Device to, String message) {
        CommunicationService.sendMessage(id, to.id, message)                <i class="conum" data-value="3"></i><b>(3)</b>
    }
}

class MyDevice extends Device implements Communicating {}                   <i class="conum" data-value="4"></i><b>(4)</b>

def bob = new MyDevice(id:'Bob')
def alice = new MyDevice(id:'Alice')
bob.sendMessage(alice,'secret')                                             <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>Service</code> class, beyond your control (in a library, &#8230;&#8203;) defines a <code>sendMessage</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>Device</code> class, beyond your control (in a library, &#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines a communicating trait for devices that can call the service</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defines <code>MyDevice</code> as a communicating device</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The method from the trait is called, and <code>id</code> is resolved</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is clear, here, that the <code>Communicating</code> trait can only apply to <code>Device</code>. However, there&#8217;s no explicit
contract to indicate that, because traits cannot extend classes. However, the code compiles and runs perfectly
fine, because <code>id</code> in the trait method will be resolved dynamically. The problem is that there is nothing that
prevents the trait from being applied to any class which is <strong>not</strong> a <code>Device</code>. Any class which has an <code>id</code> would
work, while any class that does not have an <code>id</code> property would cause a runtime error.</p>
</div>
<div class="paragraph">
<p>The problem is even more complex if you want to enable type checking or apply <code>@CompileStatic</code> on the trait: because
the trait knows nothing about itself being a <code>Device</code>, the type checker will complain saying that it does not find
the <code>id</code> property.</p>
</div>
<div class="paragraph">
<p>One possibility is to explicitly add a <code>getId</code> method in the trait, but it would not solve all issues. What if a method
requires <code>this</code> as a parameter, and actually requires it to be a <code>Device</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SecurityService {
    static void check(Device d) { if (d.id==null) throw new SecurityException() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to be able to call <code>this</code> in the trait, then you will explicitly need to cast <code>this</code> into a <code>Device</code>. This can
quickly become unreadable with explicit casts to <code>this</code> everywhere.</p>
</div>
</div>
<div class="sect5">
<h6 id="traits-selftype"><a class="anchor" href="#traits-selftype"></a><a class="link" href="#traits-selftype">The @SelfType annotation</a></h6>
<div class="paragraph">
<p>In order to make this contract explicit, and to make the type checker aware of the <em>type of itself</em>, Groovy provides
a <code>@SelfType</code> annotation that will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>let you declare the types that a class that implements this trait must inherit or implement</p>
</li>
<li>
<p>throw a compile-time error if those type constraints are not satisfied</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So in our previous example, we can fix the trait using the <code>@groovy.transform.SelfType</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@SelfType(Device)
@CompileStatic
trait Communicating {
    void sendMessage(Device to, String message) {
        SecurityService.check(this)
        CommunicationService.sendMessage(id, to.id, message)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you try to implement this trait on a class that is <strong>not</strong> a device, a compile-time error will occur:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyDevice implements Communicating {} // forgot to extend Device</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class 'MyDevice' implements trait 'Communicating' but does not extend self type class 'Device'</pre>
</div>
</div>
<div class="paragraph">
<p>In conclusion, self types are a powerful way of declaring constraints on traits without having to declare the contract
directly in the trait or having to use casts everywhere, maintaining separation of concerns as tight as it should be.</p>
</div>
</div>
<div class="sect5">
<h6 id="_differences_with_sealed_annotation_incubating"><a class="anchor" href="#_differences_with_sealed_annotation_incubating"></a><a class="link" href="#_differences_with_sealed_annotation_incubating">Differences with Sealed annotation (incubating)</a></h6>
<div class="paragraph">
<p>Both <code>@Sealed</code> and <code>@SelfType</code> restrict classes which use a trait but in orthogonal ways.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface HasHeight { double getHeight() }
interface HasArea { double getArea() }

@SelfType([HasHeight, HasArea])                       <i class="conum" data-value="1"></i><b>(1)</b>
@Sealed(permittedSubclasses=[UnitCylinder,UnitCube])  <i class="conum" data-value="2"></i><b>(2)</b>
trait HasVolume {
    double getVolume() { height * area }
}

final class UnitCube implements HasVolume, HasHeight, HasArea {
    // for the purposes of this example: h=1, w=1, l=1
    double height = 1d
    double area = 1d
}

final class UnitCylinder implements HasVolume, HasHeight, HasArea {
    // for the purposes of this example: h=1, diameter=1
    // radius=diameter/2, area=PI * r^2
    double height = 1d
    double area = Math.PI * 0.5d**2
}

assert new UnitCube().volume == 1d
assert new UnitCylinder().volume == 0.7853981633974483d</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All usages of the <code>HasVolume</code> trait must implement or extend both <code>HasHeight</code> and <code>HasArea</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Only <code>UnitCube</code> or <code>UnitCylinder</code> can use the trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the degenerate case where a single class implements a trait, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">final class Foo implements FooTrait {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, either:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@SelfType(Foo)
trait FooTrait {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Sealed(permittedSubclasses='Foo') <i class="conum" data-value="1"></i><b>(1)</b>
trait FooTrait {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Or just <code>@Sealed</code> if <code>Foo</code> and <code>FooTrait</code> are in the same source file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>could express this constraint. Generally, the former of these is preferred.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_limitations"><a class="anchor" href="#_limitations"></a><a class="link" href="#_limitations">Limitations</a></h5>
<div class="sect5">
<h6 id="_compatibility_with_ast_transformations"><a class="anchor" href="#_compatibility_with_ast_transformations"></a><a class="link" href="#_compatibility_with_ast_transformations">Compatibility with AST transformations</a></h6>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Traits are not officially compatible with AST transformations. Some of them, like <code>@CompileStatic</code> will be applied
on the trait itself (not on implementing classes), while others will apply on both the implementing class and the trait.
There is absolutely no guarantee that an AST transformation will run on a trait as it does on a regular class, so use it
at your own risk!
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_prefix_and_postfix_operations"><a class="anchor" href="#_prefix_and_postfix_operations"></a><a class="link" href="#_prefix_and_postfix_operations">Prefix and postfix operations</a></h6>
<div class="paragraph">
<p>Within traits, prefix and postfix operations are not allowed if they update a field of the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait Counting {
    int x
    void inc() {
        x++                             <i class="conum" data-value="1"></i><b>(1)</b>
    }
    void dec() {
        --x                             <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
class Counter implements Counting {}
def c = new Counter()
c.inc()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>x</code> is defined within the trait, postfix increment is not allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>x</code> is defined within the trait, prefix decrement is not allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A workaround is to use the <code>+=</code> operator instead.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_record_classes_incubating"><a class="anchor" href="#_record_classes_incubating"></a><a class="link" href="#_record_classes_incubating">1.4.6. Record classes (incubating)</a></h4>
<div class="paragraph">
<p>Record classes, or <em>records</em> for short, are a special kind of class
useful for modelling plain data aggregates.
They provide a compact syntax with less ceremony than normal classes.
Groovy already has AST transforms such as <code>@Immutable</code> and <code>@Canonical</code>
which already dramatically reduce ceremony but records have been
introduced in Java and record classes in Groovy are designed to align
with Java record classes.</p>
</div>
<div class="paragraph">
<p>For example, suppose we want to create a <code>Message</code> record
representing an email message. For the purposes of this example,
let&#8217;s simplify such a message to contain just a <em>from</em> email address,
a <em>to</em> email address, and a message <em>body</em>. We can define such
a record as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Message(String from, String to, String body) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;d use the record class in the same way as a normal class, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def msg = new Message('me@myhost.com', 'you@yourhost.net', 'Hello!')
assert msg.toString() == 'Message[from=me@myhost.com, to=you@yourhost.net, body=Hello!]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reduced ceremony saves us from defining explicit fields, getters and
<code>toString</code>, <code>equals</code> and <code>hashCode</code> methods. In fact, it&#8217;s a shorthand
for the following rough equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">final class Message extends Record {
    private final String from
    private final String to
    private final String body
    private static final long serialVersionUID = 0

    /* constructor(s) */

    final String toString() { /*...*/ }

    final boolean equals(Object other) { /*...*/ }

    final int hashCode() { /*...*/ }

    String from() { from }
    // other getters ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the special naming convention for record getters. They are the same name as the field
(rather than the often common JavaBean convention of capitalized with a "get" prefix).
Rather than referring to a record&#8217;s fields or properties, the term <em>component</em>
is typically used for records. So our <code>Message</code> record has <code>from</code>, <code>to</code>, and <code>body</code> components.</p>
</div>
<div class="paragraph">
<p>Like in Java, you can override the normally implicitly supplied methods
by writing your own:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Point3D(int x, int y, int z) {
    String toString() {
        "Point3D[coords=$x,$y,$z]"
    }
}

assert new Point3D(10, 20, 30).toString() == 'Point3D[coords=10,20,30]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use generics with records in the normal way. For example, consider the following <code>Coord</code> record definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Coord&lt;T extends Number&gt;(T v1, T v2){
    double distFromOrigin() { Math.sqrt(v1()**2 + v2()**2 as double) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def r1 = new Coord&lt;Integer&gt;(3, 4)
assert r1.distFromOrigin() == 5
def r2 = new Coord&lt;Double&gt;(6d, 2.5d)
assert r2.distFromOrigin() == 6.5d</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_special_record_features"><a class="anchor" href="#_special_record_features"></a><a class="link" href="#_special_record_features">Special record features</a></h5>
<div class="sect5">
<h6 id="_compact_constructor"><a class="anchor" href="#_compact_constructor"></a><a class="link" href="#_compact_constructor">Compact constructor</a></h6>
<div class="paragraph">
<p>Records have an implicit constructor. This can be overridden in the normal way
by providing your own constructor - you need to make sure you set all the fields
if you do this.
However, for succinctness, a compact constructor syntax can be used where
the parameter declaration part of a normal constructor is elided.
For this special case, the normal implicit constructor is still provided
but is augmented by the supplied statements in the compact constructor definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public record Warning(String message) {
    public Warning {
        Objects.requireNonNull(message)
        message = message.toUpperCase()
    }
}

def w = new Warning('Help')
assert w.message() == 'HELP'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_serializability"><a class="anchor" href="#_serializability"></a><a class="link" href="#_serializability">Serializability</a></h6>
<div class="paragraph">
<p>Groovy <em>native</em> records follow the
<a href="https://docs.oracle.com/en/java/javase/16/docs/specs/records-serialization.html">special conventions</a>
for serializability which apply to Java records.
Groovy <em>record-like</em> classes (discussed below) follow normal Java class serializability conventions.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovy_enhancements"><a class="anchor" href="#_groovy_enhancements"></a><a class="link" href="#_groovy_enhancements">Groovy enhancements</a></h5>
<div class="sect5">
<h6 id="_argument_defaults"><a class="anchor" href="#_argument_defaults"></a><a class="link" href="#_argument_defaults">Argument defaults</a></h6>
<div class="paragraph">
<p>Groovy supports default values for constructor arguments.
This capability is also available for records as shown in the following record definition
which has default values for <code>y</code> and <code>color</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record ColoredPoint(int x, int y = 0, String color = 'white') {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Arguments when left off (dropping one or more arguments from the right) are replaced
with their defaults values as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new ColoredPoint(5, 5, 'black').toString() == 'ColoredPoint[x=5, y=5, color=black]'
assert new ColoredPoint(5, 5).toString() == 'ColoredPoint[x=5, y=5, color=white]'
assert new ColoredPoint(5).toString() == 'ColoredPoint[x=5, y=0, color=white]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This processing follows normal Groovy conventions for default arguments for constructors, essentially automatically providing the constructors with the following signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">ColoredPoint(int, int, String)
ColoredPoint(int, int)
ColoredPoint(int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Named arguments may also be used (default values also apply here):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new ColoredPoint(x: 5).toString() == 'ColoredPoint[x=5, y=0, color=white]'
assert new ColoredPoint(x: 0, y: 5).toString() == 'ColoredPoint[x=0, y=5, color=white]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can disable default argument processing as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TupleConstructor(defaultsMode=DefaultsMode.OFF)
record ColoredPoint2(int x, int y, String color) {}
assert new ColoredPoint2(4, 5, 'red').toString() == 'ColoredPoint2[x=4, y=5, color=red]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a single constructor as per the default with Java.
It will be an error if you drop off arguments in this scenario.</p>
</div>
<div class="paragraph">
<p>You can force all properties to have a default value as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TupleConstructor(defaultsMode=DefaultsMode.ON)
record ColoredPoint3(int x, int y = 0, String color = 'white') {}
assert new ColoredPoint3(y: 5).toString() == 'ColoredPoint3[x=0, y=5, color=white]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any property/field without an explicit initial value will be given the default value for the argument&#8217;s type (null, or zero/false for primitives).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Diving deeper</div>
<div class="paragraph">
<p>We previously described a <code>Message</code> record and displayed it&#8217;s rough equivalent.
Groovy in fact steps through an intermediate stage where the <code>record</code> keyword
is replaced by the <code>class</code> keyword and an accompanying <code>@RecordType</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@RecordType
class Message {
    String from
    String to
    String body
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>@RecordType</code> itself is processed as a <em>meta-annotation</em> (annotation collector)
and expanded into its constituent sub-annotations such as <code>@TupleConstructor</code>, <code>@POJO</code>,
<code>@RecordBase</code>, and others. This is in some sense an implementation detail which can often be ignored.
However, if you wish to customise or configure the record implementation,
you may wish to drop back to the <code>@RecordType</code> style or augment your record class
with one of the constituent sub-annotations.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_declarative_tostring_customization"><a class="anchor" href="#_declarative_tostring_customization"></a><a class="link" href="#_declarative_tostring_customization">Declarative <code>toString</code> customization</a></h6>
<div class="paragraph">
<p>As per Java, you can customize a record&#8217;s <code>toString</code> method by writing your own.
If you prefer a more declarative style, you can alternatively use Groovy&#8217;s <code>@ToString</code> transform
to override the default record <code>toString</code>.
As an example, you can a three-dimensional point record as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package threed

import groovy.transform.ToString

@ToString(ignoreNulls=true, cache=true, includeNames=true,
          leftDelimiter='[', rightDelimiter=']', nameValueSeparator='=')
record Point(Integer x, Integer y, Integer z=null) { }

assert new Point(10, 20).toString() == 'threed.Point[x=10, y=20]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>We customise the <code>toString</code> by including the package name (excluded by default for records)
and by caching the <code>toString</code> value since it won&#8217;t change for this immutable record.
We are also ignoring null values (the default value for <code>z</code> in our definition).</p>
</div>
<div class="paragraph">
<p>We can have a similar definition for a two-dimensional point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package twod

import groovy.transform.ToString

@ToString(ignoreNulls=true, cache=true, includeNames=true,
          leftDelimiter='[', rightDelimiter=']', nameValueSeparator='=')
record Point(Integer x, Integer y) { }

assert new Point(10, 20).toString() == 'twod.Point[x=10, y=20]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see here that without the package name it would have the same toString as our previous example.</p>
</div>
</div>
<div class="sect5">
<h6 id="_obtaining_a_list_of_the_record_component_values"><a class="anchor" href="#_obtaining_a_list_of_the_record_component_values"></a><a class="link" href="#_obtaining_a_list_of_the_record_component_values">Obtaining a list of the record component values</a></h6>
<div class="paragraph">
<p>We can obtain the component values from a record as a list like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Point(int x, int y, String color) { }

def p = new Point(100, 200, 'green')
def (x, y, c) = p.toList()
assert x == 100
assert y == 200
assert c == 'green'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>@RecordOptions(toList=false)</code> to disable this feature.</p>
</div>
</div>
<div class="sect5">
<h6 id="_obtaining_a_map_of_the_record_component_values"><a class="anchor" href="#_obtaining_a_map_of_the_record_component_values"></a><a class="link" href="#_obtaining_a_map_of_the_record_component_values">Obtaining a map of the record component values</a></h6>
<div class="paragraph">
<p>We can obtain the component values from a record as a map like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Point(int x, int y, String color) { }

def p = new Point(100, 200, 'green')
assert p.toMap() == [x: 100, y: 200, color: 'green']</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>@RecordOptions(toMap=false)</code> to disable this feature.</p>
</div>
</div>
<div class="sect5">
<h6 id="_obtaining_the_number_of_components_in_a_record"><a class="anchor" href="#_obtaining_the_number_of_components_in_a_record"></a><a class="link" href="#_obtaining_the_number_of_components_in_a_record">Obtaining the number of components in a record</a></h6>
<div class="paragraph">
<p>We can obtain the number of components in a record like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Point(int x, int y, String color) { }

def p = new Point(100, 200, 'green')
assert p.size() == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>@RecordOptions(size=false)</code> to disable this feature.</p>
</div>
</div>
<div class="sect5">
<h6 id="_obtaining_the_nth_component_from_a_record"><a class="anchor" href="#_obtaining_the_nth_component_from_a_record"></a><a class="link" href="#_obtaining_the_nth_component_from_a_record">Obtaining the n<sup>th</sup> component from a record</a></h6>
<div class="paragraph">
<p>We can use Groovy&#8217;s normal positional indexing to obtain a particular component in a record like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">record Point(int x, int y, String color) { }

def p = new Point(100, 200, 'green')
assert p[1] == 200</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>@RecordOptions(getAt=false)</code> to disable this feature.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_groovy_features"><a class="anchor" href="#_optional_groovy_features"></a><a class="link" href="#_optional_groovy_features">Optional Groovy features</a></h5>
<div class="sect5">
<h6 id="_copying"><a class="anchor" href="#_copying"></a><a class="link" href="#_copying">Copying</a></h6>
<div class="paragraph">
<p>It can be useful to make a copy of a record with some components changed.
This can be done using an optional <code>copyWith</code> method which takes named arguments.
Record components are set from the supplied arguments.
For components not mentioned, a (shallow) copy of the original record component is used.
Here is how you might use <code>copyWith</code> for the <code>Fruit</code> record:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@RecordOptions(copyWith=true)
record Fruit(String name, double price) {}
def apple = new Fruit('Apple', 11.6)
assert 'Apple' == apple.name()
assert 11.6 == apple.price()

def orange = apple.copyWith(name: 'Orange')
assert orange.toString() == 'Fruit[name=Orange, price=11.6]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>copyWith</code> functionality can be disabled by setting the
<code>RecordOptions#copyWith</code> annotation attribute to <code>false</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_deep_immutability"><a class="anchor" href="#_deep_immutability"></a><a class="link" href="#_deep_immutability">Deep immutability</a></h6>
<div class="paragraph">
<p>As with Java, records by default offer shallow immutability.
Groovy&#8217;s <code>@Immutable</code> transform performs defensive copying for a range of mutable
data types. Records can make use of this defensive copying to gain deep immutability as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ImmutableProperties
record Shopping(List items) {}

def items = ['bread', 'milk']
def shop = new Shopping(items)
items &lt;&lt; 'chocolate'
assert shop.items() == ['bread', 'milk']</code></pre>
</div>
</div>
<div class="paragraph">
<p>These examples illustrate the principal behind
Groovy&#8217;s record feature offering three levels of convenience:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>record</code> keyword for maximum succinctness</p>
</li>
<li>
<p>Supporting low-ceremony customization using declarative annotations</p>
</li>
<li>
<p>Allowing normal method implementations when full control is required</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_obtaining_the_components_of_a_record_as_a_typed_tuple"><a class="anchor" href="#_obtaining_the_components_of_a_record_as_a_typed_tuple"></a><a class="link" href="#_obtaining_the_components_of_a_record_as_a_typed_tuple">Obtaining the components of a record as a typed tuple</a></h6>
<div class="paragraph">
<p>You can obtain the components of a record as a typed tuple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@RecordOptions(components=true)
record Point(int x, int y, String color) { }

@CompileStatic
def method() {
    def p1 = new Point(100, 200, 'green')
    def (int x1, int y1, String c1) = p1.components()
    assert x1 == 100
    assert y1 == 200
    assert c1 == 'green'

    def p2 = new Point(10, 20, 'blue')
    def (x2, y2, c2) = p2.components()
    assert x2 * 10 == 100
    assert y2 ** 2 == 400
    assert c2.toUpperCase() == 'BLUE'

    def p3 = new Point(1, 2, 'red')
    assert p3.components() instanceof Tuple3
}

method()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy has a limited number of <code>TupleN</code> classes.
If you have a large number of components in your record, you might not be able to use this feature.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_differences_to_java"><a class="anchor" href="#_other_differences_to_java"></a><a class="link" href="#_other_differences_to_java">Other differences to Java</a></h5>
<div class="paragraph">
<p>Groovy supports creating <em>record-like</em> classes as well as native records.
Record-like classes don&#8217;t extend Java&#8217;s <code>Record</code> class and such classes
won&#8217;t be seen by Java as records but will otherwise have similar properties.</p>
</div>
<div class="paragraph">
<p>The <code>@RecordOptions</code> annotation (part of <code>@RecordType</code>) supports a <code>mode</code> annotation attribute
which can take one of three values (with <code>AUTO</code> being the default):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NATIVE</dt>
<dd>
<p>Produces a class similar to what Java would do. Produces an error when compiling on JDKs earlier than JDK16.</p>
</dd>
<dt class="hdlist1">EMULATE</dt>
<dd>
<p>Produces a record-like class for all JDK versions.</p>
</dd>
<dt class="hdlist1">AUTO</dt>
<dd>
<p>Produces a native record for JDK16+ and emulates the record otherwise.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Whether you use the <code>record</code> keyword or the <code>@RecordType</code> annotation
is independent of the mode.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sealed_hierarchies_incubating"><a class="anchor" href="#_sealed_hierarchies_incubating"></a><a class="link" href="#_sealed_hierarchies_incubating">1.4.7. Sealed hierarchies (incubating)</a></h4>
<div class="paragraph">
<p>Sealed classes, interfaces and traits restrict which subclasses can extend/implement them.
Prior to sealed classes, class hierarchy designers had two main options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a class final to allow no extension.</p>
</li>
<li>
<p>Make the class public and non-final to allow extension by anyone.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sealed classes provide a middle-ground compared to these all or nothing choices.</p>
</div>
<div class="paragraph">
<p>Sealed classes are also more flexible than other tricks previously used
to try to achieve a middle-ground. For example, for class hierarchies,
access modifiers like protected and package-private give some ability to restrict inheritance
hierarchies but often at the expense of flexible use of those hierarchies.</p>
</div>
<div class="paragraph">
<p>Sealed hierarchies provide full inheritance within a known hierarchy of classes, interfaces
and traits but disable or only provide controlled inheritance outside the hierarchy.</p>
</div>
<div class="paragraph">
<p>As an example, suppose we want to create a shape hierarchy containing
only circles and squares. We also want a shape interface to
be able to refer to instances in our hierarchy.
We can create the hierarchy as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sealed interface ShapeI permits Circle,Square { }
final class Circle implements ShapeI { }
final class Square implements ShapeI { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy also supports an alternative annotation syntax.
We think the keyword style is nicer but you might choose the annotation style if your editor doesn&#8217;t yet have Groovy 4 support.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Sealed(permittedSubclasses=[Circle,Square]) interface ShapeI { }
final class Circle implements ShapeI { }
final class Square implements ShapeI { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can have a reference of type <code>ShapeI</code> which, thanks to the <code>permits</code> clause,
can point to either a <code>Circle</code> or <code>Square</code> and, since our classes are <code>final</code>,
we know no additional classes will be added to our hierarchy in the future.
At least not without changing the <code>permits</code> clause and recompiling.</p>
</div>
<div class="paragraph">
<p>In general, we might want to have some parts of our class hierarchy
immediately locked down like we have here, where we marked the
subclasses as <code>final</code> but other times we might want to allow further
controlled inheritance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sealed class Shape permits Circle,Polygon,Rectangle { }

final class Circle extends Shape { }

class Polygon extends Shape { }
non-sealed class RegularPolygon extends Polygon { }
final class Hexagon extends Polygon { }

sealed class Rectangle extends Shape permits Square{ }
final class Square extends Rectangle { }</code></pre>
</div>
</div>
<details>
<summary class="title">&lt;Click to see the alternate annotations syntax&gt;</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Sealed(permittedSubclasses=[Circle,Polygon,Rectangle]) class Shape { }

final class Circle extends Shape { }

class Polygon extends Shape { }
@NonSealed class RegularPolygon extends Polygon { }
final class Hexagon extends Polygon { }

@Sealed(permittedSubclasses=Square) class Rectangle extends Shape { }
final class Square extends Rectangle { }</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>&nbsp;<br>
In this example, our permitted subclasses for <code>Shape</code> are <code>Circle</code>, <code>Polygon</code>, and <code>Rectangle</code>.
<code>Circle</code> is <code>final</code> and hence that part of the hierarchy cannot be extended.
<code>Polygon</code> is implicitly non-sealed and <code>RegularPolygon</code> is explicitly marked as <code>non-sealed</code>.
That means our hierarchy is open to any further extension by subclassing,
as seen with <code>Polygon &#8594; RegularPolygon</code> and <code>RegularPolygon &#8594; Hexagon</code>.
<code>Rectangle</code> is itself sealed which means that part of the hierarchy can be extended
but only in a controlled way (only <code>Square</code> is permitted).</p>
</div>
<div class="paragraph">
<p>Sealed classes are useful for creating enum-like related classes
which need to contain instance specific data. For instance, we might have the following enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">enum Weather { Rainy, Cloudy, Sunny }
def forecast = [Weather.Rainy, Weather.Sunny, Weather.Cloudy]
assert forecast.toString() == '[Rainy, Sunny, Cloudy]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>but we now wish to also add weather specific instance data to weather forecasts.
We can alter our abstraction as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sealed abstract class Weather { }
@Immutable(includeNames=true) class Rainy extends Weather { Integer expectedRainfall }
@Immutable(includeNames=true) class Sunny extends Weather { Integer expectedTemp }
@Immutable(includeNames=true) class Cloudy extends Weather { Integer expectedUV }
def forecast = [new Rainy(12), new Sunny(35), new Cloudy(6)]
assert forecast.toString() == '[Rainy(expectedRainfall:12), Sunny(expectedTemp:35), Cloudy(expectedUV:6)]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sealed hierarchies are also useful when specifying Algebraic or Abstract Data Types (ADTs) as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

sealed interface Tree&lt;T&gt; {}
@Singleton final class Empty implements Tree {
    String toString() { 'Empty' }
}
@Canonical final class Node&lt;T&gt; implements Tree&lt;T&gt; {
    T value
    Tree&lt;T&gt; left, right
}

Tree&lt;Integer&gt; tree = new Node&lt;&gt;(42, new Node&lt;&gt;(0, Empty.instance, Empty.instance), Empty.instance)
assert tree.toString() == 'Node(42, Node(0, Empty, Empty), Empty)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sealed hierarchies work well with records as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sealed interface Expr {}
record ConstExpr(int i) implements Expr {}
record PlusExpr(Expr e1, Expr e2) implements Expr {}
record MinusExpr(Expr e1, Expr e2) implements Expr {}
record NegExpr(Expr e) implements Expr {}

def threePlusNegOne = new PlusExpr(new ConstExpr(3), new NegExpr(new ConstExpr(1)))
assert threePlusNegOne.toString() == 'PlusExpr[e1=ConstExpr[i=3], e2=NegExpr[e=ConstExpr[i=1]]]'</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_differences_to_java"><a class="anchor" href="#_differences_to_java"></a><a class="link" href="#_differences_to_java">Differences to Java</a></h5>
<div class="ulist">
<ul>
<li>
<p>Java provides no default modifier for subclasses of sealed classes
and requires that one of <code>final</code>, <code>sealed</code> or <code>non-sealed</code> be specified.
Groovy defaults to <em>non-sealed</em> but you can still use <code>non-sealed/@NonSealed</code> if you wish.
We anticipate the style checking tool CodeNarc will eventually have a rule that
looks for the presence of <code>non-sealed</code> so developers wanting that stricter
style will be able to use CodeNarc and that rule if they want.</p>
</li>
<li>
<p>Currently, Groovy doesn&#8217;t check that all classes mentioned in <code>permittedSubclasses</code>
are available at compile-time and compiled along with the base sealed class.
This may change in a future version of Groovy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy supports annotating classes as sealed as well as "native" sealed classes.</p>
</div>
<div class="paragraph">
<p>The <code>@SealedOptions</code> annotation supports a <code>mode</code> annotation attribute
which can take one of three values (with <code>AUTO</code> being the default):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NATIVE</dt>
<dd>
<p>Produces a class similar to what Java would do.
Produces an error when compiling on JDKs earlier than JDK17.</p>
</dd>
<dt class="hdlist1">EMULATE</dt>
<dd>
<p>Indicates the class is sealed using the <code>@Sealed</code> annotation.
This mechanism works with the Groovy compiler for JDK8+ but is not recognised by the Java compiler.</p>
</dd>
<dt class="hdlist1">AUTO</dt>
<dd>
<p>Produces a native record for JDK17+ and emulates the record otherwise.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Whether you use the <code>sealed</code> keyword or the <code>@Sealed</code> annotation
is independent of the mode.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closures"><a class="anchor" href="#_closures"></a><a class="link" href="#_closures">1.5. Closures</a></h3>
<div class="paragraph">
<p>This chapter covers Groovy Closures. A closure in Groovy is an open, anonymous, block of code that can take arguments,
return a value and be assigned to a variable. A closure may reference variables declared in its surrounding scope. In
opposition to the formal definition of a closure, <code>Closure</code> in the Groovy language can also contain free variables which
are defined outside of its surrounding scope. While breaking the formal concept of a closure, it offers a variety of
advantages which are described in this chapter.</p>
</div>
<div class="sect3">
<h4 id="_syntax_2"><a class="anchor" href="#_syntax_2"></a><a class="link" href="#_syntax_2">1.5.1. Syntax</a></h4>
<div class="sect4">
<h5 id="_defining_a_closure"><a class="anchor" href="#_defining_a_closure"></a><a class="link" href="#_defining_a_closure">Defining a closure</a></h5>
<div class="paragraph">
<p>A closure definition follows this syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">{ [closureParameters -&gt; ] statements }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>[closureParameters-&gt;]</code> is an optional comma-delimited list of
parameters, and statements are 0 or more Groovy statements. The parameters
look similar to a method parameter list, and these parameters may be
typed or untyped.</p>
</div>
<div class="paragraph">
<p>When a parameter list is specified, the <code>-&gt;</code> character
is required and serves to separate the arguments from the closure body.
The <em>statements</em> portion consists of 0, 1, or many Groovy statements.</p>
</div>
<div class="paragraph">
<p>Some examples of valid closure definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">{ item++ }                                          <i class="conum" data-value="1"></i><b>(1)</b>

{ -&gt; item++ }                                       <i class="conum" data-value="2"></i><b>(2)</b>

{ println it }                                      <i class="conum" data-value="3"></i><b>(3)</b>

{ it -&gt; println it }                                <i class="conum" data-value="4"></i><b>(4)</b>

{ name -&gt; println name }                            <i class="conum" data-value="5"></i><b>(5)</b>

{ String x, int y -&gt;                                <i class="conum" data-value="6"></i><b>(6)</b>
    println "hey ${x} the value is ${y}"
}

{ reader -&gt;                                         <i class="conum" data-value="7"></i><b>(7)</b>
    def line = reader.readLine()
    line.trim()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure referencing a variable named <code>item</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to explicitly separate closure parameters from code by adding an arrow (<code>-&gt;</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A closure using an implicit parameter (<code>it</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>An alternative version where <code>it</code> is an explicit parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In that case it is often better to use an explicit name for the parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A closure accepting two typed parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>A closure can contain multiple statements</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="closure-as-object"><a class="anchor" href="#closure-as-object"></a><a class="link" href="#closure-as-object">Closures as an object</a></h5>
<div class="paragraph">
<p>A closure is an instance of the <code>groovy.lang.Closure</code> class, making it assignable to a variable or a field as any
other variable, despite being a block of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def listener = { e -&gt; println "Clicked on $e.source" }      <i class="conum" data-value="1"></i><b>(1)</b>
assert listener instanceof Closure
Closure callback = { println 'Done!' }                      <i class="conum" data-value="2"></i><b>(2)</b>
Closure&lt;Boolean&gt; isTextFile = {
    File it -&gt; it.name.endsWith('.txt')                     <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can assign a closure to a variable, and it is an instance of <code>groovy.lang.Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If not using <code>def</code> or <code>var</code>, use <code>groovy.lang.Closure</code> as the type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optionally, you can specify the return type of the closure by using the generic type of <code>groovy.lang.Closure</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_calling_a_closure"><a class="anchor" href="#_calling_a_closure"></a><a class="link" href="#_calling_a_closure">Calling a closure</a></h5>
<div class="paragraph">
<p>A closure, as an anonymous block of code, can be called like any other method. If you define a closure which takes
no argument like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def code = { 123 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the code inside the closure will only be executed when you <em>call</em> the closure, which can be done by using the
variable as if it was a regular method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert code() == 123</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can be explicit and use the <code>call</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert code.call() == 123</code></pre>
</div>
</div>
<div class="paragraph">
<p>The principle is the same if the closure accepts arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def isOdd = { int i -&gt; i%2 != 0 }                           <i class="conum" data-value="1"></i><b>(1)</b>
assert isOdd(3) == true                                     <i class="conum" data-value="2"></i><b>(2)</b>
assert isOdd.call(2) == false                               <i class="conum" data-value="3"></i><b>(3)</b>

def isEven = { it%2 == 0 }                                  <i class="conum" data-value="4"></i><b>(4)</b>
assert isEven(3) == false                                   <i class="conum" data-value="5"></i><b>(5)</b>
assert isEven.call(2) == true                               <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a closure which accepts an <code>int</code> as a parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it can be called directly</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or using the <code>call</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>same goes for a closure with an implicit argument (<code>it</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>which can be called directly using <code>(arg)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>or using <code>call</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unlike a method, a closure <strong>always</strong> returns a value when called. The next section discusses how to declare closure arguments, when to use them and what is the <a href="#implicit-it">implicit
"it" parameter</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parameters"><a class="anchor" href="#_parameters"></a><a class="link" href="#_parameters">1.5.2. Parameters</a></h4>
<div class="sect4">
<h5 id="_normal_parameters"><a class="anchor" href="#_normal_parameters"></a><a class="link" href="#_normal_parameters">Normal parameters</a></h5>
<div class="paragraph">
<p>Parameters of closures follow the same principle as parameters of regular methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an optional type</p>
</li>
<li>
<p>a name</p>
</li>
<li>
<p>an optional default value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parameters are separated with commas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def closureWithOneArg = { str -&gt; str.toUpperCase() }
assert closureWithOneArg('groovy') == 'GROOVY'

def closureWithOneArgAndExplicitType = { String str -&gt; str.toUpperCase() }
assert closureWithOneArgAndExplicitType('groovy') == 'GROOVY'

def closureWithTwoArgs = { a,b -&gt; a+b }
assert closureWithTwoArgs(1,2) == 3

def closureWithTwoArgsAndExplicitTypes = { int a, int b -&gt; a+b }
assert closureWithTwoArgsAndExplicitTypes(1,2) == 3

def closureWithTwoArgsAndOptionalTypes = { a, int b -&gt; a+b }
assert closureWithTwoArgsAndOptionalTypes(1,2) == 3

def closureWithTwoArgAndDefaultValue = { int a, int b=2 -&gt; a+b }
assert closureWithTwoArgAndDefaultValue(1) == 3</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implicit-it"><a class="anchor" href="#implicit-it"></a><a class="link" href="#implicit-it">Implicit parameter</a></h5>
<div class="paragraph">
<p>When a closure does not explicitly define a parameter list (using <code>-&gt;</code>), a closure <strong>always</strong> defines an implicit
parameter, named <code>it</code>. This means that this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def greeting = { "Hello, $it!" }
assert greeting('Patrick') == 'Hello, Patrick!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>is strictly equivalent to this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def greeting = { it -&gt; "Hello, $it!" }
assert greeting('Patrick') == 'Hello, Patrick!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to declare a closure which accepts no argument and must be restricted to calls without arguments,
then you <strong>must</strong> declare it with an explicit empty argument list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def magicNumber = { -&gt; 42 }

// this call will fail because the closure doesn't accept any argument
magicNumber(11)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_varargs_2"><a class="anchor" href="#_varargs_2"></a><a class="link" href="#_varargs_2">Varargs</a></h5>
<div class="paragraph">
<p>It is possible for a closure to declare variable arguments like any other method. <em>Vargs</em> methods are methods that
can accept a variable number of arguments if the last parameter is of variable length (or an array) like in the next
examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def concat1 = { String... args -&gt; args.join('') }           <i class="conum" data-value="1"></i><b>(1)</b>
assert concat1('abc','def') == 'abcdef'                     <i class="conum" data-value="2"></i><b>(2)</b>
def concat2 = { String[] args -&gt; args.join('') }            <i class="conum" data-value="3"></i><b>(3)</b>
assert concat2('abc', 'def') == 'abcdef'

def multiConcat = { int n, String... args -&gt;                <i class="conum" data-value="4"></i><b>(4)</b>
    args.join('')*n
}
assert multiConcat(2, 'abc','def') == 'abcdefabcdef'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure accepting a variable number of strings as first parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It may be called using any number of arguments <strong>without</strong> having to explicitly wrap them into an array</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The same behavior is directly available if the <em>args</em> parameter is declared as an array</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>As long as the <strong>last</strong> parameter is an array or an explicit vargs type</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delegation_strategy"><a class="anchor" href="#_delegation_strategy"></a><a class="link" href="#_delegation_strategy">1.5.3. Delegation strategy</a></h4>
<div class="sect4">
<h5 id="_groovy_closures_vs_lambda_expressions"><a class="anchor" href="#_groovy_closures_vs_lambda_expressions"></a><a class="link" href="#_groovy_closures_vs_lambda_expressions">Groovy closures vs lambda expressions</a></h5>
<div class="paragraph">
<p>Groovy defines closures as <a href="#closure-as-object">instances of the Closure class</a>. It makes it very different from
<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expressions in Java 8</a>. Delegation is a
key concept in Groovy closures which has no equivalent in lambdas. The ability to <em>change the delegate</em> or <em>change the
delegation strategy</em> of closures make it possible to design beautiful domain specific languages (DSLs) in Groovy.</p>
</div>
</div>
<div class="sect4">
<h5 id="closure-owner"><a class="anchor" href="#closure-owner"></a><a class="link" href="#closure-owner">Owner, delegate and this</a></h5>
<div class="paragraph">
<p>To understand the concept of delegate, we must first explain the meaning of <code>this</code> inside a closure. A closure actually
defines 3 distinct things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>this</code> corresponds to the <em>enclosing class</em> where the closure is defined</p>
</li>
<li>
<p><code>owner</code> corresponds to the <em>enclosing object</em> where the closure is defined, which may be either a class or a closure</p>
</li>
<li>
<p><code>delegate</code> corresponds to a third party object where methods calls or properties are resolved whenever the receiver of
the message is not defined</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="closure-this"><a class="anchor" href="#closure-this"></a><a class="link" href="#closure-this">The meaning of this</a></h6>
<div class="paragraph">
<p>In a closure, calling <code>getThisObject</code> will return the enclosing class where the closure is defined. It is equivalent to
using an explicit <code>this</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Enclosing {
    void run() {
        def whatIsThisObject = { getThisObject() }          <i class="conum" data-value="1"></i><b>(1)</b>
        assert whatIsThisObject() == this                   <i class="conum" data-value="2"></i><b>(2)</b>
        def whatIsThis = { this }                           <i class="conum" data-value="3"></i><b>(3)</b>
        assert whatIsThis() == this                         <i class="conum" data-value="4"></i><b>(4)</b>
    }
}
class EnclosedInInnerClass {
    class Inner {
        Closure cl = { this }                               <i class="conum" data-value="5"></i><b>(5)</b>
    }
    void run() {
        def inner = new Inner()
        assert inner.cl() == inner                          <i class="conum" data-value="6"></i><b>(6)</b>
    }
}
class NestedClosures {
    void run() {
        def nestedClosures = {
            def cl = { this }                               <i class="conum" data-value="7"></i><b>(7)</b>
            cl()
        }
        assert nestedClosures() == this                     <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined inside the <code>Enclosing</code> class, and returns <code>getThisObject</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling the closure will return the instance of <code>Enclosing</code> where the closure is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>in general, you will just want to use the shortcut <code>this</code> notation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it returns <strong>exactly</strong> the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the closure is defined in an inner class</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>this</code> in the closure <strong>will</strong> return the inner class, not the top-level one</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>in case of nested closures, like here <code>cl</code> being defined inside the scope of <code>nestedClosures</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then <code>this</code> corresponds to the closest outer class, not the enclosing closure!</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is of course possible to call methods from the enclosing class this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    int age
    String toString() { "$name is $age years old" }

    String dump() {
        def cl = {
            String msg = this.toString()               <i class="conum" data-value="1"></i><b>(1)</b>
            println msg
            msg
        }
        cl()
    }
}
def p = new Person(name:'Janice', age:74)
assert p.dump() == 'Janice is 74 years old'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure calls <code>toString</code> on <code>this</code>, which will actually call the <code>toString</code> method on the enclosing object,
that is to say the <code>Person</code> instance</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_owner_of_a_closure"><a class="anchor" href="#_owner_of_a_closure"></a><a class="link" href="#_owner_of_a_closure">Owner of a closure</a></h6>
<div class="paragraph">
<p>The owner of a closure is very similar to the definition of <a href="#closure-this">this in a closure</a> with a subtle difference:
it will return the direct enclosing object, be it a closure or a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Enclosing {
    void run() {
        def whatIsOwnerMethod = { getOwner() }               <i class="conum" data-value="1"></i><b>(1)</b>
        assert whatIsOwnerMethod() == this                   <i class="conum" data-value="2"></i><b>(2)</b>
        def whatIsOwner = { owner }                          <i class="conum" data-value="3"></i><b>(3)</b>
        assert whatIsOwner() == this                         <i class="conum" data-value="4"></i><b>(4)</b>
    }
}
class EnclosedInInnerClass {
    class Inner {
        Closure cl = { owner }                               <i class="conum" data-value="5"></i><b>(5)</b>
    }
    void run() {
        def inner = new Inner()
        assert inner.cl() == inner                           <i class="conum" data-value="6"></i><b>(6)</b>
    }
}
class NestedClosures {
    void run() {
        def nestedClosures = {
            def cl = { owner }                               <i class="conum" data-value="7"></i><b>(7)</b>
            cl()
        }
        assert nestedClosures() == nestedClosures            <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined inside the <code>Enclosing</code> class, and returns <code>getOwner</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling the closure will return the instance of <code>Enclosing</code> where the closure is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>in general, you will just want to use the shortcut <code>owner</code> notation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it returns <strong>exactly</strong> the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the closure is defined in an inner class</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>owner</code> in the closure <strong>will</strong> return the inner class, not the top-level one</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>but in case of nested closures, like here <code>cl</code> being defined inside the scope of <code>nestedClosures</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then <code>owner</code> corresponds to the enclosing closure, hence a different object from <code>this</code>!</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_delegate_of_a_closure"><a class="anchor" href="#_delegate_of_a_closure"></a><a class="link" href="#_delegate_of_a_closure">Delegate of a closure</a></h6>
<div class="paragraph">
<p>The delegate of a closure can be accessed by using the <code>delegate</code> property or calling the <code>getDelegate</code> method. It is a
powerful concept for building domain specific languages in Groovy. While <a href="#closure-this">this</a> and <a href="#closure-owner">owner</a>
refer to the lexical scope of a closure, the delegate is a user defined object that a closure will use. By default, the
delegate is set to <code>owner</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Enclosing {
    void run() {
        def cl = { getDelegate() }                          <i class="conum" data-value="1"></i><b>(1)</b>
        def cl2 = { delegate }                              <i class="conum" data-value="2"></i><b>(2)</b>
        assert cl() == cl2()                                <i class="conum" data-value="3"></i><b>(3)</b>
        assert cl() == this                                 <i class="conum" data-value="4"></i><b>(4)</b>
        def enclosed = {
            { -&gt; delegate }.call()                          <i class="conum" data-value="5"></i><b>(5)</b>
        }
        assert enclosed() == enclosed                       <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>you can get the delegate of a closure calling the <code>getDelegate</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>or using the <code>delegate</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>both return the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which is the enclosing class or closure</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>in particular in case of nested closures</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>delegate</code> will correspond to the <code>owner</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The delegate of a closure can be changed to <strong>any object</strong>. Let&#8217;s illustrate this by creating two classes which are not
subclasses of each other but both define a property called <code>name</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}
class Thing {
    String name
}

def p = new Person(name: 'Norman')
def t = new Thing(name: 'Teapot')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then let&#8217;s define a closure which fetches the <code>name</code> property on the delegate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def upperCasedName = { delegate.name.toUpperCase() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then by changing the delegate of the closure, you can see that the target object will change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">upperCasedName.delegate = p
assert upperCasedName() == 'NORMAN'
upperCasedName.delegate = t
assert upperCasedName() == 'TEAPOT'</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, the behavior is not different from having a <code>target</code> variable defined in the lexical scope of the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def target = p
def upperCasedNameUsingVar = { target.name.toUpperCase() }
assert upperCasedNameUsingVar() == 'NORMAN'</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are major differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the last example, <em>target</em> is a local variable referenced from within the closure</p>
</li>
<li>
<p>the delegate can be used transparently, that is to say without prefixing method calls with <code>delegate.</code> as explained
in the next paragraph.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_delegation_strategy_2"><a class="anchor" href="#_delegation_strategy_2"></a><a class="link" href="#_delegation_strategy_2">Delegation strategy</a></h6>
<div class="paragraph">
<p>Whenever, in a closure, a property is accessed without explicitly setting a receiver object, then a delegation strategy
is involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}
def p = new Person(name:'Igor')
def cl = { name.toUpperCase() }                 <i class="conum" data-value="1"></i><b>(1)</b>
cl.delegate = p                                 <i class="conum" data-value="2"></i><b>(2)</b>
assert cl() == 'IGOR'                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>name</code> is not referencing a variable in the lexical scope of the closure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can change the delegate of the closure to be an instance of <code>Person</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and the method call will succeed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason this code works is that the <code>name</code> property will be resolved transparently on the <code>delegate</code> object! This is
a very powerful way to resolve properties or method calls inside closures. There&#8217;s no need to set an explicit <code>delegate.</code>
receiver: the call will be made because the default delegation strategy of the closure makes it so. A closure actually
defines multiple resolution strategies that you can choose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Closure.OWNER_FIRST</code> is the <strong>default strategy</strong>. If a property/method exists on the <strong>owner</strong>, then it will be called on
the owner. If not, then the <strong>delegate</strong> is used.</p>
</li>
<li>
<p><code>Closure.DELEGATE_FIRST</code> reverses the logic: the <strong>delegate</strong> is used first, then the <strong>owner</strong></p>
</li>
<li>
<p><code>Closure.OWNER_ONLY</code> will only resolve the property/method lookup on the owner: the delegate will be ignored.</p>
</li>
<li>
<p><code>Closure.DELEGATE_ONLY</code> will only resolve the property/method lookup on the delegate: the owner will be ignored.</p>
</li>
<li>
<p><code>Closure.TO_SELF</code> can be used by developers who need advanced meta-programming techniques and wish to implement a
custom resolution strategy: the resolution will not be made on the owner or the delegate but only on the closure class
itself. It makes only sense to use this if you implement your own subclass of <code>Closure</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate the default "owner first" strategy with this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    def pretty = { "My name is $name" }             <i class="conum" data-value="1"></i><b>(1)</b>
    String toString() {
        pretty()
    }
}
class Thing {
    String name                                     <i class="conum" data-value="2"></i><b>(2)</b>
}

def p = new Person(name: 'Sarah')
def t = new Thing(name: 'Teapot')

assert p.toString() == 'My name is Sarah'           <i class="conum" data-value="3"></i><b>(3)</b>
p.pretty.delegate = t                               <i class="conum" data-value="4"></i><b>(4)</b>
assert p.toString() == 'My name is Sarah'           <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for the illustration, we define a closure member which references "name"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>both the <code>Person</code> and the <code>Thing</code> class define a <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using the default strategy, the <code>name</code> property is resolved on the owner first</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>so if we change the <code>delegate</code> to <code>t</code> which is an instance of <code>Thing</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>there is no change in the result: <code>name</code> is first resolved on the <code>owner</code> of the closure</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, it is possible to change the resolution strategy of the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p.pretty.resolveStrategy = Closure.DELEGATE_FIRST
assert p.toString() == 'My name is Teapot'</code></pre>
</div>
</div>
<div class="paragraph">
<p>By changing the <code>resolveStrategy</code>, we are modifying the way Groovy will resolve the "implicit this" references: in this
case, <code>name</code> will first be looked in the delegate, then if not found, on the owner. Since <code>name</code> is defined in the
delegate, an instance of <code>Thing</code>, then this value is used.</p>
</div>
<div class="paragraph">
<p>The difference between "delegate first" and "delegate only" or "owner first" and "owner only" can be illustrated if one
of the delegate (resp. owner) does <strong>not</strong> have such a method or property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    int age
    def fetchAge = { age }
}
class Thing {
    String name
}

def p = new Person(name:'Jessica', age:42)
def t = new Thing(name:'Printer')
def cl = p.fetchAge
cl.delegate = p
assert cl() == 42          <i class="conum" data-value="1"></i><b>(1)</b>
cl.delegate = t
assert cl() == 42          <i class="conum" data-value="1"></i><b>(1)</b>

cl.resolveStrategy = Closure.DELEGATE_ONLY
cl.delegate = p
assert cl() == 42          <i class="conum" data-value="2"></i><b>(2)</b>
cl.delegate = t
try {
    cl()                   <i class="conum" data-value="3"></i><b>(3)</b>
    assert false
} catch (MissingPropertyException ex) {
    // "age" is not defined on the delegate
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for "owner first" it doesn&#8217;t matter what the delegate is</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for "delegate only" having <code>p</code> as the delegate succeeds</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>for "delegate only" having <code>t</code> as the delegate fails</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, we define two classes which both have a <code>name</code> property but only the <code>Person</code> class declares an <code>age</code>.
The <code>Person</code> class also declares a closure which references <code>age</code>. We can change the default resolution strategy from
"owner first" to "delegate only". Since the owner of the closure is the <code>Person</code> class, then we can check that if the
delegate is an instance of <code>Person</code>, calling the closure is successful, but if we call it with a delegate being an
instance of <code>Thing</code>, it fails with a <code>groovy.lang.MissingPropertyException</code>. Despite the closure being defined inside
the <code>Person</code> class, the owner is not used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A comprehensive explanation about how to use this feature to develop DSLs can be found in a
<a href="core-domain-specific-languages.html">dedicated section of the manual</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_delegation_strategy_in_the_presence_of_metaprogramming"><a class="anchor" href="#_delegation_strategy_in_the_presence_of_metaprogramming"></a><a class="link" href="#_delegation_strategy_in_the_presence_of_metaprogramming">Delegation strategy in the presence of metaprogramming</a></h6>
<div class="paragraph">
<p>When describing the "owner first" delegation strategy we spoke
about using a property/method from the owner if it "<em>existed</em>" otherwise
using the respective property/method from the delegate. And a similar
story for "delegate first" but in reverse. Instead of using the word
"<em>existed</em>", it would have been more accurate to use the wording "<em>handled</em>".
That means that for "owner first", if the property/method exists in
the owner, or it has a propertyMissing/methodMissing hook, then the owner
will handle the member access.</p>
</div>
<div class="paragraph">
<p>We can see this in action with a slightly altered version of our previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    int age
    def fetchAge = { age }
}
class Thing {
    String name
    def propertyMissing(String name) { -1 }
}

def p = new Person(name:'Jessica', age:42)
def t = new Thing(name:'Printer')
def cl = p.fetchAge
cl.resolveStrategy = Closure.DELEGATE_FIRST
cl.delegate = p
assert cl() == 42
cl.delegate = t
assert cl() == -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, even though our instance of the <code>Thing</code> class (our delegate for the last use of <code>cl</code>) has no <code>age</code> property,
the fact that it handles the missing property via its <code>propertyMissing</code> hook,
means that <code>age</code> will be <code>-1</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closures_in_gstrings"><a class="anchor" href="#_closures_in_gstrings"></a><a class="link" href="#_closures_in_gstrings">1.5.4. Closures in GStrings</a></h4>
<div class="paragraph">
<p>Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 1
def gs = "x = ${x}"
assert gs == 'x = 1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code behaves as you would expect, but what happens if you add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">x = 2
assert gs == 'x = 2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see that the assert fails! There are two reasons for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a GString only evaluates lazily the <code>toString</code> representation of values</p>
</li>
<li>
<p>the syntax <code>${x}</code> in a GString does <strong>not</strong> represent a closure but an <strong>expression</strong> to <code>$x</code>, evaluated when the GString
is created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example, the <code>GString</code> is created with an expression referencing <code>x</code>. When the <code>GString</code> is created, the <strong>value</strong>
of <code>x</code> is 1, so the <code>GString</code> is created with a value of 1. When the assert is triggered, the <code>GString</code> is evaluated
and 1 is converted to a <code>String</code> using <code>toString</code>. When we change <code>x</code> to 2, we did change the value of <code>x</code>, but it is
a different object, and the <code>GString</code> still references the old one.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <code>GString</code> will only change its <code>toString</code> representation if the values it references are mutating. If the references
change, nothing will happen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need a real closure in a GString and for example enforce lazy evaluation of variables, you need to use the
alternate syntax <code>${&#8594; x}</code> like in the fixed example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 1
def gs = "x = ${-&gt; x}"
assert gs == 'x = 1'

x = 2
assert gs == 'x = 2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s illustrate how it differs from mutation with this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    String toString() { name }          <i class="conum" data-value="1"></i><b>(1)</b>
}
def sam = new Person(name:'Sam')        <i class="conum" data-value="2"></i><b>(2)</b>
def lucy = new Person(name:'Lucy')      <i class="conum" data-value="3"></i><b>(3)</b>
def p = sam                             <i class="conum" data-value="4"></i><b>(4)</b>
def gs = "Name: ${p}"                   <i class="conum" data-value="5"></i><b>(5)</b>
assert gs == 'Name: Sam'                <i class="conum" data-value="6"></i><b>(6)</b>
p = lucy                                <i class="conum" data-value="7"></i><b>(7)</b>
assert gs == 'Name: Sam'                <i class="conum" data-value="8"></i><b>(8)</b>
sam.name = 'Lucy'                       <i class="conum" data-value="9"></i><b>(9)</b>
assert gs == 'Name: Lucy'               <i class="conum" data-value="10"></i><b>(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class has a <code>toString</code> method returning the <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we create a first <code>Person</code> named <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we create another <code>Person</code> named <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>p</code> variable is set to <code>Sam</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and a closure is created, referencing the value of <code>p</code>, that is to say <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>so when we evaluate the string, it returns <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>if we change <code>p</code> to <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>the string still evaluates to <em>Sam</em> because it was the <strong>value</strong> of <code>p</code> when the <code>GString</code> was created</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>so if we mutate <em>Sam</em> to change the name to <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>this time the <code>GString</code> is correctly mutated</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So if you don&#8217;t want to rely on mutating objects or wrapping objects, you <strong>must</strong> use closures in <code>GString</code> by explicitly
declaring an empty argument list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    String toString() { name }
}
def sam = new Person(name:'Sam')
def lucy = new Person(name:'Lucy')
def p = sam
// Create a GString with lazy evaluation of "p"
def gs = "Name: ${-&gt; p}"
assert gs == 'Name: Sam'
p = lucy
assert gs == 'Name: Lucy'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closure_coercion"><a class="anchor" href="#_closure_coercion"></a><a class="link" href="#_closure_coercion">1.5.5. Closure coercion</a></h4>
<div class="paragraph">
<p>Closures can be converted into interfaces or single-abstract method types. Please refer to
<a href="core-semantics.html#closure-coercion">this section of the manual</a> for a complete description.</p>
</div>
</div>
<div class="sect3">
<h4 id="_functional_programming"><a class="anchor" href="#_functional_programming"></a><a class="link" href="#_functional_programming">1.5.6. Functional programming</a></h4>
<div class="paragraph">
<p>Closures, like <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expressions in Java 8</a> are at the core of the functional programming paradigm in Groovy. Some functional programming
operations on functions are available directly on the <code>Closure</code> class, like illustrated in this section.</p>
</div>
<div class="sect4">
<h5 id="_currying"><a class="anchor" href="#_currying"></a><a class="link" href="#_currying">Currying</a></h5>
<div class="paragraph">
<p>In Groovy, currying refers to the concept of partial application. It does <strong>not</strong> correspond to the real concept of currying
in functional programming because of the different scoping rules that Groovy applies on closures. Currying in Groovy will
let you set the value of one parameter of a closure, and it will return a new closure accepting one less argument.</p>
</div>
<div class="sect5">
<h6 id="_left_currying"><a class="anchor" href="#_left_currying"></a><a class="link" href="#_left_currying">Left currying</a></h6>
<div class="paragraph">
<p>Left currying is the fact of setting the left-most parameter of a closure, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nCopies = { int n, String str -&gt; str*n }    <i class="conum" data-value="1"></i><b>(1)</b>
def twice = nCopies.curry(2)                    <i class="conum" data-value="2"></i><b>(2)</b>
assert twice('bla') == 'blabla'                 <i class="conum" data-value="3"></i><b>(3)</b>
assert twice('bla') == nCopies(2, 'bla')        <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>nCopies</code> closure defines two parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>curry</code> will set the first parameter to <code>2</code>, creating a new closure (function) which accepts a single <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so the new function call be called with only a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it is equivalent to calling <code>nCopies</code> with two parameters</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_right_currying"><a class="anchor" href="#_right_currying"></a><a class="link" href="#_right_currying">Right currying</a></h6>
<div class="paragraph">
<p>Similarly to left currying, it is possible to set the right-most parameter of a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nCopies = { int n, String str -&gt; str*n }    <i class="conum" data-value="1"></i><b>(1)</b>
def blah = nCopies.rcurry('bla')                <i class="conum" data-value="2"></i><b>(2)</b>
assert blah(2) == 'blabla'                      <i class="conum" data-value="3"></i><b>(3)</b>
assert blah(2) == nCopies(2, 'bla')             <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>nCopies</code> closure defines two parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>rcurry</code> will set the last parameter to <code>bla</code>, creating a new closure (function) which accepts a single <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so the new function call be called with only an <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it is equivalent to calling <code>nCopies</code> with two parameters</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_index_based_currying"><a class="anchor" href="#_index_based_currying"></a><a class="link" href="#_index_based_currying">Index based currying</a></h6>
<div class="paragraph">
<p>In case a closure accepts more than 2 parameters, it is possible to set an arbitrary parameter using <code>ncurry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def volume = { double l, double w, double h -&gt; l*w*h }      <i class="conum" data-value="1"></i><b>(1)</b>
def fixedWidthVolume = volume.ncurry(1, 2d)                 <i class="conum" data-value="2"></i><b>(2)</b>
assert volume(3d, 2d, 4d) == fixedWidthVolume(3d, 4d)       <i class="conum" data-value="3"></i><b>(3)</b>
def fixedWidthAndHeight = volume.ncurry(1, 2d, 4d)          <i class="conum" data-value="4"></i><b>(4)</b>
assert volume(3d, 2d, 4d) == fixedWidthAndHeight(3d)        <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>volume</code> function defines 3 parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ncurry</code> will set the second parameter (index = 1) to <code>2d</code>, creating a new volume function which accepts length and height</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>that function is equivalent to calling <code>volume</code> omitting the width</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>it is also possible to set multiple parameters, starting from the specified index</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the resulting function accepts as many parameters as the initial one minus the number of parameters set by <code>ncurry</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_memoization"><a class="anchor" href="#_memoization"></a><a class="link" href="#_memoization">Memoization</a></h5>
<div class="paragraph">
<p>Memoization allows the result of the call of a closure to be cached. It is interesting if the computation done by a
function (closure) is slow, but you know that this function is going to be called often with the same arguments. A
typical example is the Fibonacci suite. A naive implementation may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def fib
fib = { long n -&gt; n&lt;2?n:fib(n-1)+fib(n-2) }
assert fib(15) == 610 // slow!</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a naive implementation because 'fib' is often called recursively with the same arguments, leading to an exponential
algorithm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>computing <code>fib(15)</code> requires the result of <code>fib(14)</code> and <code>fib(13)</code></p>
</li>
<li>
<p>computing <code>fib(14)</code> requires the result of <code>fib(13)</code> and <code>fib(12)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since calls are recursive, you can already see that we will compute the same values again and again, although they could
be cached. This naive implementation can be "fixed" by caching the result of calls using <code>memoize</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">fib = { long n -&gt; n&lt;2?n:fib(n-1)+fib(n-2) }.memoize()
assert fib(25) == 75025 // fast!</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The cache works <strong>using the actual values of the arguments</strong>. This means that you should be very careful if you use
memoization with something else than primitive or boxed primitive types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The behavior of the cache can be tweaked using alternate methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memoizeAtMost</code> will generate a new closure which caches <strong>at most</strong> <em>n</em> values</p>
</li>
<li>
<p><code>memoizeAtLeast</code> will generate a new closure which caches <strong>at least</strong> <em>n</em> values</p>
</li>
<li>
<p><code>memoizeBetween</code> will generate a new closure which caches <strong>at least</strong> <em>n</em> values and <strong>at most</strong> <em>n</em> values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cache used in all memoize variants is an LRU cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="_composition"><a class="anchor" href="#_composition"></a><a class="link" href="#_composition">Composition</a></h5>
<div class="paragraph">
<p>Closure composition corresponds to the concept of function composition, that is to say creating a new function by
composing two or more functions (chaining calls), as illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def plus2  = { it + 2 }
def times3 = { it * 3 }

def times3plus2 = plus2 &lt;&lt; times3
assert times3plus2(3) == 11
assert times3plus2(4) == plus2(times3(4))

def plus2times3 = times3 &lt;&lt; plus2
assert plus2times3(3) == 15
assert plus2times3(5) == times3(plus2(5))

// reverse composition
assert times3plus2(3) == (times3 &gt;&gt; plus2)(3)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_trampoline"><a class="anchor" href="#_trampoline"></a><a class="link" href="#_trampoline">Trampoline</a></h5>
<div class="paragraph">
<p>Recursive algorithms are often restricted by a physical limit: the maximum stack height. For example, if you call a method
that recursively calls itself too deep, you will eventually receive a <code>StackOverflowException</code>.</p>
</div>
<div class="paragraph">
<p>An approach that helps in those situations is by using <code>Closure</code> and its trampoline capability.</p>
</div>
<div class="paragraph">
<p>Closures are wrapped in a <code>TrampolineClosure</code>. Upon calling, a trampolined <code>Closure</code> will call the original <code>Closure</code> waiting
for its result. If the outcome of the call is another instance of a <code>TrampolineClosure</code>, created perhaps as a result
to a call to the <code>trampoline()</code> method, the <code>Closure</code> will again be invoked. This repetitive invocation of returned
trampolined Closures instances will continue until a value other than a trampolined <code>Closure</code> is returned. That value
will become the final result of the trampoline. That way, calls are made serially, rather than filling the stack.</p>
</div>
<div class="paragraph">
<p>Here’s an example of the use of <code>trampoline()</code> to implement the factorial function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def factorial
factorial = { int n, def accu = 1G -&gt;
    if (n &lt; 2) return accu
    factorial.trampoline(n - 1, n * accu)
}
factorial = factorial.trampoline()

assert factorial(1)    == 1
assert factorial(3)    == 1 * 2 * 3
assert factorial(1000) // == 402387260.. plus another 2560 digits</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_method_pointers"><a class="anchor" href="#_method_pointers"></a><a class="link" href="#_method_pointers">Method pointers</a></h5>
<div class="paragraph">
<p>It is often practical to be able to use a regular method as a closure. For example, you might want to use the currying
abilities of a closure, but those are not available to normal methods. In Groovy, you can obtain a closure from any
method with the <a href="core-operators.html#method-pointer-operator">method pointer operator</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_semantics"><a class="anchor" href="#_semantics"></a><a class="link" href="#_semantics">1.6. Semantics</a></h3>
<div class="paragraph">
<p>This chapter covers the semantics of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_statements"><a class="anchor" href="#_statements"></a><a class="link" href="#_statements">1.6.1. Statements</a></h4>
<div class="sect4">
<h5 id="_variable_definition"><a class="anchor" href="#_variable_definition"></a><a class="link" href="#_variable_definition">Variable definition</a></h5>
<div class="paragraph">
<p>Variables can be defined using either their type (like <code>String</code>) or by using the keyword <code>def</code> (or <code>var</code>) followed by a variable name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String x
def y
var z</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>def</code> and <code>var</code> act as a type placeholder, i.e. a replacement for the type name,
when you do not want to give an explicit type.
It could be that you don&#8217;t care about the type at compile time
or are relying on type inference (with Groovy&#8217;s static nature).
It is mandatory for variable definitions to have a type or placeholder.
If left out, the type name will be deemed to refer to an existing variable (presumably declared earlier).
For scripts, undeclared variables are assumed to come from the Script binding.
In other cases, you will get a missing property (dynamic Groovy) or compile time error (static Groovy).
If you think of <code>def</code> and <code>var</code> as an alias of <code>Object</code>, you will understand in an instant.</p>
</div>
<div class="paragraph">
<p>Variable definitions can provide an initial value,
in which case it&#8217;s like having a declaration and assignment (which we cover next) all in one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Variable definition types can be refined by using generics, like in <code>List&lt;String&gt; names</code>.
To learn more about the generics support, please read the <a href="#generics">generics section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_variable_assignment"><a class="anchor" href="#_variable_assignment"></a><a class="link" href="#_variable_assignment">Variable assignment</a></h5>
<div class="paragraph">
<p>You can assign values to variables for later use. Try the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">x = 1
println x

x = new java.util.Date()
println x

x = -3.1499392
println x

x = false
println x

x = "Hi"
println x</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_assignment"><a class="anchor" href="#_multiple_assignment"></a><a class="link" href="#_multiple_assignment">Multiple assignment</a></h6>
<div class="paragraph">
<p>Groovy supports multiple assignment, i.e. where multiple variables can be assigned at once, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def (a, b, c) = [10, 20, 'foo']
assert a == 10 &amp;&amp; b == 20 &amp;&amp; c == 'foo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide types as part of the declaration if you wish:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def (int i, String j) = [10, 'foo']
assert i == 10 &amp;&amp; j == 'foo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as used when declaring variables it also applies to existing variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nums = [1, 3, 5]
def a, b, c
(a, b, c) = nums
assert a == 1 &amp;&amp; b == 3 &amp;&amp; c == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax works for arrays as well as lists, as well as methods that return either of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def (_, month, year) = "18th June 2009".split()
assert "In $month of $year" == 'In June of 2009'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_overflow_and_underflow"><a class="anchor" href="#_overflow_and_underflow"></a><a class="link" href="#_overflow_and_underflow">Overflow and Underflow</a></h6>
<div class="paragraph">
<p>If the left hand side has too many variables, excess ones are filled with null&#8217;s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def (a, b, c) = [1, 2]
assert a == 1 &amp;&amp; b == 2 &amp;&amp; c == null</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the right hand side has too many variables, the extra ones are ignored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def (a, b) = [1, 2, 3]
assert a == 1 &amp;&amp; b == 2</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_object_destructuring_with_multiple_assignment"><a class="anchor" href="#_object_destructuring_with_multiple_assignment"></a><a class="link" href="#_object_destructuring_with_multiple_assignment">Object destructuring with multiple assignment</a></h6>
<div class="paragraph">
<p>In the section describing Groovy&#8217;s operators,
the case of the <a href="#subscript-operator">subscript operator</a> has been covered,
explaining how you can override the <code>getAt()</code>/<code>putAt()</code> method.</p>
</div>
<div class="paragraph">
<p>With this technique, we can combine multiple assignments and the subscript operator methods to implement <em>object destructuring</em>.</p>
</div>
<div class="paragraph">
<p>Consider the following immutable <code>Coordinates</code> class, containing a pair of longitude and latitude doubles,
and notice our implementation of the <code>getAt()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Immutable
class Coordinates {
    double latitude
    double longitude

    double getAt(int idx) {
        if (idx == 0) latitude
        else if (idx == 1) longitude
        else throw new Exception("Wrong coordinate index, use 0 or 1")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s instantiate this class and destructure its longitude and latitude:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def coordinates = new Coordinates(latitude: 43.23, longitude: 3.67) <i class="conum" data-value="1"></i><b>(1)</b>

def (la, lo) = coordinates                                          <i class="conum" data-value="2"></i><b>(2)</b>

assert la == 43.23                                                  <i class="conum" data-value="3"></i><b>(3)</b>
assert lo == 3.67</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we create an instance of the <code>Coordinates</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then, we use a multiple assignment to get the individual longitude and latitude values</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and we can finally assert their values.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_control_structures"><a class="anchor" href="#_control_structures"></a><a class="link" href="#_control_structures">Control structures</a></h5>
<div class="sect5">
<h6 id="_conditional_structures"><a class="anchor" href="#_conditional_structures"></a><a class="link" href="#_conditional_structures">Conditional structures</a></h6>
<div class="sect6">
<h7 id="_if_else"><a class="anchor" href="#_if_else"></a><a class="link" href="#_if_else">if / else</a></h7>
<div class="paragraph">
<p>Groovy supports the usual if - else syntax from Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = false
def y = false

if ( !x ) {
    x = true
}

assert x == true

if ( x ) {
    x = false
} else {
    y = true
}

assert x == y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy also supports the normal Java "nested" if then else if syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if ( ... ) {
    ...
} else if (...) {
    ...
} else {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_switch_case"><a class="anchor" href="#_switch_case"></a><a class="link" href="#_switch_case">switch / case</a></h7>
<div class="paragraph">
<p>The switch statement in Groovy is backwards compatible with Java code; so you can fall through cases sharing the same code for multiple matches.</p>
</div>
<div class="paragraph">
<p>One difference though is that the Groovy switch statement can handle any kind of switch value and different kinds of matching can be performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 1.23
def result = ""

switch (x) {
    case "foo":
        result = "found foo"
        // lets fall through

    case "bar":
        result += "bar"

    case [4, 5, 6, 'inList']:
        result = "list"
        break

    case 12..30:
        result = "range"
        break

    case Integer:
        result = "integer"
        break

    case Number:
        result = "number"
        break

    case ~/fo*/: // toString() representation of x matches the pattern?
        result = "foo regex"
        break

    case { it &lt; 0 }: // or { x &lt; 0 }
        result = "negative"
        break

    default:
        result = "default"
}

assert result == "number"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Switch supports the following kinds of comparisons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class case values match if the switch value is an instance of the class</p>
</li>
<li>
<p>Regular expression case values match if the <code>toString()</code> representation of the switch value matches the regex</p>
</li>
<li>
<p>Collection case values match if the switch value is contained in the collection. This also includes ranges (since they are Lists)</p>
</li>
<li>
<p>Closure case values match if the calling the closure returns a result which is true according to the <a href="#the-groovy-truth">Groovy truth</a></p>
</li>
<li>
<p>If none of the above are used then the case value matches if the case value equals the switch value</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using a closure case value, the default <code>it</code> parameter is actually the switch value (in our example, variable <code>x</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy also supports switch expressions as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def partner = switch(person) {
    case 'Romeo'  -&gt; 'Juliet'
    case 'Adam'   -&gt; 'Eve'
    case 'Antony' -&gt; 'Cleopatra'
    case 'Bonnie' -&gt; 'Clyde'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_looping_structures"><a class="anchor" href="#_looping_structures"></a><a class="link" href="#_looping_structures">Looping structures</a></h6>
<div class="sect6">
<h7 id="_classic_for_loop"><a class="anchor" href="#_classic_for_loop"></a><a class="link" href="#_classic_for_loop">Classic for loop</a></h7>
<div class="paragraph">
<p>Groovy supports the standard Java / C for loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String message = ''
for (int i = 0; i &lt; 5; i++) {
    message += 'Hi '
}
assert message == 'Hi Hi Hi Hi Hi '</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_enhanced_classic_java_style_for_loop"><a class="anchor" href="#_enhanced_classic_java_style_for_loop"></a><a class="link" href="#_enhanced_classic_java_style_for_loop">Enhanced classic Java-style for loop</a></h7>
<div class="paragraph">
<p>The more elaborate form of Java&#8217;s classic for loop with comma-separate expressions
is now supported. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def facts = []
def count = 5
for (int fact = 1, i = 1; i &lt;= count; i++, fact *= i) {
    facts &lt;&lt; fact
}
assert facts == [1, 2, 6, 24, 120]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_multi_assignment_in_combination_with_for_loop"><a class="anchor" href="#_multi_assignment_in_combination_with_for_loop"></a><a class="link" href="#_multi_assignment_in_combination_with_for_loop">Multi-assignment in combination with for loop</a></h7>
<div class="paragraph">
<p>Groovy has supported multi-assignment statements since Groovy 1.6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// multi-assignment with types
def (String x, int y) = ['foo', 42]
assert "$x $y" == 'foo 42'</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can now appear in for loops:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// multi-assignment goes loopy
def baNums = []
for (def (String u, int v) = ['bar', 42]; v &lt; 45; u++, v++) {
    baNums &lt;&lt; "$u $v"
}
assert baNums == ['bar 42', 'bas 43', 'bat 44']</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_for_in_loop"><a class="anchor" href="#_for_in_loop"></a><a class="link" href="#_for_in_loop">for in loop</a></h7>
<div class="paragraph">
<p>The for loop in Groovy is much simpler and works with any kind of array, collection, Map, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// iterate over a range
def x = 0
for ( i in 0..9 ) {
    x += i
}
assert x == 45

// iterate over a list
x = 0
for ( i in [0, 1, 2, 3, 4] ) {
    x += i
}
assert x == 10

// iterate over an array
def array = (0..4).toArray()
x = 0
for ( i in array ) {
    x += i
}
assert x == 10

// iterate over a map
def map = ['abc':1, 'def':2, 'xyz':3]
x = 0
for ( e in map ) {
    x += e.value
}
assert x == 6

// iterate over values in a map
x = 0
for ( v in map.values() ) {
    x += v
}
assert x == 6

// iterate over the characters in a string
def text = "abc"
def list = []
for (c in text) {
    list.add(c)
}
assert list == ["a", "b", "c"]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy also supports the Java colon variation with colons: <code>for (char c : text) {}</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_while_loop"><a class="anchor" href="#_while_loop"></a><a class="link" href="#_while_loop">while loop</a></h7>
<div class="paragraph">
<p>Groovy supports the usual while {&#8230;&#8203;} loops like Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 0
def y = 5

while ( y-- &gt; 0 ) {
    x++
}

assert x == 5</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_dowhile_loop"><a class="anchor" href="#_dowhile_loop"></a><a class="link" href="#_dowhile_loop">do/while loop</a></h7>
<div class="paragraph">
<p>Java&#8217;s class do/while loop is now supported. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// classic Java-style do..while loop
def count = 5
def fact = 1
do {
    fact *= count--
} while(count &gt; 1)
assert fact == 120</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exception_handling"><a class="anchor" href="#_exception_handling"></a><a class="link" href="#_exception_handling">Exception handling</a></h6>
<div class="paragraph">
<p>Exception handling is the same as Java.</p>
</div>
</div>
<div class="sect5">
<h6 id="_try_catch_finally"><a class="anchor" href="#_try_catch_finally"></a><a class="link" href="#_try_catch_finally">try / catch / finally</a></h6>
<div class="paragraph">
<p>You can specify a complete <code>try-catch-finally</code>, a <code>try-catch</code>, or a <code>try-finally</code> set of blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Braces are required around each block&#8217;s body.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">try {
    'moo'.toLong()   // this will generate an exception
    assert false     // asserting that this point should never be reached
} catch ( e ) {
    assert e in NumberFormatException
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can put code within a 'finally' clause following a matching 'try' clause, so that regardless of whether the code in the 'try' clause throws an exception, the code in the finally clause will always execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def z
try {
    def i = 7, j = 0
    try {
        def k = i / j
        assert false        //never reached due to Exception in previous line
    } finally {
        z = 'reached here'  //always executed even if Exception thrown
    }
} catch ( e ) {
    assert e in ArithmeticException
    assert z == 'reached here'
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multi_catch"><a class="anchor" href="#_multi_catch"></a><a class="link" href="#_multi_catch">Multi-catch</a></h6>
<div class="paragraph">
<p>With the multi catch block (since Groovy 2.0), we&#8217;re able to define several exceptions to be catch and treated by the same catch block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">try {
    /* ... */
} catch ( IOException | NullPointerException e ) {
    /* one block to handle 2 exceptions */
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_arm_try_with_resources"><a class="anchor" href="#_arm_try_with_resources"></a><a class="link" href="#_arm_try_with_resources">ARM Try with resources</a></h6>
<div class="paragraph">
<p>Groovy often provides better alternatives to Java 7&#8217;s <code>try</code>-with-resources statement for Automatic Resource Management (ARM).
That syntax is now supported for Java programmers migrating to Groovy and still wanting to use the old style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class FromResource extends ByteArrayInputStream {
    @Override
    void close() throws IOException {
        super.close()
        println "FromResource closing"
    }

    FromResource(String input) {
        super(input.toLowerCase().bytes)
    }
}

class ToResource extends ByteArrayOutputStream {
    @Override
    void close() throws IOException {
        super.close()
        println "ToResource closing"
    }
}

def wrestle(s) {
    try (
            FromResource from = new FromResource(s)
            ToResource to = new ToResource()
    ) {
        to &lt;&lt; from
        return to.toString()
    }
}

def wrestle2(s) {
    FromResource from = new FromResource(s)
    try (from; ToResource to = new ToResource()) { // Enhanced try-with-resources in Java 9+
        to &lt;&lt; from
        return to.toString()
    }
}

assert wrestle("ARM was here!").contains('arm')
assert wrestle2("ARM was here!").contains('arm')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which yields the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ToResource closing
FromResource closing
ToResource closing
FromResource closing</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_power_assertion"><a class="anchor" href="#_power_assertion"></a><a class="link" href="#_power_assertion">Power assertion</a></h5>
<div class="paragraph">
<p>Unlike Java with which Groovy shares the <code>assert</code> keyword, the latter in Groovy behaves very differently. First of all,
an assertion in Groovy is always executed, independently of the <code>-ea</code> flag of the JVM. It makes this a first class choice
for unit tests. The notion of "power asserts" is directly related to how the Groovy <code>assert</code> behaves.</p>
</div>
<div class="paragraph">
<p>A power assertion is decomposed into 3 parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>assert [left expression] == [right expression] : (optional message)</pre>
</div>
</div>
<div class="paragraph">
<p>The result of the assertion is very different from what you would get in Java. If the assertion is true, then nothing
happens. If the assertion is false, then it provides a visual representation of the value of each sub-expressions of the
expression being asserted. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 1+1 == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will yield:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Caught: Assertion failed:

assert 1+1 == 3
        |  |
        2  false</pre>
</div>
</div>
<div class="paragraph">
<p>Power asserts become very interesting when the expressions are more complex, like in the next example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 2
def y = 7
def z = 5
def calc = { a,b -&gt; a*b+1 }
assert calc(x,y) == [x,z].sum()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will print the value for each sub-expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert calc(x,y) == [x,z].sum()
       |    | |  |   | |  |
       15   2 7  |   2 5  7
                 false</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you don&#8217;t want a pretty printed error message like above, you can fall back to a custom error message by
changing the optional message part of the assertion, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 2
def y = 7
def z = 5
def calc = { a,b -&gt; a*b+1 }
assert calc(x,y) == z*z : 'Incorrect computation result'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will print the following error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Incorrect computation result. Expression: (calc.call(x, y) == (z * z)). Values: z = 5, z = 5</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_labeled_statements"><a class="anchor" href="#_labeled_statements"></a><a class="link" href="#_labeled_statements">Labeled statements</a></h5>
<div class="paragraph">
<p>Any statement can be associated with a label. Labels do not impact the semantics of the code and can be used to make
the code easier to read like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">given:
    def x = 1
    def y = 2
when:
    def z = x+y
then:
    assert z == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite not changing the semantics of the labelled statement, it is possible to use labels in the <code>break</code> instruction
as a target for jump, as in the next example. However, even if this is allowed, this coding style is in general considered
a bad practice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">for (int i=0;i&lt;10;i++) {
    for (int j=0;j&lt;i;j++) {
        println "j=$j"
        if (j == 5) {
            break exit
        }
    }
    exit: println "i=$i"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to understand that by default labels have no impact on the semantics of the code, however they belong to the abstract
syntax tree (AST) so it is possible for an AST transformation to use that information to perform transformations over
the code, hence leading to different semantics. This is in particular what the <a href="http://spockframework.github.io/spock/docs/current/index.html">Spock Framework</a>
does to make testing easier.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expressions"><a class="anchor" href="#_expressions"></a><a class="link" href="#_expressions">1.6.2. Expressions</a></h4>
<div class="paragraph">
<p>Expressions are the building blocks of Groovy programs that are used to reference
existing values and execute code to create new ones.</p>
</div>
<div class="paragraph">
<p>Groovy supports many of the same kinds of expressions as Java, including:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Expressions like Java</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Example expression(s)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>foo</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>the name of a variable, field, parameter, &#8230;&#8203;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>this</code>, <code>super</code>, <code>it</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>special names</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code>, <code>10</code>, <code>"bar"</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>literals</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>String.class</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Class literal</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>(</code> <em>expression</em> <code>)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>parenthesised expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>foo++</code>, <code>~bar</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unary <a href="core-operators.html">operator</a> expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>foo + bar</code>, <code>bar * baz</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Binary <a href="core-operators.html">operator</a> expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>foo ? bar : baz</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Ternary <a href="core-operators.html">operator</a> expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>(Integer x, Integer y) &#8594; x + y</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lambda expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'bar' == switch('foo') {
  case 'foo' -&gt; 'bar'
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>switch expressions</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Groovy also has some of its own special expressions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Special expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Example expression(s)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>String</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Abbreviated class literal (when not ambiguous)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>{ x, y &#8594; x + y }</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Closure expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>[1, 3, 5]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>literal list expressions</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>[a:2, b:4, c:6]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>literal map expressions</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Groovy also expands on the normal dot-notation used in Java for member access.
Groovy provides special support for accessing hierarchical data structures by specifying the
path in the hierarchy of some data of interest.
These <em>Groovy path</em> expressions are known as GPath expressions.</p>
</div>
<div class="sect4">
<h5 id="gpath_expressions"><a class="anchor" href="#gpath_expressions"></a><a class="link" href="#gpath_expressions">GPath expressions</a></h5>
<div class="paragraph">
<p><code>GPath</code> is a path expression language integrated into Groovy which allows parts of nested structured data to be identified. In this
sense, it has similar aims and scope as XPath does for XML.  GPath is often used in the context of processing XML, but it really applies
to any object graph.  Where XPath uses a filesystem-like path notation, a tree hierarchy with parts separated by a slash <code>/</code>, GPath <strong>use a
dot-object notation</strong> to perform object navigation.</p>
</div>
<div class="paragraph">
<p>As an example, you can specify a path to an object or element of interest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a.b.c</code> &#8594; for XML, yields all the <code>c</code> elements inside <code>b</code> inside <code>a</code></p>
</li>
<li>
<p><code>a.b.c</code> &#8594; for POJOs, yields the <code>c</code> properties for all the <code>b</code> properties of <code>a</code> (sort of like <code>a.getB().getC()</code> in JavaBeans)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the GPath expression can be viewed as a query on an object graph.  For POJOs, the object graph is most often built by the
program being written through object instantiation and composition; for XML processing, the object graph is the result of <code>parsing</code>
the XML text, most often with classes like XmlParser or XmlSlurper. See <a href="#processing-xml">Processing XML</a>
for more in-depth details on consuming XML in Groovy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When querying the object graph generated from XmlParser or XmlSlurper, a GPath expression can refer to attributes defined on elements with
the <code>@</code> notation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a["@href"]</code> &#8594; map-like notation : the href attribute of all the a elements</p>
</li>
<li>
<p><code>a.'@href'</code>  &#8594; property notation : an alternative way of expressing this</p>
</li>
<li>
<p><code>a.@href</code>    &#8594; direct notation : yet another alternative way of expressing this</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_object_navigation"><a class="anchor" href="#_object_navigation"></a><a class="link" href="#_object_navigation">Object navigation</a></h6>
<div class="paragraph">
<p>Let&#8217;s see an example of a GPath expression on a simple <em>object graph</em>, the one obtained using java reflection.  Suppose you are in a non-static method of a
class having another method named <code>aMethodFoo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void aMethodFoo() { println "This is aMethodFoo." } <i class="conum" data-value="0"></i><b>(0)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>the following GPath expression will get the name of that method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['aMethodFoo'] == this.class.methods.name.grep(~/.*Foo/)</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>More precisely</em>, the above GPath expression produces a list of String, each being the name of an existing method on <code>this</code> where that name ends with <code>Foo</code>.</p>
</div>
<div class="paragraph">
<p>Now, given the following methods also defined in that class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void aMethodBar() { println "This is aMethodBar." } <i class="conum" data-value="1"></i><b>(1)</b>
void anotherFooMethod() { println "This is anotherFooMethod." } <i class="conum" data-value="2"></i><b>(2)</b>
void aSecondMethodBar() { println "This is aSecondMethodBar." } <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>then the following GPath expression will get the names of <strong>(1)</strong> and <strong>(3)</strong>, but not <strong>(2)</strong> or <strong>(0)</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['aMethodBar', 'aSecondMethodBar'] as Set == this.class.methods.name.grep(~/.*Bar/) as Set</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_expression_deconstruction"><a class="anchor" href="#_expression_deconstruction"></a><a class="link" href="#_expression_deconstruction">Expression Deconstruction</a></h6>
<div class="paragraph">
<p>We can decompose the expression <code>this.class.methods.name.grep(~/.*Bar/)</code> to get an idea of how a GPath is evaluated:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>this.class</code></dt>
<dd>
<p>property accessor, equivalent to <code>this.getClass()</code> in Java, yields a <code>Class</code> object.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods</code></dt>
<dd>
<p>property accessor, equivalent to <code>this.getClass().getMethods()</code>, yields an array of <code>Method</code> objects.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods.name</code></dt>
<dd>
<p>apply a property accessor on each element of an array and produce a list of the results.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods.name.grep(&#8230;&#8203;)</code></dt>
<dd>
<p>call method <code>grep</code> on each element of the list yielded by <code>this.class.methods.name</code> and produce a list of the results.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A sub-expression like <code>this.class.methods</code> yields an array because this is what calling <code>this.getClass().getMethods()</code> in Java
would produce. <code>GPath</code> expressions do not have a convention where a <code>s</code> means a list or anything like that.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One powerful feature of GPath expression is that property access on a collection is converted to a <em>property access on each element of the collection</em> with
the results collected into a collection. Therefore, the expression <code>this.class.methods.name</code> could be expressed as follows in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">List&lt;String&gt; methodNames = new ArrayList&lt;String&gt;();
for (Method method : this.getClass().getMethods()) {
   methodNames.add(method.getName());
}
return methodNames;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Array access notation can also be used in a GPath expression where a collection is present :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'aSecondMethodBar' == this.class.methods.name.grep(~/.*Bar/).sort()[1]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
array access are zero-based in GPath expressions
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_gpath_for_xml_navigation"><a class="anchor" href="#_gpath_for_xml_navigation"></a><a class="link" href="#_gpath_for_xml_navigation">GPath for XML navigation</a></h6>
<div class="paragraph">
<p>Here is an example with an XML document and various form of GPath expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlText = """
              | &lt;root&gt;
              |   &lt;level&gt;
              |      &lt;sublevel id='1'&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;mykey&lt;/key&gt;
              |          &lt;value&gt;value 123&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |      &lt;/sublevel&gt;
              |      &lt;sublevel id='2'&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;anotherKey&lt;/key&gt;
              |          &lt;value&gt;42&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;mykey&lt;/key&gt;
              |          &lt;value&gt;fizzbuzz&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |      &lt;/sublevel&gt;
              |   &lt;/level&gt;
              | &lt;/root&gt;
              """
def root = new XmlSlurper().parseText(xmlText.stripMargin())
assert root.level.size() == 1 <i class="conum" data-value="1"></i><b>(1)</b>
assert root.level.sublevel.size() == 2 <i class="conum" data-value="2"></i><b>(2)</b>
assert root.level.sublevel.findAll { it.@id == 1 }.size() == 1 <i class="conum" data-value="3"></i><b>(3)</b>
assert root.level.sublevel[1].keyVal[0].key.text() == 'anotherKey' <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is one <code>level</code> node under <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>There are two <code>sublevel</code> nodes under <code>root/level</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>There is one element <code>sublevel</code> having an attribute <code>id</code> with value <code>1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Text value of <code>key</code> element of first <code>keyVal</code> element of second <code>sublevel</code> element under <code>root/level</code> is 'anotherKey'</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Further details about GPath expressions for XML are in the
<a href="#processing-xml">XML User Guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promotion_and_coercion"><a class="anchor" href="#_promotion_and_coercion"></a><a class="link" href="#_promotion_and_coercion">1.6.3. Promotion and coercion</a></h4>
<div class="sect4">
<h5 id="_number_promotion"><a class="anchor" href="#_number_promotion"></a><a class="link" href="#_number_promotion">Number promotion</a></h5>
<div class="paragraph">
<p>The rules of number promotion are specified in the section on <a href="#_math_operations">math operations</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="closure-coercion"><a class="anchor" href="#closure-coercion"></a><a class="link" href="#closure-coercion">Closure to type coercion</a></h5>
<div class="sect5">
<h6 id="_assigning_a_closure_to_a_sam_type"><a class="anchor" href="#_assigning_a_closure_to_a_sam_type"></a><a class="link" href="#_assigning_a_closure_to_a_sam_type">Assigning a closure to a SAM type</a></h6>
<div class="paragraph">
<p>A SAM type is a type which defines a single abstract method. This includes:</p>
</div>
<div class="listingblock">
<div class="title">Functional interfaces</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Predicate&lt;T&gt; {
    boolean accept(T obj)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Abstract classes with single abstract method</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Greeter {
    abstract String getName()
    void greet() {
        println "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any closure can be converted into a SAM type using the <code>as</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Predicate filter = { it.contains 'G' } as Predicate
assert filter.accept('Groovy') == true

Greeter greeter = { 'Groovy' } as Greeter
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the <code>as Type</code> expression is optional since Groovy 2.2.0. You can omit it and simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Predicate filter = { it.contains 'G' }
assert filter.accept('Groovy') == true

Greeter greeter = { 'Groovy' }
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>which means you are also allowed to use method pointers, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">boolean doFilter(String s) { s.contains('G') }

Predicate filter = this.&amp;doFilter
assert filter.accept('Groovy') == true

Greeter greeter = GroovySystem.&amp;getVersion
greeter.greet()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_calling_a_method_accepting_a_sam_type_with_a_closure"><a class="anchor" href="#_calling_a_method_accepting_a_sam_type_with_a_closure"></a><a class="link" href="#_calling_a_method_accepting_a_sam_type_with_a_closure">Calling a method accepting a SAM type with a closure</a></h6>
<div class="paragraph">
<p>The second and probably more important use case for closure to SAM type coercion is calling a method which accepts
a SAM type. Imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public &lt;T&gt; List&lt;T&gt; filter(List&lt;T&gt; source, Predicate&lt;T&gt; predicate) {
    source.findAll { predicate.accept(it) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call it with a closure, without having to create an explicit implementation of the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert filter(['Java','Groovy'], { it.contains 'G'} as Predicate) == ['Groovy']</code></pre>
</div>
</div>
<div class="paragraph">
<p>But since Groovy 2.2.0, you are also able to omit the explicit coercion and call the method as if it used a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert filter(['Java','Groovy']) { it.contains 'G'} == ['Groovy']</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this has the advantage of letting you use the closure syntax for method calls, that is to say put the
closure outside the parenthesis, improving the readability of your code.</p>
</div>
</div>
<div class="sect5">
<h6 id="_closure_to_arbitrary_type_coercion"><a class="anchor" href="#_closure_to_arbitrary_type_coercion"></a><a class="link" href="#_closure_to_arbitrary_type_coercion">Closure to arbitrary type coercion</a></h6>
<div class="paragraph">
<p>In addition to SAM types, a closure can be coerced to any type and in particular interfaces. Let&#8217;s define the
following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface FooBar {
    int foo()
    void bar()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can coerce a closure into the interface using the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def impl = { println 'ok'; 123 } as FooBar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces a class for which all methods are implemented using the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert impl.foo() == 123
impl.bar()</code></pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to coerce a closure to any class. For example, we can replace the <code>interface</code> that we defined
with <code>class</code> without changing the assertions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class FooBar {
    int foo() { 1 }
    void bar() { println 'bar' }
}

def impl = { println 'ok'; 123 } as FooBar

assert impl.foo() == 123
impl.bar()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_map_to_type_coercion"><a class="anchor" href="#_map_to_type_coercion"></a><a class="link" href="#_map_to_type_coercion">Map to type coercion</a></h5>
<div class="paragraph">
<p>Usually using a single closure to implement an interface or a class with multiple methods is not the way to go. As an
alternative, Groovy allows you to coerce a map into an interface or a class. In that case, keys of the map are
interpreted as method names, while the values are the method implementation. The following example illustrates the
coercion of a map into an <code>Iterator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map
map = [
  i: 10,
  hasNext: { map.i &gt; 0 },
  next: { map.i-- },
]
def iter = map as Iterator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course this is a rather contrived example, but illustrates the concept. You only need to implement those methods
that are actually called, but if a method is called that doesn&#8217;t exist in the map a <code>MissingMethodException</code> or an
<code>UnsupportedOperationException</code> is thrown, depending on the arguments passed to the call,
as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface X {
    void f()
    void g(int n)
    void h(String s, int n)
}

x = [ f: {println "f called"} ] as X
x.f() // method exists
x.g() // MissingMethodException here
x.g(5) // UnsupportedOperationException here</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type of the exception depends on the call itself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MissingMethodException</code> if the arguments of the call do not match those from the interface/class</p>
</li>
<li>
<p><code>UnsupportedOperationException</code> if the arguments of the call match one of the overloaded methods of the interface/class</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_string_to_enum_coercion"><a class="anchor" href="#_string_to_enum_coercion"></a><a class="link" href="#_string_to_enum_coercion">String to enum coercion</a></h5>
<div class="paragraph">
<p>Groovy allows transparent <code>String</code> (or <code>GString</code>) to enum values coercion. Imagine you define the following enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">enum State {
    up,
    down
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can assign a string to the enum without having to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">State st = 'up'
assert st == State.up</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use a <code>GString</code> as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def val = "up"
State st = "${val}"
assert st == State.up</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this would throw a runtime error (<code>IllegalArgumentException</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">State st = 'not an enum value'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it is also possible to use implicit coercion in switch statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">State switchState(State st) {
    switch (st) {
        case 'up':
            return State.down // explicit constant
        case 'down':
            return 'up' // implicit coercion for return types
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>in particular, see how the <code>case</code> use string constants. But if you call a method that uses an enum with a <code>String</code>
argument, you still have to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert switchState('up' as State) == State.down
assert switchState(State.down) == State.up</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_type_coercion"><a class="anchor" href="#_custom_type_coercion"></a><a class="link" href="#_custom_type_coercion">Custom type coercion</a></h5>
<div class="paragraph">
<p>It is possible for a class to define custom coercion strategies by implementing the <code>asType</code> method. Custom coercion
is invoked using the <code>as</code> operator and is never implicit. As an example,
imagine you defined two classes, <code>Polar</code> and <code>Cartesian</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Polar {
    double r
    double phi
}
class Cartesian {
   double x
   double y
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that you want to convert from polar coordinates to cartesian coordinates. One way of doing this is to define
the <code>asType</code> method in the <code>Polar</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def asType(Class target) {
    if (Cartesian==target) {
        return new Cartesian(x: r*cos(phi), y: r*sin(phi))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which allows you to use the <code>as</code> coercion operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sigma = 1E-16
def polar = new Polar(r:1.0,phi:PI/2)
def cartesian = polar as Cartesian
assert abs(cartesian.x-sigma) &lt; sigma</code></pre>
</div>
</div>
<div class="paragraph">
<p>Putting it all together, the <code>Polar</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Polar {
    double r
    double phi
    def asType(Class target) {
        if (Cartesian==target) {
            return new Cartesian(x: r*cos(phi), y: r*sin(phi))
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but it is also possible to define <code>asType</code> outside of the <code>Polar</code> class, which can be practical if you want to define
custom coercion strategies for "closed" classes or classes for which you don&#8217;t own the source code, for example using
a metaclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Polar.metaClass.asType = { Class target -&gt;
    if (Cartesian==target) {
        return new Cartesian(x: r*cos(phi), y: r*sin(phi))
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_class_literals_vs_variables_and_the_as_operator"><a class="anchor" href="#_class_literals_vs_variables_and_the_as_operator"></a><a class="link" href="#_class_literals_vs_variables_and_the_as_operator">Class literals vs variables and the as operator</a></h5>
<div class="paragraph">
<p>Using the <code>as</code> keyword is only possible if you have a static reference to a class, like in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Greeter {
    void greet()
}
def greeter = { println 'Hello, Groovy!' } as Greeter // Greeter is known statically
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if you get the class by reflection, for example by calling <code>Class.forName</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Class clazz = Class.forName('Greeter')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Trying to use the reference to the class with the <code>as</code> keyword would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">greeter = { println 'Hello, Groovy!' } as clazz
// throws:
// unable to resolve class clazz
// @ line 9, column 40.
//   greeter = { println 'Hello, Groovy!' } as clazz</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is failing because the <code>as</code> keyword only works with class literals. Instead, you need to call the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">greeter = { println 'Hello, Groovy!' }.asType(clazz)
greeter.greet()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_optionality"><a class="anchor" href="#_optionality"></a><a class="link" href="#_optionality">1.6.4. Optionality</a></h4>
<div class="sect4">
<h5 id="_optional_parentheses"><a class="anchor" href="#_optional_parentheses"></a><a class="link" href="#_optional_parentheses">Optional parentheses</a></h5>
<div class="paragraph">
<p>Method calls can omit the parentheses if there is at least one parameter and there is no ambiguity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println 'Hello World'
def maximum = Math.max 5, 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parentheses are required for method calls without parameters or ambiguous method calls:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println()
println(Math.max(5, 10))</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_semicolons"><a class="anchor" href="#_optional_semicolons"></a><a class="link" href="#_optional_semicolons">Optional semicolons</a></h5>
<div class="paragraph">
<p>In Groovy semicolons at the end of the line can be omitted, if the line contains only a single statement.</p>
</div>
<div class="paragraph">
<p>This means that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert true;</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be more idiomatically written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple statements in a line require semicolons to separate them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">boolean a = true; assert a</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_return_keyword"><a class="anchor" href="#_optional_return_keyword"></a><a class="link" href="#_optional_return_keyword">Optional return keyword</a></h5>
<div class="paragraph">
<p>In Groovy, the last expression evaluated in the body of a method or a closure is returned. This means that the <code>return</code> keyword is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int add(int a, int b) {
    return a+b
}
assert add(1, 2) == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be shortened to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int add(int a, int b) {
    a+b
}
assert add(1, 2) == 3</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_public_keyword"><a class="anchor" href="#_optional_public_keyword"></a><a class="link" href="#_optional_public_keyword">Optional public keyword</a></h5>
<div class="paragraph">
<p>By default, Groovy classes and methods are <code>public</code>. Therefore this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class Server {
    public String toString() { "a server" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is identical to this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Server {
    String toString() { "a server" }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-groovy-truth"><a class="anchor" href="#the-groovy-truth"></a><a class="link" href="#the-groovy-truth">1.6.5. The Groovy Truth</a></h4>
<div class="paragraph">
<p>Groovy decides whether an expression is true or false by applying the rules given below.</p>
</div>
<div class="sect4">
<h5 id="_boolean_expressions"><a class="anchor" href="#_boolean_expressions"></a><a class="link" href="#_boolean_expressions">Boolean expressions</a></h5>
<div class="paragraph">
<p>True if the corresponding Boolean value is <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert true
assert !false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_collections_and_arrays"><a class="anchor" href="#_collections_and_arrays"></a><a class="link" href="#_collections_and_arrays">Collections and Arrays</a></h5>
<div class="paragraph">
<p>Non-empty Collections and arrays are true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 2, 3]
assert ![]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_matchers"><a class="anchor" href="#_matchers"></a><a class="link" href="#_matchers">Matchers</a></h5>
<div class="paragraph">
<p>True if the Matcher has at least one match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ('a' =~ /a/)
assert !('a' =~ /b/)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterators_and_enumerations"><a class="anchor" href="#_iterators_and_enumerations"></a><a class="link" href="#_iterators_and_enumerations">Iterators and Enumerations</a></h5>
<div class="paragraph">
<p>Iterators and Enumerations with further elements are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [0].iterator()
assert ![].iterator()
Vector v = [0] as Vector
Enumeration enumeration = v.elements()
assert enumeration
enumeration.nextElement()
assert !enumeration</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_maps_2"><a class="anchor" href="#_maps_2"></a><a class="link" href="#_maps_2">Maps</a></h5>
<div class="paragraph">
<p>Non-empty Maps are evaluated to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['one' : 1]
assert ![:]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_strings"><a class="anchor" href="#_strings"></a><a class="link" href="#_strings">Strings</a></h5>
<div class="paragraph">
<p>Non-empty Strings, GStrings and CharSequences are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'a'
assert !''
def nonEmpty = 'a'
assert "$nonEmpty"
def empty = ''
assert !"$empty"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_numbers_2"><a class="anchor" href="#_numbers_2"></a><a class="link" href="#_numbers_2">Numbers</a></h5>
<div class="paragraph">
<p>Non-zero numbers are true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 1
assert 3.5
assert !0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_object_references"><a class="anchor" href="#_object_references"></a><a class="link" href="#_object_references">Object References</a></h5>
<div class="paragraph">
<p>Non-null object references are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new Object()
assert !null</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_the_truth_with_asboolean_methods"><a class="anchor" href="#_customizing_the_truth_with_asboolean_methods"></a><a class="link" href="#_customizing_the_truth_with_asboolean_methods">Customizing the truth with asBoolean() methods</a></h5>
<div class="paragraph">
<p>In order to customize whether groovy evaluates your object to <code>true</code> or <code>false</code> implement the <code>asBoolean()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Color {
    String name

    boolean asBoolean(){
        name == 'green' ? true : false 
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy will call this method to coerce your object to a boolean value, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new Color(name: 'green')
assert !new Color(name: 'red')</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_typing"><a class="anchor" href="#_typing"></a><a class="link" href="#_typing">1.6.6. Typing</a></h4>
<div class="sect4">
<h5 id="_optional_typing"><a class="anchor" href="#_optional_typing"></a><a class="link" href="#_optional_typing">Optional typing</a></h5>
<div class="paragraph">
<p>Optional typing is the idea that a program can work even if you don&#8217;t put an explicit type on a variable. Being a dynamic
language, Groovy naturally implements that feature, for example when you declare a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String aString = 'foo'                      <i class="conum" data-value="1"></i><b>(1)</b>
assert aString.toUpperCase()                <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using an explicit type, <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the <code>toUpperCase</code> method on a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy will let you write this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def aString = 'foo'                         <i class="conum" data-value="1"></i><b>(1)</b>
assert aString.toUpperCase()                <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can still call the <code>toUpperCase</code> method, because the type of <code>aString</code> is resolved at runtime</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So it doesn&#8217;t matter that you use an explicit type here. It is in particular interesting when you combine this feature
with <a href="#static-type-checking">static type checking</a>, because the type checker performs type inference.</p>
</div>
<div class="paragraph">
<p>Likewise, Groovy doesn&#8217;t make it mandatory to declare the types of a parameter in a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String concat(String a, String b) {
    a+b
}
assert concat('foo','bar') == 'foobar'</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be rewritten using <code>def</code> as both return type and parameter types, in order to take advantage of duck typing, as
illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def concat(def a, def b) {                              <i class="conum" data-value="1"></i><b>(1)</b>
    a+b
}
assert concat('foo','bar') == 'foobar'                  <i class="conum" data-value="2"></i><b>(2)</b>
assert concat(1,2) == 3                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>both the return type and the parameter types use <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it makes it possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but also with <code>int</code> since the <code>plus</code> method is defined</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <code>def</code> keyword here is recommended to describe the intent of a method which is supposed to work on any
type, but technically, we could use <code>Object</code> instead and the result would be the same: <code>def</code> is, in Groovy, strictly
equivalent to using <code>Object</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Eventually, the type can be removed altogether from both the return type and the descriptor. But if you want to remove
it from the return type, you then need to add an explicit modifier for the method, so that the compiler can make a difference
between a method declaration and a method call, like illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">private concat(a,b) {                                   <i class="conum" data-value="1"></i><b>(1)</b>
    a+b
}
assert concat('foo','bar') == 'foobar'                  <i class="conum" data-value="2"></i><b>(2)</b>
assert concat(1,2) == 3                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if we want to omit the return type, an explicit modifier has to be set.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is still possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and also with <code>int</code></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Omitting types is in general considered a bad practice in method parameters or method return types for public APIs.
While using <code>def</code> in a local variable is not really a problem because the visibility of the variable is limited to the
method itself, while set on a method parameter, <code>def</code> will be converted to <code>Object</code> in the method signature, making it
difficult for users to know which is the expected type of the arguments. This means that you should limit this to cases
where you are explicitly relying on duck typing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="static-type-checking"><a class="anchor" href="#static-type-checking"></a><a class="link" href="#static-type-checking">Static type checking</a></h5>
<div class="paragraph">
<p>By default, Groovy performs minimal type checking at compile time. Since it is primarily a dynamic language,
most checks that a static compiler would normally do aren&#8217;t possible at compile time. A method added via runtime
metaprogramming might alter a class or object&#8217;s runtime behavior. Let&#8217;s illustrate why in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {                                                          <i class="conum" data-value="1"></i><b>(1)</b>
    String firstName
    String lastName
}
def p = new Person(firstName: 'Raymond', lastName: 'Devos')             <i class="conum" data-value="2"></i><b>(2)</b>
assert p.formattedName == 'Raymond Devos'                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class only defines two properties, <code>firstName</code> and <code>lastName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can create an instance of Person</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and call a method named <code>formattedName</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is quite common in dynamic languages for code such as the above example not to throw any error. How can this be?
In Java, this would typically fail at compile time. However, in Groovy, it will not fail at compile time, and if coded
correctly, will also not fail at runtime. In fact, to make this work at runtime, <strong>one</strong> possibility is to rely on
runtime metaprogramming. So just adding this line after the declaration of the <code>Person</code> class is enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Person.metaClass.getFormattedName = { "$delegate.firstName $delegate.lastName" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that in general, in Groovy, you can&#8217;t make any assumption about the type of an object beyond its declaration
type, and even if you know it, you can&#8217;t determine at compile time what method will be called, or which property will
be retrieved. It has a lot of interest, going from writing DSLs to testing, which is discussed in other sections of this
manual.</p>
</div>
<div class="paragraph">
<p>However, if your program doesn&#8217;t rely on dynamic features and that you come from the static world (in particular, from
a Java mindset), not catching such "errors" at compile time can be surprising. As we have seen in the previous example,
the compiler cannot be sure this is an error. To make it aware that it is, you have to explicitly instruct the compiler
that you are switching to a type checked mode. This can be done by annotating a class or a method with <code>@groovy.transform.TypeChecked</code>.</p>
</div>
<div class="paragraph">
<p>When type checking is activated, the compiler performs much more work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type inference is activated, meaning that even if you use <code>def</code> on a local variable for example, the type checker will be
able to infer the type of the variable from the assignments</p>
</li>
<li>
<p>method calls are resolved at compile time, meaning that if a method is not declared on a class, the compiler will throw an error</p>
</li>
<li>
<p>in general, all the compile time errors that you are used to find in a static language will appear: method not found, property not found,
incompatible types for method calls, number precision errors, &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section, we will describe the behavior of the type checker in various situations and explain the limits of using
<code>@TypeChecked</code> on your code.</p>
</div>
<div class="sect5">
<h6 id="_the_typechecked_annotation"><a class="anchor" href="#_the_typechecked_annotation"></a><a class="link" href="#_the_typechecked_annotation">The <code>@TypeChecked</code> annotation</a></h6>
<div class="sect6">
<h7 id="_activating_type_checking_at_compile_time"><a class="anchor" href="#_activating_type_checking_at_compile_time"></a><a class="link" href="#_activating_type_checking_at_compile_time">Activating type checking at compile time</a></h7>
<div class="paragraph">
<p>The <code>groovy.transform.TypeChecked</code> annotation enables type checking. It can be placed on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
class Calculator {
    int sum(int x, int y) { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Calculator {
    @groovy.transform.TypeChecked
    int sum(int x, int y) { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the first case, all methods, properties, fields, inner classes, &#8230;&#8203; of the annotated class will be type checked, whereas
in the second case, only the method and potential closures or anonymous inner classes that it contains will be type checked.</p>
</div>
</div>
<div class="sect6">
<h7 id="_skipping_sections"><a class="anchor" href="#_skipping_sections"></a><a class="link" href="#_skipping_sections">Skipping sections</a></h7>
<div class="paragraph">
<p>The scope of type checking can be restricted. For example, if a class is type checked, you can instruct the type checker
to skip a method by annotating it with <code>@TypeChecked(TypeCheckingMode.SKIP)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TypeChecked
import groovy.transform.TypeCheckingMode

@TypeChecked                                        <i class="conum" data-value="1"></i><b>(1)</b>
class GreetingService {
    String greeting() {                             <i class="conum" data-value="2"></i><b>(2)</b>
        doGreet()
    }

    @TypeChecked(TypeCheckingMode.SKIP)             <i class="conum" data-value="3"></i><b>(3)</b>
    private String doGreet() {
        def b = new SentenceBuilder()
        b.Hello.my.name.is.John                     <i class="conum" data-value="4"></i><b>(4)</b>
        b
    }
}
def s = new GreetingService()
assert s.greeting() == 'Hello my name is John'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>GreetingService</code> class is marked as type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so the <code>greeting</code> method is automatically type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but <code>doGreet</code> is marked with <code>SKIP</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the type checker doesn&#8217;t complain about missing properties here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous example, <code>SentenceBuilder</code> relies on dynamic code. There&#8217;s no real <code>Hello</code> method or property, so the
type checker would normally complain and compilation would fail. Since the method that uses the builder is marked with
<code>TypeCheckingMode.SKIP</code>, type checking is <em>skipped</em> for this method, so the code will compile, even if the rest of the
class is type checked.</p>
</div>
<div class="paragraph">
<p>The following sections describe the semantics of type checking in Groovy.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_type_checking_assignments"><a class="anchor" href="#_type_checking_assignments"></a><a class="link" href="#_type_checking_assignments">Type checking assignments</a></h6>
<div class="paragraph">
<p>An object <code>o</code> of type <code>A</code> can be assigned to a variable of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Date now = new Date()</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is one of <code>String</code>, <code>boolean</code>, <code>Boolean</code> or <code>Class</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String s = new Date() // implicit call to toString
Boolean boxed = 'some string'       // Groovy truth
boolean prim = 'some string'        // Groovy truth
Class clazz = 'java.lang.String'    // class coercion</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String s = null         // passes
int i = null            // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int[] i = new int[4]        // passes
int[] i = new String[4]     // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is a collection or stream and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int[] i = [1,2,3]               // passes
int[] i = [1,2, new Date()]     // fails
Set set = [1,2,3]
Number[] na = set               // passes
def stream = Arrays.stream(1,2,3)
int[] i = stream                // passes</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">AbstractList list = new ArrayList()     // passes
LinkedList list = new ArrayList()       // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List list = new ArrayList()             // passes
RandomAccess list = new LinkedList()    // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int i = 0
Integer bi = 1
int x = Integer.valueOf(123)
double d = Float.valueOf(5f)</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Runnable r = { println 'Hello' }
interface SAMType {
    int doSomething()
}
SAMType sam = { 123 }
assert sam.doSomething() == 123
abstract class AbstractSAM {
    int calc() { 2* value() }
    abstract int value()
}
AbstractSAM c = { 123 }
assert c.calc() == 246</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the following table</p>
</li>
</ul>
</div>
<table id="number-assignment" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Number types (java.lang.XXX)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">A</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any but BigDecimal or BigInteger</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Double d1 = 4d
Double d2 = 4f
Double d3 = 4l
Double d4 = 4i
Double d5 = (short) 4
Double d6 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger or Double</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Float f1 = 4f
Float f2 = 4l
Float f3 = 4i
Float f4 = (short) 4
Float f5 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double or Float</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Long l1 = 4l
Long l2 = 4i
Long l3 = (short) 4
Long l4 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float or Long</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Integer i1 = 4i
Integer i2 = (short) 4
Integer i3 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float, Long or Integer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Short s1 = (short) 4
Short s2 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Byte b1 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_list_and_map_constructors"><a class="anchor" href="#_list_and_map_constructors"></a><a class="link" href="#_list_and_map_constructors">List and map constructors</a></h6>
<div class="paragraph">
<p>In addition to the assignment rules above, if an assignment is deemed invalid, in type checked mode, a <em>list</em> literal or a <em>map</em> literal <code>A</code> can be assigned
to a variable of type <code>T</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a list literal and <code>T</code> has a constructor whose parameters match the types of the elements in the list literal</p>
</li>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a map literal and <code>T</code> has a no-arg constructor and a property for each of the map keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TupleConstructor
class Person {
    String firstName
    String lastName
}
Person classic = new Person('Ada','Lovelace')</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a "list constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Person list = ['Ada','Lovelace']</code></pre>
</div>
</div>
<div class="paragraph">
<p>or a "map constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Person map = [firstName:'Ada', lastName:'Lovelace']</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use a map constructor, additional checks are done on the keys of the map to check if a property of the same name
is defined. For example, the following will fail at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TupleConstructor
class Person {
    String firstName
    String lastName
}
Person map = [firstName:'Ada', lastName:'Lovelace', age: 24]     <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The type checker will throw an error <code>No such property: age for class: Person</code> at compile time</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_method_resolution"><a class="anchor" href="#_method_resolution"></a><a class="link" href="#_method_resolution">Method resolution</a></h6>
<div class="paragraph">
<p>In type checked mode, methods are resolved at compile time. Resolution works by name and arguments. The return type is
irrelevant to method selection. Types of arguments are matched against the types of the parameters following those rules:</p>
</div>
<div class="paragraph">
<p>An argument <code>o</code> of type <code>A</code> can be used for a parameter of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int sum(int x, int y) {
    x+y
}
assert sum(3,4) == 7</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a <code>String</code> and <code>A</code> is a <code>GString</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String format(String str) {
    "Result: $str"
}
assert format("${3+4}") == "Result: 7"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String format(int value) {
    "Result: $value"
}
assert format(7) == "Result: 7"
format(null)           // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String format(String[] values) {
    "Result: ${values.join(' ')}"
}
assert format(['a','b'] as String[]) == "Result: a b"
format([1,2] as int[])              // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String format(AbstractList list) {
    list.join(',')
}
format(new ArrayList())              // passes
String format(LinkedList list) {
    list.join(',')
}
format(new ArrayList())              // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String format(List list) {
    list.join(',')
}
format(new ArrayList())                  // passes
String format(RandomAccess list) {
    'foo'
}
format(new LinkedList())                 // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int sum(int x, Integer y) {
    x+y
}
assert sum(3, new Integer(4)) == 7
assert sum(new Integer(3), 4) == 7
assert sum(new Integer(3), new Integer(4)) == 7
assert sum(new Integer(3), 4) == 7</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface SAMType {
    int doSomething()
}
int twice(SAMType sam) { 2*sam.doSomething() }
assert twice { 123 } == 246
abstract class AbstractSAM {
    int calc() { 2* value() }
    abstract int value()
}
int eightTimes(AbstractSAM sam) { 4*sam.calc() }
assert eightTimes { 123 } == 984</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the same rules as <a href="#number-assignment">assignment of numbers</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a method with the appropriate name and arguments is not found at compile time, an error is thrown. The difference with "normal" Groovy is
illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyService {
    void doSomething() {
        printLine 'Do something'            <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is an error, but since we&#8217;re in a dynamic mode, the error is not caught at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above shows a class that Groovy will be able to compile. However, if you try to create an instance of <code>MyService</code> and call the
<code>doSomething</code> method, then it will fail <strong>at runtime</strong>, because <code>printLine</code> doesn&#8217;t exist. Of course, we already showed how Groovy could make
this a perfectly valid call, for example by catching <code>MethodMissingException</code> or implementing a custom metaclass, but if you know you&#8217;re
not in such a case, <code>@TypeChecked</code> comes handy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
class MyService {
    void doSomething() {
        printLine 'Do something'            <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is this time a compile-time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just adding <code>@TypeChecked</code> will trigger compile time method resolution. The type checker will try to find a method <code>printLine</code> accepting
a <code>String</code> on the <code>MyService</code> class, but cannot find one. It will fail compilation with the following message:</p>
</div>
<div class="paragraph">
<p><code>Cannot find matching method MyService#printLine(java.lang.String)</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is important to understand the logic behind the type checker: it is a compile-time check, so by definition, the type checker
is not aware of any kind of <strong>runtime</strong> metaprogramming that you do. This means that code which is perfectly valid without <code>@TypeChecked</code> will
<strong>not</strong> compile anymore if you activate type checking. This is in particular true if you think of duck typing:<br>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Duck {
    void quack() {              <i class="conum" data-value="1"></i><b>(1)</b>
        println 'Quack!'
    }
}
class QuackingBird {
    void quack() {              <i class="conum" data-value="2"></i><b>(2)</b>
        println 'Quack!'
    }
}
@groovy.transform.TypeChecked
void accept(quacker) {
    quacker.quack()             <i class="conum" data-value="3"></i><b>(3)</b>
}
accept(new Duck())              <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we define a <code>Duck</code> class which defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define another <code>QuackingBird</code> class which also defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>quacker</code> is loosely typed, so since the method is <code>@TypeChecked</code>, we will obtain a compile-time error</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>even if in non type-checked Groovy, this would have passed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are possible workarounds, like introducing an interface, but basically, by activating type checking, you gain type safety
but you loose some features of the language. Hopefully, Groovy introduces some features like flow typing to reduce the gap between
type-checked and non type-checked Groovy.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="type-inference"><a class="anchor" href="#type-inference"></a><a class="link" href="#type-inference">Type inference</a></h6>
<div class="sect6">
<h7 id="_principles"><a class="anchor" href="#_principles"></a><a class="link" href="#_principles">Principles</a></h7>
<div class="paragraph">
<p>When code is annotated with <code>@TypeChecked</code>, the compiler performs type inference. It doesn&#8217;t simply rely on static types, but also uses various
techniques to infer the types of variables, return types, literals, &#8230;&#8203; so that the code remains as clean as possible even if you activate the
type checker.</p>
</div>
<div class="paragraph">
<p>The simplest example is inferring the type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def message = 'Welcome to Groovy!'              <i class="conum" data-value="1"></i><b>(1)</b>
println message.toUpperCase()                   <i class="conum" data-value="2"></i><b>(2)</b>
println message.upper() // compile time error   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable is declared using the <code>def</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling <code>toUpperCase</code> is allowed by the type checker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>upper</code> will fail at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason the call to <code>toUpperCase</code> works is because the type of <code>message</code> was <em>inferred</em> as being a <code>String</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_variables_vs_fields_in_type_inference"><a class="anchor" href="#_variables_vs_fields_in_type_inference"></a><a class="link" href="#_variables_vs_fields_in_type_inference">Variables vs fields in type inference</a></h7>
<div class="paragraph">
<p>It is worth noting that although the compiler performs type inference on local variables, it does <strong>not</strong> perform any kind
of type inference on fields, always falling back to the <strong>declared type</strong> of a field. To illustrate this, let&#8217;s take a
look at this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeClass {
    def someUntypedField                                                                <i class="conum" data-value="1"></i><b>(1)</b>
    String someTypedField                                                               <i class="conum" data-value="2"></i><b>(2)</b>

    void someMethod() {
        someUntypedField = '123'                                                        <i class="conum" data-value="3"></i><b>(3)</b>
        someUntypedField = someUntypedField.toUpperCase()  // compile-time error        <i class="conum" data-value="4"></i><b>(4)</b>
    }

    void someSafeMethod() {
        someTypedField = '123'                                                          <i class="conum" data-value="5"></i><b>(5)</b>
        someTypedField = someTypedField.toUpperCase()                                   <i class="conum" data-value="6"></i><b>(6)</b>
    }

    void someMethodUsingLocalVariable() {
        def localVariable = '123'                                                       <i class="conum" data-value="7"></i><b>(7)</b>
        someUntypedField = localVariable.toUpperCase()                                  <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>someUntypedField</code> uses <code>def</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>someTypedField</code> uses <code>String</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can assign <strong>anything</strong> to <code>someUntypedField</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>yet calling <code>toUpperCase</code> fails at compile time because the field is not typed properly</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can assign a <code>String</code> to a field of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>and this time <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>if we assign a <code>String</code> to a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then calling <code>toUpperCase</code> is allowed on the local variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Why such a difference? The reason is <em>thread safety</em>. At compile time, we can&#8217;t make <strong>any</strong> guarantee about the type of
a field. Any thread can access any field at any time and between the moment a field is assigned a variable of some
type in a method and the time is used the line after, another thread may have changed the contents of the field. This
is not the case for local variables: we know if they "escape" or not, so we can make sure that the type of a variable is
constant (or not) over time. Note that even if a field is final, the JVM makes no guarantee about it, so the type checker
doesn&#8217;t behave differently if a field is final or not.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is one of the reasons why we recommend to use <strong>typed</strong> fields. While using <code>def</code> for local variables is perfectly
fine thanks to type inference, this is not the case for fields, which also belong to the public API of a class, hence the
type is important.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_collection_literal_type_inference"><a class="anchor" href="#_collection_literal_type_inference"></a><a class="link" href="#_collection_literal_type_inference">Collection literal type inference</a></h7>
<div class="paragraph">
<p>Groovy provides a syntax for various type literals. There are three native collection literals in Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lists, using the <code>[]</code> literal</p>
</li>
<li>
<p>maps, using the <code>[:]</code> literal</p>
</li>
<li>
<p>ranges, using <code>from..to</code> (inclusive), <code>from..&lt;to</code> (right exclusive),<code>from&lt;..to</code> (left exclusive) and <code>from&lt;..&lt;to</code> (full exclusive)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The inferred type of a literal depends on the elements of the literal, as illustrated in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Literal</th>
<th class="tableblock halign-left valign-top">Inferred type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = []</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.List</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = ['foo','bar']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.List&lt;String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = ["${foo}","${bar}"]</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.List&lt;GString&gt;</code> be careful, a <code>GString</code> is <strong>not</strong> a <code>String</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [:]</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.LinkedHashMap</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map1 = [someKey: 'someValue']
def map2 = ['someKey': 'someValue']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;String,String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = ["${someKey}": 'someValue']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;GString,String&gt;</code> be careful, the key is a <code>GString</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def intRange = (0..10)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>groovy.lang.IntRange</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def charRange = ('a'..'z')</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>groovy.lang.Range&lt;String&gt;</code> : uses the type of the bounds to infer the component type of the range</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, with the noticeable exception of the <code>IntRange</code>, the inferred type makes use of generics types to describe
the contents of a collection. In case the collection contains elements of different types, the type checker still performs
type inference of the components, but uses the notion of <a href="#section-lub">least upper bound</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="section-lub"><a class="anchor" href="#section-lub"></a><a class="link" href="#section-lub">Least upper bound</a></h7>
<div class="paragraph">
<p>In Groovy, the <em>least upper bound</em> of two types <code>A</code> and <code>B</code> is defined as a type which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>superclass corresponds to the common super class of <code>A</code> and <code>B</code></p>
</li>
<li>
<p>interfaces correspond to the interfaces implemented by both <code>A</code> and <code>B</code></p>
</li>
<li>
<p>if <code>A</code> or <code>B</code> is a primitive type and that <code>A</code> isn&#8217;t equal to <code>B</code>, the least upper bound of <code>A</code> and <code>B</code> is the least
upper bound of their wrapper types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>A</code> and <code>B</code> only have one (1) interface in common and that their common superclass is <code>Object</code>, then the LUB of both
is the common interface.</p>
</div>
<div class="paragraph">
<p>The least upper bound represents the minimal type to which both <code>A</code> and <code>B</code> can be assigned. So for example, if <code>A</code> and <code>B</code>
are both <code>String</code>, then the LUB (least upper bound) of both is also <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Top {}
class Bottom1 extends Top {}
class Bottom2 extends Top {}

assert leastUpperBound(String, String) == String                    <i class="conum" data-value="1"></i><b>(1)</b>
assert leastUpperBound(ArrayList, LinkedList) == AbstractList       <i class="conum" data-value="2"></i><b>(2)</b>
assert leastUpperBound(ArrayList, List) == List                     <i class="conum" data-value="3"></i><b>(3)</b>
assert leastUpperBound(List, List) == List                          <i class="conum" data-value="4"></i><b>(4)</b>
assert leastUpperBound(Bottom1, Bottom2) == Top                     <i class="conum" data-value="5"></i><b>(5)</b>
assert leastUpperBound(List, Serializable) == Object                <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the LUB of <code>String</code> and <code>String</code> is <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the LUB of <code>ArrayList</code> and <code>LinkedList</code> is their common super type, <code>AbstractList</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the LUB of <code>ArrayList</code> and <code>List</code> is their only common interface, <code>List</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the LUB of two identical interfaces is the interface itself</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the LUB of <code>Bottom1</code> and <code>Bottom2</code> is their superclass <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the LUB of two types which have nothing in common is <code>Object</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In those examples, the LUB is always representable as a normal, JVM supported, type. But Groovy internally represents the LUB
as a type which can be more complex, and that you wouldn&#8217;t be able to use to define a variable for example. To illustrate this,
let&#8217;s continue with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Foo {}
class Top {}
class Bottom extends Top implements Serializable, Foo {}
class SerializableFooImpl implements Serializable, Foo {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the least upper bound of <code>Bottom</code> and <code>SerializableFooImpl</code>? They don&#8217;t have a common super class (apart from <code>Object</code>),
but they do share 2 interfaces (<code>Serializable</code> and <code>Foo</code>), so their least upper bound is a type which represents the union of
two interfaces (<code>Serializable</code> and <code>Foo</code>). This type cannot be defined in the source code, yet Groovy knows about it.</p>
</div>
<div class="paragraph">
<p>In the context of collection type inference (and generic type inference in general), this becomes handy, because the type of the
components is inferred as the least upper bound. We can illustrate why this is important in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Greeter { void greet() }                  <i class="conum" data-value="1"></i><b>(1)</b>
interface Salute { void salute() }                  <i class="conum" data-value="2"></i><b>(2)</b>

class A implements Greeter, Salute {                <i class="conum" data-value="3"></i><b>(3)</b>
    void greet() { println "Hello, I'm A!" }
    void salute() { println "Bye from A!" }
}
class B implements Greeter, Salute {                <i class="conum" data-value="4"></i><b>(4)</b>
    void greet() { println "Hello, I'm B!" }
    void salute() { println "Bye from B!" }
    void exit() { println 'No way!' }               <i class="conum" data-value="5"></i><b>(5)</b>
}
def list = [new A(), new B()]                       <i class="conum" data-value="6"></i><b>(6)</b>
list.each {
    it.greet()                                      <i class="conum" data-value="7"></i><b>(7)</b>
    it.salute()                                     <i class="conum" data-value="8"></i><b>(8)</b>
    it.exit()                                       <i class="conum" data-value="9"></i><b>(9)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Greeter</code> interface defines a single method, <code>greet</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Salute</code>  interface defines a single method, <code>salute</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>A</code> implements both <code>Greeter</code> and <code>Salute</code> but there&#8217;s no explicit interface extending both</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>same for <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but <code>B</code> defines an additional <code>exit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the type of <code>list</code> is inferred as "list of the LUB of <code>A</code> and `B`"</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>so it is possible to call <code>greet</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Greeter</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>and it is possible to call <code>salute</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Salute</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>yet calling <code>exit</code> is a compile time error because it doesn&#8217;t belong to the LUB of <code>A</code> and <code>B</code> (only defined in <code>B</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The error message will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method Greeter or Salute#exit()</pre>
</div>
</div>
<div class="paragraph">
<p>which indicates that the <code>exit</code> method is neither defines on <code>Greeter</code> nor <code>Salute</code>, which are the two interfaces defined
in the least upper bound of <code>A</code> and <code>B</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_instanceof_inference"><a class="anchor" href="#_instanceof_inference"></a><a class="link" href="#_instanceof_inference">instanceof inference</a></h7>
<div class="paragraph">
<p>In normal, non type checked, Groovy, you can write things like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Greeter {
    String greeting() { 'Hello' }
}

void doSomething(def o) {
    if (o instanceof Greeter) {     <i class="conum" data-value="1"></i><b>(1)</b>
        println o.greeting()        <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

doSomething(new Greeter())</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>guard the method call with an <code>instanceof</code> check</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>make the call</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The method call works because of dynamic dispatch (the method is selected at runtime). The equivalent code in Java would
require to cast <code>o</code> to a <code>Greeter</code> before calling the <code>greeting</code> method, because methods are selected at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (o instanceof Greeter) {
    System.out.println(((Greeter)o).greeting());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in Groovy, even if you add <code>@TypeChecked</code> (and thus activate type checking) on the <code>doSomething</code> method, the
cast is <strong>not</strong> necessary. The compiler embeds <em>instanceof</em> inference that makes the cast optional.</p>
</div>
</div>
<div class="sect6">
<h7 id="section-flow-typing"><a class="anchor" href="#section-flow-typing"></a><a class="link" href="#section-flow-typing">Flow typing</a></h7>
<div class="paragraph">
<p>Flow typing is an important concept of Groovy in type checked mode and an extension of type inference. The idea is that
the compiler is capable of inferring the type of variables in the flow of the code, not just at initialization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
void flowTyping() {
    def o = 'foo'                       <i class="conum" data-value="1"></i><b>(1)</b>
    o = o.toUpperCase()                 <i class="conum" data-value="2"></i><b>(2)</b>
    o = 9d                              <i class="conum" data-value="3"></i><b>(3)</b>
    o = Math.sqrt(o)                    <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>first, <code>o</code> is declared using <code>def</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the compiler inferred that <code>o</code> is a <code>String</code>, so calling <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>o</code> is reassigned with a <code>double</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling <code>Math.sqrt</code> passes compilation because the compiler knows that at this point, <code>o</code> is a <code>double</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So the type checker is <em>aware</em> of the fact that the concrete type of a variable is different over time. In particular,
if you replace the last assignment with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">o = 9d
o = o.toUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker will now fail at compile time, because it knows that <code>o</code> is a <code>double</code> when <code>toUpperCase</code> is called,
so it&#8217;s a type error.</p>
</div>
<div class="paragraph">
<p>It is important to understand that it is not the fact of declaring a variable with <code>def</code> that triggers type inference.
Flow typing works for <strong>any</strong> variable of any type. Declaring a variable with an explicit type only constrains what you
can assign to the variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List list = ['a','b','c']           <i class="conum" data-value="1"></i><b>(1)</b>
    list = list*.toUpperCase()          <i class="conum" data-value="2"></i><b>(2)</b>
    list = 'foo'                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is declared as an unchecked <code>List</code> and assigned a list literal of `String`s</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this line passes compilation because of flow typing: the type checker knows that <code>list</code> is at this point a <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but you can&#8217;t assign a <code>String</code> to a <code>List</code> so this is a type checking error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also note that even if the variable is declared <strong>without</strong> generics information, the type checker knows what is
the component type. Therefore, such code would fail compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List list = ['a','b','c']           <i class="conum" data-value="1"></i><b>(1)</b>
    list.add(1)                         <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is inferred as <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;String&gt;</code> is a compile-time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fixing this requires adding an explicit generic type to the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List&lt;? extends Serializable&gt; list = []                      <i class="conum" data-value="1"></i><b>(1)</b>
    list.addAll(['a','b','c'])                                  <i class="conum" data-value="2"></i><b>(2)</b>
    list.add(1)                                                 <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> declared as <code>List&lt;? extends Serializable&gt;</code> and initialized with an empty list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>elements added to the list conform to the declaration type of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;? extends Serializable&gt;</code> is allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flow typing has been introduced to reduce the difference in semantics between classic and static Groovy. In particular,
consider the behavior of this code in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public Integer compute(String str) {
    return str.length();
}
public String compute(Object o) {
    return "Nope";
}
// ...
Object string = "Some string";          <i class="conum" data-value="1"></i><b>(1)</b>
Object result = compute(string);        <i class="conum" data-value="2"></i><b>(2)</b>
System.out.println(result);             <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>o</code> is declared as an <code>Object</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the <code>compute</code> method with <code>o</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and print the result</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Java, this code will output <code>Nope</code>, because method selection is done at compile time and based on the <strong>declared</strong> types.
So even if <code>o</code> is a <code>String</code> at runtime, it is still the <code>Object</code> version which is called, because <code>o</code> has been declared
as an <code>Object</code>. To be short, in Java, declared types are most important, be it variable types, parameter types or return
types.</p>
</div>
<div class="paragraph">
<p>In Groovy, we could write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int compute(String string) { string.length() }
String compute(Object o) { "Nope" }
Object o = 'string'
def result = compute(o)
println result</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this time, it will return <code>6</code>, because the method which is chosen <strong>at runtime</strong>, based on the <em>actual</em>
argument types. So at runtime, <code>o</code> is a <code>String</code> so the <code>String</code> variant is used. Note that this behavior has nothing
to do with type checking, it&#8217;s the way Groovy works in general: dynamic dispatch.</p>
</div>
<div class="paragraph">
<p>In type checked Groovy, we want to make sure the type checker selects the same method <strong>at compile time</strong>, that the runtime
would choose. It is not possible in general, due to the semantics of the language, but we can make things better with flow
typing. With flow typing, <code>o</code> is <em>inferred</em> as a <code>String</code> when the <code>compute</code> method is called, so the version which takes
a <code>String</code> and returns an <code>int</code> is chosen. This means that we can infer the return type of the method to be an <code>int</code>, and
not a <code>String</code>. This is important for subsequent calls and type safety.</p>
</div>
<div class="paragraph">
<p>So in type checked Groovy, flow typing is a very important concept, which also implies that if <code>@TypeChecked</code> is applied,
methods are selected based on the <em>inferred types</em> of the arguments, not on the declared types. This doesn&#8217;t ensure 100%
type safety, because the type checker <em>may</em> select a wrong method, but it ensures the closest semantics to dynamic Groovy.</p>
</div>
</div>
<div class="sect6">
<h7 id="_advanced_type_inference"><a class="anchor" href="#_advanced_type_inference"></a><a class="link" href="#_advanced_type_inference">Advanced type inference</a></h7>
<div class="paragraph">
<p>A combination of <a href="#section-flow-typing">flow typing</a> and <a href="#section-lub">least upper bound inference</a> is used to perform
advanced type inference and ensure type safety in multiple situations. In particular, program control structures are
likely to alter the inferred type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Top {
   void methodFromTop() {}
}
class Bottom extends Top {
   void methodFromBottom() {}
}
def o
if (someCondition) {
    o = new Top()                               <i class="conum" data-value="1"></i><b>(1)</b>
} else {
    o = new Bottom()                            <i class="conum" data-value="2"></i><b>(2)</b>
}
o.methodFromTop()                               <i class="conum" data-value="3"></i><b>(3)</b>
o.methodFromBottom()  // compilation error      <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if <code>someCondition</code> is true, <code>o</code> is assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if <code>someCondition</code> is false, <code>o</code> is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>methodFromTop</code> is safe</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but calling <code>methodFromBottom</code> is not, so it&#8217;s a compile time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the type checker visits an <code>if/else</code> control structure, it checks all variables which are assigned in <code>if/else</code> branches
and computes the <a href="#section-lub">least upper bound</a> of all assignments. This type is the type of the inferred variable
after the <code>if/else</code> block, so in this example, <code>o</code> is assigned a <code>Top</code> in the <code>if</code> branch and a <code>Bottom</code> in the <code>else</code>
branch. The <a href="#section-lub">LUB</a> of those is a <code>Top</code>, so after the conditional branches, the compiler infers <code>o</code> as being
a <code>Top</code>. Calling <code>methodFromTop</code> will therefore be allowed, but not <code>methodFromBottom</code>.</p>
</div>
<div class="paragraph">
<p>The same reasoning exists with closures and in particular closure shared variables. A closure shared variable is a variable
which is defined outside of a closure, but used inside a closure, as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = 'Hello, world!'                          <i class="conum" data-value="1"></i><b>(1)</b>
def closure = {
    println text                                    <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable named <code>text</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>text</code> is used from inside a closure. It is a <em>closure shared variable</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy allows developers to use those variables without requiring them to be final. This means that a closure shared
variable can be reassigned inside a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String result
doSomething { String it -&gt;
    result = "Result: $it"
}
result = result?.toUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that a closure is an independent block of code that can be executed (or not) at <strong>any</strong> time. In particular,
<code>doSomething</code> may be asynchronous, for example. This means that the body of a closure doesn&#8217;t belong to the main control
flow. For that reason, the type checker also computes, for each closure shared variable, the <a href="#section-lub">LUB</a> of all
assignments of the variable, and will use that <code>LUB</code> as the inferred type outside of the scope of the closure, like in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Top {
   void methodFromTop() {}
}
class Bottom extends Top {
   void methodFromBottom() {}
}
def o = new Top()                               <i class="conum" data-value="1"></i><b>(1)</b>
Thread.start {
    o = new Bottom()                            <i class="conum" data-value="2"></i><b>(2)</b>
}
o.methodFromTop()                               <i class="conum" data-value="3"></i><b>(3)</b>
o.methodFromBottom()  // compilation error      <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure-shared variable is first assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inside the closure, it is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>methodFromTop</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromBottom</code> is a compilation error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here, it is clear that when <code>methodFromBottom</code> is called, there&#8217;s no guarantee, at compile-time or runtime that the
type of <code>o</code> will <em>effectively</em> be a <code>Bottom</code>. There are chances that it will be, but we can&#8217;t make sure, because it&#8217;s
asynchronous. So the type checker will only allow calls on the <a href="#section-lub">least upper bound</a>, which is here a <code>Top</code>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_closures_and_type_inference"><a class="anchor" href="#_closures_and_type_inference"></a><a class="link" href="#_closures_and_type_inference">Closures and type inference</a></h6>
<div class="paragraph">
<p>The type checker performs special inference on closures, resulting on additional checks on one side and improved fluency
on the other side.</p>
</div>
<div class="sect6">
<h7 id="_return_type_inference"><a class="anchor" href="#_return_type_inference"></a><a class="link" href="#_return_type_inference">Return type inference</a></h7>
<div class="paragraph">
<p>The first thing that the type checker is capable of doing is inferring the <em>return type</em> of a closure. This is simply
 illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
int testClosureReturnTypeInference(String arg) {
    def cl = { "Arg: $arg" }                                <i class="conum" data-value="1"></i><b>(1)</b>
    def val = cl()                                          <i class="conum" data-value="2"></i><b>(2)</b>

    val.length()                                            <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined, and it returns a string (more precisely a <code>GString</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the closure and assign the result to a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the type checker inferred that the closure would return a string, so calling <code>length()</code> is allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, unlike a method which declares its return type explicitly, there&#8217;s no need to declare the return type
of a closure: its type is inferred from the body of the closure.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Closures vs methods</div>
<div class="paragraph">
<p>It&#8217;s worth noting that return type inference is only applicable to closures. While the type checker could do the
same on a method, it is in practice not desirable: <em>in general</em>, methods can be overridden and it is not statically
possible to make sure that the method which is called is not an overridden version. So flow typing would actually
think that a method returns something, while in reality, it could return something else, like illustrated in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TypeChecked
class A {
    def compute() { 'some string' }             <i class="conum" data-value="1"></i><b>(1)</b>
    def computeFully() {
        compute().toUpperCase()                 <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
@TypeChecked
class B extends A {
    def compute() { 123 }                       <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines a method <code>compute</code> which effectively returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this will fail compilation because the return type of <code>compute</code> is <code>def</code>(aka <code>Object</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>B</code> extends <code>A</code> and redefines <code>compute</code>, this type returning an <code>int</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, if the type checker relied on the inferred return type of a method, with <a href="#section-flow-typing">flow typing</a>,
the type checker could determine that it is ok to call <code>toUpperCase</code>. It is in fact an <strong>error</strong>, because a subclass can
override <code>compute</code> and return a different object. Here, <code>B#compute</code> returns an <code>int</code>, so someone calling <code>computeFully</code>
on an instance of <code>B</code> would see a runtime error. The compiler prevents this from happening by using the declared return
type of methods instead of the inferred return type.</p>
</div>
<div class="paragraph">
<p>For consistency, this behavior is the same for <strong>every</strong> method, even if they are static or final.</p>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_parameter_type_inference"><a class="anchor" href="#_parameter_type_inference"></a><a class="link" href="#_parameter_type_inference">Parameter type inference</a></h7>
<div class="paragraph">
<p>In addition to the return type, it is possible for a closure to infer its parameter types from the context. There are
two ways for the compiler to infer the parameter types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>through <em>implicit SAM type coercion</em></p>
</li>
<li>
<p>through API metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, lets start with an example that will fail compilation due to the inability for the type checker
to infer the parameter types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    int age
}

void inviteIf(Person p, Closure&lt;Boolean&gt; predicate) {           <i class="conum" data-value="1"></i><b>(1)</b>
    if (predicate.call(p)) {
        // send invite
        // ...
    }
}

@groovy.transform.TypeChecked
void failCompilation() {
    Person p = new Person(name: 'Gerard', age: 55)
    inviteIf(p) {                                               <i class="conum" data-value="2"></i><b>(2)</b>
        it.age &gt;= 18 // No such property: age                   <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>inviteIf</code> method accepts a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call it with a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>yet <code>it</code> is not statically known as being a <code>Person</code> and compilation fails</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the closure body contains <code>it.age</code>. With dynamic, not type checked code, this would work, because the
type of <code>it</code> would be a <code>Person</code> at runtime. Unfortunately, at compile-time, there&#8217;s no way to know what is the type
of <code>it</code>, just by reading the signature of <code>inviteIf</code>.</p>
</div>
<div class="sect7">
<h8 id="_explicit_closure_parameters"><a class="anchor" href="#_explicit_closure_parameters"></a><a class="link" href="#_explicit_closure_parameters">Explicit closure parameters</a></h8>
<div class="paragraph">
<p>To be short, the type checker doesn&#8217;t have enough contextual information on the <code>inviteIf</code> method to determine statically
the type of <code>it</code>. This means that the method call needs to be rewritten like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">inviteIf(p) { Person it -&gt;                                  <i class="conum" data-value="1"></i><b>(1)</b>
    it.age &gt;= 18
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the type of <code>it</code> needs to be declared explicitly</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By explicitly declaring the type of the <code>it</code> variable, you can work around the problem and make this code statically
checked.</p>
</div>
</div>
<div class="sect7">
<h8 id="_parameters_inferred_from_single_abstract_method_types"><a class="anchor" href="#_parameters_inferred_from_single_abstract_method_types"></a><a class="link" href="#_parameters_inferred_from_single_abstract_method_types">Parameters inferred from single-abstract method types</a></h8>
<div class="paragraph">
<p>For an API or framework designer, there are two ways to make this more elegant for users, so that they don&#8217;t have to
declare an explicit type for the closure parameters. The first one, and easiest, is to replace the closure with a
SAM type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Predicate&lt;On&gt; { boolean apply(On e) }                 <i class="conum" data-value="1"></i><b>(1)</b>

void inviteIf(Person p, Predicate&lt;Person&gt; predicate) {          <i class="conum" data-value="2"></i><b>(2)</b>
    if (predicate.apply(p)) {
        // send invite
        // ...
    }
}

@groovy.transform.TypeChecked
void passesCompilation() {
    Person p = new Person(name: 'Gerard', age: 55)

    inviteIf(p) {                                               <i class="conum" data-value="3"></i><b>(3)</b>
        it.age &gt;= 18                                            <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a <code>SAM</code> interface with an <code>apply</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>inviteIf</code> now uses a <code>Predicate&lt;Person&gt;</code> instead of a <code>Closure&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>there&#8217;s no need to declare the type of the <code>it</code> variable anymore</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>it.age</code> compiles properly, the type of <code>it</code> is inferred from the <code>Predicate#apply</code> method signature</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By using this technique, we leverage the <em>automatic coercion of closures to SAM types</em> feature of Groovy.
Whether you should use a <em>SAM type</em> or a <em>Closure</em> really depends on what you need to do. In a lot of cases,
using a SAM interface is enough, especially if you consider functional interfaces as they are found in Java 8. However,
closures provide features that are not accessible to functional interfaces. In particular, closures can have a delegate,
and owner and can be manipulated as objects (for example, cloned, serialized, curried, &#8230;&#8203;) before being called. They can
also support multiple signatures (polymorphism). So if you need that kind of manipulation, it is preferable to switch to
the most advanced type inference annotations which are described below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The original issue that needs to be solved when it comes to closure parameter type inference, that is to say, statically
determining the types of the arguments of a closure <em>without</em> having to have them explicitly declared, is that the Groovy
type system inherits the Java type system, which is insufficient to describe the types of the arguments.</p>
</div>
</div>
<div class="sect7">
<h8 id="_the_closureparams_annotation"><a class="anchor" href="#_the_closureparams_annotation"></a><a class="link" href="#_the_closureparams_annotation">The <code>@ClosureParams</code> annotation</a></h8>
<div class="paragraph">
<p>Groovy provides an annotation, <code>@ClosureParams</code> which is aimed at completing type information. This annotation is primarily
aimed at framework and API developers who want to extend the capabilities of the type checker by providing type inference
metadata. This is important if your library makes use of closures and that you want the maximum level of tooling support
too.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate this by fixing the original example, introducing the <code>@ClosureParams</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.ClosureParams
import groovy.transform.stc.FirstParam
void inviteIf(Person p, @ClosureParams(FirstParam) Closure&lt;Boolean&gt; predicate) {        <i class="conum" data-value="1"></i><b>(1)</b>
    if (predicate.call(p)) {
        // send invite
        // ...
    }
}
inviteIf(p) {                                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    it.age &gt;= 18
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure parameter is annotated with <code>@ClosureParams</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it&#8217;s not necessary to use an explicit type for <code>it</code>, which is inferred</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@ClosureParams</code> annotation minimally accepts one argument, which is named a <em>type hint</em>. A type hint is a class which
is responsible for completing type information at compile time for the closure. In this example, the type hint being used
is <code>groovy.transform.stc.FirstParam</code> which indicated to the type checker that the closure will accept one parameter
whose type is the type of the first parameter of the method. In this case, the first parameter of the method is <code>Person</code>,
so it indicates to the type checker that the first parameter of the closure is in fact a <code>Person</code>.</p>
</div>
<div class="paragraph">
<p>A second optional argument is named <em>options</em>. Its semantics depend on the <em>type hint</em> class. Groovy comes with
various bundled type hints, illustrated in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Predefined type hints</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type hint</th>
<th class="tableblock halign-left valign-top">Polymorphic?</th>
<th class="tableblock halign-left valign-top">Description and examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FirstParam</code><br>
<code>SecondParam</code><br>
<code>ThirdParam</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The first (resp. second, third) parameter type of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FirstParam
void doSomething(String str, @ClosureParams(FirstParam) Closure c) {
    c(str)
}
doSomething('foo') { println it.toUpperCase() }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.SecondParam
void withHash(String str, int seed, @ClosureParams(SecondParam) Closure c) {
    c(31*str.hashCode()+seed)
}
withHash('foo', (int)System.currentTimeMillis()) {
    int mod = it%2
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.ThirdParam
String format(String prefix, String postfix, String o, @ClosureParams(ThirdParam) Closure c) {
    "$prefix${c(o)}$postfix"
}
assert format('foo', 'bar', 'baz') {
    it.toUpperCase()
} == 'fooBAZbar'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FirstParam.FirstGenericType</code><br>
<code>SecondParam.FirstGenericType</code><br>
<code>ThirdParam.FirstGenericType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The first generic type of the first (resp. second, third) parameter of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FirstParam
public &lt;T&gt; void doSomething(List&lt;T&gt; strings, @ClosureParams(FirstParam.FirstGenericType) Closure c) {
    strings.each {
        c(it)
    }
}
doSomething(['foo','bar']) { println it.toUpperCase() }
doSomething([1,2,3]) { println(2*it) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variants for <code>SecondGenericType</code> and <code>ThirdGenericType</code> exist for all <code>FirstParam</code>, <code>SecondParam</code> and <code>ThirdParam</code>
type hints.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SimpleType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A type hint for which the type of closure parameters comes from the options string.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.SimpleType
public void doSomething(@ClosureParams(value=SimpleType,options=['java.lang.String','int']) Closure c) {
    c('foo',3)
}
doSomething { str, len -&gt;
    assert str.length() == len
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint supports a <strong>single</strong> signature and each of the parameter is specified as a value of the <em>options</em> array
using a fully-qualified type name or a primitive type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MapEntryOrKeyValue</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A dedicated type hint for closures that either work on a <code>Map.Entry</code> single parameter, or two parameters corresponding
to the key and the value.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.MapEntryOrKeyValue
public &lt;K,V&gt; void doSomething(Map&lt;K,V&gt; map, @ClosureParams(MapEntryOrKeyValue) Closure c) {
    // ...
}
doSomething([a: 'A']) { k,v -&gt;
    assert k.toUpperCase() == v.toUpperCase()
}
doSomething([abc: 3]) { e -&gt;
    assert e.key.length() == e.value
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint <strong>requires</strong> that the first argument is a <code>Map</code> type, and infers the closure parameter types from the map
actual key/value types.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FromAbstractTypeMethods</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Infers closure parameter types from the abstract method of some type. A signature is inferred for <strong>each</strong> abstract method.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FromAbstractTypeMethods
abstract class Foo {
    abstract void firstSignature(int x, int y)
    abstract void secondSignature(String str)
}
void doSomething(@ClosureParams(value=FromAbstractTypeMethods, options=["Foo"]) Closure cl) {
    // ...
}
doSomething { a, b -&gt; a+b }
doSomething { s -&gt; s.toUpperCase() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are multiple signatures like in the example above, the type checker will <strong>only</strong> be able to infer the types of
the arguments if the arity of each method is different. In the example above, <code>firstSignature</code> takes 2 arguments and
<code>secondSignature</code> takes 1 argument, so the type checker can infer the argument types based on the number of arguments.
But see the optional resolver class attribute discussed next.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FromString</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Infers the closure parameter types from the <code>options</code> argument. The <code>options</code> argument consists of an array of comma-separated
non-primitive types. Each element of the array corresponds to a single signature, and each comma in an element separate
parameters of the signature. In short, this is the most generic type hint, and each string of the <code>options</code> map is <strong>parsed</strong>
as if it was a signature literal. While being very powerful, this type hint must be avoided if you can because it increases
the compilation times due to the necessity of parsing the type signatures.</p>
</div>
<div class="paragraph">
<p>A single signature for a closure accepting a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FromString
void doSomething(@ClosureParams(value=FromString, options=["String","String,Integer"]) Closure cl) {
    // ...
}
doSomething { s -&gt; s.toUpperCase() }
doSomething { s,i -&gt; s.toUpperCase()*i }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>String</code> or a <code>String, Integer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FromString
void doSomething(@ClosureParams(value=FromString, options=["String","String,Integer"]) Closure cl) {
    // ...
}
doSomething { s -&gt; s.toUpperCase() }
doSomething { s,i -&gt; s.toUpperCase()*i }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>T</code> or a pair <code>T,T</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.stc.FromString
public &lt;T&gt; void doSomething(T e, @ClosureParams(value=FromString, options=["T","T,T"]) Closure cl) {
    // ...
}
doSomething('foo') { s -&gt; s.toUpperCase() }
doSomething('foo') { s1,s2 -&gt; assert s1.toUpperCase() == s2.toUpperCase() }</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Even though you use <code>FirstParam</code>, <code>SecondParam</code> or <code>ThirdParam</code> as a type hint, it doesn&#8217;t strictly mean that the
argument which will be passed to the closure <strong>will</strong> be the first (resp. second, third) argument of the method call. It
only means that the <strong>type</strong> of the parameter of the closure will be the <strong>same</strong> as the type of the first (resp.  second,
 third) argument of the method call.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In short, the lack of the <code>@ClosureParams</code> annotation on a method accepting a <code>Closure</code> will <strong>not</strong> fail compilation. If
 present (and it can be present in Java sources as well as Groovy sources), then the type checker has <strong>more</strong> information
 and can perform additional type inference. This makes this feature particularly interesting for framework developers.</p>
</div>
<div class="paragraph">
<p>A third optional argument is named <em>conflictResolutionStrategy</em>. It can reference a class (extending from
<code>ClosureSignatureConflictResolver</code>) that can perform additional resolution of parameter types if more than
one are found after initial inference calculations are complete. Groovy comes with a default type resolver
which does nothing, and another which selects the first signature if multiple are found. The resolver is
only invoked if more than one signature is found and is by design a post processor. Any statements which need
injected typing information must pass one of the parameter signatures determined through type hints. The
resolver then picks among the returned candidate signatures.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_delegatesto"><a class="anchor" href="#_delegatesto"></a><a class="link" href="#_delegatesto"><code>@DelegatesTo</code></a></h7>
<div class="paragraph">
<p>The <code>@DelegatesTo</code> annotation is used by the type checker to infer the type of the delegate. It allows the API designer
to instruct the compiler what is the type of the delegate and the delegation strategy. The <code>@DelegatesTo</code> annotation is
discussed in a <a href="core-domain-specific-languages.html#section-delegatesto">specific section</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_compilation"><a class="anchor" href="#_static_compilation"></a><a class="link" href="#_static_compilation">Static compilation</a></h5>
<div class="sect5">
<h6 id="_dynamic_vs_static"><a class="anchor" href="#_dynamic_vs_static"></a><a class="link" href="#_dynamic_vs_static">Dynamic vs static</a></h6>
<div class="paragraph">
<p>In the <a href="#static-type-checking">type checking section</a>, we have seen that Groovy provides optional type checking thanks to the
<code>@TypeChecked</code> annotation. The type checker runs at compile time and performs a static analysis of dynamic code. The
program will behave exactly the same whether type checking has been enabled or not. This means that the <code>@TypeChecked</code>
annotation is neutral in regard to the semantics of a program. Even though it may be necessary to add type information
in the sources so that the program is considered type safe, in the end, the semantics of the program are the same.</p>
</div>
<div class="paragraph">
<p>While this may sound fine, there is actually one issue with this: type checking of dynamic code, done at compile time, is
by definition only correct if no runtime specific behavior occurs. For example, the following program passes type checking:</p>
</div>
<div id="typechecked-defeated" class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Computer {
    int compute(String str) {
        str.length()
    }
    String compute(int x) {
        String.valueOf(x)
    }
}

@groovy.transform.TypeChecked
void test() {
    def computer = new Computer()
    computer.with {
        assert compute(compute('foobar')) =='6'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two <code>compute</code> methods. One accepts a <code>String</code> and returns an <code>int</code>, the other accepts an <code>int</code> and returns
a <code>String</code>. If you compile this, it is considered type safe: the inner <code>compute('foobar')</code> call will return an <code>int</code>,
and calling <code>compute</code> on this <code>int</code> will in turn return a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>Now, before calling <code>test()</code>, consider adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Computer.metaClass.compute = { String str -&gt; new Date() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using runtime metaprogramming, we&#8217;re actually modifying the behavior of the <code>compute(String)</code> method, so that instead of
returning the length of the provided argument, it will return a <code>Date</code>. If you execute the program, it will fail at
runtime. Since this line can be added from anywhere, in any thread, there&#8217;s absolutely no way for the type checker to
statically make sure that no such thing happens. In short, the type checker is vulnerable to monkey patching. This is
just one example, but this illustrates the concept that doing static analysis of a dynamic program is inherently wrong.</p>
</div>
<div class="paragraph">
<p>The Groovy language provides an alternative annotation to <code>@TypeChecked</code> which will actually make sure that the methods
which are inferred as being called <strong>will</strong> effectively be called at runtime. This annotation turns the Groovy compiler
into a <strong>static compiler</strong>, where all method calls are resolved at compile time <strong>and</strong> the generated bytecode makes sure
that this happens: the annotation is <code>@groovy.transform.CompileStatic</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="compilestatic-annotation"><a class="anchor" href="#compilestatic-annotation"></a><a class="link" href="#compilestatic-annotation">The <code>@CompileStatic</code> annotation</a></h6>
<div class="paragraph">
<p>The <code>@CompileStatic</code> annotation can be added anywhere the <code>@TypeChecked</code> annotation can be used, that is to say on
a class or a method. It is not necessary to add both <code>@TypeChecked</code> and <code>@CompileStatic</code>, as <code>@CompileStatic</code> performs
everything <code>@TypeChecked</code> does, but in addition triggers static compilation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take the <a href="#typechecked-defeated">example which failed</a>, but this time let&#8217;s replace the <code>@TypeChecked</code> annotation
with <code>@CompileStatic</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Computer {
    int compute(String str) {
        str.length()
    }
    String compute(int x) {
        String.valueOf(x)
    }
}

@groovy.transform.CompileStatic
void test() {
    def computer = new Computer()
    computer.with {
        assert compute(compute('foobar')) =='6'
    }
}
Computer.metaClass.compute = { String str -&gt; new Date() }
test()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> difference. If we execute this program, this time, there is no runtime error. The <code>test</code> method
became immune to monkey patching, because the <code>compute</code> methods which are called in its body are linked at compile
time, so even if the metaclass of <code>Computer</code> changes, the program still behaves <strong>as expected by the type checker</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_key_benefits"><a class="anchor" href="#_key_benefits"></a><a class="link" href="#_key_benefits">Key benefits</a></h6>
<div class="paragraph">
<p>There are several benefits of using <code>@CompileStatic</code> on your code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type safety</p>
</li>
<li>
<p>immunity to <a href="#compilestatic-annotation">monkey patching</a></p>
</li>
<li>
<p>performance improvements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The performance improvements depend on the kind of program you are executing. If it is I/O bound, the difference between
statically compiled code and dynamic code is barely noticeable. On highly CPU intensive code, since the bytecode which
is generated is very close, if not equal, to the one that Java would produce for an equivalent program, the performance
is greatly improved.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <em>invokedynamic</em> version of Groovy, which is accessible to people using JDK 7 and above, the performance
of the dynamic code should be very close to the performance of statically compiled code. Sometimes, it can even be faster!
There is only one way to determine which version you should choose: measuring. The reason is that depending on your program
<strong>and</strong> the JVM that you use, the performance can be significantly different. In particular, the <em>invokedynamic</em> version of
Groovy is very sensitive to the JVM version in use.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_checking_extensions"><a class="anchor" href="#_type_checking_extensions"></a><a class="link" href="#_type_checking_extensions">1.6.7. Type checking extensions</a></h4>
<div class="sect4">
<h5 id="_writing_a_type_checking_extension"><a class="anchor" href="#_writing_a_type_checking_extension"></a><a class="link" href="#_writing_a_type_checking_extension">Writing a type checking extension</a></h5>
<div class="sect5">
<h6 id="_towards_a_smarter_type_checker"><a class="anchor" href="#_towards_a_smarter_type_checker"></a><a class="link" href="#_towards_a_smarter_type_checker">Towards a smarter type checker</a></h6>
<div class="paragraph">
<p>Despite being a dynamic language, Groovy can be used with a <a href="#static-type-checking">static type checker</a>
at compile time, enabled using the <code>@TypeChecked</code> annotation. In this mode, the
compiler becomes more verbose and throws errors for, example, typos, non-existent
methods, etc. This comes with a few limitations though, most of them coming from
the fact that Groovy remains inherently a dynamic language. For example, you
wouldn’t be able to use type checking on code that uses the markup builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def builder = new MarkupBuilder(out)
builder.html {
    head {
        // ...
    }
    body {
        p 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, none of the <code>html</code>, <code>head</code>, <code>body</code> or <code>p</code> methods
exist. However if you execute the code, it works because Groovy uses dynamic dispatch
and converts those method calls at runtime. In this builder, there’s no limitation about
the number of tags that you can use, nor the attributes, which means there is no chance
for a type checker to know about all the possible methods (tags) at compile time, unless
you create a builder dedicated to HTML for example.</p>
</div>
<div class="paragraph">
<p>Groovy is a platform of choice when it comes to implement internal DSLs. The flexible syntax,
combined with runtime and compile-time metaprogramming capabilities make Groovy an interesting
choice because it allows the programmer to focus on the DSL rather than
on tooling or implementation. Since Groovy DSLs are Groovy code, it’s
easy to have IDE support without having to write a dedicated plugin for
example.</p>
</div>
<div class="paragraph">
<p>In a lot of cases, DSL engines are written in Groovy (or Java) then user
code is executed as scripts, meaning that you have some kind of wrapper
on top of user logic. The wrapper may consist, for example, in a
<code>GroovyShell</code> or <code>GroovyScriptEngine</code> that performs some tasks transparently
before running the script (adding imports, applying AST transforms,
extending a base script,…). Often, user written scripts come to
production without testing because the DSL logic comes to a point
where <strong>any</strong> user may write code using the DSL syntax. In the end, a user
may just ignore that what they write is actually <strong>code</strong>. This adds some
challenges for the DSL implementer, such as securing execution of user
code or, in this case, early reporting of errors.</p>
</div>
<div class="paragraph">
<p>For example, imagine a DSL which goal is to drive a rover on Mars
remotely. Sending a message to the rover takes around 15 minutes. If the
rover executes the script and fails with an error (say a typo), you have
two problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, feedback comes only after 30 minutes (the time needed for the
rover to get the script and the time needed to receive the error)</p>
</li>
<li>
<p>second, some portion of the script has been executed and you may have
to change the fixed script significantly (implying that you need to know
the current state of the rover…)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type checking extensions is a mechanism that will
allow the developer of a DSL engine to make those scripts safer by
applying the same kind of checks that static type checking allows on
regular groovy classes.</p>
</div>
<div class="paragraph">
<p>The principle, here, is to fail early, that is
to say fail compilation of scripts as soon as possible, and if possible
provide feedback to the user (including nice error messages).</p>
</div>
<div class="paragraph">
<p>In short, the idea behind type checking extensions is to make the compiler
aware of all the runtime metaprogramming tricks that the DSL uses, so that
scripts can benefit the same level of compile-time checks as a verbose statically
compiled code would have. We will see that you can go even further by performing
checks that a normal type checker wouldn&#8217;t do, delivering powerful compile-time
checks for your users.</p>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-Howdoesitwork"><a class="anchor" href="#Typecheckingextensions-Howdoesitwork"></a><a class="link" href="#Typecheckingextensions-Howdoesitwork">The extensions attribute</a></h6>
<div class="paragraph">
<p>The <code>@TypeChecked</code> annotation supports an attribute
named <code>extensions</code>. This parameter takes an array of strings
corresponding to a list of <em>type checking extensions scripts</em>. Those
scripts are found at <strong>compile time</strong> on classpath. For example, you would
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TypeChecked(extensions='/path/to/myextension.groovy')
void foo() { ...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the <em>foo</em> methods would be type checked with the rules of
the normal type checker completed by those found in
the <em>myextension.groovy</em> script. Note that while internally the type
checker supports multiple mechanisms to implement type checking
extensions (including plain old java code), the recommended way is to
use those type checking extension scripts.</p>
</div>
</div>
<div class="sect5">
<h6 id="_a_dsl_for_type_checking"><a class="anchor" href="#_a_dsl_for_type_checking"></a><a class="link" href="#_a_dsl_for_type_checking">A DSL for type checking</a></h6>
<div class="paragraph">
<p>The idea behind type checking extensions is to use a DSL to extend the
type checker capabilities. This DSL allows you to hook into the
compilation process, more specifically the type checking phase, using an
"event-driven" API. For example, when the type checker enters a method
body, it throws a <em>beforeVisitMethod</em> event that the extension can react to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">beforeVisitMethod { methodNode -&gt;
 println "Entering ${methodNode.name}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Imagine that you have this rover DSL at hand. A user would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">robot.move 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a class defined as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Robot {
    Robot move(int qt) { this }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script can be type checked before being executed using the following
script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
    new ASTTransformationCustomizer(TypeChecked)            <i class="conum" data-value="1"></i><b>(1)</b>
)
def shell = new GroovyShell(config)                         <i class="conum" data-value="2"></i><b>(2)</b>
def robot = new Robot()
shell.setVariable('robot', robot)
shell.evaluate(script)                                      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a compiler configuration adds the <code>@TypeChecked</code> annotation to all classes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use the configuration in a <code>GroovyShell</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so that scripts compiled using the shell are compiled with <code>@TypeChecked</code> without the user having to add it explicitly</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the compiler configuration above, we can apply <em>@TypeChecked</em>
transparently to the script. In that case, it will fail at compile
time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - The variable [robot] is undeclared.</pre>
</div>
</div>
<div class="paragraph">
<p>Now, we will slightly update the configuration to include the
``extensions'' parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.addCompilationCustomizers(
    new ASTTransformationCustomizer(
        TypeChecked,
        extensions:['robotextension.groovy'])
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add the following to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">robotextension.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">unresolvedVariable { var -&gt;
    if ('robot'==var.name) {
        storeType(var, classNodeFor(Robot))
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we’re telling the compiler that if an <em>unresolved variable</em> is found
and that the name of the variable is <em>robot</em>, then we can make sure that the type of this
variable is <code>Robot</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-TheAPI"><a class="anchor" href="#Typecheckingextensions-TheAPI"></a><a class="link" href="#Typecheckingextensions-TheAPI">Type checking extensions API</a></h6>
<div class="sect6">
<h7 id="Typecheckingextensions-AST"><a class="anchor" href="#Typecheckingextensions-AST"></a><a class="link" href="#Typecheckingextensions-AST">AST</a></h7>
<div class="paragraph">
<p>The type checking API is a low level API, dealing with the Abstract
Syntax Tree. You will have to know your AST well to develop extensions,
even if the DSL makes it much easier than just dealing with AST code
from plain Java or Groovy.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Events"><a class="anchor" href="#Typecheckingextensions-Events"></a><a class="link" href="#Typecheckingextensions-Events">Events</a></h7>
<div class="paragraph">
<p>The type checker sends the following events, to which an extension
script can react:</p>
</div>
<table id="event-setup" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>setup</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called after the type checker finished initialization</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">setup {
    // this is called before anything else
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be used to perform setup of your extension</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-finish" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>finish</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called after the type checker completed type checking</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">finish {
    // this is after completion
    // of all type checking
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be used to perform additional checks after the type checker has finished its job.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedVariable" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>unresolvedVariable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker finds an
  unresolved variable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>VariableExpression vexp</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">unresolvedVariable { VariableExpression vexp -&gt;
    if (vexp.name == 'people') {
        storeType(vexp, LIST_TYPE)
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to help the type checker with user-injected variables.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedProperty" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>unresolvedProperty</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker cannot find
  a property on the receiver</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>PropertyExpression pexp</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">unresolvedProperty { PropertyExpression pexp -&gt;
    if (pexp.propertyAsString == 'longueur' &amp;&amp;
            getType(pexp.objectExpression) == STRING_TYPE) {
        storeType(pexp, int_TYPE)
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to handle "dynamic" properties</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedAttribute" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>unresolvedAttribute</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker cannot
  find an attribute on the receiver</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>AttributeExpression aexp</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">unresolvedAttribute { AttributeExpression aexp -&gt;
    if (getType(aexp.objectExpression) == STRING_TYPE) {
        storeType(aexp, STRING_TYPE)
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to handle missing attributes</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeMethodCall" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>beforeMethodCall</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called before the type checker starts type
  checking a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">beforeMethodCall { call -&gt;
    if (isMethodCallExpression(call)
            &amp;&amp; call.methodAsString=='toUpperCase') {
        addStaticTypeError('Not allowed',call)
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows you to intercept method calls before the
type checker performs its own checks. This is useful if you want to
replace the default type checking with a custom one for a limited scope.
In that case, you must set the handled flag to true, so that the type
checker skips its own checks.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterMethodCall" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>afterMethodCall</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called once the type checker has finished
  type checking a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">afterMethodCall { call -&gt;
    if (getTargetMethod(call).name=='toUpperCase') {
        addStaticTypeError('Not allowed',call)
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allow you to perform additional checks after the type
checker has done its own checks. This is in particular useful if you
want to perform the standard type checking tests but also want to ensure
additional type safety, for example checking the arguments against each
other.Note that <code>afterMethodCall</code> is called even if you did
<code>beforeMethodCall</code> and set the handled flag to true.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-onMethodSelection" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>onMethodSelection</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker when it finds
  a method appropriate for a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Expression expr, MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">onMethodSelection { expr, node -&gt;
    if (node.declaringClass.name == 'java.lang.String') {
        // calling a method on 'String'
        // let’s perform additional checks!
        if (++count&gt;2) {
            addStaticTypeError("You can use only 2 calls on String in your source code",expr)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker works by inferring
argument types of a method call, then chooses a target method. If it
finds one that corresponds, then it triggers this event. It is for
example interesting if you want to react on a specific method call, such
as entering the scope of a method that takes a closure as argument (as
in builders).Please note that this event may be thrown for various types
of expressions, not only method calls (binary expressions for example).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-methodNotFound" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>methodNotFound</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker when it fails to
  find an appropriate method for a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ClassNode receiver, String name, ArgumentListExpression argList, ClassNode[] argTypes,MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">methodNotFound { receiver, name, argList, argTypes, call -&gt;
    // receiver is the inferred type of the receiver
    // name is the name of the called method
    // argList is the list of arguments the method was called with
    // argTypes is the array of inferred types for each argument
    // call is the method call for which we couldn’t find a target method
    if (receiver==classNodeFor(String)
            &amp;&amp; name=='longueur'
            &amp;&amp; argList.size()==0) {
        handled = true
        return newMethod('longueur', classNodeFor(String))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <code>onMethodSelection</code>, this event is
sent when the type checker cannot find a target method for a method call
(instance or static). It gives you the chance to intercept the error
before it is sent to the user, but also set the target method.For this,
you need to return a list of <code>MethodNode</code>. In most situations, you would
either return: an empty list, meaning that you didn’t find a
corresponding method, a list with exactly one element, saying that there’s
no doubt about the target methodIf you return more than one MethodNode,
then the compiler would throw an error to the user stating that the
method call is ambiguous, listing the possible methods.For convenience,
if you want to return only one method, you are allowed to return it
directly instead of wrapping it into a list.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeVisitMethod" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>beforeVisitMethod</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker before type
  checking a method body</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">beforeVisitMethod { methodNode -&gt;
    // tell the type checker we will handle the body by ourselves
    handled = methodNode.name.startsWith('skip')
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker will call this method before
starting to type check a method body. If you want, for example, to
perform type checking by yourself instead of letting the type checker do
it, you have to set the handled flag to true. This event can also be used
to help define the scope of your extension (for example, applying it
only if you are inside method foo).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterVisitMethod" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>afterVisitMethod</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker after type
  checking a method body</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">afterVisitMethod { methodNode -&gt;
    scopeExit {
        if (methods&gt;2) {
            addStaticTypeError("Method ${methodNode.name} contains more than 2 method calls", methodNode)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives you the opportunity to perform additional
checks after a method body is visited by the type checker. This is
useful if you collect information, for example, and want to perform
additional checks once everything has been collected.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeVisitClass" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>beforeVisitClass</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker before type checking a class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ClassNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">beforeVisitClass { ClassNode classNode -&gt;
    def name = classNode.nameWithoutPackage
    if (!(name[0] in 'A'..'Z')) {
        addStaticTypeError("Class '${name}' doesn't start with an uppercase letter",classNode)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a class is type checked, then
before visiting the class, this event will be sent. It is also the case
for inner classes defined inside a class annotated with <code>@TypeChecked</code>. It
can help you define the scope of your extension, or you can even totally
replace the visit of the type checker with a custom type checking
implementation. For that, you would have to set the <code>handled</code> flag to
<code>true</code>. </p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterVisitClass" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>afterVisitClass</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called by the type checker after having finished the visit of a type checked class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ClassNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">afterVisitClass { ClassNode classNode -&gt;
    def name = classNode.nameWithoutPackage
    if (!(name[0] in 'A'..'Z')) {
        addStaticTypeError("Class '${name}' doesn't start with an uppercase letter",classNode)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Called
for every class being type checked after the type checker finished its
work. This includes classes annotated with <code>@TypeChecked</code> and any
inner/anonymous class defined in the same class with is not skipped.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-incompatibleAssignment" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>incompatibleAssignment</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker thinks
    that an assignment is incorrect, meaning that the right-hand side of an
    assignment is incompatible with the left-hand side</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ClassNode lhsType, ClassNode rhsType, Expression assignment</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">incompatibleAssignment { lhsType, rhsType, expr -&gt;
    if (isBinaryExpression(expr) &amp;&amp; isAssignment(expr.operation.type)) {
        if (lhsType==classNodeFor(int) &amp;&amp; rhsType==classNodeFor(Closure)) {
            handled = true
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the
developer the ability to handle incorrect assignments. This is for
example useful if a class overrides <code>setProperty</code>, because in that case it
is possible that assigning a variable of one type to a property of
another type is handled through that runtime mechanism. In that case, you
can help the type checker just by telling it that the assignment is
valid (using <code>handled</code> set to <code>true</code>).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-incompatibleReturnType" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>incompatibleReturnType</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker thinks that a return value is incompatibe with
    the return type of the enclosing closure or method</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ReturnStatement statement, ClassNode valueType</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">incompatibleReturnType { stmt, type -&gt;
    if (type == STRING_TYPE) {
        handled = true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the developer the ability to handle incorrect return values. This is for
example useful when the return value will undergo implicit conversion or the
enclosing closure&#8217;s target type is difficult to infer properly. In that case,
you can help the type checker just by telling it that the assignment is valid
(by setting the <code>handled</code> property).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-ambiguousMethods" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ambiguousMethods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Called when the type checker cannot choose between several candidate methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;MethodNode&gt; methods,  Expression origin</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">ambiguousMethods { methods, origin -&gt;
    // choose the method which has an Integer as parameter type
    methods.find { it.parameters.any { it.type == classNodeFor(Integer) } }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the
developer the ability to handle incorrect assignments. This is for
example useful if a class overrides <code>setProperty</code>, because in that case it
is possible that assigning a variable of one type to a property of
another type is handled through that runtime mechanism. In that case, you
can help the type checker just by telling it that the assignment is
valid (using <code>handled</code> set to <code>true</code>).</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of course, an extension script may consist of several blocks, and you
can have multiple blocks responding to the same event. This makes the
DSL look nicer and easier to write. However, reacting to events is far
from sufficient. If you know you can react to events, you also need to
deal with the errors, which implies several <em>helper</em> methods that will
make things easier.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-Workingwithextensions"><a class="anchor" href="#Typecheckingextensions-Workingwithextensions"></a><a class="link" href="#Typecheckingextensions-Workingwithextensions">Working with extensions</a></h6>
<div class="sect6">
<h7 id="Typecheckingextensions-Supportclasses"><a class="anchor" href="#Typecheckingextensions-Supportclasses"></a><a class="link" href="#Typecheckingextensions-Supportclasses">Support classes</a></h7>
<div class="paragraph">
<p>The DSL relies on a support class called <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> .
This class itself extends <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingExtension.html">org.codehaus.groovy.transform.stc.TypeCheckingExtension</a> .
Those two classes define a number of <em>helper</em> methods that will make working
with the AST easier, especially regarding type checking. One interesting
thing to know is that you <strong>have access to the type checker</strong>. This means
that you can programmatically call methods of the type checker,
including those that allow you to <strong>throw compilation errors</strong>.</p>
</div>
<div class="paragraph">
<p>The extension script delegates to the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> class,
meaning that you have direct access to the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>context</em>: the type checker context, of type <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingContext.html">org.codehaus.groovy.transform.stc.TypeCheckingContext</a></p>
</li>
<li>
<p><em>typeCheckingVisitor</em>: the type checker itself, a <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.html">org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor</a> instance</p>
</li>
<li>
<p><em>generatedMethods</em>: a list of "generated methods", which is in fact the list of "dummy" methods that you can create
inside a type checking extension using the <code>newMethod</code> calls</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type checking context contains a lot of information that is useful
in context for the type checker. For example, the current stack of
enclosing method calls, binary expressions, closures, … This information
is in particular important if you have to know <em>where</em> you are when an
error occurs and that you want to handle it.</p>
</div>
<div class="paragraph">
<p>In addition to facilities provided by <code>GroovyTypeCheckingExtensionSupport</code> and <code>StaticTypeCheckingVisitor</code>,
a type-checking DSL script imports static members from <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/ast/ClassHelper.html">org.codehaus.groovy.ast.ClassHelper</a> and
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/StaticTypeCheckingSupport.html">org.codehaus.groovy.transform.stc.StaticTypeCheckingSupport</a> granting access to common types via
<code>OBJECT_TYPE</code>, <code>STRING_TYPE</code>, <code>THROWABLE_TYPE</code>, etc. and checks like <code>missesGenericsTypes(ClassNode)</code>,
<code>isClassClassNodeWrappingConcreteType(ClassNode)</code> and so on.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Classnodes"><a class="anchor" href="#Typecheckingextensions-Classnodes"></a><a class="link" href="#Typecheckingextensions-Classnodes">Class nodes</a></h7>
<div class="paragraph">
<p>Handling class nodes is something that needs particular attention when
you work with a type checking extension. Compilation works with an
abstract syntax tree (AST) and the tree may not be complete when you are
type checking a class. This also means that when you refer to types, you
must not use class literals such as <code>String</code> or <code>HashSet</code>, but to class
nodes representing those types. This requires a certain level of
abstraction and understanding how Groovy deals with class nodes. To make
things easier, Groovy supplies several helper methods to deal with class
nodes. For example, if you want to say "the type for String", you can
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert classNodeFor(String) instanceof ClassNode</code></pre>
</div>
</div>
<div class="paragraph">
<p>You would also note that there is a variant of <em>classNodeFor</em> that takes
a <code>String</code> as an argument, instead of a <code>Class</code>. In general, you
should <strong>not</strong> use that one, because it would create a class node for
which the name is <code>String</code>, but without any method, any property, …
defined on it. The first version returns a class node that is <em>resolved</em>
but the second one returns one that is <em>not</em>. So the latter should be
reserved for very special cases.</p>
</div>
<div class="paragraph">
<p>The second problem that you might encounter is referencing a type which
is not yet compiled. This may happen more often than you think. For
example, when you compile a set of files together. In that case, if you
want to say "that variable is of type Foo" but <code>Foo</code> is not yet
compiled, you can still refer to the <code>Foo</code> class node
using <code>lookupClassNodeFor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert lookupClassNodeFor('Foo') instanceof ClassNode</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Helpingthetypechecker"><a class="anchor" href="#Typecheckingextensions-Helpingthetypechecker"></a><a class="link" href="#Typecheckingextensions-Helpingthetypechecker">Helping the type checker</a></h7>
<div class="paragraph">
<p>Say that you know that variable <code>foo</code> is of type <code>Foo</code> and you want to
tell the type checker about it. Then you can use the <code>storeType</code> method,
which takes two arguments: the first one is the node for which you want
to store the type and the second one is the type of the node. If you
look at the implementation of <code>storeType</code>, you would see that it
delegates to the type checker equivalent method, which itself does a lot
of work to store node metadata. You would also see that storing the type
is not limited to variables: you can set the type of any expression.</p>
</div>
<div class="paragraph">
<p>Likewise, getting the type of an AST node is just a matter of
calling <code>getType</code> on that node. This would in general be what you want,
but there’s something that you must understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getType</code> returns the <strong>inferred type</strong> of an expression. This means
that it will not return, for a variable declared of type <code>Object</code> the
class node for <code>Object</code>, but the inferred type of this variable <strong>at this
point of the code</strong> (flow typing)</p>
</li>
<li>
<p>if you want to access the origin type of a variable (or
field/parameter), then you must call the appropriate method on the AST
node</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Throwinganerror"><a class="anchor" href="#Typecheckingextensions-Throwinganerror"></a><a class="link" href="#Typecheckingextensions-Throwinganerror">Throwing an error</a></h7>
<div class="paragraph">
<p>To throw a type checking error, you only have to call the
<code>addStaticTypeError</code> method which takes two arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>message</em> which is a string that will be displayed to the end user</p>
</li>
<li>
<p>an <em>AST node</em> responsible for the error. It’s better to provide the best
suiting AST node because it will be used to retrieve the line and column
numbers</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-isXXXExpression"><a class="anchor" href="#Typecheckingextensions-isXXXExpression"></a><a class="link" href="#Typecheckingextensions-isXXXExpression">isXXXExpression</a></h7>
<div class="paragraph">
<p>It is often required to know the type of an AST node. For readability,
the DSL provides a special isXXXExpression method that will delegate to
<code>x instance of XXXExpression</code>. For example, instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (node instanceof BinaryExpression) {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can just write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (isBinaryExpression(node)) {
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Virtualmethods"><a class="anchor" href="#Typecheckingextensions-Virtualmethods"></a><a class="link" href="#Typecheckingextensions-Virtualmethods">Virtual methods</a></h7>
<div class="paragraph">
<p>When you perform type checking of dynamic code, you may often face the
case when you know that a method call is valid but there is no "real"
method behind it. As an example, take the Grails dynamic finders. You
can have a method call consisting of a method named <em>findByName(…)</em>. As
there’s no <em>findByName</em> method defined in the bean, the type checker
would complain. Yet, you would know that this method wouldn’t fail at
runtime, and you can even tell what is the return type of this method.
For this case, the DSL supports two special constructs that consist of
<em>phantom methods</em>. This means that you will return a method node that
doesn’t really exist but is defined in the context of type checking.
Three methods exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>newMethod(String name, Class returnType)</code></p>
</li>
<li>
<p><code>newMethod(String name, ClassNode returnType)</code></p>
</li>
<li>
<p><code>newMethod(String name, Callable&lt;ClassNode&gt; return Type)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three variants do the same: they create a new method node which name
is the supplied name and define the return type of this method.
Moreover, the type checker would add those methods in
the <code>generatedMethods</code> list (see <code>isGenerated</code> below). The reason why we
only set a name and a return type is that it is only what you need in
90% of the cases. For example, in the <code>findByName</code> example upper, the
only thing you need to know is that <code>findByName</code> wouldn’t fail at
runtime, and that it returns a domain class. The <code>Callable</code> version of
return type is interesting because it defers the computation of the
return type when the type checker actually needs it. This is interesting
because in some circumstances, you may not know the actual return type
when the type checker demands it, so you can use a closure that will be
called each time <code>getReturnType</code> is called by the type checker on this
method node. If you combine this with deferred checks, you can achieve
pretty complex type checking including handling of forward references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">newMethod(name) {
    // each time getReturnType on this method node will be called, this closure will be called!
    println 'Type checker called me!'
    lookupClassNodeFor(Foo) // return type
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need more than the name and return type, you can always
create a new <code>MethodNode</code> by yourself.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Scoping"><a class="anchor" href="#Typecheckingextensions-Scoping"></a><a class="link" href="#Typecheckingextensions-Scoping">Scoping</a></h7>
<div class="paragraph">
<p>Scoping is very important in DSL type checking and is one of the reasons
why we couldn’t use a <em>pointcut</em> based approach to DSL type checking.
Basically, you must be able to define very precisely when your extension
applies and when it does not. Moreover, you must be able to handle
situations that a regular type checker would not be able to handle, such
as forward references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">point a(1,1)
line a,b // b is referenced afterwards!
point b(5,2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Say for example that you want to handle a builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">builder.foo {
   bar
   baz(bar)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your extension, then, should only be active once you’ve entered
the <code>foo</code> method, and inactive outside this scope. But you could have
complex situations like multiple builders in the same file or embedded
builders (builders in builders). While you should not try to fix all
this from start (you must accept limitations to type checking), the type
checker does offer a nice mechanism to handle this: a scoping stack,
using the <code>newScope</code> and <code>scopeExit</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>newScope</code> creates a new scope and puts it on top of the stack</p>
</li>
<li>
<p><code>scopeExits</code> pops a scope from the stack</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A scope consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a parent scope</p>
</li>
<li>
<p>a map of custom data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to look at the implementation, it’s simply a <code>LinkedHashMap</code>
(<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport/TypeCheckingScope.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport.TypeCheckingScope</a>),
but it’s quite powerful. For example, you can use such a scope to store
a list of closures to be executed when you exit the scope. This is how
you would handle forward references: </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def scope = newScope()
scope.secondPassChecks = []
//...
scope.secondPassChecks &lt;&lt; { println 'executed later' }
// ...
scopeExit {
    secondPassChecks*.run() // execute deferred checks
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is to say, that if at some point you are not able to determine the
type of an expression, or that you are not able to check at this point
that an assignment is valid or not, you can still make the check later…
This is a very powerful feature. Now, <code>newScope</code> and <code>scopeExit</code>
provide some interesting syntactic sugar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">newScope {
    secondPassChecks = []
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At anytime in the DSL, you can access the current scope
using <code>getCurrentScope()</code> or more simply <code>currentScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//...
currentScope.secondPassChecks &lt;&lt; { println 'executed later' }
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general schema would then be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>determine a <em>pointcut</em> where you push a new scope on stack and
initialize custom variables within this scope</p>
</li>
<li>
<p>using the various events, you can use the information stored in your
custom scope to perform checks, defer checks,…</p>
</li>
<li>
<p>determine a <em>pointcut</em> where you exit the scope, call <code>scopeExit</code>
and eventually perform additional checks</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Otherusefulmethods"><a class="anchor" href="#Typecheckingextensions-Otherusefulmethods"></a><a class="link" href="#Typecheckingextensions-Otherusefulmethods">Other useful methods</a></h7>
<div class="paragraph">
<p>For the complete list of helper methods, please refer to
the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> and 
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingExtension.html">org.codehaus.groovy.transform.stc.TypeCheckingExtension</a> classes. However,
take special attention to those methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isDynamic</code>: takes a VariableExpression as argument and returns true
if the variable is a DynamicExpression, which means, in a script, that
it wasn’t defined using a type or <code>def</code>.</p>
</li>
<li>
<p><code>isGenerated</code>: takes a MethodNode as an argument and tells if the
method is one that was generated by the type checker extension using
the <code>newMethod</code> method</p>
</li>
<li>
<p><code>isAnnotatedBy</code>: takes an AST node and a Class (or ClassNode), and
tells if the node is annotated with this class. For example:
<code>isAnnotatedBy(node, NotNull)</code></p>
</li>
<li>
<p><code>getTargetMethod</code>: takes a method call as argument and returns
the <code>MethodNode</code> that the type checker has determined for it</p>
</li>
<li>
<p><code>delegatesTo</code>: emulates the behaviour of the <code>@DelegatesTo</code>
annotation. It allows you to tell that the argument will delegate to a
specific type (you can also specify the delegation strategy)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_type_checking_extensions"><a class="anchor" href="#_advanced_type_checking_extensions"></a><a class="link" href="#_advanced_type_checking_extensions">Advanced type checking extensions</a></h5>
<div class="sect5">
<h6 id="_precompiled_type_checking_extensions"><a class="anchor" href="#_precompiled_type_checking_extensions"></a><a class="link" href="#_precompiled_type_checking_extensions">Precompiled type checking extensions</a></h6>
<div class="paragraph">
<p>All the examples above use type checking scripts. They are found in source form in classpath, meaning that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Groovy source file, corresponding to the type checking extension, is available on compilation classpath</p>
</li>
<li>
<p>this file is compiled by the Groovy compiler for each source unit being compiled (often, a source unit corresponds
to a single file)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is a very convenient way to develop type checking extensions, however it implies a slower compilation phase, because
of the compilation of the extension itself for each file being compiled. For those reasons, it can be practical to rely
on a precompiled extension. You have two options to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write the extension in Groovy, compile it, then use a reference to the extension class instead of the source</p>
</li>
<li>
<p>write the extension in Java, compile it, then use a reference to the extension class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Writing a type checking extension in Groovy is the easiest path. Basically, the idea is that the type checking extension
script becomes the body of the main method of a type checking extension class, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport

class PrecompiledExtension extends GroovyTypeCheckingExtensionSupport.TypeCheckingDSL {     <i class="conum" data-value="1"></i><b>(1)</b>
    @Override
    Object run() {                                                                          <i class="conum" data-value="2"></i><b>(2)</b>
        unresolvedVariable { var -&gt;
            if ('robot'==var.name) {
                storeType(var, classNodeFor(Robot))                                         <i class="conum" data-value="3"></i><b>(3)</b>
                handled = true
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>extending the <code>TypeCheckingDSL</code> class is the easiest</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then the extension code needs to go inside the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and you can use the very same events as an extension written in source form</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Setting up the extension is very similar to using a source form extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.addCompilationCustomizers(
    new ASTTransformationCustomizer(
        TypeChecked,
        extensions:['typing.PrecompiledExtension'])
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is that instead of using a path in classpath, you just specify the fully qualified class name of the
precompiled extension.</p>
</div>
<div class="paragraph">
<p>In case you really want to write an extension in Java, then you will not benefit from the type checking extension DSL.
The extension above can be rewritten in Java this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import org.codehaus.groovy.ast.ClassHelper;
import org.codehaus.groovy.ast.expr.VariableExpression;
import org.codehaus.groovy.transform.stc.AbstractTypeCheckingExtension;


import org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor;

public class PrecompiledJavaExtension extends AbstractTypeCheckingExtension {                   <i class="conum" data-value="1"></i><b>(1)</b>

    public PrecompiledJavaExtension(final StaticTypeCheckingVisitor typeCheckingVisitor) {
        super(typeCheckingVisitor);
    }

    @Override
    public boolean handleUnresolvedVariableExpression(final VariableExpression vexp) {          <i class="conum" data-value="2"></i><b>(2)</b>
        if ("robot".equals(vexp.getName())) {
            storeType(vexp, ClassHelper.make(Robot.class));
            setHandled(true);
            return true;
        }
        return false;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>extend the <code>AbstractTypeCheckingExtension</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then override the <code>handleXXX</code> methods as required</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_using_grab_in_a_type_checking_extension"><a class="anchor" href="#_using_grab_in_a_type_checking_extension"></a><a class="link" href="#_using_grab_in_a_type_checking_extension">Using @Grab in a type checking extension</a></h6>
<div class="paragraph">
<p>It is totally possible to use the <code>@Grab</code> annotation in a type checking extension.
This means you can include libraries that would only be
available at compile time. In that case, you must understand that you
would increase the time of compilation significantly (at least, the
first time it grabs the dependencies).</p>
</div>
</div>
<div class="sect5">
<h6 id="_sharing_or_packaging_type_checking_extensions"><a class="anchor" href="#_sharing_or_packaging_type_checking_extensions"></a><a class="link" href="#_sharing_or_packaging_type_checking_extensions">Sharing or packaging type checking extensions</a></h6>
<div class="paragraph">
<p>A type checking extension is just a script that need to be on classpath. As such,
you can share it as is, or bundle it in a jar file that would be added to classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="_global_type_checking_extensions"><a class="anchor" href="#_global_type_checking_extensions"></a><a class="link" href="#_global_type_checking_extensions">Global type checking extensions</a></h6>
<div class="paragraph">
<p>While you can configure the compiler to transparently add type checking extensions to your
script, there is currently no way to apply an extension transparently just by having it on
classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="_type_checking_extensions_and_compilestatic"><a class="anchor" href="#_type_checking_extensions_and_compilestatic"></a><a class="link" href="#_type_checking_extensions_and_compilestatic">Type checking extensions and @CompileStatic</a></h6>
<div class="paragraph">
<p>Type checking extensions are used with <code>@TypeChecked</code> but can also be used with <code>@CompileStatic</code>. However, you must
be aware that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a type checking extension used with <code>@CompileStatic</code> will in general not be sufficient to let the compiler know how
to generate statically compilable code from "unsafe" code</p>
</li>
<li>
<p>it is possible to use a type checking extension with <code>@CompileStatic</code> just to enhance type checking, that is to say
introduce <strong>more</strong> compilation errors, without actually dealing with dynamic code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s explain the first point, which is that even if you use an extension, the compiler will not know how to compile
your code statically: technically, even if you tell the type checker what is the type of a dynamic
variable, for example, it would not know how to compile it. Is it <code>getBinding('foo')</code>, <code>getProperty('foo')</code>,
<code>delegate.getFoo()</code>,…? There&#8217;s absolutely no direct way to tell the static compiler how to compile such
code even if you use a type checking extension (that would, again, only give hints about the type).</p>
</div>
<div class="paragraph">
<p>One possible solution for this particular example is to instruct the compiler to use <a href="#mixed-mode">mixed mode compilation</a>.
The more advanced one is to use <a href="#ast-xform-as-extension">AST transformations during type checking</a> but it is far more
complex.</p>
</div>
<div class="paragraph">
<p>Type checking extensions allow you to help the type checker where it
fails, but it also allows you to fail where it doesn’t. In that context,
it makes sense to support extensions for <code>@CompileStatic</code> too. Imagine
an extension that is capable of type checking SQL queries. In that case,
the extension would be valid in both dynamic and static context, because
without the extension, the code would still pass.</p>
</div>
</div>
<div class="sect5">
<h6 id="mixed-mode"><a class="anchor" href="#mixed-mode"></a><a class="link" href="#mixed-mode">Mixed mode compilation</a></h6>
<div class="paragraph">
<p>In the previous section, we highlighted the fact that you can activate type checking extensions with
<code>@CompileStatic</code>. In that context, the type checker would not complain anymore about some unresolved variables or
unknown method calls, but it would still wouldn&#8217;t know how to compile them statically.</p>
</div>
<div class="paragraph">
<p>Mixed mode compilation offers a third way, which is to instruct the compiler that whenever an unresolved variable
or method call is found, then it should fall back to a dynamic mode. This is possible thanks to type checking extensions
and a special <code>makeDynamic</code> call.</p>
</div>
<div class="paragraph">
<p>To illustrate this, let&#8217;s come back to the <code>Robot</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">robot.move 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s try to activate our type checking extension using <code>@CompileStatic</code> instead of <code>@TypeChecked</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
    new ASTTransformationCustomizer(
        CompileStatic,                                      <i class="conum" data-value="1"></i><b>(1)</b>
        extensions:['robotextension.groovy'])               <i class="conum" data-value="2"></i><b>(2)</b>
)
def shell = new GroovyShell(config)
def robot = new Robot()
shell.setVariable('robot', robot)
shell.evaluate(script)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply <code>@CompileStatic</code> transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activate the type checking extension</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script will run fine because the static compiler is told about the type of the <code>robot</code> variable, so it is capable
of making a direct call to <code>move</code>. But before that, how did the compiler know how to get the <code>robot</code> variable? In fact
by default, in a type checking extension, setting <code>handled=true</code> on an unresolved variable will automatically trigger
a dynamic resolution, so in this case you don&#8217;t have anything special to make the compiler use a mixed mode. However,
let&#8217;s slightly update our example, starting from the robot script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">move 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can notice that there is no reference to <code>robot</code> anymore. Our extension will not help then because we will not
be able to instruct the compiler that <code>move</code> is done on a <code>Robot</code> instance. This example of code can be executed in a
totally dynamic way thanks to the help of a <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/util/DelegatingScript.html">groovy.util.DelegatingScript</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
config.scriptBaseClass = 'groovy.util.DelegatingScript'     <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(config)
def runner = shell.parse(script)                            <i class="conum" data-value="2"></i><b>(2)</b>
runner.setDelegate(new Robot())                             <i class="conum" data-value="3"></i><b>(3)</b>
runner.run()                                                <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we configure the compiler to use a <code>DelegatingScript</code> as the base class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the script source needs to be parsed and will return an instance of <code>DelegatingScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can then call <code>setDelegate</code> to use a <code>Robot</code> as the delegate of the script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then execute the script. <code>move</code> will be directly executed on the delegate</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we want this to pass with <code>@CompileStatic</code>, we have to use a type checking extension, so let&#8217;s update our configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.addCompilationCustomizers(
    new ASTTransformationCustomizer(
        CompileStatic,                                      <i class="conum" data-value="1"></i><b>(1)</b>
        extensions:['robotextension2.groovy'])              <i class="conum" data-value="2"></i><b>(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply <code>@CompileStatic</code> transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use an alternate type checking extension meant to recognize the call to <code>move</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then in the previous section we have learnt how to deal with unrecognized method calls, so we are able to write this
extension:</p>
</div>
<div class="listingblock">
<div class="title">robotextension2.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">methodNotFound { receiver, name, argList, argTypes, call -&gt;
    if (isMethodCallExpression(call)                        <i class="conum" data-value="1"></i><b>(1)</b>
        &amp;&amp; call.implicitThis                                <i class="conum" data-value="2"></i><b>(2)</b>
        &amp;&amp; 'move'==name                                     <i class="conum" data-value="3"></i><b>(3)</b>
        &amp;&amp; argTypes.length==1                               <i class="conum" data-value="4"></i><b>(4)</b>
        &amp;&amp; argTypes[0] == classNodeFor(int)                 <i class="conum" data-value="5"></i><b>(5)</b>
    ) {
        handled = true                                      <i class="conum" data-value="6"></i><b>(6)</b>
        newMethod('move', classNodeFor(Robot))              <i class="conum" data-value="7"></i><b>(7)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the call is a method call (not a static method call)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>that this call is made on "implicit this" (no explicit <code>this.</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>that the method being called is <code>move</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and that the call is done with a single argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and that argument is of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>then tell the type checker that the call is valid</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>and that the return type of the call is <code>Robot</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you try to execute this code, then you could be surprised that it actually fails at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.NoSuchMethodError: java.lang.Object.move()Ltyping/Robot;</pre>
</div>
</div>
<div class="paragraph">
<p>The reason is very simple: while the type checking extension is sufficient for <code>@TypeChecked</code>, which does not involve
static compilation, it is not enough for <code>@CompileStatic</code> which requires additional information. In this case, you told
the compiler that the method existed, but you didn&#8217;t explain to it <strong>what</strong> method it is in reality, and what is the
receiver of the message (the delegate).</p>
</div>
<div class="paragraph">
<p>Fixing this is very easy and just implies replacing the <code>newMethod</code> call with something else:</p>
</div>
<div class="listingblock">
<div class="title">robotextension3.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">methodNotFound { receiver, name, argList, argTypes, call -&gt;
    if (isMethodCallExpression(call)
        &amp;&amp; call.implicitThis
        &amp;&amp; 'move'==name
        &amp;&amp; argTypes.length==1
        &amp;&amp; argTypes[0] == classNodeFor(int)
    ) {
        makeDynamic(call, classNodeFor(Robot))              <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tell the compiler that the call should be make dynamic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>makeDynamic</code> call does 3 things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it returns a virtual method just like <code>newMethod</code></p>
</li>
<li>
<p>automatically sets the <code>handled</code> flag to <code>true</code> for you</p>
</li>
<li>
<p>but also marks the <code>call</code> to be done dynamically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So when the compiler will have to generate bytecode for the call to <code>move</code>, since it is now marked as a dynamic call,
it will fall back to the dynamic compiler and let it handle the call. And since the extension tells us that the return
type of the dynamic call is a <code>Robot</code>, subsequent calls will be done statically!</p>
</div>
<div class="paragraph">
<p>Some would wonder why the static compiler doesn&#8217;t do this by default without an extension. It is a design decision:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the code is statically compiled, we normally want type safety and best performance</p>
</li>
<li>
<p>so if unrecognized variables/method calls are made dynamic, you loose type safety, but also all support for typos at
compile time!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, if you want to have mixed mode compilation, it <strong>has</strong> to be explicit, through a type checking extension, so
that the compiler, and the designer of the DSL, are totally aware of what they are doing.</p>
</div>
<div class="paragraph">
<p><code>makeDynamic</code> can be used on 3 kind of AST nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a method node (<code>MethodNode</code>)</p>
</li>
<li>
<p>a variable (<code>VariableExpression</code>)</p>
</li>
<li>
<p>a property expression (<code>PropertyExpression</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If that is not enough, then it means that static compilation cannot be done directly and that you have to rely on AST
transformations.</p>
</div>
</div>
<div class="sect5">
<h6 id="ast-xform-as-extension"><a class="anchor" href="#ast-xform-as-extension"></a><a class="link" href="#ast-xform-as-extension">Transforming the AST in an extension</a></h6>
<div class="paragraph">
<p>Type checking extensions look very attractive from an AST transformation design point of view: extensions have access
to context like inferred types, which is often nice to have. And an extension has a direct access to the abstract
syntax tree. Since you have access to the AST, there is nothing in theory that prevents
you from modifying the AST. However, we do not recommend you to do so, unless you are an advanced AST transformation
designer and well aware of the compiler internals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First of all, you would explicitly break the contract of type checking, which is to annotate,
and only annotate the AST. Type checking should <strong>not</strong> modify the AST tree because you wouldn’t be able to
guarantee anymore that code without the <em>@TypeChecked</em> annotation
behaves the same without the annotation.</p>
</li>
<li>
<p>If your extension is meant to work with <em>@CompileStatic</em>, then you <strong>can</strong> modify the AST because
this is indeed what <em>@CompileStatic</em> will eventually do. Static compilation doesn’t guarantee the same semantics at
dynamic Groovy so there is effectively a difference between code compiled with <em>@CompileStatic</em> and code compiled
with <em>@TypeChecked</em>. It’s up to you to choose whatever strategy you want to update the AST, but probably
using an AST transformation that runs before type checking is easier.</p>
</li>
<li>
<p>if you cannot rely on a transformation that kicks in before the type checker, then you must be <strong>very</strong> careful</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The type checking phase is the last phase running in the compiler before bytecode generation. All other AST
transformations run before that and the compiler does a very good job at "fixing" incorrect AST generated before the
type checking phase. As soon as you perform a transformation during type checking, for example directly in a type
checking extension, then you have to do all this work of generating a 100% compiler compliant abstract syntax tree by
yourself, which can easily become complex. That&#8217;s why we do not recommend to go that way if you are beginning with
type checking extensions and AST transformations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">Examples</a></h6>
<div class="paragraph">
<p>Examples of real life type checking extensions are easy to find. You can download the source code for Groovy and
take a look at the
<a href="https://github.com/apache/groovy/blob/master/src/test/groovy/transform/stc/TypeCheckingExtensionsTest.groovy">TypeCheckingExtensionsTest</a>
class which is linked to
<a href="https://github.com/apache/groovy/tree/master/src/test-resources/groovy/transform/stc">various extension scripts</a>.</p>
</div>
<div class="paragraph">
<p>An example of a complex type checking extension can be found in the <a href="markup-template-engine.html">Markup Template Engine</a>
source code: this template engine relies on a type checking extension and AST transformations to transform templates into
fully statically compiled code. Sources for this can be found
<a href="https://github.com/apache/groovy/tree/master/subprojects/groovy-templates/src/main/groovy/groovy/text/markup">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools"><a class="anchor" href="#_tools"></a><a class="link" href="#_tools">2. Tools</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_groovy_from_the_commandline"><a class="anchor" href="#_running_groovy_from_the_commandline"></a><a class="link" href="#_running_groovy_from_the_commandline">2.1. Running Groovy from the commandline</a></h3>
<div class="sect3">
<h4 id="section-groovy-commandline"><a class="anchor" href="#section-groovy-commandline"></a><a class="link" href="#section-groovy-commandline">2.1.1. groovy, the Groovy command</a></h4>
<div class="paragraph">
<p><code>groovy</code> invokes the Groovy command line processor. It allows you to run inline Groovy expressions, and scripts, tests or application within groovy files.
It plays a similar role to <code>java</code> in the Java world but handles inline scripts and rather than invoking class files, it is normally called with scripts
and will automatically call the Groovy compiler as needed.</p>
</div>
<div class="paragraph">
<p>The easiest way to run a Groovy script, test or application is to run the following command at your shell prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; groovy MyScript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>.groovy</code> part is optional. The <code>groovy</code> command supports a number of command line switches:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--autosplit &lt;splitPattern&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split lines using splitPattern (default '\s') using implicit 'split' variable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--basescript &lt;class&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class name for scripts (must derive from Script)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--encoding &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify the encoding of the files</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cp &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath &lt;path&gt;<br>
--classpath &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the compilation classpath. Must be the first argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -cp lib/dep.jar MyScript</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--configscript &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced compiler configuration script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --configscript config/config.groovy src/Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--define &lt;name=value&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">define a system property</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug mode will print out full stack traces</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--disableopt &lt;optlist&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disables one or all optimization elements.<br>
optlist can be a comma separated list with the elements:<br>
all (disables all optimizations),<br>
int (disable any int based optimizations)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e &lt;script&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify an inline command line script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -e "println new Date()"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays usage information for the command line groovy command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --help</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i &lt;extension&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">modify files in place; create backup if extension is given (e.g. '.bak')</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-l &lt;port&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen on a port and process inbound lines (default: 1960)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-n</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process files line by line using implicit 'line' variable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-p</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process files line by line and print result (see also -n)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display the Groovy and JVM versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -v</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-pa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates metadata for reflection on method parameter names on JDK 8 and above. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --parameters Person.groovy</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-pr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--enable-preview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable preview Java features (jdk12+ only).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --enable-preview Person.groovy</p></td>
</tr>
</tfoot>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_compiling_groovy"><a class="anchor" href="#_compiling_groovy"></a><a class="link" href="#_compiling_groovy">2.2. Compiling Groovy</a></h3>
<div class="sect3">
<h4 id="section-groovyc-compiler"><a class="anchor" href="#section-groovyc-compiler"></a><a class="link" href="#section-groovyc-compiler">2.2.1. groovyc, the Groovy compiler</a></h4>
<div class="paragraph">
<p><code>groovyc</code> is the Groovy compiler command line tool. It allows you to compile Groovy sources into bytecode. It plays
the same role as <code>javac</code> in the Java world. The easiest way to compile a Groovy script or class is to run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a <code>MyClass.class</code> file (as well as other .class files depending on the contents of the source). <code>groovyc</code> supports
a number of command line switches:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, --classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the compilation classpath. Must be the first argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -cp lib/dep.jar MyClass.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where to find source files. Not used anymore. Specifying this parameter will have no effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--temp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary directory for the compiler</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of the source files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --encoding utf-8 script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help for the command line groovyc tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --help</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to place generated class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -d target Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the compiler version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -v</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the stack trace in case of compilation error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -e script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--jointCompilation*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables joint compilation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j A.groovy B.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--basescript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class name for scripts (must derive from Script)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--configscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced compiler configuration script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --configscript config/config.groovy src/Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Jproperty=value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties to be passed to <code>javac</code> if joint compilation is enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j -Jtarget=1.6 -Jsource=1.6 A.groovy B.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Fflag</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags to be passed to <code>javac</code> if joint compilation is enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j -Fnowarn A.groovy B.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-pa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates metadata for reflection on method parameter names. Requires Java 8+.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --parameters Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-pr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--enable-preview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable preview Java features (jdk12+ only).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --enable-preview Person.groovy</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@argfile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read options and source files from specified file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc @conf/args</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p><strong>Notes:</strong>
* for a full description of joint compilation, see <a href="#section-jointcompilation">the joint compilation section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ant_task"><a class="anchor" href="#_ant_task"></a><a class="link" href="#_ant_task">2.2.2. Ant task</a></h4>
<div class="paragraph">
<p>See the <a href="#groovyc-ant-task-using">groovyc Ant task</a> documentation.
It allows the Groovy compiler to be invoked from <a href="http://ant.apache.org/">Apache Ant</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Gant"><a class="anchor" href="#Gant"></a><a class="link" href="#Gant">2.2.3. Gant</a></h4>
<div class="paragraph">
<p><a href="https://github.com/Gant/Gant">Gant</a> is a tool for scripting Ant tasks using Groovy
instead of XML to specify the logic. As such, it has exactly the same features
as the Groovyc Ant task.</p>
</div>
</div>
<div class="sect3">
<h4 id="Gradle"><a class="anchor" href="#Gradle"></a><a class="link" href="#Gradle">2.2.4. Gradle</a></h4>
<div class="paragraph">
<p><a href="http://www.gradle.org/">Gradle</a> is a build tool that allows you to leverage the
flexibility of <a href="http://ant.apache.org/">Ant</a>, while keeping the simplicity of
convention over configuration that tools like <a href="http://maven.apache.org/">Maven</a>
offer. Builds are specified using a Groovy DSL, which offers great flexibility
and succinctness.</p>
</div>
</div>
<div class="sect3">
<h4 id="_maven_integration"><a class="anchor" href="#_maven_integration"></a><a class="link" href="#_maven_integration">2.2.5. Maven integration</a></h4>
<div class="paragraph">
<p>There are several approaches to compiling Groovy code in your Maven
projects. <a href="#section-gmavenplus">GMavenPlus</a> is the
most flexible and feature rich, but like most Groovy compiler tools, it can
have difficulties with joint Java-Groovy projects (for the same reason
<a href="#section-gmaven">GMaven</a> and <a href="#Gradle">Gradle</a> can have issues).
The <a href="#section-groovyeclipse">Groovy-Eclipse compiler plugin for Maven</a>
sidesteps the joint compilation issues. Read
<a href="https://github.com/groovy/groovy-eclipse/wiki/Groovy-Eclipse-Maven-plugin#why-another-groovy-compiler-for-maven-what-about-gmaven">this</a>
for a deeper discussion of the benefits and disadvantages of the two
approaches.</p>
</div>
<div class="paragraph">
<p>A third approach is to use Maven’s Ant plugin to compile a groovy
project. Note that the Ant plugin is bound to the compile and
test-compile phases of the build in the example below. It will be
invoked during these phases and the contained tasks will be carried out
which runs the Groovy compiler over the source and test directories. The
resulting Java classes will coexist with and be treated like any
standard Java classes compiled from Java source and will appear no
different to the JRE, or the JUnit runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.mycomp.MyGroovy&lt;/groupId&gt;
    &lt;artifactId&gt;MyGroovy&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Maven Example building a Groovy project&lt;/name&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
            &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
            &lt;version&gt;2.5.0&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt; &lt;!-- required JUST since Groovy 2.5.0 --&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;compile&lt;/id&gt;
                        &lt;phase&gt;compile&lt;/phase&gt;
                        &lt;configuration&gt;
                            &lt;tasks&gt;
                                &lt;mkdir dir="${basedir}/src/main/groovy"/&gt;
                                &lt;taskdef name="groovyc"
                                    classname="org.codehaus.groovy.ant.Groovyc"&gt;
                                    &lt;classpath refid="maven.compile.classpath"/&gt;
                                &lt;/taskdef&gt;
                                &lt;mkdir dir="${project.build.outputDirectory}"/&gt;
                                &lt;groovyc destdir="${project.build.outputDirectory}"
                                    srcdir="${basedir}/src/main/groovy/" listfiles="true"&gt;
                                    &lt;classpath refid="maven.compile.classpath"/&gt;
                                &lt;/groovyc&gt;
                            &lt;/tasks&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;test-compile&lt;/id&gt;
                        &lt;phase&gt;test-compile&lt;/phase&gt;
                        &lt;configuration&gt;
                            &lt;tasks&gt;
                                &lt;mkdir dir="${basedir}/src/test/groovy"/&gt;
                                &lt;taskdef name="groovyc"
                                    classname="org.codehaus.groovy.ant.Groovyc"&gt;
                                    &lt;classpath refid="maven.test.classpath"/&gt;
                                &lt;/taskdef&gt;
                                &lt;mkdir dir="${project.build.testOutputDirectory}"/&gt;
                                &lt;groovyc destdir="${project.build.testOutputDirectory}"
                                    srcdir="${basedir}/src/test/groovy/" listfiles="true"&gt;
                                    &lt;classpath refid="maven.test.classpath"/&gt;
                                &lt;/groovyc&gt;
                            &lt;/tasks&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you have a Maven project setup with <code>groovy</code> subfolders
as peers to the java src and test subfolders. You can use the <code>java</code>/<code>jar</code>
archetype to set this up then rename the java folders to groovy or keep
the java folders and just create groovy peer folders. There exists, also
a groovy plugin which has not been tested or used in production. After
defining the build section as in the above example, you can invoke the
typical Maven build phases normally. For example, <code>mvn test</code> will
execute the test phase, compiling Groovy source and Groovy test source
and finally executing the unit tests. If you run <code>mvn jar</code> it will
execute the jar phase bundling up all of your compiled production
classes into a jar after all the unit tests pass. For more detail on
Maven build phases consult the Maven2 documentation.</p>
</div>
<div class="sect4">
<h5 id="_gmaven_and_gmavenplus"><a class="anchor" href="#_gmaven_and_gmavenplus"></a><a class="link" href="#_gmaven_and_gmavenplus">GMaven and GMavenPlus</a></h5>
<div class="sect5">
<h6 id="section-gmaven"><a class="anchor" href="#section-gmaven"></a><a class="link" href="#section-gmaven">GMaven</a></h6>
<div class="paragraph">
<p><a href="https://github.com/groovy/gmaven">GMaven</a> is the original Maven plugin
for Groovy, supporting both compiling and scripting Groovy.</p>
</div>
<div class="paragraph">
<p><strong>Important:</strong></p>
</div>
<div class="paragraph">
<p>You should be aware that GMaven is <strong>not supported anymore</strong> and can have
difficulties with <a href="#section-jointcompilation">joint compilation</a>.
<a href="#section-gmavenplus">GMavenPlus</a> can be a good replacement, but if you
are having problems with joint compilation, you might consider the
<a href="#section-groovyeclipse">Groovy Eclipse maven plugin</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="section-gmavenplus"><a class="anchor" href="#section-gmavenplus"></a><a class="link" href="#section-gmavenplus">GMavenPlus</a></h6>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a rewrite of
<a href="#section-gmaven">GMaven</a> and is in active development. It supports most of the
features of GMaven (a couple notable exceptions being
<a href="http://maven.apache.org/plugin-tools/maven-plugin-tools-java/index.html">mojo Javadoc tags</a>
and support for older Groovy versions). Its joint compilation uses stubs (which
means it has the same potential issues as <a href="#section-gmaven">GMaven</a> and <a href="#Gradle">Gradle</a>). The main
advantages over its predecessor are that it supports recent Groovy versions,
InvokeDynamic, Groovy on Android, GroovyDoc, and configuration scripts.</p>
</div>
</div>
<div class="sect5">
<h6 id="section-gmaven2"><a class="anchor" href="#section-gmaven2"></a><a class="link" href="#section-gmaven2">GMaven 2</a></h6>
<div class="paragraph">
<p>Unlike the name might seem to suggest, <a href="http://groovy.github.io/gmaven/">GMaven 2</a>
is not aimed at replacing <a href="#section-gmaven">GMaven</a>. In fact, it removes the
non-scripting features of the GMaven plugin. It has not yet had any release and
appears to be inactive currently.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="section-groovyeclipse"><a class="anchor" href="#section-groovyeclipse"></a><a class="link" href="#section-groovyeclipse">The Groovy Eclipse Maven plugin</a></h5>
<div class="paragraph">
<p><a href="https://github.com/groovy/groovy-eclipse/wiki/Groovy-Eclipse-Maven-plugin">Groovy-Eclipse</a>
provides a compiler plugin for Maven. Using the compiler
plugin, it is possible to compile your maven projects using the
Groovy-Eclipse compiler. One feature unavailable elsewhere is
stubless joint compilation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-jointcompilation"><a class="anchor" href="#section-jointcompilation"></a><a class="link" href="#section-jointcompilation">2.2.6. Joint compilation</a></h4>
<div class="paragraph">
<p>Joint compilation means that the Groovy compiler will parse the
Groovy source files, create stubs for all of them, invoke the Java
compiler to compile the stubs along with Java sources, and then continue
compilation in the normal Groovy compiler way. This allows mixing of
Java and Groovy files without constraint.</p>
</div>
<div class="paragraph">
<p>Joint compilation can be enabled using the <code>-j</code> flag with the command-line compiler,
or using a nested tag and all the attributes and further nested tags as required
for the Ant task.</p>
</div>
<div class="paragraph">
<p>It is important to know that if you don&#8217;t enable joint compilation and try to compile
Java source files with the Groovy compiler, the Java source files will be compiled as
if they were Groovy sources. In some situations, this might work since most of the Java
syntax is compatible with Groovy, but there are a number of places where semantics could be different.</p>
</div>
</div>
<div class="sect3">
<h4 id="section-android"><a class="anchor" href="#section-android"></a><a class="link" href="#section-android">2.2.7. Android support</a></h4>
<div class="paragraph">
<p>It is possible to write an Android application in Groovy. However this requires a special
version of the compiler, meaning that you cannot use the regular
<a href="#section-groovyc-compiler">groovyc tool</a> to target Android bytecode. In particular, Groovy
provides specific JAR files for Android, which have a classifier of <code>grooid</code>. In order to make
things easier, a <a href="https://github.com/groovy/groovy-android-gradle-plugin">Gradle plugin</a> adds
support for the Groovy language in the Android Gradle toolchain.</p>
</div>
<div class="paragraph">
<p>The plugin can be applied like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:2.1.2'
        classpath 'org.codehaus.groovy:groovy-android-gradle-plugin:1.0.0'
    }
}

apply plugin: 'groovyx.android'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you will need to add a dependency on the <code>grooid</code> version of the Groovy compiler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
    compile 'org.codehaus.groovy:groovy:2.4.7:grooid'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if a Groovy jar does not provide a <code>grooid</code> classifier alternative, then it means
that the jar is directly compatible with Android. In that case, you can add the dependency directly
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
    compile 'org.codehaus.groovy:groovy:2.4.7:grooid'       // requires the grooid classifier
    compile ('org.codehaus.groovy:groovy-json:2.4.7') {     // no grooid version available
        transitive = false                                  // so do not depend on non-grooid version
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>transitive=false</code> parameter for <code>groovy-json</code> will let Gradle download the JSON support jar
without adding a dependency onto the normal jar of Groovy.</p>
</div>
<div class="paragraph">
<p>Please make sure to go to the <a href="https://github.com/groovy/groovy-android-gradle-plugin">plugin homepage</a> in order to
find the latest documentation and version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovysh_the_groovy_shell"><a class="anchor" href="#_groovysh_the_groovy_shell"></a><a class="link" href="#_groovysh_the_groovy_shell">2.3. Groovysh, the Groovy shell</a></h3>
<div class="sect3">
<h4 id="_groovy_groovy_shell"><a class="anchor" href="#_groovy_groovy_shell"></a><a class="link" href="#_groovy_groovy_shell">2.3.1. Groovy : Groovy Shell</a></h4>
<div class="paragraph">
<p>The Groovy Shell, aka. <code>groovysh</code> is a command-line application which
allows easy access to evaluate Groovy expressions, define classes and
run simple experiments.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-Features"><a class="anchor" href="#GroovyShell-Features"></a><a class="link" href="#GroovyShell-Features">Features</a></h5>
<div class="ulist">
<ul>
<li>
<p>No need for <code>go</code> command to execute buffer.</p>
</li>
<li>
<p>Rich cross-platform edit-line editing, history and completion thanks
to <a href="https://github.com/jline/jline2">JLine2</a>.</p>
</li>
<li>
<p>ANSI colors (prompt, exception traces, etc).</p>
</li>
<li>
<p>Simple, yet robust, command system with online help, user alias
support and more.</p>
</li>
<li>
<p>User profile support</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Command-lineOptionsandArguments"><a class="anchor" href="#GroovyShell-Command-lineOptionsandArguments"></a><a class="link" href="#GroovyShell-Command-lineOptionsandArguments">Command-line Options and Arguments</a></h5>
<div class="paragraph">
<p>The shell supports several options to control verbosity, ANSI coloring
and other features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">./bin/groovysh --help

Usage: groovysh [options] [...]
The Groovy Shell, aka groovysh, is a command-line application which allows easy
access to evaluate Groovy expressions, define classes and run simple
experiments.
  -C, --color[=&lt;FLAG&gt;]    Enable or disable use of ANSI colors
      -cp, -classpath, --classpath
                          Specify where to find the class files - must be first
                            argument
  -d, --debug             Enable debug output
  -D, --define=&lt;name=value&gt;
                          Define a system property
  -e, --evaluate=&lt;CODE&gt;   Evaluate the code first when starting interactive session
  -h, --help              Display this help message
  -pa, --parameters       Generate metadata for reflection on method parameter names
                            (jdk8+ only)
  -pr, --enable-preview   Enable preview Java features (jdk12+ only)
  -q, --quiet             Suppress superfluous output
  -T, --terminal=&lt;TYPE&gt;   Specify the terminal TYPE to use
  -v, --verbose           Enable verbose output
  -V, --version           Display the version</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-EvaluatingExpressions"><a class="anchor" href="#GroovyShell-EvaluatingExpressions"></a><a class="link" href="#GroovyShell-EvaluatingExpressions">Evaluating Expressions</a></h5>
<div class="sect5">
<h6 id="GroovyShell-SimpleExpressions"><a class="anchor" href="#GroovyShell-SimpleExpressions"></a><a class="link" href="#GroovyShell-SimpleExpressions">Simple Expressions</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println "Hello"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-EvaluationResult"><a class="anchor" href="#GroovyShell-EvaluationResult"></a><a class="link" href="#GroovyShell-EvaluationResult">Evaluation Result</a></h6>
<div class="paragraph">
<p>When a complete expression is found, it is compiled and evaluated. The
result of the evaluation is stored into the _ variable.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Multi-lineExpressions"><a class="anchor" href="#GroovyShell-Multi-lineExpressions"></a><a class="link" href="#GroovyShell-Multi-lineExpressions">Multi-line Expressions</a></h6>
<div class="paragraph">
<p>Multi-line/complex expressions (like closure or class definitions) may
be defined over several lines. When the shell detects that it has a
complete expression it will compile and evaluate it.</p>
</div>
<div class="sect6">
<h7 id="GroovyShell-DefineaClass"><a class="anchor" href="#GroovyShell-DefineaClass"></a><a class="link" href="#GroovyShell-DefineaClass">Define a Class</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
    def bar() {
        println "baz"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-UsetheClass"><a class="anchor" href="#GroovyShell-UsetheClass"></a><a class="link" href="#GroovyShell-UsetheClass">Use the Class</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">foo = new Foo()
foo.bar()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Variables"><a class="anchor" href="#GroovyShell-Variables"></a><a class="link" href="#GroovyShell-Variables">Variables</a></h6>
<div class="paragraph">
<p>Shell variables are <strong>all</strong> untyped (i.e. no <code>def</code> or other type information).</p>
</div>
<div class="paragraph">
<p>This <strong>will</strong> set a shell variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">foo = "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>But, this will evaluate a local variable and will <strong>not</strong> be saved to the shell’s environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def foo = "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This behavior can be changed by activating <a href="#GroovyShell-InterpreterMode">interpreter mode</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Functions"><a class="anchor" href="#GroovyShell-Functions"></a><a class="link" href="#GroovyShell-Functions">Functions</a></h6>
<div class="paragraph">
<p>Functions can be defined in the shell, and will be saved for later use.</p>
</div>
<div class="paragraph">
<p>Defining a function is easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">groovy:000&gt; def hello(name) {
groovy:001&gt; println("Hello $name")
groovy:002&gt; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then using it is as one might expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">hello("Jason")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally the shell creates a closure to encapsulate the function and
then binds the closure to a variable. So variables and functions share
the same namespace.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Commands"><a class="anchor" href="#GroovyShell-Commands"></a><a class="link" href="#GroovyShell-Commands">Commands</a></h5>
<div class="paragraph">
<p>The shell has a number of different commands, which provide rich access
to the shell’s environment.</p>
</div>
<div class="paragraph">
<p>Commands all have a <em>name</em> and a <em>shortcut</em> (which is something like
<code>\h</code>). Commands may also have some predefined system <em>aliases</em>. Users
may also create their own aliases.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-RecognizedCommands"><a class="anchor" href="#GroovyShell-RecognizedCommands"></a><a class="link" href="#GroovyShell-RecognizedCommands">Recognized Commands</a></h6>
<div class="sect6">
<h7 id="GroovyShell-help"><a class="anchor" href="#GroovyShell-help"></a><a class="link" href="#GroovyShell-help"><code>help</code></a></h7>
<div class="paragraph">
<p>Display the list of commands (and aliases) or the help text for specific command.</p>
</div>
<div id="GroovyShell-TheCommandList" class="paragraph">
<p>The Command List</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :help

For information about Groovy, visit:
    http://groovy-lang.org

Available commands:
  :help      (:h ) Display this help message
  ?          (:? ) Alias to: :help
  :exit      (:x ) Exit the shell
  :quit      (:q ) Alias to: :exit
  import     (:i ) Import a class into the namespace
  :display   (:d ) Display the current buffer
  :clear     (:c ) Clear the buffer and reset the prompt counter
  :show      (:S ) Show variables, classes or imports
  :inspect   (:n ) Inspect a variable or the last result with the GUI object browser
  :purge     (:p ) Purge variables, classes, imports or preferences
  :edit      (:e ) Edit the current buffer
  :load      (:l ) Load a file or URL into the buffer
  .          (:. ) Alias to: :load
  :save      (:s ) Save the current buffer to a file
  :record    (:r ) Record the current session to a file
  :history   (:H ) Display, manage and recall edit-line history
  :alias     (:a ) Create an alias
  :set       (:= ) Set (or list) preferences
  :grab      (:g ) Add a dependency to the shell environment
  :register  (:rc) Register a new command with the shell
  :doc       (:D ) Open a browser window displaying the doc for the argument

For help on a specific command type:
    :help &lt;command&gt;</pre>
</div>
</div>
<div id="GroovyShell-HelpforaCommand" class="paragraph">
<p>Help for a Command</p>
</div>
<div class="paragraph">
<p>While in the interactive shell, you can ask for help for any command to
get more details about its syntax or function. Here is an example of
what happens when you ask for help for the <code>help</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :help :help

usage: :help [&lt;command&gt;]

Display the list of commands or the help text for &lt;command&gt;.</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-exit"><a class="anchor" href="#GroovyShell-exit"></a><a class="link" href="#GroovyShell-exit"><code>exit</code></a></h7>
<div class="paragraph">
<p>Exit the shell.</p>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> way to exit the shell. Well, you can still <code>CTRL-C</code>,
but the shell will complain about an abnormal shutdown of the JVM.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-import"><a class="anchor" href="#GroovyShell-import"></a><a class="link" href="#GroovyShell-import"><code>import</code></a></h7>
<div class="paragraph">
<p>Add a custom import which will be included for all shell evaluations.</p>
</div>
<div class="paragraph">
<p>This command can be given at any time to add new imports.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-grab"><a class="anchor" href="#GroovyShell-grab"></a><a class="link" href="#GroovyShell-grab"><code>grab</code></a></h7>
<div class="paragraph">
<p>Grab a dependency (Maven, Ivy, etc.) from Internet sources or cache,
and add it to the Groovy Shell environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :grab 'com.google.guava:guava:19.0'
groovy:000&gt; import com.google.common.collect.BiMap
===&gt; com.google.common.collect.BiMap</pre>
</div>
</div>
<div class="paragraph">
<p>This command can be given at any time to add new dependencies.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-display"><a class="anchor" href="#GroovyShell-display"></a><a class="link" href="#GroovyShell-display"><code>display</code></a></h7>
<div class="paragraph">
<p>Display the contents of the current buffer.</p>
</div>
<div class="paragraph">
<p>This only displays the buffer of an incomplete expression. Once the
expression is complete, the buffer is reset. The prompt will update to
show the size of the current buffer as well.</p>
</div>
<div id="GroovyShell-Example" class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; class Foo {
groovy:001&gt; def bar
groovy:002&gt; def baz() {
groovy:003&gt; :display
 001&gt; class Foo {
 002&gt; def bar
 003&gt; def baz() {</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-clear"><a class="anchor" href="#GroovyShell-clear"></a><a class="link" href="#GroovyShell-clear"><code>clear</code></a></h7>
<div class="paragraph">
<p>Clears the current buffer, resetting the prompt counter to 000. Can be used to recover from compilation errors.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-show"><a class="anchor" href="#GroovyShell-show"></a><a class="link" href="#GroovyShell-show"><code>show</code></a></h7>
<div class="paragraph">
<p>Show variables, classes or preferences or imports.</p>
</div>
<div id="GroovyShell-showvariables" class="paragraph">
<p><code>show variables</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :show variables
Variables:
  _ = true</pre>
</div>
</div>
<div id="GroovyShell-showclasses" class="paragraph">
<p><code>show classes</code></p>
</div>
<div id="GroovyShell-showimports" class="paragraph">
<p><code>show imports</code></p>
</div>
<div id="GroovyShell-showpreferences" class="paragraph">
<p><code>show preferences</code></p>
</div>
<div id="GroovyShell-showall" class="paragraph">
<p><code>show all</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-inspect"><a class="anchor" href="#GroovyShell-inspect"></a><a class="link" href="#GroovyShell-inspect"><code>inspect</code></a></h7>
<div class="paragraph">
<p>Opens the GUI object browser to inspect a variable or the result of the
last evaluation.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-purge"><a class="anchor" href="#GroovyShell-purge"></a><a class="link" href="#GroovyShell-purge"><code>purge</code></a></h7>
<div class="paragraph">
<p>Purges objects from the shell.</p>
</div>
<div id="GroovyShell-purgevariables" class="paragraph">
<p><code>purge variables</code></p>
</div>
<div id="GroovyShell-purgeclasses" class="paragraph">
<p><code>purge classes</code></p>
</div>
<div id="GroovyShell-purgeimports" class="paragraph">
<p><code>purge imports</code></p>
</div>
<div id="GroovyShell-purgepreferences" class="paragraph">
<p><code>purge preferences</code></p>
</div>
<div id="GroovyShell-purgeall" class="paragraph">
<p><code>purge all</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-edit"><a class="anchor" href="#GroovyShell-edit"></a><a class="link" href="#GroovyShell-edit"><code>edit</code></a></h7>
<div class="paragraph">
<p>Edit the current buffer in an external editor.</p>
</div>
<div class="paragraph">
<p>Currently only works on UNIX systems which have the <code>EDITOR</code> environment
variable set, or have configured the <code>editor</code> preference.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-load"><a class="anchor" href="#GroovyShell-load"></a><a class="link" href="#GroovyShell-load"><code>load</code></a></h7>
<div class="paragraph">
<p>Load one or more files (or urls) into the buffer.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-save"><a class="anchor" href="#GroovyShell-save"></a><a class="link" href="#GroovyShell-save"><code>save</code></a></h7>
<div class="paragraph">
<p>Saves the buffer’s contents to a file.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-record"><a class="anchor" href="#GroovyShell-record"></a><a class="link" href="#GroovyShell-record"><code>record</code></a></h7>
<div class="paragraph">
<p>Record the current session to a file.</p>
</div>
<div id="GroovyShell-recordstart" class="paragraph">
<p><code>record start</code></p>
</div>
<div id="GroovyShell-recordstop" class="paragraph">
<p><code>record stop</code></p>
</div>
<div id="GroovyShell-recordstatus" class="paragraph">
<p><code>record status</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-history"><a class="anchor" href="#GroovyShell-history"></a><a class="link" href="#GroovyShell-history"><code>history</code></a></h7>
<div class="paragraph">
<p>Display, manage and recall edit-line history.</p>
</div>
<div id="GroovyShell-historyshow" class="paragraph">
<p><code>history show</code></p>
</div>
<div id="GroovyShell-historyrecall" class="paragraph">
<p><code>history recall</code></p>
</div>
<div id="GroovyShell-historyflush" class="paragraph">
<p><code>history flush</code></p>
</div>
<div id="GroovyShell-historyclear" class="paragraph">
<p><code>history clear</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-alias"><a class="anchor" href="#GroovyShell-alias"></a><a class="link" href="#GroovyShell-alias"><code>alias</code></a></h7>
<div class="paragraph">
<p>Create an alias.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-doc"><a class="anchor" href="#GroovyShell-doc"></a><a class="link" href="#GroovyShell-doc"><code>doc</code></a></h7>
<div class="paragraph">
<p>Opens a browser with documentation for the provided class.</p>
</div>
<div class="paragraph">
<p>For example, we can get both the Javadoc and GDK enhancements doc for <code>java.util.List</code> (shown running on JDK17):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000> :doc java.util.List
https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html
https://docs.groovy-lang.org/4.0.15/html/groovy-jdk/java/util/List.html</pre>
</div>
</div>
<div class="paragraph">
<p>This will print the documentation URLs found and open two windows (or tabs, depending on your browser):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one for the JDK documentation</p>
</li>
<li>
<p>one for the GDK documentation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, for Java classes, the <code>java.base</code> module is assumed. You can specify an optional module
for other cases (shown running on JDK17):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :doc java.scripting javax.script.ScriptContext
https://docs.oracle.com/en/java/javase/17/docs/api/java.scripting/javax/script/ScriptContext.html</pre>
</div>
</div>
<div class="paragraph">
<p>For backwards compatibility, if no module is specified when searching for Java classes, and no class is found in the <code>java.base</code> module, an additional attempt is made to find documentation for the class in the JDK8 (pre-module) Javadoc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :doc javax.script.ScriptContext
https://docs.oracle.com/javase/8/docs/api/javax/script/ScriptContext.html</pre>
</div>
</div>
<div class="paragraph">
<p>To get the Groovydoc for <code>groovy.ant.AntBuilder</code> and <code>groovy.xml.XmlSlurper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000> :doc groovy.ant.AntBuilder
https://docs.groovy-lang.org/4.0.15/html/gapi/groovy/ant/AntBuilder.html
groovy:000> :doc groovy.xml.XmlSlurper
https://docs.groovy-lang.org/4.0.15/html/gapi/groovy/xml/XmlSlurper.html</pre>
</div>
</div>
<div class="paragraph">
<p>To get both the Groovydoc and GDK enhancements doc for <code>groovy.lang.Closure</code> and <code>groovy.sql.GroovyResultSet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000> :doc groovy.lang.Closure
https://docs.groovy-lang.org/4.0.15/html/gapi/groovy/lang/Closure.html
https://docs.groovy-lang.org/4.0.15/html/groovy-jdk/groovy/lang/Closure.html
groovy:000> :doc groovy.sql.GroovyResultSet
https://docs.groovy-lang.org/4.0.15/html/gapi/groovy/sql/GroovyResultSet.html
https://docs.groovy-lang.org/4.0.15/html/groovy-jdk/groovy/sql/GroovyResultSet.html</pre>
</div>
</div>
<div class="paragraph">
<p>Documentation is also available for the GDK enhancements to primitive arrays and arrays of arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000> :doc int[]
https://docs.groovy-lang.org/4.0.15/html/groovy-jdk/primitives-and-primitive-arrays/int%5B%5D.html
groovy:000> :doc double[][]
https://docs.groovy-lang.org/4.0.15/html/groovy-jdk/primitives-and-primitive-arrays/double%5B%5D%5B%5D.html</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In contexts where opening a browser may not be desirable, e.g. on a CI server,
this command can be disabled by setting the <code>groovysh.disableDocCommand</code> system property to <code>true</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-set"><a class="anchor" href="#GroovyShell-set"></a><a class="link" href="#GroovyShell-set"><code>set</code></a></h7>
<div class="paragraph">
<p>Set or list preferences.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Preferences"><a class="anchor" href="#GroovyShell-Preferences"></a><a class="link" href="#GroovyShell-Preferences">Preferences</a></h5>
<div class="paragraph">
<p>Some aspects of <code>groovysh</code> behaviors can be customized by setting
preferences. Preferences are set using the <code>set</code> command or the <code>:=</code>
shortcut.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-RecognizedPreferences"><a class="anchor" href="#GroovyShell-RecognizedPreferences"></a><a class="link" href="#GroovyShell-RecognizedPreferences">Recognized Preferences</a></h6>
<div class="sect6">
<h7 id="GroovyShell-InterpreterMode"><a class="anchor" href="#GroovyShell-InterpreterMode"></a><a class="link" href="#GroovyShell-InterpreterMode"><code>interpreterMode</code></a></h7>
<div class="paragraph">
<p>Allows the use of typed variables (i.e. <code>def</code> or other type information):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; def x = 3
===&gt; 3
groovy:000&gt; x
===&gt; 3</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s especially useful for copy&amp;pasting code from tutorials etc. into the running session.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-verbosity"><a class="anchor" href="#GroovyShell-verbosity"></a><a class="link" href="#GroovyShell-verbosity"><code>verbosity</code></a></h7>
<div class="paragraph">
<p>Set the shell’s verbosity level. Expected to be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEBUG</code></p>
</li>
<li>
<p><code>VERBOSE</code></p>
</li>
<li>
<p><code>INFO</code></p>
</li>
<li>
<p><code>QUIET</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default is <code>INFO</code>.</p>
</div>
<div class="paragraph">
<p>If this preference is set to an invalid value, then the previous setting
will be used, or if there is none, then the preference is removed and
the default is used.</p>
</div>
</div>
<div class="sect6">
<h7 id="_colors"><a class="anchor" href="#_colors"></a><a class="link" href="#_colors"><code>colors</code></a></h7>
<div class="paragraph">
<p>Set the shell’s use of colors.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-show-last-result"><a class="anchor" href="#GroovyShell-show-last-result"></a><a class="link" href="#GroovyShell-show-last-result"><code>show-last-result</code></a></h7>
<div class="paragraph">
<p>Show the last result after an execution.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-sanitize-stack-trace"><a class="anchor" href="#GroovyShell-sanitize-stack-trace"></a><a class="link" href="#GroovyShell-sanitize-stack-trace"><code>sanitize-stack-trace</code></a></h7>
<div class="paragraph">
<p>Sanitize (trim-down/filter) stack traces.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-editor"><a class="anchor" href="#GroovyShell-editor"></a><a class="link" href="#GroovyShell-editor"><code>editor</code></a></h7>
<div class="paragraph">
<p>Configures the editor used by the <code>edit</code> command.</p>
</div>
<div class="paragraph">
<p>Default is the value of the system environment variable <code>EDITOR</code>.</p>
</div>
<div class="paragraph">
<p>To use TextEdit, the default text editor on macOS, configure:
set editor /Applications/TextEdit.app/Contents/MacOS/TextEdit</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-SettingaPreference"><a class="anchor" href="#GroovyShell-SettingaPreference"></a><a class="link" href="#GroovyShell-SettingaPreference">Setting a Preference</a></h6>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :set verbosity DEBUG</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-ListingPreferences"><a class="anchor" href="#GroovyShell-ListingPreferences"></a><a class="link" href="#GroovyShell-ListingPreferences">Listing Preferences</a></h6>
<div class="paragraph">
<p>To list the current <em>set</em> preferences (and their values):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :show preferences</pre>
</div>
</div>
<div class="paragraph">
<p>Limitation: At the moment, there is no way to list all the
known/available preferences to be set.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-ClearingPreferencesieResettingtoDefaults"><a class="anchor" href="#GroovyShell-ClearingPreferencesieResettingtoDefaults"></a><a class="link" href="#GroovyShell-ClearingPreferencesieResettingtoDefaults">Clearing Preferences (i.e. Resetting to Defaults)</a></h6>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :purge preferences</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-UserProfileScriptsandState"><a class="anchor" href="#GroovyShell-UserProfileScriptsandState"></a><a class="link" href="#GroovyShell-UserProfileScriptsandState">User Profile Scripts and State</a></h5>
<div class="sect5">
<h6 id="GroovyShell-ProfileScripts"><a class="anchor" href="#GroovyShell-ProfileScripts"></a><a class="link" href="#GroovyShell-ProfileScripts">Profile Scripts</a></h6>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshprofile"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshprofile"></a><a class="link" href="#GroovyShell-HOMEgroovygroovyshprofile"><code>$HOME/.groovy/groovysh.profile</code></a></h7>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell starts up.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshrc"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshrc"></a><a class="link" href="#GroovyShell-HOMEgroovygroovyshrc"><code>$HOME/.groovy/groovysh.rc</code></a></h7>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell enters interactive
mode.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-State"><a class="anchor" href="#GroovyShell-State"></a><a class="link" href="#GroovyShell-State">State</a></h6>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshhistory"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshhistory"></a><a class="link" href="#GroovyShell-HOMEgroovygroovyshhistory"><code>$HOME/.groovy/groovysh.history</code></a></h7>
<div class="paragraph">
<p>Edit-line history is stored in this file.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-register"><a class="anchor" href="#GroovyShell-register"></a><a class="link" href="#GroovyShell-register">Custom commands</a></h5>
<div class="paragraph">
<p>The <code>register</code> command allows you to register custom commands in the shell. For example, writing the following
will register the <code>Stats</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :register Stats</pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>Stats</code> class is a class extending the <code>org.apache.groovy.groovysh.CommandSupport</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.apache.groovy.groovysh.CommandSupport
import org.apache.groovy.groovysh.Groovysh

class Stats extends CommandSupport {
    protected Stats(final Groovysh shell) {
        super(shell, 'stats', 'T')
    }

    public Object execute(List args) {
        println "Free memory: ${Runtime.runtime.freeMemory()}"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the command can be called using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :stats
stats
Free memory: 139474880
groovy:000&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the command class must be found on classpath: you cannot define a new command from within the shell.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Troubleshooting"><a class="anchor" href="#GroovyShell-Troubleshooting"></a><a class="link" href="#GroovyShell-Troubleshooting">Troubleshooting</a></h5>
<div class="paragraph">
<p>Please <a href="https://issues.apache.org/jira/browse/GROOVY">report</a> any problems you
run into. Please be sure to mark the JIRA issue with the <code>Groovysh</code>
component.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-PlatformProblems"><a class="anchor" href="#GroovyShell-PlatformProblems"></a><a class="link" href="#GroovyShell-PlatformProblems">Platform Problems</a></h6>
<div class="sect6">
<h7 id="GroovyShell-ProblemsloadingtheJLineDLL"><a class="anchor" href="#GroovyShell-ProblemsloadingtheJLineDLL"></a><a class="link" href="#GroovyShell-ProblemsloadingtheJLineDLL">Problems loading the JLine DLL</a></h7>
<div class="paragraph">
<p>On Windows, <a href="https://github.com/jline/jline2">JLine2</a> (which is used for the fancy
shell input/history/completion fluff), uses a <strong>tiny</strong> DLL file to trick
the <strong>evil</strong> Windows faux-shell (<code>CMD.EXE</code> or <code>COMMAND.COM</code>) into
providing Java with unbuffered input. In some rare cases, this might
fail to load or initialize.</p>
</div>
<div class="paragraph">
<p>One solution is to disable the frills and use the unsupported terminal
instance. You can do that on the command-line using the <code>--terminal</code>
flag and set it to one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code></p>
</li>
<li>
<p><code>false</code></p>
</li>
<li>
<p><code>off</code></p>
</li>
<li>
<p><code>jline.UnsupportedTerminal</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>groovysh --terminal=none</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-ProblemswithCygwinonWindows"><a class="anchor" href="#GroovyShell-ProblemswithCygwinonWindows"></a><a class="link" href="#GroovyShell-ProblemswithCygwinonWindows">Problems with Cygwin on Windows</a></h7>
<div class="paragraph">
<p>Some people have issues when running groovysh with cygwin. If you have
troubles, the following may help:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stty -icanon min 1 -echo
groovysh --terminal=unix
stty icanon echo</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-GMavenPlus"><a class="anchor" href="#GroovyShell-GMavenPlus"></a><a class="link" href="#GroovyShell-GMavenPlus">2.3.2. GMavenPlus Maven Plugin</a></h4>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a Maven plugin with goals
that support launching a Groovy Shell or Groovy Console bound to a Maven
project.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-GradleGroovyshPlugin"><a class="anchor" href="#GroovyShell-GradleGroovyshPlugin"></a><a class="link" href="#GroovyShell-GradleGroovyshPlugin">2.3.3. Gradle Groovysh Plugin</a></h4>
<div class="paragraph">
<p><a href="https://github.com/tkruse/gradle-groovysh-plugin">Gradle Groovysh Plugin</a> is a Gradle plugin that provides gradle tasks to start a Groovy Shell bound to a Gradle project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovyconsole_the_groovy_swing_console"><a class="anchor" href="#_groovyconsole_the_groovy_swing_console"></a><a class="link" href="#_groovyconsole_the_groovy_swing_console">2.4. groovyConsole, the Groovy swing console</a></h3>
<div class="sect3">
<h4 id="title-heading"><a class="anchor" href="#title-heading"></a><a class="link" href="#title-heading">2.4.1. Groovy : Groovy Console</a></h4>
<div class="paragraph">
<p>The Groovy Swing Console allows a user to enter and run Groovy scripts.
This page documents the features of this user interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Basics"><a class="anchor" href="#GroovyConsole-Basics"></a><a class="link" href="#GroovyConsole-Basics">2.4.2. Basics</a></h4>
<div class="paragraph">
<p><span class="image"><img src="assets/img/GroovyConsole.png.pagespeed.ce.p1PnWIdil4.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Groovy Console is launched via <code>groovyConsole</code> or
<code>groovyConsole.bat</code>, both located in <code>$GROOVY_HOME/bin</code></p>
</li>
<li>
<p>The Console has an input area and an output area.</p>
</li>
<li>
<p>You type a Groovy script in the input area.</p>
</li>
<li>
<p>When you select <code>Run</code> from the <code>Actions</code> menu, the console
compiles the script and runs it.</p>
</li>
<li>
<p>Anything that would normally be printed on <code>System.out</code> is printed in
the output area.</p>
</li>
<li>
<p>If the script returns a non-null result, that result is printed.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Features"><a class="anchor" href="#GroovyConsole-Features"></a><a class="link" href="#GroovyConsole-Features">2.4.3. Features</a></h4>
<div class="sect4">
<h5 id="GroovyConsole-Command-lineOptionsandArguments"><a class="anchor" href="#GroovyConsole-Command-lineOptionsandArguments"></a><a class="link" href="#GroovyConsole-Command-lineOptionsandArguments">Command-line Options and Arguments</a></h5>
<div class="paragraph">
<p>The Groovy Console supports several options to control classpath and other features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">./bin/groovyConsole --help
Usage: groovyConsole [options] [filename]
The Groovy Swing Console allows a user to enter and run Groovy scripts.
      --configscript=PARAM   A script for tweaking the compiler configuration options
      -cp, -classpath, --classpath
                             Specify where to find the class files - must be first
                               argument
  -D, --define=&lt;name=value&gt;  Define a system property
  -h, --help                 Display this help message
  -pa, --parameters          Generate metadata for reflection on method parameter
                               names (jdk8+ only)
  -pr, --enable-preview      Enable preview Java features (jdk12+ only)
  -V, --version              Display the version</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-RunningScripts"><a class="anchor" href="#GroovyConsole-RunningScripts"></a><a class="link" href="#GroovyConsole-RunningScripts">Running Scripts</a></h5>
<div class="paragraph">
<p>There are several shortcuts that you can use to run scripts or code snippets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Ctrl+Enter</code> and <code>Ctrl+R</code> are both shortcut keys for <code>Run Script</code>.</p>
</li>
<li>
<p>If you highlight just part of the text in the input area, then Groovy
runs just that text.</p>
</li>
<li>
<p>The result of a script is the value of the last expression
executed.</p>
</li>
<li>
<p>You can turn the System.out capture on and off by selecting <code>Capture
System.out</code> from the <code>Actions</code> menu</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-EditingFiles"><a class="anchor" href="#GroovyConsole-EditingFiles"></a><a class="link" href="#GroovyConsole-EditingFiles">Editing Files</a></h5>
<div class="paragraph">
<p>You can open any text file, edit it, run it (as a Groovy Script) and
then save it again when you are finished.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select <code>File &gt; Open</code> (shortcut key <code>ctrl+O</code>) to open a file</p>
</li>
<li>
<p>Select <code>File &gt; Save</code> (shortcut key <code>ctrl+S</code>) to save a file</p>
</li>
<li>
<p>Select <code>File &gt; New File</code> (shortcut key <code>ctrl+Q</code>) to start again with a
blank input area</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Historyandresults"><a class="anchor" href="#GroovyConsole-Historyandresults"></a><a class="link" href="#GroovyConsole-Historyandresults">History and results</a></h5>
<div class="ulist">
<ul>
<li>
<p>You can pop up a gui inspector on the last (non-null) result by
selecting <code>Inspect Last</code> from the <code>Actions</code> menu. The inspector is a
convenient way to view lists and maps.</p>
</li>
<li>
<p>The console remembers the last ten script runs. You can scroll back
and forth through the history by selecting <code>Next</code> and <code>Previous</code>
from the <code>Edit</code> menu. <code>Ctrl-N</code> and <code>ctrl-P</code> are convenient shortcut keys.</p>
</li>
<li>
<p>The last (non-null) result is bound to a variable named <code>_</code> (an
underscore).</p>
</li>
<li>
<p>The last result (null and non-null) for every run in the history is
bound into a list variable named <code><em></code> (two underscores). The result of
the last run is <code></em>[-1]</code>, the result of the second to last run is
<code>__[-2]</code> and so forth.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Interrupt"><a class="anchor" href="#GroovyConsole-Interrupt"></a><a class="link" href="#GroovyConsole-Interrupt">Interrupting a script</a></h5>
<div class="paragraph">
<p>The Groovy console is a very handy tool to develop scripts. Often, you will
find yourself running a script multiple times until it works the way you want
it to. However, what if your code takes too long to finish or worse, creates
an infinite loop? Interrupting script execution can be achieved by clicking
the <code>interrupt</code> button on the small dialog box that pops up when a script
is executing or through the <code>interrupt</code> icon in the toolbar.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xgconsole-toolbar.png.pagespeed.ic.Omrek7FGMP.png" alt="Toolbar"></span></p>
</div>
<div class="paragraph">
<p>However, this may not be sufficient to interrupt a script: clicking the button
will interrupt the execution thread, but if your code doesn&#8217;t handle the interrupt
flag, the script is likely to keep running without you being able to effectively
stop it. To avoid that, you have to make sure that the <code>Script &gt; Allow interruption</code>
menu item is flagged. This will automatically apply an AST transformation to your
script which will take care of checking the interrupt flag (<code>@ThreadInterrupt</code>).
This way, you guarantee that the script can be interrupted even if you don&#8217;t explicitly
handle interruption, at the cost of extra execution time.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Andmore"><a class="anchor" href="#GroovyConsole-Andmore"></a><a class="link" href="#GroovyConsole-Andmore">And more</a></h5>
<div class="ulist">
<ul>
<li>
<p>You can change the font size by selecting <code>Smaller Font</code> or <code>Larger
Font</code> from the <code>Actions menu</code></p>
</li>
<li>
<p>The console can be run as an Applet thanks to <code>groovy.ui.ConsoleApplet</code></p>
</li>
<li>
<p>Code is auto indented when you hit return</p>
</li>
<li>
<p>You can drag&#8217;n&#8217;drop a Groovy script over the text area to open a file</p>
</li>
<li>
<p>You can modify the classpath with which the script in the console is
being run by adding a new JAR or a directory to the classpath from the
<code>Script</code> menu</p>
</li>
<li>
<p>Error hyperlinking from the output area when a compilation error is
expected or when an exception is thrown</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-EmbeddingtheConsole"><a class="anchor" href="#GroovyConsole-EmbeddingtheConsole"></a><a class="link" href="#GroovyConsole-EmbeddingtheConsole">2.4.4. Embedding the Console</a></h4>
<div class="paragraph">
<p>To embed a Swing console in your application, simply create the Console
object, load some variables, and then launch it. The console can be embedded in
either Java or Groovy code. The Java code for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import groovy.ui.Console;

    ...
    Console console = new Console();
    console.setVariable("var1", getValueOfVar1());
    console.setVariable("var2", getValueOfVar2());
    console.run();
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the console is launched, you can use the variable values in Groovy
code.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Visualizingscriptoutputresults"><a class="anchor" href="#GroovyConsole-Visualizingscriptoutputresults"></a><a class="link" href="#GroovyConsole-Visualizingscriptoutputresults">2.4.5. Visualizing script output results</a></h4>
<div class="paragraph">
<p>You can customize the way script output results are visualized. Let’s
see how we can customize this. For example, viewing a map result would
show something like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xgconsole-sc-without-visu.png.pagespeed.ic.TSPo_5irME.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>What you see here is the usual textual representation of a Map. But,
what if we enabled custom visualization of certain results? The Swing
console allows you to do just that. First of all, you have to ensure
that the visualization option is ticked: <code>View &#8594; Visualize Script
Results</code> — for the record, all settings of the Groovy Console are stored
and remembered thanks to the Preference API. There are a few result
visualizations built-in: if the script returns a <code>java.awt.Image</code>, a
<code>javax.swing.Icon</code>, or a <code>java.awt.Component</code> with no parent, the object is
displayed instead of its <code>toString()</code> representation. Otherwise,
everything else is still just represented as text. Now, create the
following Groovy script in <code>~/.groovy/OutputTransforms.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import javax.swing.*

transforms &lt;&lt; { result -&gt;
    if (result instanceof Map) {
        def table = new JTable(
            result.collect{ k, v -&gt;
                [k, v?.inspect()] as Object[]
            } as Object[][],
            ['Key', 'Value'] as Object[])
        table.preferredViewportSize = table.preferredSize
        return new JScrollPane(table)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy Swing console will execute that script on startup, injecting
a transforms list in the binding of the script, so that you can add your
own script results representations. In our case, we transform the Map
into a nice-looking Swing JTable. We’re now able to visualize maps
in a friendly and attractive fashion, as the screenshot below shows:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xgconsole-sc-with-visu.png.pagespeed.ic.YFycZ79fuz.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-ASTbrowser"><a class="anchor" href="#GroovyConsole-ASTbrowser"></a><a class="link" href="#GroovyConsole-ASTbrowser">2.4.6. Advanced debugging: AST browser</a></h4>
<div class="paragraph">
<p>Groovy Console can visualize the AST (Abstract Syntax Tree) representing
the currently edited script, as shown by the screenshot below. This is
useful when you want to understand how an AST transformation
is working and particularly handy if you are developing your own AST transform.
In the example below, we have annotated our class with the <code>@Immutable</code> annotation
and the Groovy compiler has generated a lot of boilerplate code for us.
We can see the code for the generated equals method in the <code>Source</code> tab.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xastbrowser_source.png.pagespeed.ic.y0ASHxdKGR.png" alt="AST Browser"></span></p>
</div>
<div class="paragraph">
<p>We can even examine the JVM bytecode generated by the compiler.
In the image below we are looking at the bytecode for the Groovy
expression <code>LocalDate.parse('2020/02/10', 'yyyy/MM/dd')</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xastbrowser_bytecode.png.pagespeed.ic.KIfzkX37ZA.png" alt="AST Browser"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-CSTbrowser"><a class="anchor" href="#GroovyConsole-CSTbrowser"></a><a class="link" href="#GroovyConsole-CSTbrowser">2.4.7. Advanced debugging: CST browser</a></h4>
<div class="paragraph">
<p>Groovy Console can visualize the CST (Concrete Syntax Tree) representing
the initial parsing of the script. This is mainly useful for parsing gurus.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xcstbrowser.png.pagespeed.ic.MHPpiE_6oM.png" alt="CST Browser"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovydoc_the_groovy_java_documentation_generator"><a class="anchor" href="#_groovydoc_the_groovy_java_documentation_generator"></a><a class="link" href="#_groovydoc_the_groovy_java_documentation_generator">2.5. groovydoc, the Groovy &amp; Java documentation generator</a></h3>
<div class="paragraph">
<p>GroovyDoc is a tool responsible for generating documentation from your code. It acts like the Javadoc tool in the
Java world but is capable of handling both <code>groovy</code> and <code>java</code> files. The distribution comes with two ways of generating
documentation: from <a href="#Groovydoc-CommandLine">command line</a> or from <a href="#Groovydoc-Ant">Apache Ant</a>. Other build tools
like Maven or Gradle also offer wrappers for Groovydoc.</p>
</div>
<div class="sect3">
<h4 id="Groovydoc-CommandLine"><a class="anchor" href="#Groovydoc-CommandLine"></a><a class="link" href="#Groovydoc-CommandLine">2.5.1. The groovydoc command line tool</a></h4>
<div class="paragraph">
<p>The <code>groovydoc</code> command line can be invoked to generate groovydocs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovydoc [options] [packagenames] [sourcefiles]</pre>
</div>
</div>
<div class="paragraph">
<p>where options must be picked from the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-author</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include @author paragraphs (currently not used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-charset &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for cross-platform viewing of generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, -cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find the class files - must be
first argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--destdir &lt;dir&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination directory for output files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable debug output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-doctitle &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the overview page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-exclude &lt;pkglist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a list of packages to exclude
(separated by colons for all operating systems)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-fileEncoding &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for generated documentation files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-footer &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-header &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display help message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-nomainforscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t include the implicit 'public static void
main' method for scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-noscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t process Groovy Scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-notimestamp</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t include timestamp within hidden comment in generated HTML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-noversionstamp</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t include Groovy version within hidden comment in generated HTML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-overview &lt;file&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-package</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show package/protected/public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-private</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-protected</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show protected/public classes and members (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-public</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show only public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-quiet</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppress superfluous output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-sourcepath &lt;pathlist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find source files (dirs
separated by platform path separator)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-stylesheetfile &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to change style of the generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-verbose</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable verbose output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the version</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-windowtitle &lt;text&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="Groovydoc-Ant"><a class="anchor" href="#Groovydoc-Ant"></a><a class="link" href="#Groovydoc-Ant">2.5.2. The groovydoc Ant task</a></h4>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task allows generating groovydocs from an Ant build.</p>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-Requiredtaskdef"><a class="anchor" href="#ThegroovydocAnttask-Requiredtaskdef"></a><a class="link" href="#ThegroovydocAnttask-Requiredtaskdef">Required taskdef</a></h5>
<div class="paragraph">
<p>Assuming all the groovy jars you need are in <em>my.classpath</em> (this will be <code>groovy-VERSION.jar</code>,
<code>groovy-ant-VERSION.jar</code>, <code>groovy-groovydoc-VERSION.jar</code> plus any modules and transitive dependencies you might be using)
you will need to declare this task at some point in the build.xml prior to the groovydoc task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;taskdef name         = "groovydoc"
         classname    = "org.codehaus.groovy.ant.Groovydoc"
         classpathref = "my.classpath"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocAttributes"><a class="anchor" href="#ThegroovydocAnttask-groovydocAttributes"></a><a class="link" href="#ThegroovydocAnttask-groovydocAttributes">&lt;groovydoc&gt; Attributes</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packagenames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package files (with terminating
wildcard).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create class and package usage pages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windowtitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation (text).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">doctitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the package index(first) page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">footer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members (i.e. including private ones) if
set to ``true''.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocNestedElements"><a class="anchor" href="#ThegroovydocAnttask-groovydocNestedElements"></a><a class="link" href="#ThegroovydocAnttask-groovydocNestedElements">&lt;groovydoc&gt; Nested Elements</a></h5>
<div class="sect5">
<h6 id="ThegroovydocAnttask-link"><a class="anchor" href="#ThegroovydocAnttask-link"></a><a class="link" href="#ThegroovydocAnttask-link">link</a></h6>
<div class="paragraph">
<p>Create link to groovydoc/javadoc output at the given URL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package prefixes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">href</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base URL of external site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example1-groovydocAnttask"><a class="anchor" href="#ThegroovydocAnttask-Example1-groovydocAnttask"></a><a class="link" href="#ThegroovydocAnttask-Example1-groovydocAnttask">Example #1 - &lt;groovydoc&gt; Ant task</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;taskdef name           = "groovydoc"
         classname      = "org.codehaus.groovy.ant.Groovydoc"
         classpathref   = "path_to_groovy_all"/&gt;

&lt;groovydoc destdir      = "${docsDirectory}/gapi"
           sourcepath   = "${mainSourceDirectory}"
           packagenames = "**.*"
           use          = "true"
           windowtitle  = "${title}"
           doctitle     = "${title}"
           header       = "${title}"
           footer       = "${docFooter}"
           overview     = "src/main/overview.html"
           private      = "false"&gt;
        &lt;link packages="java.,org.xml.,javax.,org.xml." href="http://docs.oracle.com/javase/8/docs/api/"/&gt;
        &lt;link packages="org.apache.tools.ant."          href="http://docs.groovy-lang.org/docs/ant/api/"/&gt;
        &lt;link packages="org.junit.,junit.framework."    href="http://junit.org/junit4/javadoc/latest/"/&gt;
        &lt;link packages="groovy.,org.codehaus.groovy."   href="http://docs.groovy-lang.org/latest/html/api/"/&gt;
        &lt;link packages="org.codehaus.gmaven."           href="http://groovy.github.io/gmaven/apidocs/"/&gt;
&lt;/groovydoc&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy"><a class="anchor" href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy"></a><a class="link" href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy">Example #2 - Executing &lt;groovydoc&gt; from Groovy</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ant = new AntBuilder()
ant.taskdef(name: "groovydoc", classname: "org.codehaus.groovy.ant.Groovydoc")
ant.groovydoc(
    destdir      : "${docsDirectory}/gapi",
    sourcepath   : "${mainSourceDirectory}",
    packagenames : "**.*",
    use          : "true",
    windowtitle  : "${title}",
    doctitle     : "${title}",
    header       : "${title}",
    footer       : "${docFooter}",
    overview     : "src/main/overview.html",
    private      : "false") {
        link(packages:"java.,org.xml.,javax.,org.xml.",href:"http://docs.oracle.com/javase/8/docs/api/")
        link(packages:"groovy.,org.codehaus.groovy.",  href:"http://docs.groovy-lang.org/latest/html/api/")
        link(packages:"org.apache.tools.ant.",         href:"http://docs.groovy-lang.org/docs/ant/api/")
        link(packages:"org.junit.,junit.framework.",   href:"http://junit.org/junit4/javadoc/latest/")
        link(packages:"org.codehaus.gmaven.",          href:"http://groovy.github.io/gmaven/apidocs/")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_templates"><a class="anchor" href="#_custom_templates"></a><a class="link" href="#_custom_templates">Custom templates</a></h5>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task supports custom templates, but it requires two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A custom groovydoc class</p>
</li>
<li>
<p>A new groovydoc task definition</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="_custom_groovydoc_class"><a class="anchor" href="#_custom_groovydoc_class"></a><a class="link" href="#_custom_groovydoc_class">Custom Groovydoc class</a></h6>
<div class="paragraph">
<p>The first step requires you to extend the <code>Groovydoc</code> class, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package org.codehaus.groovy.tools.groovydoc;

import org.codehaus.groovy.ant.Groovydoc;

/**
 * Overrides GroovyDoc's default class template - for testing purpose only.
 */
public class CustomGroovyDoc extends Groovydoc {

    @Override
    protected String[] getClassTemplates() {
        return new String[]{"org/codehaus/groovy/tools/groovydoc/testfiles/classDocName.html"};
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getClassTemplates</code> for class-level templates</p>
</li>
<li>
<p><code>getPackageTemplates</code> for package-level templates</p>
</li>
<li>
<p><code>getDocTemplates</code> for top-level templates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find the list of default templates in the <code>org.codehaus.groovy.tools.groovydoc.gstringTemplates.GroovyDocTemplateInfo</code>
class.</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_custom_groovydoc_task"><a class="anchor" href="#_using_the_custom_groovydoc_task"></a><a class="link" href="#_using_the_custom_groovydoc_task">Using the custom groovydoc task</a></h6>
<div class="paragraph">
<p>Once you&#8217;ve written the class, using it is just a matter of redefining the <code>groovydoc</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;taskdef name           = "groovydoc"
         classname      = "org.codehaus.groovy.ant.CustomGroovyDoc"
         classpathref   = "path_to_groovy_all"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that template customization is provided as is. APIs are subject to change, so you must consider this as a
fragile feature.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Groovydoc-GMavenPlus"><a class="anchor" href="#Groovydoc-GMavenPlus"></a><a class="link" href="#Groovydoc-GMavenPlus">2.5.3. GMavenPlus Maven Plugin</a></h4>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a Maven plugin with goals that
support GroovyDoc generation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ide_integration"><a class="anchor" href="#_ide_integration"></a><a class="link" href="#_ide_integration">2.6. IDE integration</a></h3>
<div class="paragraph">
<p>Many IDEs and text editors support the Groovy programming language.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Editor</th>
<th class="tableblock halign-left valign-top">Syntax highlighting</th>
<th class="tableblock halign-left valign-top">Code completion</th>
<th class="tableblock halign-left valign-top">Refactoring</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/groovy/groovy-eclipse">Groovy Eclipse Plugin</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.jetbrains.com/idea/features/groovy.html">IntelliJ IDEA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/features/groovy/">Netbeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/Groovy-Emacs-Modes/groovy-emacs-modes">Groovy Emacs Modes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/textmate/groovy.tmbundle">TextMate</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.vim.org/">vim</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ultraedit.com/">UltraEdit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.slickedit.com/products/slickedit/419-the-most-powerful-groovy-editor-in-the-world/">SlickEdit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://editrocket.com/features/groovy_editor.html">EditRocket</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://code.visualstudio.com/">VSCode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://marketplace.visualstudio.com/items?itemName=NicolasVuillamy.vscode-groovy-lint">Yes</a></p></td>
</tr>
</tfoot>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guides"><a class="anchor" href="#_user_guides"></a><a class="link" href="#_user_guides">3. User Guides</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_started"><a class="anchor" href="#_getting_started"></a><a class="link" href="#_getting_started">3.1. Getting started</a></h3>
<div class="sect3">
<h4 id="_download"><a class="anchor" href="#_download"></a><a class="link" href="#_download">3.1.1. Download</a></h4>
<div class="paragraph">
<p>From the <a href="https://groovy.apache.org/download.html">download</a> page,
you will be able to download the distribution (binary and source),
the Windows installer (a community artifact) and the documentation for <strong>Groovy</strong>.</p>
</div>
<div class="paragraph">
<p>For a quick and effortless start on Mac OSX, Linux, WSL2 or Cygwin, you can use <a href="https://sdkman.io/">SDKMAN!</a>
(The Software Development Kit Manager) to download and configure any <strong>Groovy</strong> version of your choice.
Basic <a href="#SDKMAN">instructions</a> can be found below.</p>
</div>
<div class="sect4">
<h5 id="_stable"><a class="anchor" href="#_stable"></a><a class="link" href="#_stable">Stable</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Download zip</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-binary-4.0.15.zip"><strong>Binary Release</strong></a> | <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-src-4.0.15.zip">Source Release</a></p>
</li>
<li>
<p><strong>Download documentation</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-docs-4.0.15.zip"><strong>JavaDoc and zipped online documentation</strong></a></p>
</li>
<li>
<p><strong>Combined binary / source / documentation bundle</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-sdk-4.0.15.zip"><strong>Distribution bundle</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about this version in the <a href="https://groovy-lang.org/releasenotes/groovy-4.0.html">release notes</a> or in the <a href="https://groovy-lang.org/changelogs/changelog-4.0.15.html">changelog</a>.</p>
</div>
<div class="paragraph">
<p>If you plan on using invokedynamic support, <a href="invokedynamic-support.html">read those notes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_snapshots"><a class="anchor" href="#_snapshots"></a><a class="link" href="#_snapshots">Snapshots</a></h5>
<div class="paragraph">
<p>For those who want to test the very latest versions of Groovy and live on the bleeding edge, you can use our <a href="https://repository.apache.org/content/groups/snapshots/org/apache/groovy">snapshot builds</a>.
As soon as a build succeeds on our continuous integration server a snapshot is deployed to this repository.
These snapshots are not official releases and are intended for integration testing by the development
community prior to official versions being released. We welcome any feedback.</p>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">Prerequisites</a></h5>
<div class="paragraph">
<p>Groovy 4.0 requires Java 8+ with support for up to Java 16.</p>
</div>
<div class="paragraph">
<p>Various Groovy CI servers run the test suite (with more than 10000 tests) across numerous versions of Java.
Those servers are also useful to look at to confirm supported Java versions for different Groovy releases.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_repository"><a class="anchor" href="#_maven_repository"></a><a class="link" href="#_maven_repository">3.1.2. Maven Repository</a></h4>
<div class="paragraph">
<p>If you wish to embed Groovy in your application, you may just prefer to point your build
to your favourite maven repository or the Groovy <a href="https://groovy.jfrog.io/artifactory/libs-release-local/">artifactory instance</a>.
Please see the <a href="https://groovy.apache.org/download.html#buildtools">download page</a> for available modules for each Groovy version.</p>
</div>
</div>
<div class="sect3">
<h4 id="SDKMAN"><a class="anchor" href="#SDKMAN"></a><a class="link" href="#SDKMAN">3.1.3. SDKMAN! (The Software Development Kit Manager)</a></h4>
<div class="paragraph">
<p>This tool makes installing Groovy on any Bash platform (Mac OSX, Linux, Cygwin, Solaris or FreeBSD) very easy.</p>
</div>
<div class="paragraph">
<p>Simply open a new terminal and enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">$ curl -s get.sdkman.io | bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the instructions on-screen to complete installation.</p>
</div>
<div class="paragraph">
<p>Open a new terminal or type the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">$ source "$HOME/.sdkman/bin/sdkman-init.sh"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the latest stable Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">$ sdk install groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>After installation is complete and you&#8217;ve made it your default version, test it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">$ groovy -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all there is to it!</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_ways_to_get_groovy"><a class="anchor" href="#_other_ways_to_get_groovy"></a><a class="link" href="#_other_ways_to_get_groovy">3.1.4. Other ways to get Groovy</a></h4>
<div class="sect4">
<h5 id="_installation_on_mac_os_x"><a class="anchor" href="#_installation_on_mac_os_x"></a><a class="link" href="#_installation_on_mac_os_x">Installation on Mac OS X</a></h5>
<div class="sect5">
<h6 id="_macports"><a class="anchor" href="#_macports"></a><a class="link" href="#_macports">MacPorts</a></h6>
<div class="paragraph">
<p>If you&#8217;re on macOS and have <a href="https://www.macports.org">MacPorts</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">sudo port install groovy</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_homebrew"><a class="anchor" href="#_homebrew"></a><a class="link" href="#_homebrew">Homebrew</a></h6>
<div class="paragraph">
<p>If you&#8217;re on macOS and have <a href="https://mxcl.github.com/homebrew">Homebrew</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">brew install groovy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_installation_on_windows"><a class="anchor" href="#_installation_on_windows"></a><a class="link" href="#_installation_on_windows">Installation on Windows</a></h5>
<div class="paragraph">
<p>If you&#8217;re on Windows, you can also use the <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-windows-installer/">Windows installer</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_distributions"><a class="anchor" href="#_other_distributions"></a><a class="link" href="#_other_distributions">Other Distributions</a></h5>
<div class="paragraph">
<p>You may download other distributions of Groovy from the ASF
<a href="https://archive.apache.org/dist/groovy/">archive repository</a>
or from the Groovy
<a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/">artifactory instance</a> (also includes pre-ASF versions).</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_code"><a class="anchor" href="#_source_code"></a><a class="link" href="#_source_code">Source Code</a></h5>
<div class="paragraph">
<p>If you prefer to live on the bleeding edge, you can also grab the <a href="https://github.com/apache/groovy">source code from GitHub</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ide_plugin"><a class="anchor" href="#_ide_plugin"></a><a class="link" href="#_ide_plugin">IDE plugin</a></h5>
<div class="paragraph">
<p>If you are an IDE user, you can just grab the latest <a href="tools-ide.html">IDE plugin</a> and follow the plugin installation instructions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_binary"><a class="anchor" href="#_install_binary"></a><a class="link" href="#_install_binary">3.1.5. Install Binary</a></h4>
<div class="paragraph">
<p>These instructions describe how to install a binary distribution of <strong>Groovy</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://groovy.apache.org/download.html">Download</a> a binary distribution of Groovy and unpack it into some folder on your local file system.</p>
</li>
<li>
<p>Set your <code>GROOVY_HOME</code> environment variable to the directory where you unpacked the distribution.</p>
</li>
<li>
<p>Add <code>GROOVY_HOME/bin</code> to your <code>PATH</code> environment variable.</p>
</li>
<li>
<p>Set your <code>JAVA_HOME</code> environment variable to point to your JDK. On OS X this is <code>/Library/Java/Home</code>, on other unixes its often <code>/usr/java</code> etc. If you&#8217;ve already installed tools like Ant or Maven you&#8217;ve probably already done this step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should now have Groovy installed properly. You can test this by typing the following in a command shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">groovysh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which should create an interactive groovy shell where you can type Groovy statements. Or to run the <a href="#title-heading">Swing interactive console</a> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">groovyConsole</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a specific Groovy script type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">groovy SomeScript</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_with_java"><a class="anchor" href="#_differences_with_java"></a><a class="link" href="#_differences_with_java">3.2. Differences with Java</a></h3>
<div class="paragraph">
<p>Groovy tries to be as natural as possible for Java developers. We’ve
tried to follow the principle of least surprise when designing Groovy,
particularly for developers learning Groovy who’ve come from a Java
background.</p>
</div>
<div class="paragraph">
<p>Here we list all the major differences between Java and Groovy.</p>
</div>
<div class="sect3">
<h4 id="_default_imports_2"><a class="anchor" href="#_default_imports_2"></a><a class="link" href="#_default_imports_2">3.2.1. Default imports</a></h4>
<div class="paragraph">
<p>All these packages and classes are imported by default, i.e. you do not
have to use an explicit <code>import</code> statement to use them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java.io.*</p>
</li>
<li>
<p>java.lang.*</p>
</li>
<li>
<p>java.math.BigDecimal</p>
</li>
<li>
<p>java.math.BigInteger</p>
</li>
<li>
<p>java.net.*</p>
</li>
<li>
<p>java.util.*</p>
</li>
<li>
<p>groovy.lang.*</p>
</li>
<li>
<p>groovy.util.*</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_multi_methods"><a class="anchor" href="#_multi_methods"></a><a class="link" href="#_multi_methods">3.2.2. Multi-methods</a></h4>
<div class="paragraph">
<p>In Groovy, the methods which will be invoked are chosen at runtime. This is called runtime dispatch or multi-methods. It
means that the method will be chosen based on the types of the arguments at runtime. In Java, this is the opposite: methods
are chosen at compile time, based on the declared types.</p>
</div>
<div class="paragraph">
<p>The following code, written as Java code, can be compiled in both Java and Groovy, but it will behave differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">int method(String arg) {
    return 1;
}
int method(Object arg) {
    return 2;
}
Object o = "Object";
int result = method(o);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, you would have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">assertEquals(2, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">assertEquals(1, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is because Java will use the static information type, which is that <code>o</code> is declared as an <code>Object</code>, whereas
Groovy will choose at runtime, when the method is actually called. Since it is called with a <code>String</code>, then the
<code>String</code> version is called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_array_initializers"><a class="anchor" href="#_array_initializers"></a><a class="link" href="#_array_initializers">3.2.3. Array initializers</a></h4>
<div class="paragraph">
<p>In Java, array initializers take either of these two forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">int[] array = {1, 2, 3};             // Java array initializer shorthand syntax
int[] array2 = new int[] {4, 5, 6};  // Java array initializer long syntax</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Groovy, the <code>{ &#8230;&#8203; }</code> block is reserved for closures.
That means that you cannot create array literals using Java&#8217;s array initializer shorthand syntax.
You instead borrow Groovy&#8217;s literal list notation like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int[] array = [1, 2, 3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy 3+, you can optionally use the Java&#8217;s array initializer long syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def array2 = new int[] {1, 2, 3} // Groovy 3.0+ supports the Java-style array initialization long syntax</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_scope_visibility"><a class="anchor" href="#_package_scope_visibility"></a><a class="link" href="#_package_scope_visibility">3.2.4. Package scope visibility</a></h4>
<div class="paragraph">
<p>In Groovy, omitting a modifier on a field doesn&#8217;t result in a package-private field like in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, it is used to create a <em>property</em>, that is to say a <em>private field</em>, an associated <em>getter</em> and an associated
<em>setter</em>.</p>
</div>
<div class="paragraph">
<p>It is possible to create a package-private field by annotating it with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    @PackageScope String name
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arm_blocks"><a class="anchor" href="#_arm_blocks"></a><a class="link" href="#_arm_blocks">3.2.5. ARM blocks</a></h4>
<div class="paragraph">
<p>Java 7 introduced ARM (Automatic Resource Management) blocks (also know as try-with-resources) blocks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Path file = Paths.get("/path/to/file");
Charset charset = Charset.forName("UTF-8");
try (BufferedReader reader = Files.newBufferedReader(file, charset)) {
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }

} catch (IOException e) {
    e.printStackTrace();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such blocks are supported from Groovy 3+.
However, Groovy provides various methods relying on closures, which have the same effect while being more idiomatic. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File('/path/to/file').eachLine('UTF-8') {
   println it
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if you want a version closer to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File('/path/to/file').withReader('UTF-8') { reader -&gt;
   reader.eachLine {
       println it
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inner_classes"><a class="anchor" href="#_inner_classes"></a><a class="link" href="#_inner_classes">3.2.6. Inner classes</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The implementation of anonymous inner classes and nested classes follow Java closely,
but there are some differences, e.g.
local variables accessed from within such classes don&#8217;t have to be final.
We piggyback on some implementation details we use for <code>groovy.lang.Closure</code>
when generating inner class bytecode.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_static_inner_classes"><a class="anchor" href="#_static_inner_classes"></a><a class="link" href="#_static_inner_classes">Static inner classes</a></h5>
<div class="paragraph">
<p>Here&#8217;s an example of static inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class A {
    static class B {}
}

new A.B()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The usage of static inner classes is the best supported one. If you
absolutely need an inner class, you should make it a static one.</p>
</div>
</div>
<div class="sect4">
<h5 id="_anonymous_inner_classes"><a class="anchor" href="#_anonymous_inner_classes"></a><a class="link" href="#_anonymous_inner_classes">Anonymous Inner Classes</a></h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.concurrent.CountDownLatch
import java.util.concurrent.TimeUnit

CountDownLatch called = new CountDownLatch(1)

Timer timer = new Timer()
timer.schedule(new TimerTask() {
    void run() {
        called.countDown()
    }
}, 0)

assert called.await(10, TimeUnit.SECONDS)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_creating_instances_of_non_static_inner_classes"><a class="anchor" href="#_creating_instances_of_non_static_inner_classes"></a><a class="link" href="#_creating_instances_of_non_static_inner_classes">Creating Instances of Non-Static Inner Classes</a></h5>
<div class="paragraph">
<p>In Java you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Y {
    public class X {}
    public X foo() {
        return new X();
    }
    public static X createX(Y y) {
        return y.new X();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before 3.0.0, Groovy doesn&#8217;t support the <code>y.new X()</code> syntax. Instead, you have to write <code>new X(y)</code>, like in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class Y {
    public class X {}
    public X foo() {
        return new X()
    }
    public static X createX(Y y) {
        return new X(y)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Caution though, Groovy supports calling methods with one
parameter without giving an argument. The parameter will then have the
value null. Basically the same rules apply to calling a constructor.
There is a danger that you will write new X() instead of new X(this) for
example. Since this might also be the regular way we have not yet found
a good way to prevent this problem.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy 3.0.0 supports Java style syntax for creating instances of non-static inner classes.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lambda_expressions_and_the_method_reference_operator"><a class="anchor" href="#_lambda_expressions_and_the_method_reference_operator"></a><a class="link" href="#_lambda_expressions_and_the_method_reference_operator">3.2.7. Lambda expressions and the method reference operator</a></h4>
<div class="paragraph">
<p>Java 8+ supports lambda expressions and the method reference operator (<code>::</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Runnable run = () -&gt; System.out.println("Run");  // Java
list.forEach(System.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy 3 and above also support these within the Parrot parser.
In earlier versions of Groovy you should use closures instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Runnable run = { println 'run' }
list.each { println it } // or list.each(this.&amp;println)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gstrings"><a class="anchor" href="#_gstrings"></a><a class="link" href="#_gstrings">3.2.8. GStrings</a></h4>
<div class="paragraph">
<p>As double-quoted string literals are interpreted as <code>GString</code> values, Groovy may fail
with compile error or produce subtly different code if a class with <code>String</code> literal
containing a dollar character is compiled with Groovy and Java compiler.</p>
</div>
<div class="paragraph">
<p>While typically, Groovy will auto-cast between <code>GString</code> and <code>String</code> if an API declares
the type of a parameter, beware of Java APIs that accept an <code>Object</code> parameter and then
check the actual type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_string_and_character_literals"><a class="anchor" href="#_string_and_character_literals"></a><a class="link" href="#_string_and_character_literals">3.2.9. String and Character literals</a></h4>
<div class="paragraph">
<p>Singly-quoted literals in Groovy are used for <code>String</code>, and double-quoted result in
<code>String</code> or <code>GString</code>, depending whether there is interpolation in the literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'c'.class == String
assert "c".class == String
assert "c${1}".class in GString</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy will automatically cast a single-character <code>String</code> to <code>char</code> only when assigning to
a variable of type <code>char</code>. When calling methods with arguments of type <code>char</code> we need
to either cast explicitly or make sure the value has been cast in advance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">char a = 'a'
assert Character.digit(a, 16) == 10: 'But Groovy does boxing'
assert Character.digit((char) 'a', 16) == 10

try {
  assert Character.digit('a', 16) == 10
  assert false: 'Need explicit cast'
} catch(MissingMethodException e) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports two styles of casting and in the case of casting to <code>char</code> there
are subtle differences when casting a multi-char strings. The Groovy style cast is
more lenient and will take the first character, while the C-style cast will fail
with exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// for single char strings, both are the same
assert ((char) "c").class == Character
assert ("c" as char).class == Character

// for multi char strings they are not
try {
  ((char) 'cx') == 'c'
  assert false: 'will fail - not castable'
} catch(GroovyCastException e) {
}
assert ('cx' as char) == 'c'
assert 'cx'.asType(char) == 'c'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_behaviour_of"><a class="anchor" href="#_behaviour_of"></a><a class="link" href="#_behaviour_of">3.2.10. Behaviour of <code>==</code></a></h4>
<div class="paragraph">
<p>In Java, <code>==</code> means equality of primitive types or identity for objects.
In Groovy, <code>==</code> means equality in all places.
For non-primitives, it translates to <code>a.compareTo(b) == 0</code>,
when evaluating equality for <code>Comparable</code> objects,
and <code>a.equals(b)</code> otherwise.</p>
</div>
<div class="paragraph">
<p>To check for identity (reference equality), use the <code>is</code> method: <code>a.is(b)</code>.
From Groovy 3, you can also use the <code>===</code> operator (or negated version): <code>a === b</code> (or <code>c !== d</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_primitives_and_wrappers"><a class="anchor" href="#_primitives_and_wrappers"></a><a class="link" href="#_primitives_and_wrappers">3.2.11. Primitives and wrappers</a></h4>
<div class="paragraph">
<p>In a pure object-oriented language, everything would be an object.
Java takes the stance that primitive types, such as int, boolean and double,
are used very frequently and worthy of special treatment.
Primitives can be efficiently stored and manipulated but can&#8217;t be used in all contexts where an object could be used.
Luckily, Java auto boxes and unboxes primitives when they are passed as parameters or used as return types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Main {           // Java

   float f1 = 1.0f;
   Float f2 = 2.0f;

   float add(Float a1, float a2) { return a1 + a2; }

   Float calc() { return add(f1, f2); } <i class="conum" data-value="1"></i><b>(1)</b>

    public static void main(String[] args) {
       Float calcResult = new Main().calc();
       System.out.println(calcResult); // =&gt; 3.0
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>add</code> method expects wrapper then primitive type arguments,
but we are supplying parameters with a primitive then wrapper type.
Similarly, the return type from <code>add</code> is primitive, but we need the wrapper type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy does the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Main {

    float f1 = 1.0f
    Float f2 = 2.0f

    float add(Float a1, float a2) { a1 + a2 }

    Float calc() { add(f1, f2) }
}

assert new Main().calc() == 3.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy, also supports primitives and object types, however, it goes a little further
in pushing OO purity; it tries hard to treat <em>everything</em> as an object.
Any primitive typed variable or field can be treated like an object, and it
will be <a href="core-object-orientation.html#_primitive_types">auto-wrapped</a> as needed.
While primitive types might be used under the covers,
their use should be indistinguishable from normal object use whenever possible,
and they will be boxed/unboxed as needed.</p>
</div>
<div class="paragraph">
<p>Here is a little example using Java trying to (incorrectly for Java) dereference a primitive <code>float</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Main {           // Java

    public float z1 = 0.0f;

    public static void main(String[] args){
      new Main().z1.equals(1.0f); // DOESN'T COMPILE, error: float cannot be dereferenced
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same example using Groovy compiles and runs successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Main {
    float z1 = 0.0f
}
assert !(new Main().z1.equals(1.0f))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because of Groovy&#8217;s additional use of un/boxing, it does not follow
Java&#8217;s behavior of widening taking priority over boxing.
Here&#8217;s an example using <code>int</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int i
m(i)

void m(long l) {           <i class="conum" data-value="1"></i><b>(1)</b>
    println "in m(long)"
}

void m(Integer i) {        <i class="conum" data-value="2"></i><b>(2)</b>
    println "in m(Integer)"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the method that Java would call, since widening has precedence over unboxing.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is the method Groovy actually calls, since all primitive references use their wrapper class.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="primitive-optimisation-numbers"><a class="anchor" href="#primitive-optimisation-numbers"></a><a class="link" href="#primitive-optimisation-numbers">Numeric Primitive Optimisation with <code>@CompileStatic</code></a></h5>
<div class="paragraph">
<p>Since Groovy converts to wrapper classes in more places, you might wonder
whether it produces less efficient bytecode for numeric expressions.
Groovy has a highly optimised set of classes for doing math computations.
When using <code>@CompileStatic</code>, expressions involving only primitives
uses the same bytecode that Java would use.</p>
</div>
</div>
<div class="sect4">
<h5 id="zero-edge-case"><a class="anchor" href="#zero-edge-case"></a><a class="link" href="#zero-edge-case">Positive/Negative zero edge case</a></h5>
<div class="paragraph">
<p>Java float/double operations for both primitives and wrapper classes follow the IEEE 754 standard
but there is an interesting edge case involving positive and negative zero.
The standard supports distinguishing between these two cases and while in many scenarios
programmers may not care about the difference, in some mathematical or data science scenarios
it is important to cater for the distinction.</p>
</div>
<div class="paragraph">
<p>For primitives, Java maps down onto a special
<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.dcmp_op">bytecode instruction</a>
when comparing such values which has the property that
"Positive zero and negative zero are considered equal".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="ruby">jshell&gt; float f1 = 0.0f
f1 ==&gt; 0.0

jshell&gt; float f2 = -0.0f
f2 ==&gt; -0.0

jshell&gt; f1 == f2
$3 ==&gt; true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the wrapper classes, e.g. <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html?java/base/java/lang/Float.html#equals(java.lang.Object)">java.base/java.lang.Float#equals(java.lang.Object)</a>,
the result is <code>false</code> for this same case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="ruby">jshell&gt; Float f1 = 0.0f
f1 ==&gt; 0.0

jshell&gt; Float f2 = -0.0f
f2 ==&gt; -0.0

jshell&gt; f1.equals(f2)
$3 ==&gt; false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy on the one hand tries to follow Java behavior closely, but on the other
switches automatically between primitives and wrapped equivalents in more places.
To avoid confusion we recommend the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you wish to distinguish between positive and negative zero, use the <code>equals</code>
method directly or cast any primitives to their wrapper equivalent before using <code>==</code>.</p>
</li>
<li>
<p>If you wish to ignore the difference between positive and negative zero, use the <code>equalsIgnoreZeroSign</code>
method directly or cast any non-primitives to their primitive equivalent before using <code>==</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These guidelines are illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">float f1 = 0.0f
float f2 = -0.0f
Float f3 = 0.0f
Float f4 = -0.0f

assert f1 == f2
assert (Float) f1 != (Float) f2

assert f3 != f4         <i class="conum" data-value="1"></i><b>(1)</b>
assert (float) f3 == (float) f4

assert !f1.equals(f2)
assert !f3.equals(f4)

assert f1.equalsIgnoreZeroSign(f2)
assert f3.equalsIgnoreZeroSign(f4)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recall that for non-primitives, <code>==</code> maps to <code>.equals()</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conversions"><a class="anchor" href="#_conversions"></a><a class="link" href="#_conversions">3.2.12. Conversions</a></h4>
<div class="paragraph">
<p>Java does automatic widening and narrowing
<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html">conversions</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Java Conversions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="8"><div class="content"><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>boolean</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>byte</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>short</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>char</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>int</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>long</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>float</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>double</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>'Y' indicates a conversion Java can make<br></p>
</li>
<li>
<p>'C' indicates a conversion Java can make when there is an explicit cast<br></p>
</li>
<li>
<p>'T` indicates a conversion Java can make but data is truncated<br></p>
</li>
<li>
<p>'N' indicates a conversion Java can&#8217;t make</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy expands greatly on this.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. Groovy Conversions</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="18"><div class="content"><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">boolean</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Boolean</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">byte</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Byte</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">short</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Short</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">char</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Character</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">int</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Integer</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">long</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Long</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">BigInteger</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">float</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Float</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">double</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Double</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">BigDecimal</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>boolean</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Boolean</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>byte</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Byte</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>short</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Short</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>char</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Character</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>int</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Integer</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>long</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Long</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>BigInteger</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>float</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Float</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>double</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Double</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>BigDecimal</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>'Y' indicates a conversion Groovy can make<br></p>
</li>
<li>
<p>'D' indicates a conversion Groovy can make when compiled dynamically or explicitly cast<br></p>
</li>
<li>
<p>'T' indicates a conversion Groovy can make but data is truncated<br></p>
</li>
<li>
<p>'B' indicates a boxing/unboxing operation<br></p>
</li>
<li>
<p>'N' indicates a conversion Groovy can&#8217;t make.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The truncation uses <a href="#the-groovy-truth">Groovy Truth</a> when converting to <code>boolean</code>/<code>Boolean</code>. Converting
from a number to a character casts the <code>Number.intvalue()</code> to <code>char</code>. Groovy constructs <code>BigInteger</code> and <code>BigDecimal</code>
using <code>Number.doubleValue()</code> when converting from a <code>Float</code> or <code>Double</code>, otherwise it constructs using <code>toString()</code>.
Other conversions have their behavior defined by <code>java.lang.Number</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extra_keywords"><a class="anchor" href="#_extra_keywords"></a><a class="link" href="#_extra_keywords">3.2.13. Extra keywords</a></h4>
<div class="paragraph">
<p>Groovy has many of the same keywords as Java and Groovy 3 and above also has the same <code>var</code> reserved type as Java.
In addition, Groovy has the following keywords:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>as</code></p>
</li>
<li>
<p><code>def</code></p>
</li>
<li>
<p><code>in</code></p>
</li>
<li>
<p><code>trait</code></p>
</li>
<li>
<p><code>it</code> // within closures</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy is less stringent than Java in that it allows some keywords to appear in places that would be illegal in Java,
e.g. the following is valid: <code>var var = [def: 1, as: 2, in: 3, trait: 4]</code>.
Never-the-less, you are discouraged from using the above keywords in places that might cause confusion even when
the compiler might be happy. In particular, avoid using them for variable, method and class names,
so our previous <code>var var</code> example would be considered poor style.</p>
</div>
<div class="paragraph">
<p>Additional documentation is available for <a href="#_keywords">keywords</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_development_kit"><a class="anchor" href="#_groovy_development_kit"></a><a class="link" href="#_groovy_development_kit">3.3. Groovy Development Kit</a></h3>
<div class="sect3">
<h4 id="_working_with_io"><a class="anchor" href="#_working_with_io"></a><a class="link" href="#_working_with_io">3.3.1. Working with IO</a></h4>
<div class="paragraph">
<p>Groovy provides a number of
<a href="gdk.html">helper methods</a> for working
with I/O. While you could use standard Java code in Groovy to deal with those,
Groovy provides much more convenient ways to handle files, streams, readers, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>In particular, you should take a look at methods added to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>java.io.File</code> class : <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html</a></p>
</li>
<li>
<p>the <code>java.io.InputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.OutputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.Reader</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html</a></p>
</li>
<li>
<p>the <code>java.io.Writer</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html</a></p>
</li>
<li>
<p>the <code>java.nio.file.Path</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section focuses on sample idiomatic constructs using helper methods available above but is not meant
to be a complete description of all available methods. For that, please read the <a href="gdk.html">GDK API</a>.</p>
</div>
<div class="sect4">
<h5 id="_reading_files"><a class="anchor" href="#_reading_files"></a><a class="link" href="#_reading_files">Reading files</a></h5>
<div class="paragraph">
<p>As a first example, let&#8217;s see how you would print all lines of a text file in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir, 'haiku.txt').eachLine { line -&gt;
    println line
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>eachLine</code> method is a method added to the <code>File</code> class automatically by Groovy and has many variants, for example
if you need to know the line number, you can use this variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir, 'haiku.txt').eachLine { line, nb -&gt;
    println "Line $nb: $line"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If for whatever reason an exception is thrown in the <code>eachLine</code> body, the method makes sure that the resource
is properly closed. This is true for all I/O resource methods that Groovy adds.</p>
</div>
<div class="paragraph">
<p>For example in some cases you will prefer to use a <code>Reader</code>, but still benefit from the automatic resource management
from Groovy. In the next example, the reader <strong>will</strong> be closed even if the exception occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def count = 0, MAXSIZE = 3
new File(baseDir,"haiku.txt").withReader { reader -&gt;
    while (reader.readLine()) {
        if (++count &gt; MAXSIZE) {
            throw new RuntimeException('Haiku should only have 3 verses')
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need to collect the lines of a text file into a list, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = new File(baseDir, 'haiku.txt').collect {it}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can even leverage the <code>as</code> operator to get the contents of the file into an array of lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def array = new File(baseDir, 'haiku.txt') as String[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>How many times did you have to get the contents of a file into a <code>byte[]</code> and how much code does it require? Groovy
makes it very easy actually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">byte[] contents = file.bytes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Working with I/O is not limited to dealing with files. In fact, a lot of operations rely on input/output streams,
hence why Groovy adds a lot of support methods to those, as you can see in the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html">documentation</a>.</p>
</div>
<div class="paragraph">
<p>As an example, you can obtain an <code>InputStream</code> from a <code>File</code> very easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def is = new File(baseDir,'haiku.txt').newInputStream()
// do something ...
is.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the inputstream. In Groovy it is in general a better
idea to use the <code>withInputStream</code> idiom that will take care of that for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir,'haiku.txt').withInputStream { stream -&gt;
    // do something ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_writing_files"><a class="anchor" href="#_writing_files"></a><a class="link" href="#_writing_files">Writing files</a></h5>
<div class="paragraph">
<p>Of course in some cases you won&#8217;t want to read but write a file. One of the options is to use a <code>Writer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir,'haiku.txt').withWriter('utf-8') { writer -&gt;
    writer.writeLine 'Into the ancient pond'
    writer.writeLine 'A frog jumps'
    writer.writeLine 'Water’s sound!'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But for such a simple example, using the <code>&lt;&lt;</code> operator would have been enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir,'haiku.txt') &lt;&lt; '''Into the ancient pond
A frog jumps
Water’s sound!'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we do not always deal with text contents, so you could use the <code>Writer</code> or directly write bytes as in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">file.bytes = [66,22,11]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also directly deal with output streams. For example, here is how you would create an output
stream to write into a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def os = new File(baseDir,'data.bin').newOutputStream()
// do something ...
os.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the output stream. Again it is in general a better
idea to use the <code>withOutputStream</code> idiom that will handle the exceptions and close the stream in any case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new File(baseDir,'data.bin').withOutputStream { stream -&gt;
    // do something ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_traversing_file_trees"><a class="anchor" href="#_traversing_file_trees"></a><a class="link" href="#_traversing_file_trees">Traversing file trees</a></h5>
<div class="paragraph">
<p>In scripting contexts it is a common task to traverse a file tree in order to find some specific files and do
something with them. Groovy provides multiple methods to do this. For example you can perform something on all files
of a directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dir.eachFile { file -&gt;                      <i class="conum" data-value="1"></i><b>(1)</b>
    println file.name
}
dir.eachFileMatch(~/.*\.txt/) { file -&gt;     <i class="conum" data-value="2"></i><b>(2)</b>
    println file.name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the closure code on each file found in the directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the closure code on files in the directory matching the specified pattern</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Often you will have to deal with a deeper hierarchy of files, in which case you can use <code>eachFileRecurse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dir.eachFileRecurse { file -&gt;                      <i class="conum" data-value="1"></i><b>(1)</b>
    println file.name
}

dir.eachFileRecurse(FileType.FILES) { file -&gt;      <i class="conum" data-value="2"></i><b>(2)</b>
    println file.name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the closure code on each file or directory found in the directory, recursively</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the closure code only on files, but recursively</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more complex traversal techniques you can use the <code>traverse</code> method, which requires you to set a special flag
indicating what to do with the traversal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dir.traverse { file -&gt;
    if (file.directory &amp;&amp; file.name=='bin') {
        FileVisitResult.TERMINATE                   <i class="conum" data-value="1"></i><b>(1)</b>
    } else {
        println file.name
        FileVisitResult.CONTINUE                    <i class="conum" data-value="2"></i><b>(2)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the current file is a directory and its name is <code>bin</code>, stop the traversal</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>otherwise print the file name and continue</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_data_and_objects"><a class="anchor" href="#_data_and_objects"></a><a class="link" href="#_data_and_objects">Data and objects</a></h5>
<div class="paragraph">
<p>In Java it is not uncommon to serialize and deserialize data using the <code>java.io.DataOutputStream</code> and
<code>java.io.DataInputStream</code> classes respectively. Groovy will make it even easier to deal with them. For example, you could
serialize data into a file and deserialize it using this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">boolean b = true
String message = 'Hello from Groovy'
// Serialize data into a file
file.withDataOutputStream { out -&gt;
    out.writeBoolean(b)
    out.writeUTF(message)
}
// ...
// Then read it back
file.withDataInputStream { input -&gt;
    assert input.readBoolean() == b
    assert input.readUTF() == message
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And similarly, if the data you want to serialize implements the <code>Serializable</code> interface, you can proceed with
an object output stream, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Person p = new Person(name:'Bob', age:76)
// Serialize data into a file
file.withObjectOutputStream { out -&gt;
    out.writeObject(p)
}
// ...
// Then read it back
file.withObjectInputStream { input -&gt;
    def p2 = input.readObject()
    assert p2.name == p.name
    assert p2.age == p.age
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="process-management"><a class="anchor" href="#process-management"></a><a class="link" href="#process-management">Executing External Processes</a></h5>
<div class="paragraph">
<p>The previous section described how easy it was to deal with files, readers or streams in Groovy. However in domains
like system administration or devops it is often required to communicate with external processes.</p>
</div>
<div class="paragraph">
<p>Groovy provides a simple way to execute command line processes. Simply
write the command line as a string and call the <code>execute()</code> method.
E.g., on a *nix machine (or a Windows machine with appropriate *nix
commands installed), you can execute this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def process = "ls -l".execute()             <i class="conum" data-value="1"></i><b>(1)</b>
println "Found text ${process.text}"        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the <code>ls</code> command in an external process</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>consume the output of the command and retrieve the text</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>execute()</code> method returns a <code>java.lang.Process</code> instance which will
subsequently allow the in/out/err streams to be processed and the exit
value from the process to be inspected etc.</p>
</div>
<div class="paragraph">
<p>e.g. here is the same command as above but we will now process the
resulting stream a line at a time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def process = "ls -l".execute()             <i class="conum" data-value="1"></i><b>(1)</b>
process.in.eachLine { line -&gt;               <i class="conum" data-value="2"></i><b>(2)</b>
    println line                            <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the <code>ls</code> command in an external process</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for each line of the input stream of the process</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>print the line</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth noting that <code>in</code> corresponds to an input stream to the standard output of the command. <code>out</code> will refer
to a stream where you can send data to the process (its standard input).</p>
</div>
<div class="paragraph">
<p>Remember that many commands are shell built-ins and need special
handling. So if you want a listing of files in a directory on a Windows
machine and write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def process = "dir".execute()
println "${process.text}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>you will receive an <code>IOException</code> saying  <em>Cannot run program "dir":
CreateProcess error=2, The system cannot find the file specified.</em></p>
</div>
<div class="paragraph">
<p>This is because <code>dir</code> is built-in to the Windows shell (<code>cmd.exe</code>) and
can’t be run as a simple executable. Instead, you will need to write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def process = "cmd /c dir".execute()
println "${process.text}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, because this functionality currently makes use of
<code>java.lang.Process</code> undercover, the deficiencies of that class
must be taken into consideration. In particular, the javadoc
for this class says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Because some native platforms only provide limited buffer size for
standard input and output streams, failure to promptly write the input
stream or read the output stream of the subprocess may cause the
subprocess to block, and even deadlock</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Because of this, Groovy provides some additional helper methods which
make stream handling for processes easier.</p>
</div>
<div class="paragraph">
<p>Here is how to gobble all of the output (including the error stream
output) from your process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p = "rm -f foo.tmp".execute([], tmpDir)
p.consumeProcessOutput()
p.waitFor()</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also variations of <code>consumeProcessOutput</code> that make use of <code>StringBuffer</code>, <code>InputStream</code>,
<code>OutputStream</code> etc&#8230;&#8203; For a complete list, please read the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Process.html">GDK API for java.lang.Process</a></p>
</div>
<div class="paragraph">
<p>In addition, there is a <code>pipeTo</code> command (mapped to <code>|</code>
to allow overloading) which lets the output stream of one process be fed
into the input stream of another process.</p>
</div>
<div class="paragraph">
<p>Here are some examples of use:</p>
</div>
<div class="listingblock">
<div class="title">Pipes in action</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">proc1 = 'ls'.execute()
proc2 = 'tr -d o'.execute()
proc3 = 'tr -d e'.execute()
proc4 = 'tr -d i'.execute()
proc1 | proc2 | proc3 | proc4
proc4.waitFor()
if (proc4.exitValue()) {
    println proc4.err.text
} else {
    println proc4.text
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Consuming errors</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sout = new StringBuilder()
def serr = new StringBuilder()
proc2 = 'tr -d o'.execute()
proc3 = 'tr -d e'.execute()
proc4 = 'tr -d i'.execute()
proc4.consumeProcessOutput(sout, serr)
proc2 | proc3 | proc4
[proc2, proc3].each { it.consumeProcessErrorStream(serr) }
proc2.withWriter { writer -&gt;
    writer &lt;&lt; 'testfile.groovy'
}
proc4.waitForOrKill(1000)
println "Standard output: $sout"
println "Standard error: $serr"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_collections"><a class="anchor" href="#_working_with_collections"></a><a class="link" href="#_working_with_collections">3.3.2. Working with collections</a></h4>
<div class="paragraph">
<p>Groovy provides native support for various collection types, including <a href="#Collections-Lists">lists</a>,
<a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>. Most of those are based on the Java
collection types and decorated with additional methods found in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>.</p>
</div>
<div class="sect4">
<h5 id="Collections-Lists"><a class="anchor" href="#Collections-Lists"></a><a class="link" href="#Collections-Lists">Lists</a></h5>
<div class="sect5">
<h6 id="_list_literals"><a class="anchor" href="#_list_literals"></a><a class="link" href="#_list_literals">List literals</a></h6>
<div class="paragraph">
<p>You can create lists as follows. Notice that <code>[]</code> is the empty list
expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = [5, 6, 7, 8]
assert list.get(2) == 7
assert list[2] == 7
assert list instanceof java.util.List

def emptyList = []
assert emptyList.size() == 0
emptyList.add(5)
assert emptyList.size() == 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each list expression creates an implementation of <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Of course lists can be used as a source to construct another list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list1 = ['a', 'b', 'c']
//construct a new list, seeded with the same items as in list1
def list2 = new ArrayList&lt;String&gt;(list1)

assert list2 == list1 // == checks that each corresponding element is the same

// clone() can also be called
def list3 = list1.clone()
assert list3 == list1</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list is an ordered collection of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = [5, 6, 7, 8]
assert list.size() == 4
assert list.getClass() == ArrayList     // the specific kind of list being used

assert list[2] == 7                     // indexing starts at 0
assert list.getAt(2) == 7               // equivalent method to subscript operator []
assert list.get(2) == 7                 // alternative method

list[2] = 9
assert list == [5, 6, 9, 8,]           // trailing comma OK

list.putAt(2, 10)                       // equivalent method to [] when value being changed
assert list == [5, 6, 10, 8]
assert list.set(2, 11) == 10            // alternative method that returns old value
assert list == [5, 6, 11, 8]

assert ['a', 1, 'a', 'a', 2.5, 2.5f, 2.5d, 'hello', 7g, null, 9 as byte]
//objects can be of different types; duplicates allowed

assert [1, 2, 3, 4, 5][-1] == 5             // use negative indices to count from the end
assert [1, 2, 3, 4, 5][-2] == 4
assert [1, 2, 3, 4, 5].getAt(-2) == 4       // getAt() available with negative index...
try {
    [1, 2, 3, 4, 5].get(-2)                 // but negative index not allowed with get()
    assert false
} catch (e) {
    assert e instanceof IndexOutOfBoundsException
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_as_a_boolean_expression"><a class="anchor" href="#_list_as_a_boolean_expression"></a><a class="link" href="#_list_as_a_boolean_expression">List as a boolean expression</a></h6>
<div class="paragraph">
<p>Lists can be evaluated as a <code>boolean</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ![]             // an empty list evaluates as false

//all other lists, irrespective of contents, evaluate as true
assert [1] &amp;&amp; ['a'] &amp;&amp; [0] &amp;&amp; [0.0] &amp;&amp; [false] &amp;&amp; [null]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_iterating_on_a_list"><a class="anchor" href="#_iterating_on_a_list"></a><a class="link" href="#_iterating_on_a_list">Iterating on a list</a></h6>
<div class="paragraph">
<p>Iterating on elements of a list is usually done calling the <code>each</code> and <code>eachWithIndex</code> methods, which execute code on each
item of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">[1, 2, 3].each {
    println "Item: $it" // `it` is an implicit parameter corresponding to the current element
}
['a', 'b', 'c'].eachWithIndex { it, i -&gt; // `it` is the current element, while `i` is the index
    println "$i: $it"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to iterating, it is often useful to create a new list by transforming each of its elements into
something else. This operation, often called mapping, is done in Groovy thanks to the <code>collect</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 2, 3].collect { it * 2 } == [2, 4, 6]

// shortcut syntax instead of collect
assert [1, 2, 3]*.multiply(2) == [1, 2, 3].collect { it.multiply(2) }

def list = [0]
// it is possible to give `collect` the list which collects the elements
assert [1, 2, 3].collect(list) { it * 2 } == [0, 2, 4, 6]
assert list == [0, 2, 4, 6]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_manipulating_lists"><a class="anchor" href="#_manipulating_lists"></a><a class="link" href="#_manipulating_lists">Manipulating lists</a></h6>
<div class="sect6">
<h7 id="List-Filtering"><a class="anchor" href="#List-Filtering"></a><a class="link" href="#List-Filtering">Filtering and searching</a></h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains a lot of methods on collections that enhance
the standard collections with pragmatic methods, some of which are illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 2, 3].find { it &gt; 1 } == 2           // find 1st element matching criteria
assert [1, 2, 3].findAll { it &gt; 1 } == [2, 3]   // find all elements matching critieria
assert ['a', 'b', 'c', 'd', 'e'].findIndexOf {      // find index of 1st element matching criteria
    it in ['c', 'e', 'g']
} == 2

assert ['a', 'b', 'c', 'd', 'c'].indexOf('c') == 2  // index returned
assert ['a', 'b', 'c', 'd', 'c'].indexOf('z') == -1 // index -1 means value not in list
assert ['a', 'b', 'c', 'd', 'c'].lastIndexOf('c') == 4

assert [1, 2, 3].every { it &lt; 5 }               // returns true if all elements match the predicate
assert ![1, 2, 3].every { it &lt; 3 }
assert [1, 2, 3].any { it &gt; 2 }                 // returns true if any element matches the predicate
assert ![1, 2, 3].any { it &gt; 3 }

assert [1, 2, 3, 4, 5, 6].sum() == 21                // sum anything with a plus() method
assert ['a', 'b', 'c', 'd', 'e'].sum {
    it == 'a' ? 1 : it == 'b' ? 2 : it == 'c' ? 3 : it == 'd' ? 4 : it == 'e' ? 5 : 0
    // custom value to use in sum
} == 15
assert ['a', 'b', 'c', 'd', 'e'].sum { ((char) it) - ((char) 'a') } == 10
assert ['a', 'b', 'c', 'd', 'e'].sum() == 'abcde'
assert [['a', 'b'], ['c', 'd']].sum() == ['a', 'b', 'c', 'd']

// an initial value can be provided
assert [].sum(1000) == 1000
assert [1, 2, 3].sum(1000) == 1006

assert [1, 2, 3].join('-') == '1-2-3'           // String joining
assert [1, 2, 3].inject('counting: ') {
    str, item -&gt; str + item                     // reduce operation
} == 'counting: 123'
assert [1, 2, 3].inject(0) { count, item -&gt;
    count + item
} == 6</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is idiomatic Groovy code for finding the maximum and minimum in a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = [9, 4, 2, 10, 5]
assert list.max() == 10
assert list.min() == 2

// we can also compare single characters, as anything comparable
assert ['x', 'y', 'a', 'z'].min() == 'a'

// we can use a closure to specify the sorting behaviour
def list2 = ['abc', 'z', 'xyzuvw', 'Hello', '321']
assert list2.max { it.size() } == 'xyzuvw'
assert list2.min { it.size() } == 'z'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to closures, you can use a <code>Comparator</code> to define the comparison criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Comparator mc = { a, b -&gt; a == b ? 0 : (a &lt; b ? -1 : 1) }

def list = [7, 4, 9, -6, -1, 11, 2, 3, -9, 5, -13]
assert list.max(mc) == 11
assert list.min(mc) == -13

Comparator mc2 = { a, b -&gt; a == b ? 0 : (Math.abs(a) &lt; Math.abs(b)) ? -1 : 1 }


assert list.max(mc2) == -13
assert list.min(mc2) == -1

assert list.max { a, b -&gt; a.equals(b) ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : 1 } == -13
assert list.min { a, b -&gt; a.equals(b) ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : 1 } == -1</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_adding_or_removing_elements"><a class="anchor" href="#_adding_or_removing_elements"></a><a class="link" href="#_adding_or_removing_elements">Adding or removing elements</a></h7>
<div class="paragraph">
<p>We can use <code>[]</code> to assign a new empty list and <code>&lt;&lt;</code> to append items to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = []
assert list.empty

list &lt;&lt; 5
assert list.size() == 1

list &lt;&lt; 7 &lt;&lt; 'i' &lt;&lt; 11
assert list == [5, 7, 'i', 11]

list &lt;&lt; ['m', 'o']
assert list == [5, 7, 'i', 11, ['m', 'o']]

//first item in chain of &lt;&lt; is target list
assert ([1, 2] &lt;&lt; 3 &lt;&lt; [4, 5] &lt;&lt; 6) == [1, 2, 3, [4, 5], 6]

//using leftShift is equivalent to using &lt;&lt;
assert ([1, 2, 3] &lt;&lt; 4) == ([1, 2, 3].leftShift(4))</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add to a list in many ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 2] + 3 + [4, 5] + 6 == [1, 2, 3, 4, 5, 6]
// equivalent to calling the `plus` method
assert [1, 2].plus(3).plus([4, 5]).plus(6) == [1, 2, 3, 4, 5, 6]

def a = [1, 2, 3]
a += 4      // creates a new list and assigns it to `a`
a += [5, 6]
assert a == [1, 2, 3, 4, 5, 6]

assert [1, *[222, 333], 456] == [1, 222, 333, 456]
assert [*[1, 2, 3]] == [1, 2, 3]
assert [1, [2, 3, [4, 5], 6], 7, [8, 9]].flatten() == [1, 2, 3, 4, 5, 6, 7, 8, 9]

def list = [1, 2]
list.add(3)
list.addAll([5, 4])
assert list == [1, 2, 3, 5, 4]

list = [1, 2]
list.add(1, 3) // add 3 just before index 1
assert list == [1, 3, 2]

list.addAll(2, [5, 4]) //add [5,4] just before index 2
assert list == [1, 3, 5, 4, 2]

list = ['a', 'b', 'z', 'e', 'u', 'v', 'g']
list[8] = 'x' // the [] operator is growing the list as needed
// nulls inserted if required
assert list == ['a', 'b', 'z', 'e', 'u', 'v', 'g', null, 'x']</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is however important that the <code>+</code> operator on a list is <strong>not mutating</strong>. Compared to <code>&lt;&lt;</code>, it will create a new
list, which is often not what you want and can lead to performance issues.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also contains methods allowing you to easily remove elements from a list by value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['a','b','c','b','b'] - 'c' == ['a','b','b','b']
assert ['a','b','c','b','b'] - 'b' == ['a','c']
assert ['a','b','c','b','b'] - ['b','c'] == ['a']

def list = [1,2,3,4,3,2,1]
list -= 3           // creates a new list by removing `3` from the original one
assert list == [1,2,4,2,1]
assert ( list -= [2,4] ) == [1,1]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to remove an element by passing its index to the <code>remove</code> method, in which case the list is mutated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = ['a','b','c','d','e','f','b','b','a']
assert list.remove(2) == 'c'        // remove the third element, and return it
assert list == ['a','b','d','e','f','b','b','a']</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you only want to remove the first element having the same value in a list, instead of removing all
elements, you can call the <code>remove</code> method passing the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list= ['a','b','c','b','b']
assert list.remove('c')             // remove 'c', and return true because element removed
assert list.remove('b')             // remove first 'b', and return true because element removed

assert ! list.remove('z')           // return false because no elements removed
assert list == ['a','b','b']</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are two <code>remove</code> methods available.  One that takes an integer and removes an element
by its index, and another that will remove the first element that matches the passed value.  So what should we
do when we have a list of integers?  In this case, you may wish to use <code>removeAt</code> to remove an element by its
index, and <code>removeElement</code> to remove the first element that matches a value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = [1,2,3,4,5,6,2,2,1]

assert list.remove(2) == 3          // this removes the element at index 2, and returns it
assert list == [1,2,4,5,6,2,2,1]

assert list.removeElement(2)        // remove first 2 and return true
assert list == [1,4,5,6,2,2,1]

assert ! list.removeElement(8)      // return false because 8 is not in the list
assert list == [1,4,5,6,2,2,1]

assert list.removeAt(1) == 4        // remove element at index 1, and return it
assert list == [1,5,6,2,2,1]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, <code>removeAt</code> and <code>removeElement</code> will work with lists of any type.</p>
</div>
<div class="paragraph">
<p>Additionally, removing all the elements in a list can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list= ['a',2,'c',4]
list.clear()
assert list == []</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_set_operations"><a class="anchor" href="#_set_operations"></a><a class="link" href="#_set_operations">Set operations</a></h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also includes methods making it easy to reason on sets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 'a' in ['a','b','c']             // returns true if an element belongs to the list
assert ['a','b','c'].contains('a')      // equivalent to the `contains` method in Java
assert [1,3,4].containsAll([1,4])       // `containsAll` will check that all elements are found

assert [1,2,3,3,3,3,4,5].count(3) == 4  // count the number of elements which have some value
assert [1,2,3,3,3,3,4,5].count {
    it%2==0                             // count the number of elements which match the predicate
} == 2

assert [1,2,4,6,8,10,12].intersect([1,3,6,9,12]) == [1,6,12]

assert [1,2,3].disjoint( [4,6,9] )
assert ![1,2,3].disjoint( [2,4,6] )</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_sorting"><a class="anchor" href="#_sorting"></a><a class="link" href="#_sorting">Sorting</a></h7>
<div class="paragraph">
<p>Working with collections often implies sorting. Groovy offers a variety of options to sort lists,
from using closures to comparators, as in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [6, 3, 9, 2, 7, 1, 5].sort() == [1, 2, 3, 5, 6, 7, 9]

def list = ['abc', 'z', 'xyzuvw', 'Hello', '321']
assert list.sort {
    it.size()
} == ['z', 'abc', '321', 'Hello', 'xyzuvw']

def list2 = [7, 4, -6, -1, 11, 2, 3, -9, 5, -13]
assert list2.sort { a, b -&gt; a == b ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : 1 } ==
        [-1, 2, 3, 4, 5, -6, 7, -9, 11, -13]

Comparator mc = { a, b -&gt; a == b ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : 1 }

// JDK 8+ only
// list2.sort(mc)
// assert list2 == [-1, 2, 3, 4, 5, -6, 7, -9, 11, -13]

def list3 = [6, -3, 9, 2, -7, 1, 5]

Collections.sort(list3)
assert list3 == [-7, -3, 1, 2, 5, 6, 9]

Collections.sort(list3, mc)
assert list3 == [1, 2, -3, 5, 6, -7, 9]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_duplicating_elements"><a class="anchor" href="#_duplicating_elements"></a><a class="link" href="#_duplicating_elements">Duplicating elements</a></h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also takes advantage of operator overloading to provide methods allowing duplication of elements
of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 2, 3] * 3 == [1, 2, 3, 1, 2, 3, 1, 2, 3]
assert [1, 2, 3].multiply(2) == [1, 2, 3, 1, 2, 3]
assert Collections.nCopies(3, 'b') == ['b', 'b', 'b']

// nCopies from the JDK has different semantics than multiply for lists
assert Collections.nCopies(2, [1, 2]) == [[1, 2], [1, 2]] //not [1,2,1,2]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Maps"><a class="anchor" href="#Collections-Maps"></a><a class="link" href="#Collections-Maps">Maps</a></h5>
<div class="sect5">
<h6 id="_map_literals"><a class="anchor" href="#_map_literals"></a><a class="link" href="#_map_literals">Map literals</a></h6>
<div class="paragraph">
<p>In Groovy, maps (also known as associative arrays) can be created using the map literal syntax: <code>[:]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [name: 'Gromit', likes: 'cheese', id: 1234]
assert map.get('name') == 'Gromit'
assert map.get('id') == 1234
assert map['name'] == 'Gromit'
assert map['id'] == 1234
assert map instanceof java.util.Map

def emptyMap = [:]
assert emptyMap.size() == 0
emptyMap.put("foo", 5)
assert emptyMap.size() == 1
assert emptyMap.get("foo") == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Map keys are strings by default: <code>[a:1]</code> is equivalent to <code>['a':1]</code>. This can be confusing if you define a variable
named <code>a</code> and that you want the <strong>value</strong> of <code>a</code> to be the key in your map. If this is the case, then you <strong>must</strong> escape
the key by adding parenthesis, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def a = 'Bob'
def ages = [a: 43]
assert ages['Bob'] == null // `Bob` is not found
assert ages['a'] == 43     // because `a` is a literal!

ages = [(a): 43]            // now we escape `a` by using parenthesis
assert ages['Bob'] == 43   // and the value is found!</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to map literals, it is possible, to get a new copy of a map, to clone it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [
        simple : 123,
        complex: [a: 1, b: 2]
]
def map2 = map.clone()
assert map2.get('simple') == map.get('simple')
assert map2.get('complex') == map.get('complex')
map2.get('complex').put('c', 3)
assert map.get('complex').get('c') == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting map is a <strong>shallow</strong> copy of the original one, as illustrated in the previous example.</p>
</div>
</div>
<div class="sect5">
<h6 id="_map_property_notation"><a class="anchor" href="#_map_property_notation"></a><a class="link" href="#_map_property_notation">Map property notation</a></h6>
<div class="paragraph">
<p>Maps also act like beans so you can use the property notation to get/set
items inside the <code>Map</code> as long as the keys are strings which are valid
Groovy identifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [name: 'Gromit', likes: 'cheese', id: 1234]
assert map.name == 'Gromit'     // can be used instead of map.get('name')
assert map.id == 1234

def emptyMap = [:]
assert emptyMap.size() == 0
emptyMap.foo = 5
assert emptyMap.size() == 1
assert emptyMap.foo == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: by design <code>map.foo</code> will always look for the key <code>foo</code> in the map. This
means <code>foo.class</code> will return <code>null</code> on a map that doesn&#8217;t contain the <code>class</code> key. Should you really want to know
the class, then you must use <code>getClass()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [name: 'Gromit', likes: 'cheese', id: 1234]
assert map.class == null
assert map.get('class') == null
assert map.getClass() == LinkedHashMap // this is probably what you want

map = [1      : 'a',
       (true) : 'p',
       (false): 'q',
       (null) : 'x',
       'null' : 'z']
assert map.containsKey(1) // 1 is not an identifier so used as is
assert map.true == null
assert map.false == null
assert map.get(true) == 'p'
assert map.get(false) == 'q'
assert map.null == 'z'
assert map.get(null) == 'x'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_iterating_on_maps"><a class="anchor" href="#_iterating_on_maps"></a><a class="link" href="#_iterating_on_maps">Iterating on maps</a></h6>
<div class="paragraph">
<p>As usual in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>, idiomatic iteration on maps makes use of the <code>each</code> and <code>eachWithIndex</code> methods.
It&#8217;s worth noting that maps created using the map literal notation are <strong>ordered</strong>, that is to say that if you iterate
on map entries, it is guaranteed that the entries will be returned in the same order they were added in the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [
        Bob  : 42,
        Alice: 54,
        Max  : 33
]

// `entry` is a map entry
map.each { entry -&gt;
    println "Name: $entry.key Age: $entry.value"
}

// `entry` is a map entry, `i` the index in the map
map.eachWithIndex { entry, i -&gt;
    println "$i - Name: $entry.key Age: $entry.value"
}

// Alternatively you can use key and value directly
map.each { key, value -&gt;
    println "Name: $key Age: $value"
}

// Key, value and i as the index in the map
map.eachWithIndex { key, value, i -&gt;
    println "$i - Name: $key Age: $value"
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_manipulating_maps"><a class="anchor" href="#_manipulating_maps"></a><a class="link" href="#_manipulating_maps">Manipulating maps</a></h6>
<div class="sect6">
<h7 id="_adding_or_removing_elements_2"><a class="anchor" href="#_adding_or_removing_elements_2"></a><a class="link" href="#_adding_or_removing_elements_2">Adding or removing elements</a></h7>
<div class="paragraph">
<p>Adding an element to a map can be done either using the <code>put</code> method, the subscript operator or using <code>putAll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def defaults = [1: 'a', 2: 'b', 3: 'c', 4: 'd']
def overrides = [2: 'z', 5: 'x', 13: 'x']

def result = new LinkedHashMap(defaults)
result.put(15, 't')
result[17] = 'u'
result.putAll(overrides)
assert result == [1: 'a', 2: 'z', 3: 'c', 4: 'd', 5: 'x', 13: 'x', 15: 't', 17: 'u']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing all the elements of a map can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def m = [1:'a', 2:'b']
assert m.get(1) == 'a'
m.clear()
assert m == [:]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maps generated using the map literal syntax are using the object <code>equals</code> and <code>hashcode</code> methods. This means that
you should <strong>never</strong> use an object which hash code is subject to change over time, or you wouldn&#8217;t be able to get
the associated value back.</p>
</div>
<div class="paragraph">
<p>It is also worth noting that you should <strong>never</strong> use a <code>GString</code> as the key of a map, because the hash code of a <code>GString</code>
is not the same as the hash code of an equivalent <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def key = 'some key'
def map = [:]
def gstringKey = "${key.toUpperCase()}"
map.put(gstringKey,'value')
assert map.get('SOME KEY') == null</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="JN1035-Maps-Collectionviewsofamap"><a class="anchor" href="#JN1035-Maps-Collectionviewsofamap"></a><a class="link" href="#JN1035-Maps-Collectionviewsofamap">Keys, values and entries</a></h7>
<div class="paragraph">
<p>We can inspect the keys, values, and entries in a view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def map = [1:'a', 2:'b', 3:'c']

def entries = map.entrySet()
entries.each { entry -&gt;
  assert entry.key in [1,2,3]
  assert entry.value in ['a','b','c']
}

def keys = map.keySet()
assert keys == [1,2,3] as Set</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutating values returned by the view (be it a map entry, a key or a value) is highly discouraged because success
of the operation directly depends on the type of the map being manipulated. In particular, Groovy relies on collections
from the JDK that in general make no guarantee that a collection can safely be manipulated through <code>keySet</code>, <code>entrySet</code>, or
<code>values</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_filtering_and_searching"><a class="anchor" href="#_filtering_and_searching"></a><a class="link" href="#_filtering_and_searching">Filtering and searching</a></h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains filtering, searching and collecting methods similar to those found
for <a href="#List-Filtering">lists</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def people = [
    1: [name:'Bob', age: 32, gender: 'M'],
    2: [name:'Johnny', age: 36, gender: 'M'],
    3: [name:'Claire', age: 21, gender: 'F'],
    4: [name:'Amy', age: 54, gender:'F']
]

def bob = people.find { it.value.name == 'Bob' } // find a single entry
def females = people.findAll { it.value.gender == 'F' }

// both return entries, but you can use collect to retrieve the ages for example
def ageOfBob = bob.value.age
def agesOfFemales = females.collect {
    it.value.age
}

assert ageOfBob == 32
assert agesOfFemales == [21,54]

// but you could also use a key/pair value as the parameters of the closures
def agesOfMales = people.findAll { id, person -&gt;
    person.gender == 'M'
}.collect { id, person -&gt;
    person.age
}
assert agesOfMales == [32, 36]

// `every` returns true if all entries match the predicate
assert people.every { id, person -&gt;
    person.age &gt; 18
}

// `any` returns true if any entry matches the predicate

assert people.any { id, person -&gt;
    person.age == 54
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Maps-Grouping"><a class="anchor" href="#Maps-Grouping"></a><a class="link" href="#Maps-Grouping">Grouping</a></h7>
<div class="paragraph">
<p>We can group a list into a map using some criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['a', 7, 'b', [2, 3]].groupBy {
    it.class
} == [(String)   : ['a', 'b'],
      (Integer)  : [7],
      (ArrayList): [[2, 3]]
]

assert [
        [name: 'Clark', city: 'London'], [name: 'Sharma', city: 'London'],
        [name: 'Maradona', city: 'LA'], [name: 'Zhang', city: 'HK'],
        [name: 'Ali', city: 'HK'], [name: 'Liu', city: 'HK'],
].groupBy { it.city } == [
        London: [[name: 'Clark', city: 'London'],
                 [name: 'Sharma', city: 'London']],
        LA    : [[name: 'Maradona', city: 'LA']],
        HK    : [[name: 'Zhang', city: 'HK'],
                 [name: 'Ali', city: 'HK'],
                 [name: 'Liu', city: 'HK']],
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Ranges"><a class="anchor" href="#Collections-Ranges"></a><a class="link" href="#Collections-Ranges">Ranges</a></h5>
<div class="paragraph">
<p>Ranges allow you to create a list of sequential values. These can be
used as <code>List</code> since
<a href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/Range.html">Range</a> extends
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..</code> notation are inclusive (that is the list
contains the from and to value).</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..&lt;</code> notation are half-open, they include the
first value but not the last value.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>&lt;..</code> notation are also half-open, they include the
last value but not the first value.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>&lt;..&lt;</code> notation are full-open, they do not include the
first value nor the last value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// an inclusive range
def range = 5..8
assert range.size() == 4
assert range.get(2) == 7
assert range[2] == 7
assert range instanceof java.util.List
assert range.contains(5)
assert range.contains(8)

// lets use a half-open range
range = 5..&lt;8
assert range.size() == 3
assert range.get(2) == 7
assert range[2] == 7
assert range instanceof java.util.List
assert range.contains(5)
assert !range.contains(8)

//get the end points of the range without using indexes
range = 1..10
assert range.from == 1
assert range.to == 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that int ranges are implemented efficiently, creating a lightweight
Java object containing a from and to value.</p>
</div>
<div class="paragraph">
<p>Ranges can be used for any Java object which implements java.lang.Comparable
for comparison and also have methods <code>next()</code> and <code>previous()</code> to return the
next / previous item in the range. For example, you can create a range of <code>String</code> elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// an inclusive range
def range = 'a'..'d'
assert range.size() == 4
assert range.get(2) == 'c'
assert range[2] == 'c'
assert range instanceof java.util.List
assert range.contains('a')
assert range.contains('d')
assert !range.contains('e')</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can iterate on a range using a classic <code>for</code> loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">for (i in 1..10) {
    println "Hello ${i}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but alternatively you can achieve the same effect in a more Groovy idiomatic style, by iterating a range
with <code>each</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">(1..10).each { i -&gt;
    println "Hello ${i}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ranges can be also used in the <code>switch</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">switch (years) {
    case 1..10: interestRate = 0.076; break;
    case 11..25: interestRate = 0.052; break;
    default: interestRate = 0.037;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_syntax_enhancements_for_collections"><a class="anchor" href="#_syntax_enhancements_for_collections"></a><a class="link" href="#_syntax_enhancements_for_collections">Syntax enhancements for collections</a></h5>
<div class="sect5">
<h6 id="_gpath_support"><a class="anchor" href="#_gpath_support"></a><a class="link" href="#_gpath_support">GPath support</a></h6>
<div class="paragraph">
<p>Thanks to the support of property notation for both lists and maps, Groovy provides syntactic sugar making it
really easy to deal with nested collections, as illustrated in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def listOfMaps = [['a': 11, 'b': 12], ['a': 21, 'b': 22]]
assert listOfMaps.a == [11, 21] //GPath notation
assert listOfMaps*.a == [11, 21] //spread dot notation

listOfMaps = [['a': 11, 'b': 12], ['a': 21, 'b': 22], null]
assert listOfMaps*.a == [11, 21, null] // caters for null values
assert listOfMaps*.a == listOfMaps.collect { it?.a } //equivalent notation
// But this will only collect non-null values
assert listOfMaps.a == [11,21]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spread_operator_2"><a class="anchor" href="#_spread_operator_2"></a><a class="link" href="#_spread_operator_2">Spread operator</a></h6>
<div class="paragraph">
<p>The spread operator can be used to "inline" a collection into another. It is syntactic sugar which often avoids calls
to <code>putAll</code> and facilitates the realization of one-liners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [ 'z': 900,
         *: ['a': 100, 'b': 200], 'a': 300] == ['a': 300, 'b': 200, 'z': 900]
//spread map notation in map definition
assert [*: [3: 3, *: [5: 5]], 7: 7] == [3: 3, 5: 5, 7: 7]

def f = { [1: 'u', 2: 'v', 3: 'w'] }
assert [*: f(), 10: 'zz'] == [1: 'u', 10: 'zz', 2: 'v', 3: 'w']
//spread map notation in function arguments
f = { map -&gt; map.c }
assert f(*: ['a': 10, 'b': 20, 'c': 30], 'e': 50) == 30

f = { m, i, j, k -&gt; [m, i, j, k] }
//using spread map notation with mixed unnamed and named arguments
assert f('e': 100, *[4, 5], *: ['a': 10, 'b': 20, 'c': 30], 6) ==
        [["e": 100, "b": 20, "c": 30, "a": 10], 4, 5, 6]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Collections-Gettingefficientwiththestar-dotoperator"><a class="anchor" href="#Collections-Gettingefficientwiththestar-dotoperator"></a><a class="link" href="#Collections-Gettingefficientwiththestar-dotoperator">The star-dot `*.' operator</a></h6>
<div class="paragraph">
<p>The "star-dot" operator is a shortcut operator allowing you to call a method or a property on all elements of a
collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1, 3, 5] == ['a', 'few', 'words']*.size()

class Person {
    String name
    int age
}
def persons = [new Person(name:'Hugo', age:17), new Person(name:'Sandra',age:19)]
assert [17, 19] == persons*.age</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Collections-Slicingwiththesubscriptoperator"><a class="anchor" href="#Collections-Slicingwiththesubscriptoperator"></a><a class="link" href="#Collections-Slicingwiththesubscriptoperator">Slicing with the subscript operator</a></h6>
<div class="paragraph">
<p>You can index into lists, arrays, maps using the subscript expression. It is interesting that strings
are considered as special kinds of collections in that context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = 'nice cheese gromit!'
def x = text[2]

assert x == 'c'
assert x.class == String

def sub = text[5..10]
assert sub == 'cheese'

def list = [10, 11, 12, 13]
def answer = list[2,3]
assert answer == [12,13]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you can use ranges to extract part of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">list = 100..200
sub = list[1, 3, 20..25, 33]
assert sub == [101, 103, 120, 121, 122, 123, 124, 125, 133]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subscript operator can be used to update an existing collection (for collection type which are not immutable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">list = ['a','x','x','d']
list[1..2] = ['b','c']
assert list == ['a','b','c','d']</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth noting that negative indices are allowed, to extract more easily from the end of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">text = "nice cheese gromit!"
x = text[-1]
assert x == "!"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use negative indices to count from the end of the List, array,
String etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def name = text[-7..-2]
assert name == "gromit"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, if you use a backwards range (the starting index is greater than
the end index), then the answer is reversed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">text = "nice cheese gromit!"
name = text[3..1]
assert name == "eci"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-EnhancedCollectionMethods"><a class="anchor" href="#Collections-EnhancedCollectionMethods"></a><a class="link" href="#Collections-EnhancedCollectionMethods">Enhanced Collection Methods</a></h5>
<div class="paragraph">
<p>In addition to <a href="#Collections-Lists">lists</a>, <a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>, Groovy offers
a lot of additional methods for filtering, collecting, grouping, counting, &#8230;&#8203; which are directly available on either
collections or more easily iterables.</p>
</div>
<div class="paragraph">
<p>In particular, we invite you to read the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> API docs and specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>methods added to <code>Iterable</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Iterable.html">here</a></p>
</li>
<li>
<p>methods added to <code>Iterator</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Iterator.html">here</a></p>
</li>
<li>
<p>methods added to <code>Collection</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Collection.html">here</a></p>
</li>
<li>
<p>methods added to <code>List</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/List.html">here</a></p>
</li>
<li>
<p>methods added to <code>Map</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Map.html">here</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_arrays"><a class="anchor" href="#_working_with_arrays"></a><a class="link" href="#_working_with_arrays">3.3.3. Working with arrays</a></h4>
<div class="paragraph">
<p>Groovy provides array support based on Java arrays with several extensions found in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>. The overall
intention is that whether you are using an array or a collection, the code for working with the aggregate remains the same.</p>
</div>
<div class="sect4">
<h5 id="Arrays"><a class="anchor" href="#Arrays"></a><a class="link" href="#Arrays">Arrays</a></h5>
<div class="sect5">
<h6 id="_array_literals"><a class="anchor" href="#_array_literals"></a><a class="link" href="#_array_literals">Array literals</a></h6>
<div class="paragraph">
<p>You can create arrays as follows. Notice that <code>[]</code> is also used as the empty array
expression when given an explicit array type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Integer[] nums = [5, 6, 7, 8]
assert nums[1] == 6
assert nums.getAt(2) == 7                // alternative syntax
assert nums[-1] == 8                     // negative indices
assert nums instanceof Integer[]

int[] primes = [2, 3, 5, 7]              // primitives
assert primes instanceof int[]

def evens = new int[]{2, 4, 6}           // alt syntax 1
assert evens instanceof int[]

def odds = [1, 3, 5] as int[]            // alt syntax 2
assert odds instanceof int[]

// empty array examples
Integer[] emptyNums = []
assert emptyNums instanceof Integer[] &amp;&amp; emptyNums.size() == 0

def emptyStrings = new String[]{}        // alternative syntax 1
assert emptyStrings instanceof String[] &amp;&amp; emptyStrings.size() == 0

var emptyObjects = new Object[0]         // alternative syntax 2
assert emptyObjects instanceof Object[] &amp;&amp; emptyObjects.size() == 0</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_iterating_on_a_list_2"><a class="anchor" href="#_iterating_on_a_list_2"></a><a class="link" href="#_iterating_on_a_list_2">Iterating on a list</a></h6>
<div class="paragraph">
<p>Iterating on elements of a list is usually done calling the <code>each</code> and <code>eachWithIndex</code> methods, which execute code on each
item of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String[] vowels = ['a', 'e', 'i', 'o', 'u']
var result = ''
vowels.each {
    result += it
}
assert result == 'aeiou'
result = ''
vowels.eachWithIndex { v, i -&gt;
    result += v * i         // index starts from 0
}
assert result == 'eiiooouuuu'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_other_useful_methods"><a class="anchor" href="#_other_useful_methods"></a><a class="link" href="#_other_useful_methods">Other useful methods</a></h6>
<div class="paragraph">
<p>There are numerous other GDK methods for working with arrays.
Just be a little careful to read the documentation.
For collections, there are some mutating methods which alter
the original collection and others which produce new collections,
leaving the original untouched.
Since arrays are of a fixed size, we wouldn&#8217;t expect mutating
methods which altered an array&#8217;s size. Often instead, such methods return
collections. Here are some interesting array GDK methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int[] nums = [1, 2, 3]
def doubled = nums.collect { it * 2 }
assert doubled == [2, 4, 6] &amp;&amp; doubled instanceof List
def tripled = nums*.multiply(3)
assert tripled == [3, 6, 9] &amp;&amp; doubled instanceof List

assert nums.any{ it &gt; 2 }
assert nums.every{ it &lt; 4 }
assert nums.average() == 2
assert nums.min() == 1
assert nums.max() == 3
assert nums.sum() == 6
assert nums.indices == [0, 1, 2]
assert nums.swap(0, 2) == [3, 2, 1] as int[]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_legacy_datecalendar_types"><a class="anchor" href="#_working_with_legacy_datecalendar_types"></a><a class="link" href="#_working_with_legacy_datecalendar_types">3.3.4. Working with legacy Date/Calendar types</a></h4>
<div class="paragraph">
<p>The <code>groovy-dateutil</code> module supports numerous extensions for working with
Java&#8217;s classic <code>Date</code> and <code>Calendar</code> classes.</p>
</div>
<div class="paragraph">
<p>You can access the properties of a <code>Date</code> or <code>Calendar</code> using the normal array index notation
with the constant field numbers from the <code>Calendar</code> class as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static java.util.Calendar.*    <i class="conum" data-value="1"></i><b>(1)</b>

def cal = Calendar.instance
cal[YEAR] = 2000                      <i class="conum" data-value="2"></i><b>(2)</b>
cal[MONTH] = JANUARY                  <i class="conum" data-value="2"></i><b>(2)</b>
cal[DAY_OF_MONTH] = 1                 <i class="conum" data-value="2"></i><b>(2)</b>
assert cal[DAY_OF_WEEK] == SATURDAY   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the constants</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setting the calendar&#8217;s year, month and day of month</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Accessing the calendar&#8217;s day of week</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy supports arithmetic on and iteration between <code>Date</code> and <code>Calendar</code> instances as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def utc = TimeZone.getTimeZone('UTC')
Date date = Date.parse("yyyy-MM-dd HH:mm", "2010-05-23 09:01", utc)

def prev = date - 1
def next = date + 1

def diffInDays = next - prev
assert diffInDays == 2

int count = 0
prev.upto(next) { count++ }
assert count == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can parse strings into dates and output dates into formatted strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def orig = '2000-01-01'
def newYear = Date.parse('yyyy-MM-dd', orig)
assert newYear[DAY_OF_WEEK] == SATURDAY
assert newYear.format('yyyy-MM-dd') == orig
assert newYear.format('dd/MM/yyyy') == '01/01/2000'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create a new Date or Calendar based on an existing one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def newYear = Date.parse('yyyy-MM-dd', '2000-01-01')
def newYearsEve = newYear.copyWith(
    year: 1999,
    month: DECEMBER,
    dayOfMonth: 31
)
assert newYearsEve[DAY_OF_WEEK] == FRIDAY</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_datetime_types"><a class="anchor" href="#_working_with_datetime_types"></a><a class="link" href="#_working_with_datetime_types">3.3.5. Working with Date/Time types</a></h4>
<div class="paragraph">
<p>The <code>groovy-datetime</code> module supports numerous extensions for working with
the <a href="http://www.oracle.com/technetwork/articles/java/jf14-date-time-2125367.html">Date/Time API</a>
introduced in Java 8. This documentation refers to the data types defined by this API as
"JSR 310 types."</p>
</div>
<div class="sect4">
<h5 id="_formatting_and_parsing"><a class="anchor" href="#_formatting_and_parsing"></a><a class="link" href="#_formatting_and_parsing">Formatting and parsing</a></h5>
<div class="paragraph">
<p>A common use case when working with date/time types is to convert them to Strings (formatting)
and from Strings (parsing). Groovy provides these additional formatting methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDateString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalDate</code> and <code>LocalDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE"><code>DateTimeFormatter.ISO_LOCAL_DATE</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>OffsetDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_DATE"><code>DateTimeFormatter.ISO_OFFSET_DATE</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10+04:00</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>ZonedDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE"><code>DateTimeFormatter.ISO_LOCAL_DATE</code></a>
and appends the <code>ZoneId</code> short name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10EST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDateTimeString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE_TIME"><code>DateTimeFormatter.ISO_LOCAL_DATE_TIME</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10T20:30:45</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>OffsetDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_DATE_TIME"><code>DateTimeFormatter.ISO_OFFSET_DATE_TIME</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10T20:30:45+04:00</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>ZonedDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE_TIME"><code>DateTimeFormatter.ISO_LOCAL_DATE_TIME</code></a>
and appends the <code>ZoneId</code> short name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2018-03-10T20:30:45EST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTimeString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalTime</code> and <code>LocalDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_TIME"><code>DateTimeFormatter.ISO_LOCAL_TIME</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:30:45</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>OffsetTime</code> and <code>OffsetDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_TIME"><code>DateTimeFormatter.ISO_OFFSET_TIME</code></a>
formatter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:30:45+04:00</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>ZonedDateTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_TIME"><code>DateTimeFormatter.ISO_LOCAL_TIME</code></a>
and appends the <code>ZoneId</code> short name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:30:45EST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format(FormatStyle style)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalTime</code> and <code>OffsetTime</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedTime-java.time.format.FormatStyle-"><code>DateTimeFormatter.ofLocalizedTime(style)</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4:30 AM</code> (with style <code>FormatStyle.SHORT</code>, e.g.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalDate</code>, formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDate-java.time.format.FormatStyle-"><code>DateTimeFormatter.ofLocalizedDate(style)</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Saturday, March 10, 2018</code> (with style <code>FormatStyle.FULL</code>, e.g.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For <code>LocalDateTime</code>, <code>OffsetDateTime</code>, and <code>ZonedDateTime</code> formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDateTime-java.time.format.FormatStyle-"><code>DateTimeFormatter.ofLocalizedDateTime(style)</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mar 10, 2019 4:30:45 AM</code> (with style <code>FormatStyle.MEDIUM</code>, e.g.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format(String pattern)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formats with
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofPattern-java.lang.String-"><code>DateTimeFormatter.ofPattern(pattern)</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>03/10/2018</code> (with pattern &#8217;MM/dd/yyyy', e.g.)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For parsing, Groovy adds a static <code>parse</code> method to many of the JSR 310 types. The method
takes two arguments: the value to be formatted and the pattern to use. The pattern is
defined by the
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html"><code>java.time.format.DateTimeFormatter</code> API</a>.
As an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def date = LocalDate.parse('Jun 3, 04', 'MMM d, yy')
assert date == LocalDate.of(2004, Month.JUNE, 3)

def time = LocalTime.parse('4:45', 'H:mm')
assert time == LocalTime.of(4, 45, 0)

def offsetTime = OffsetTime.parse('09:47:51-1234', 'HH:mm:ssZ')
assert offsetTime == OffsetTime.of(9, 47, 51, 0, ZoneOffset.ofHoursMinutes(-12, -34))

def dateTime = ZonedDateTime.parse('2017/07/11 9:47PM Pacific Standard Time', 'yyyy/MM/dd h:mma zzzz')
assert dateTime == ZonedDateTime.of(
        LocalDate.of(2017, 7, 11),
        LocalTime.of(21, 47, 0),
        ZoneId.of('America/Los_Angeles')
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that these <code>parse</code> methods have a different argument ordering than the static
<code>parse</code> method Groovy added to <code>java.util.Date</code>.
This was done to be consistent with the existing <code>parse</code> methods of the Date/Time API.</p>
</div>
</div>
<div class="sect4">
<h5 id="_manipulating_datetime"><a class="anchor" href="#_manipulating_datetime"></a><a class="link" href="#_manipulating_datetime">Manipulating date/time</a></h5>
<div class="sect5">
<h6 id="_addition_and_subtraction"><a class="anchor" href="#_addition_and_subtraction"></a><a class="link" href="#_addition_and_subtraction">Addition and subtraction</a></h6>
<div class="paragraph">
<p><code>Temporal</code> types have <code>plus</code> and <code>minus</code> methods for adding or subtracting a provided
<code>java.time.temporal.TemporalAmount</code> argument. Because Groovy maps the <code>+</code> and <code>-</code> operators
to single-argument methods of these names, a more natural expression syntax can be used to add and subtract.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def aprilFools = LocalDate.of(2018, Month.APRIL, 1)

def nextAprilFools = aprilFools + Period.ofDays(365) // add 365 days
assert nextAprilFools.year == 2019

def idesOfMarch = aprilFools - Period.ofDays(17) // subtract 17 days
assert idesOfMarch.dayOfMonth == 15
assert idesOfMarch.month == Month.MARCH</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy provides additional <code>plus</code> and <code>minus</code> methods that accept an integer argument,
enabling the above to be rewritten more succinctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nextAprilFools = aprilFools + 365 // add 365 days
def idesOfMarch = aprilFools - 17 // subtract 17 days</code></pre>
</div>
</div>
<div class="paragraph">
<p>The unit of these integers depends on the JSR 310 type operand. As evident above,
integers used with <code>ChronoLocalDate</code> types like <code>LocalDate</code> have a unit of
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#DAYShttp://days">days</a>.
Integers used with <code>Year</code> and <code>YearMonth</code> have a unit of
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#YEARS">years</a> and
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#MONTHS">months</a>, respectively.
All other types have a unit of
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#SECONDS">seconds</a>,
such as <code>LocalTime</code>, for instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def mars = LocalTime.of(12, 34, 56) // 12:34:56 pm

def thirtySecondsToMars = mars - 30 // go back 30 seconds
assert thirtySecondsToMars.second == 26</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multiplication_and_division"><a class="anchor" href="#_multiplication_and_division"></a><a class="link" href="#_multiplication_and_division">Multiplication and division</a></h6>
<div class="paragraph">
<p>The <code>*</code> operator can be used to multiply <code>Period</code> and <code>Duration</code> instances by an
integer value; the <code>/</code> operator can be used to divide <code>Duration</code> instances by an integer value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def period = Period.ofMonths(1) * 2 // a 1-month period times 2
assert period.months == 2

def duration = Duration.ofSeconds(10) / 5// a 10-second duration divided by 5
assert duration.seconds == 2</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_incrementing_and_decrementing"><a class="anchor" href="#_incrementing_and_decrementing"></a><a class="link" href="#_incrementing_and_decrementing">Incrementing and decrementing</a></h6>
<div class="paragraph">
<p>The  <code>++</code> and <code>--</code> operators can be used increment and decrement date/time values by one unit. Since the JSR 310 types
are immutable, the operation will create a new instance with the incremented/decremented value and reassign it to the
reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def year = Year.of(2000)
--year // decrement by one year
assert year.value == 1999

def offsetTime = OffsetTime.of(0, 0, 0, 0, ZoneOffset.UTC) // 00:00:00.000 UTC
offsetTime++ // increment by one second
assert offsetTime.second == 1</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_negation"><a class="anchor" href="#_negation"></a><a class="link" href="#_negation">Negation</a></h6>
<div class="paragraph">
<p>The <code>Duration</code> and <code>Period</code> types represent a negative or positive length of time.
These can be negated with the unary <code>-</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def duration = Duration.ofSeconds(-15)
def negated = -duration
assert negated.seconds == 15</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interacting_with_datetime_values"><a class="anchor" href="#_interacting_with_datetime_values"></a><a class="link" href="#_interacting_with_datetime_values">Interacting with date/time values</a></h5>
<div class="sect5">
<h6 id="_property_notation"><a class="anchor" href="#_property_notation"></a><a class="link" href="#_property_notation">Property notation</a></h6>
<div class="paragraph">
<p>The
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/TemporalAccessor.html#getLong-java.time.temporal.TemporalField-"><code>getLong(TemporalField)</code></a>
method of <code>TemporalAccessor</code> types (e.g. <code>LocalDate</code>,
<code>LocalTime</code>, <code>ZonedDateTime</code>, etc.) and the
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/TemporalAmount.html#get-java.time.temporal.TemporalUnit-"><code>get(TemporalUnit)</code></a>
method of <code>TemporalAmount</code> types (namely <code>Period</code> and <code>Duration</code>), can be invoked with
Groovy&#8217;s property notation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def date = LocalDate.of(2018, Month.MARCH, 12)
assert date[ChronoField.YEAR] == 2018
assert date[ChronoField.MONTH_OF_YEAR] == Month.MARCH.value
assert date[ChronoField.DAY_OF_MONTH] == 12
assert date[ChronoField.DAY_OF_WEEK] == DayOfWeek.MONDAY.value

def period = Period.ofYears(2).withMonths(4).withDays(6)
assert period[ChronoUnit.YEARS] == 2
assert period[ChronoUnit.MONTHS] == 4
assert period[ChronoUnit.DAYS] == 6</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ranges_upto_and_downto"><a class="anchor" href="#_ranges_upto_and_downto"></a><a class="link" href="#_ranges_upto_and_downto">Ranges, <code>upto</code>, and <code>downto</code></a></h6>
<div class="paragraph">
<p>The JSR 310 types can be used with the <a href="#_range_operator">range operator</a>.
The following example iterates between today and the <code>LocalDate</code> six days from now,
printing out the day of the week for each iteration. As both range bounds are inclusive,
this prints all seven days of the week.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def start = LocalDate.now()
def end = start + 6 // 6 days later
(start..end).each { date -&gt;
    println date.dayOfWeek
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>upto</code> method will accomplish the same as the range in the above example.
The <code>upto</code> method iterates from the earlier <code>start</code> value (inclusive) to the later <code>end</code> value
(also inclusive), calling the closure with the incremented <code>next</code> value once per iteration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def start = LocalDate.now()
def end = start + 6 // 6 days later
start.upto(end) { next -&gt;
    println next.dayOfWeek
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>downto</code> method iterates in the opposite direction, from a later <code>start</code> value
to an earlier <code>end</code> value.</p>
</div>
<div class="paragraph">
<p>The unit of iteration for <code>upto</code>, <code>downto</code>, and ranges is the same as the unit for addition
and subtraction: <code>LocalDate</code> iterates by one day at a time,
<code>YearMonth</code> iterates by one month, <code>Year</code> by one year, and everything else by one second.
Both methods also support an optional a <code>TemporalUnit</code> argument to change the unit of
iteration.</p>
</div>
<div class="paragraph">
<p>Consider the following example, where March 1st, 2018 is iterated up to March 2nd, 2018
using an iteration unit of
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#MONTHS">months</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def start = LocalDate.of(2018, Month.MARCH, 1)
def end = start + 1 // 1 day later

int iterationCount = 0
start.upto(end, ChronoUnit.MONTHS) { next -&gt;
    println next
    ++iterationCount
}

assert iterationCount == 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>start</code> date is inclusive, the closure is called with a <code>next</code> date value of March 1st.
The <code>upto</code> method then increments the date by one month, yielding the date, April 1st.
Because this date is <em>after</em> the specified <code>end</code> date of March 2nd, the iteration stops immediately,
having only called the closure once. This behavior is the same for the <code>downto</code> method except that
the iteration will stop as soon as the value of <code>next</code> becomes earlier than the targeted <code>end</code> date.</p>
</div>
<div class="paragraph">
<p>In short, when iterating with the <code>upto</code> or <code>downto</code> methods with a custom unit of iteration,
the current value of iteration will never exceed the end value.</p>
</div>
</div>
<div class="sect5">
<h6 id="_combining_datetime_values"><a class="anchor" href="#_combining_datetime_values"></a><a class="link" href="#_combining_datetime_values">Combining date/time values</a></h6>
<div class="paragraph">
<p>The left-shift operator (<code>&lt;&lt;</code>) can be used to combine two JSR 310 types into an aggregate type.
For example, a <code>LocalDate</code> can be left-shifted into a <code>LocalTime</code> to produce a composite
<code>LocalDateTime</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">MonthDay monthDay = Month.JUNE &lt;&lt; 3 // June 3rd
LocalDate date = monthDay &lt;&lt; Year.of(2015) // 3-Jun-2015
LocalDateTime dateTime = date &lt;&lt; LocalTime.NOON // 3-Jun-2015 @ 12pm
OffsetDateTime offsetDateTime = dateTime &lt;&lt; ZoneOffset.ofHours(-5) // 3-Jun-2015 @ 12pm UTC-5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The left-shift operator is reflexive; the order of the operands does not matter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def year = Year.of(2000)
def month = Month.DECEMBER

YearMonth a = year &lt;&lt; month
YearMonth b = month &lt;&lt; year
assert a == b</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_creating_periods_and_durations"><a class="anchor" href="#_creating_periods_and_durations"></a><a class="link" href="#_creating_periods_and_durations">Creating periods and durations</a></h6>
<div class="paragraph">
<p>The right-shift operator (<code>&gt;&gt;</code>) produces a value representing the period or duration between the
operands. For <code>ChronoLocalDate</code>, <code>YearMonth</code>, and <code>Year</code>, the operator yields
a <code>Period</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def newYears = LocalDate.of(2018, Month.JANUARY, 1)
def aprilFools = LocalDate.of(2018, Month.APRIL, 1)

def period = newYears &gt;&gt; aprilFools
assert period instanceof Period
assert period.months == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The operator produces a <code>Duration</code> for the time-aware JSR types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def duration = LocalTime.NOON &gt;&gt; (LocalTime.NOON + 30)
assert duration instanceof Duration
assert duration.seconds == 30</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the value on the left-hand side of the operator is earlier than the value on the right-hand
side, the result is positive. If the left-hand side is later than the right-hand side, the
result is negative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def decade = Year.of(2010) &gt;&gt; Year.of(2000)
assert decade.years == -10</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_converting_between_legacy_and_jsr_310_types"><a class="anchor" href="#_converting_between_legacy_and_jsr_310_types"></a><a class="link" href="#_converting_between_legacy_and_jsr_310_types">Converting between legacy and JSR 310 types</a></h5>
<div class="paragraph">
<p>Despite the shortcomings of <code>Date</code>, <code>Calendar</code>, and <code>TimeZone</code> types in the <code>java.util</code> package
they are fairly common in Java APIs (at least in those prior to Java 8).
To accommodate use of such APIs, Groovy provides methods for converting between the
JSR 310 types and legacy types.</p>
</div>
<div class="paragraph">
<p>Most JSR types have been fitted with <code>toDate()</code> and <code>toCalendar()</code> methods for
converting to relatively equivalent <code>java.util.Date</code> and <code>java.util.Calendar</code> values.
Both <code>ZoneId</code> and <code>ZoneOffset</code> have been given a <code>toTimeZone()</code> method for converting to
<code>java.util.TimeZone</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// LocalDate to java.util.Date
def valentines = LocalDate.of(2018, Month.FEBRUARY, 14)
assert valentines.toDate().format('MMMM dd, yyyy') == 'February 14, 2018'

// LocalTime to java.util.Date
def noon = LocalTime.of(12, 0, 0)
assert noon.toDate().format('HH:mm:ss') == '12:00:00'

// ZoneId to java.util.TimeZone
def newYork = ZoneId.of('America/New_York')
assert newYork.toTimeZone() == TimeZone.getTimeZone('America/New_York')

// ZonedDateTime to java.util.Calendar
def valAtNoonInNY = ZonedDateTime.of(valentines, noon, newYork)
assert valAtNoonInNY.toCalendar().getTimeZone().toZoneId() == newYork</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when converting to a legacy type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nanosecond values are truncated to milliseconds. A <code>LocalTime</code>, for example, with a <code>ChronoUnit.NANOS</code> value
of 999,999,999 nanoseconds translates to 999 milliseconds.</p>
</li>
<li>
<p>When converting the "local" types (<code>LocalDate</code>, <code>LocalTime</code>, and <code>LocalDateTime</code>), the time zone of the
returned <code>Date</code> or <code>Calendar</code> will be the system default.</p>
</li>
<li>
<p>When converting a time-only type (<code>LocalTime</code> or <code>OffsetTime</code>), the year/month/day of the <code>Date</code> or <code>Calendar</code> is set
to the current date.</p>
</li>
<li>
<p>When converting a date-only type (<code>LocalDate</code>), the time value of the <code>Date</code> or <code>Calendar</code> will be cleared,
i.e. <code>00:00:00.000</code>.</p>
</li>
<li>
<p>When converting an <code>OffsetDateTime</code> to a <code>Calendar</code>, only the hours and minutes of the <code>ZoneOffset</code> convey
into the corresponding <code>TimeZone</code>. Fortunately, Zone Offsets with non-zero seconds are rare.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy has added a number of methods to <code>Date</code> and <code>Calendar</code>
for converting into the various JSR 310 types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Date legacy = Date.parse('yyyy-MM-dd HH:mm:ss.SSS', '2010-04-03 10:30:58.999')

assert legacy.toLocalDate() == LocalDate.of(2010, 4, 3)
assert legacy.toLocalTime() == LocalTime.of(10, 30, 58, 999_000_000) // 999M ns = 999ms
assert legacy.toOffsetTime().hour == 10
assert legacy.toYear() == Year.of(2010)
assert legacy.toMonth() == Month.APRIL
assert legacy.toDayOfWeek() == DayOfWeek.SATURDAY
assert legacy.toMonthDay() == MonthDay.of(Month.APRIL, 3)
assert legacy.toYearMonth() == YearMonth.of(2010, Month.APRIL)
assert legacy.toLocalDateTime().year == 2010
assert legacy.toOffsetDateTime().dayOfMonth == 3
assert legacy.toZonedDateTime().zone == ZoneId.systemDefault()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_handy_utilities"><a class="anchor" href="#_handy_utilities"></a><a class="link" href="#_handy_utilities">3.3.6. Handy utilities</a></h4>
<div class="sect4">
<h5 id="_configslurper"><a class="anchor" href="#_configslurper"></a><a class="link" href="#_configslurper">ConfigSlurper</a></h5>
<div class="paragraph">
<p><code>ConfigSlurper</code> is a utility class for reading configuration files defined in the form of Groovy scripts. Like it is
the case with Java <code>*.properties</code> files, <code>ConfigSlurper</code> allows a dot notation. But in addition, it allows for Closure scoped
configuration values and arbitrary object types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()  <i class="conum" data-value="1"></i><b>(1)</b>
    app.age  = 42
    app {                  <i class="conum" data-value="2"></i><b>(2)</b>
        name = "Test${42}"
    }
''')

assert config.app.date instanceof Date
assert config.app.age == 42
assert config.app.name == 'Test42'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Usage of the dot notation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usage of Closure scopes as an alternative to the dot notation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As can be seen in the above example, the <code>parse</code> method can be used to retrieve <code>groovy.util.ConfigObject</code> instances. The
<code>ConfigObject</code> is a specialized <code>java.util.Map</code> implementation that either returns the configured value or a new <code>ConfigObject</code>
instance but never <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()
    app.age  = 42
    app.name = "Test${42}"
''')

assert config.test != null   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>config.test</code> has not been specified yet it returns a <code>ConfigObject</code> when being called.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the case of a dot being part of a configuration variable name, it can be escaped by using single or double quotes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new ConfigSlurper().parse('''
    app."person.age"  = 42
''')

assert config.app."person.age" == 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, <code>ConfigSlurper</code> comes with support for <code>environments</code>. The <code>environments</code> method can be used to hand over
a Closure instance that itself may consist of a several sections. Let&#8217;s say we wanted to create a particular configuration
value for the development environment. When creating the <code>ConfigSlurper</code> instance we can use the <code>ConfigSlurper(String)</code>
constructor to specify the target environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new ConfigSlurper('development').parse('''
  environments {
       development {
           app.port = 8080
       }

       test {
           app.port = 8082
       }

       production {
           app.port = 80
       }
  }
''')

assert config.app.port == 8080</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ConfigSlurper</code> environments aren&#8217;t restricted to any particular environment names. It solely depends on the
<code>ConfigSlurper</code> client code what value are supported and interpreted accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>environments</code> method is built-in but the <code>registerConditionalBlock</code> method can be used to register other method names
in addition to the <code>environments</code> name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def slurper = new ConfigSlurper()
slurper.registerConditionalBlock('myProject', 'developers')   <i class="conum" data-value="1"></i><b>(1)</b>

def config = slurper.parse('''
  sendMail = true

  myProject {
       developers {
           sendMail = false
       }
  }
''')

assert !config.sendMail</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Once the new block is registered <code>ConfigSlurper</code> can parse it.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Java integration purposes the <code>toProperties</code> method can be used to convert the <code>ConfigObject</code> to a <code>java.util.Properties</code>
object that might be stored to a <code>*.properties</code> text file. Be aware though that the configuration values are converted to
<code>String</code> instances during adding them to the newly created <code>Properties</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()
    app.age  = 42
    app {
        name = "Test${42}"
    }
''')

def properties = config.toProperties()

assert properties."app.date" instanceof String
assert properties."app.age" == '42'
assert properties."app.name" == 'Test42'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_expando"><a class="anchor" href="#_expando"></a><a class="link" href="#_expando">Expando</a></h5>
<div class="paragraph">
<p>The <code>Expando</code> class can be used to create a dynamically expandable object. Despite its name it does not use the
<code>ExpandoMetaClass</code> underneath. Each <code>Expando</code> object represents a standalone, dynamically-crafted instance that can be
extended with properties (or methods) at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def expando = new Expando()
expando.name = 'John'

assert expando.name == 'John'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A special case occurs when a dynamic property registers a <code>Closure</code> code block. Once being registered it can be invoked
as it would be done with a method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def expando = new Expando()
expando.toString = { -&gt; 'John' }
expando.say = { String s -&gt; "John says: ${s}" }

assert expando as String == 'John'
assert expando.say('Hi') == 'John says: Hi'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_observable_list_map_and_set"><a class="anchor" href="#_observable_list_map_and_set"></a><a class="link" href="#_observable_list_map_and_set">Observable list, map and set</a></h5>
<div class="paragraph">
<p>Groovy comes with observable lists, maps and sets. Each of these collections trigger <code>java.beans.PropertyChangeEvent</code> events when elements
are added, removed or changed. Note that a <code>PropertyChangeEvent</code> is not only signalling that a certain event has
 occurred, moreover, it holds information on the property name and the old/new value a certain property has been changed to.</p>
</div>
<div class="paragraph">
<p>Depending on the type of change that has happened, observable collections might fire more specialized <code>PropertyChangeEvent</code>
 types. For example, adding an element to an observable list fires an <code>ObservableList.ElementAddedEvent</code> event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def event                                       <i class="conum" data-value="1"></i><b>(1)</b>
def listener = {
    if (it instanceof ObservableList.ElementEvent)  {  <i class="conum" data-value="2"></i><b>(2)</b>
        event = it
    }
} as PropertyChangeListener


def observable = [1, 2, 3] as ObservableList    <i class="conum" data-value="3"></i><b>(3)</b>
observable.addPropertyChangeListener(listener)  <i class="conum" data-value="4"></i><b>(4)</b>

observable.add 42                               <i class="conum" data-value="5"></i><b>(5)</b>

assert event instanceof ObservableList.ElementAddedEvent

def elementAddedEvent = event as ObservableList.ElementAddedEvent
assert elementAddedEvent.changeType == ObservableList.ChangeType.ADDED
assert elementAddedEvent.index == 3
assert elementAddedEvent.oldValue == null
assert elementAddedEvent.newValue == 42</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declares a <code>PropertyChangeEventListener</code> that is capturing the fired events</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ObservableList.ElementEvent</code> and its descendant types are relevant for this listener</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Registers the listener</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates an <code>ObservableList</code> from the given list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Triggers an <code>ObservableList.ElementAddedEvent</code> event</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that adding an element in fact causes two events to be triggered. The first is of type <code>ObservableList.ElementAddedEvent</code>,
the second is a plain <code>PropertyChangeEvent</code> that informs listeners about the change of property <code>size</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ObservableList.ElementClearedEvent</code> event type is another interesting one. Whenever multiple
 elements are removed, for example when calling <code>clear()</code>, it holds the elements being removed from the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def event
def listener = {
    if (it instanceof ObservableList.ElementEvent)  {
        event = it
    }
} as PropertyChangeListener


def observable = [1, 2, 3] as ObservableList
observable.addPropertyChangeListener(listener)

observable.clear()

assert event instanceof ObservableList.ElementClearedEvent

def elementClearedEvent = event as ObservableList.ElementClearedEvent
assert elementClearedEvent.values == [1, 2, 3]
assert observable.size() == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an overview of all the supported event types the reader is encouraged to have a look at the JavaDoc documentation
or the source code of the observable collection in use.</p>
</div>
<div class="paragraph">
<p><code>ObservableMap</code> and <code>ObservableSet</code> come with the same concepts as we have seen for <code>ObservableList</code> in this section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metaprogramming"><a class="anchor" href="#_metaprogramming"></a><a class="link" href="#_metaprogramming">3.4. Metaprogramming</a></h3>
<div class="paragraph">
<p>The Groovy language supports two flavors of metaprogramming: runtime and compile-time.
The first allows altering the class model and the behavior of a program at runtime while the second only occurs
at compile-time. Both have pros and cons that we will detail in this section.</p>
</div>
<div class="sect3">
<h4 id="_runtime_metaprogramming"><a class="anchor" href="#_runtime_metaprogramming"></a><a class="link" href="#_runtime_metaprogramming">3.4.1. Runtime metaprogramming</a></h4>
<div class="paragraph">
<p>With runtime metaprogramming we can postpone to runtime the decision to intercept, inject and even synthesize methods of classes and interfaces. For a deep understanding of Groovy&#8217;s metaobject protocol (MOP) we need to understand Groovy objects and Groovy&#8217;s method handling.
In Groovy we work with three kinds of objects: POJO, POGO and Groovy Interceptors. Groovy allows metaprogramming for all types of objects but in a different manner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POJO - A regular Java object whose class can be written in Java or any other language for the JVM.</p>
</li>
<li>
<p>POGO - A Groovy object whose class is written in Groovy. It extends <code>java.lang.Object</code> and implements the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyObject.html">groovy.lang.GroovyObject</a> interface by default.</p>
</li>
<li>
<p>Groovy Interceptor - A Groovy object that implements the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyInterceptable.html">groovy.lang.GroovyInterceptable</a> interface and has method-interception capability which is discussed in the <a href="#_groovyinterceptable">GroovyInterceptable</a> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every method call Groovy checks whether the object is a POJO or a POGO. For POJOs, Groovy fetches its <code>MetaClass</code> from the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/MetaClassRegistry.html">groovy.lang.MetaClassRegistry</a> and delegates method invocation to it. For POGOs, Groovy takes more steps, as illustrated in the following figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xGroovyInterceptions.png.pagespeed.ic.xYF1bf6qa8.png" alt="GroovyInterceptions" width="764" height="494">
</div>
<div class="title">Figure 1. Groovy interception mechanism</div>
</div>
<div class="sect4">
<h5 id="_groovyobject_interface"><a class="anchor" href="#_groovyobject_interface"></a><a class="link" href="#_groovyobject_interface">GroovyObject interface</a></h5>
<div class="paragraph">
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyObject.html">groovy.lang.GroovyObject</a> is the main interface in Groovy as the <code>Object</code> class is in Java. <code>GroovyObject</code> has a default implementation in the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyObjectSupport.html">groovy.lang.GroovyObjectSupport</a> class and it is responsible to transfer invocation to the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/MetaClass.html">groovy.lang.MetaClass</a> object. The <code>GroovyObject</code> source looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package groovy.lang;

public interface GroovyObject {

    Object invokeMethod(String name, Object args);

    Object getProperty(String propertyName);

    void setProperty(String propertyName, Object newValue);

    MetaClass getMetaClass();

    void setMetaClass(MetaClass metaClass);
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_invokemethod"><a class="anchor" href="#_invokemethod"></a><a class="link" href="#_invokemethod">invokeMethod</a></h6>
<div class="paragraph">
<p>This method is primarily intended to be used in conjunction with the <a href="#_groovyinterceptable">GroovyInterceptable</a>
interface or an object&#8217;s <code>MetaClass</code> where it will intercept all method calls.</p>
</div>
<div class="paragraph">
<p>It is also invoked when the method called is not present on a Groovy object. Here is a simple example using an
overridden <code>invokeMethod()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeGroovyClass {

    def invokeMethod(String name, Object args) {
        return "called invokeMethod $name $args"
    }

    def test() {
        return 'method exists'
    }
}

def someGroovyClass = new SomeGroovyClass()

assert someGroovyClass.test() == 'method exists'
assert someGroovyClass.someMethod() == 'called invokeMethod someMethod []'</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the use of <code>invokeMethod</code> to intercept missing methods is discouraged.  In cases where the intent is to only
intercept method calls in the case of a failed method dispatch use <a href="#_methodmissing">methodMissing</a>
instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="_getsetproperty"><a class="anchor" href="#_getsetproperty"></a><a class="link" href="#_getsetproperty">get/setProperty</a></h6>
<div class="paragraph">
<p>Every read access to a property can be intercepted by overriding the <code>getProperty()</code> method of the current object.
Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeGroovyClass {

    def property1 = 'ha'
    def field2 = 'ho'
    def field4 = 'hu'

    def getField1() {
        return 'getHa'
    }

    def getProperty(String name) {
        if (name != 'field3')
            return metaClass.getProperty(this, name) <i class="conum" data-value="1"></i><b>(1)</b>
        else
            return 'field3'
    }
}

def someGroovyClass = new SomeGroovyClass()

assert someGroovyClass.field1 == 'getHa'
assert someGroovyClass.field2 == 'ho'
assert someGroovyClass.field3 == 'field3'
assert someGroovyClass.field4 == 'hu'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Forwards the request to the getter for all properties except <code>field3</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can intercept write access to properties by overriding the <code>setProperty()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class POGO {

    String property 

    void setProperty(String name, Object value) {
        this.@"$name" = 'overridden'
    }
}

def pogo = new POGO()
pogo.property = 'a'

assert pogo.property == 'overridden'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_getsetmetaclass"><a class="anchor" href="#_getsetmetaclass"></a><a class="link" href="#_getsetmetaclass">get/setMetaClass</a></h6>
<div class="paragraph">
<p>You can access an object&#8217;s <code>metaClass</code> or set your own <code>MetaClass</code> implementation for changing the default interception mechanism. For example, you can write your own implementation of the <code>MetaClass</code> interface and assign it to objects in order to change the interception mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// getMetaclass
someObject.metaClass

// setMetaClass
someObject.metaClass = new OwnMetaClassImplementation()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can find an additional example in the <a href="#_groovyinterceptable">GroovyInterceptable</a> topic.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_getsetattribute"><a class="anchor" href="#_getsetattribute"></a><a class="link" href="#_getsetattribute">get/setAttribute</a></h5>
<div class="paragraph">
<p>This functionality is related to the <code>MetaClass</code> implementation. In the default implementation you can access fields without invoking their getters and setters. The examples below demonstrates this approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeGroovyClass {

    def field1 = 'ha'
    def field2 = 'ho'

    def getField1() {
        return 'getHa'
    }
}

def someGroovyClass = new SomeGroovyClass()

assert someGroovyClass.metaClass.getAttribute(someGroovyClass, 'field1') == 'ha'
assert someGroovyClass.metaClass.getAttribute(someGroovyClass, 'field2') == 'ho'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class POGO {

    private String field
    String property1

    void setProperty1(String property1) {
        this.property1 = "setProperty1"
    }
}

def pogo = new POGO()
pogo.metaClass.setAttribute(pogo, 'field', 'ha')
pogo.metaClass.setAttribute(pogo, 'property1', 'ho')

assert pogo.field == 'ha'
assert pogo.property1 == 'ho'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_methodmissing"><a class="anchor" href="#_methodmissing"></a><a class="link" href="#_methodmissing">methodMissing</a></h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>methodMissing</code>. This method differs from <code>invokeMethod</code> in that it
is only invoked in the case of a failed method dispatch when no method can be found for the given name and/or the
given arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {

   def methodMissing(String name, def args) {
        return "this is me"
   }
}

assert new Foo().someUnknownMethod(42l) == 'this is me'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically when using <code>methodMissing</code> it is possible to cache the result for the next time the same method is called.</p>
</div>
<div class="paragraph">
<p>For example, consider dynamic finders in GORM. These are implemented in terms of <code>methodMissing</code>. The code resembles
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class GORM {

   def dynamicMethods = [...] // an array of dynamic methods that use regex

   def methodMissing(String name, args) {
       def method = dynamicMethods.find { it.match(name) }
       if(method) {
          GORM.metaClass."$name" = { Object[] varArgs -&gt;
             method.invoke(delegate, name, varArgs)
          }
          return method.invoke(delegate,name, args)
       }
       else throw new MissingMethodException(name, delegate, args)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how, if we find a method to invoke, we then dynamically register a new method on the fly using <a href="#metaprogramming_emc">ExpandoMetaClass</a>.
This is so that the next time the same method is called it is more efficient. This way of using <code>methodMissing</code> does not have
the overhead of <code>invokeMethod</code> <em>and</em> is not expensive from the second call on.</p>
</div>
</div>
<div class="sect4">
<h5 id="_propertymissing"><a class="anchor" href="#_propertymissing"></a><a class="link" href="#_propertymissing">propertyMissing</a></h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>propertyMissing</code> for intercepting otherwise failing property resolution attempts. In the
case of a getter method, <code>propertyMissing</code> takes a single <code>String</code> argument containing the property name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
   def propertyMissing(String name) { name }
}

assert new Foo().boo == 'boo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>propertyMissing(String)</code> method is only called when no getter method for the given property can be found by the Groovy
runtime.</p>
</div>
<div class="paragraph">
<p>For setter methods a second <code>propertyMissing</code> definition can be added that takes an additional value argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
   def storage = [:]
   def propertyMissing(String name, value) { storage[name] = value }
   def propertyMissing(String name) { storage[name] }
}

def f = new Foo()
f.foo = "bar"

assert f.foo == "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>methodMissing</code> it is best practice to dynamically register new properties at runtime to improve the overall lookup
performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_methodmissing"><a class="anchor" href="#_static_methodmissing"></a><a class="link" href="#_static_methodmissing">static methodMissing</a></h5>
<div class="paragraph">
<p>Static variant of <code>methodMissing</code> method can be added via the <a href="#metaprogramming_emc">ExpandoMetaClass</a>
or can be implemented at the class level with <code>$static_methodMissing</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
    static def $static_methodMissing(String name, Object args) {
        return "Missing static method name is $name"
    }
}

assert Foo.bar() == 'Missing static method name is bar'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_propertymissing"><a class="anchor" href="#_static_propertymissing"></a><a class="link" href="#_static_propertymissing">static propertyMissing</a></h5>
<div class="paragraph">
<p>Static variant of <code>propertyMissing</code> method can be added via the <a href="#metaprogramming_emc">ExpandoMetaClass</a>
or can be implemented at the class level with <code>$static_propertyMissing</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {
    static def $static_propertyMissing(String name) {
        return "Missing static property name is $name"
    }
}

assert Foo.foobar == 'Missing static property name is foobar'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovyinterceptable"><a class="anchor" href="#_groovyinterceptable"></a><a class="link" href="#_groovyinterceptable">GroovyInterceptable</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyInterceptable.html">groovy.lang.GroovyInterceptable</a> interface is marker interface that extends <code>GroovyObject</code> and is used to notify the Groovy runtime that all methods should be intercepted through the method dispatcher mechanism of the Groovy runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package groovy.lang;

public interface GroovyInterceptable extends GroovyObject {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a Groovy object implements the <code>GroovyInterceptable</code> interface, its <code>invokeMethod()</code> is called for any method calls. Below you can see a simple example of an object of this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Interception implements GroovyInterceptable {

    def definedMethod() { }

    def invokeMethod(String name, Object args) {
        'invokedMethod'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next piece of code is a test which shows that both calls to existing and non-existing methods will return the same value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class InterceptableTest extends GroovyTestCase {

    void testCheckInterception() {
        def interception = new Interception()

        assert interception.definedMethod() == 'invokedMethod'
        assert interception.someMethod() == 'invokedMethod'
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We cannot use default groovy methods like <code>println</code> because these methods are injected into all Groovy objects so they will be intercepted too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we want to intercept all method calls but do not want to implement the <code>GroovyInterceptable</code> interface we can implement <code>invokeMethod()</code> on an object&#8217;s <code>MetaClass</code>.
This approach works for both POGOs and POJOs, as shown by this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class InterceptionThroughMetaClassTest extends GroovyTestCase {

    void testPOJOMetaClassInterception() {
        String invoking = 'ha'
        invoking.metaClass.invokeMethod = { String name, Object args -&gt;
            'invoked'
        }

        assert invoking.length() == 'invoked'
        assert invoking.someMethod() == 'invoked'
    }

    void testPOGOMetaClassInterception() {
        Entity entity = new Entity('Hello')
        entity.metaClass.invokeMethod = { String name, Object args -&gt;
            'invoked'
        }

        assert entity.build(new Object()) == 'invoked'
        assert entity.someMethod() == 'invoked'
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Additional information about <code>MetaClass</code> can be found in the <a href="#_metaclasses">MetaClasses</a> section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="categories"><a class="anchor" href="#categories"></a><a class="link" href="#categories">Categories</a></h5>
<div class="paragraph">
<p>There are situations where it is useful if a class <em>not</em> under control had additional methods. In order to enable this
capability, Groovy implements a feature borrowed from Objective-C, called <em>Categories</em>.</p>
</div>
<div class="paragraph">
<p>Categories are implemented with so-called <em>category classes</em>. A category class is special in that it needs to meet certain
pre-defined rules for defining extension methods.</p>
</div>
<div class="paragraph">
<p>There are a few categories that are included in the system for adding functionality to classes that make them more
usable within the Groovy environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/time/TimeCategory.html">groovy.time.TimeCategory</a></p>
</li>
<li>
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/servlet/ServletCategory.html">groovy.servlet.ServletCategory</a></p>
</li>
<li>
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/xml/dom/DOMCategory.html">groovy.xml.dom.DOMCategory</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Category classes aren&#8217;t enabled by default. To use the methods defined in a category class it is necessary to apply
the scoped <code>use</code> method that is provided by the GDK and available from inside every Groovy object instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">use(TimeCategory)  {
    println 1.minute.from.now       <i class="conum" data-value="1"></i><b>(1)</b>
    println 10.hours.ago

    def someDate = new Date()       <i class="conum" data-value="2"></i><b>(2)</b>
    println someDate - 3.months
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TimeCategory</code> adds methods to <code>Integer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>TimeCategory</code> adds methods to <code>Date</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>use</code> method takes the category class as its first parameter and a closure code block as second parameter. Inside the
<code>Closure</code> access to the category methods is available. As can be seen in the example above even JDK classes
like <code>java.lang.Integer</code> or <code>java.util.Date</code> can be enriched with user-defined methods.</p>
</div>
<div class="paragraph">
<p>A category needs not to be directly exposed to the user code, the following will also do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class JPACategory{
  // Let's enhance JPA EntityManager without getting into the JSR committee
  static void persistAll(EntityManager em , Object[] entities) { //add an interface to save all
    entities?.each { em.persist(it) }
  }
}

def transactionContext = {
  EntityManager em, Closure c -&gt;
  def tx = em.transaction
  try {
    tx.begin()
    use(JPACategory) {
      c()
    }
    tx.commit()
  } catch (e) {
    tx.rollback()
  } finally {
    //cleanup your resource here
  }
}

// user code, they always forget to close resource in exception, some even forget to commit, let's not rely on them.
EntityManager em; //probably injected
transactionContext (em) {
 em.persistAll(obj1, obj2, obj3)
 // let's do some logics here to make the example sensible
 em.persistAll(obj2, obj4, obj6)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have a look at the <code>groovy.time.TimeCategory</code> class we see that the extension methods are all declared as <code>static</code>
methods. In fact, this is one of the requirements that must be met by category classes for its methods to be successfully added to
a class inside the <code>use</code> code block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class TimeCategory {

    public static Date plus(final Date date, final BaseDuration duration) {
        return duration.plus(date);
    }

    public static Date minus(final Date date, final BaseDuration duration) {
        final Calendar cal = Calendar.getInstance();

        cal.setTime(date);
        cal.add(Calendar.YEAR, -duration.getYears());
        cal.add(Calendar.MONTH, -duration.getMonths());
        cal.add(Calendar.DAY_OF_YEAR, -duration.getDays());
        cal.add(Calendar.HOUR_OF_DAY, -duration.getHours());
        cal.add(Calendar.MINUTE, -duration.getMinutes());
        cal.add(Calendar.SECOND, -duration.getSeconds());
        cal.add(Calendar.MILLISECOND, -duration.getMillis());

        return cal.getTime();
    }

    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another requirement is the first argument of the static method must define the type the method is attached to once being activated. The
other arguments are the normal arguments the method will take as parameters.</p>
</div>
<div class="paragraph">
<p>Because of the parameter and static method convention, category method definitions may be a bit less intuitive than
normal method definitions. As an alternative Groovy comes with a <code>@Category</code> annotation that transforms annotated classes
into category classes at compile-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Distance {
    def number
    String toString() { "${number}m" }
}

@Category(Number)
class NumberCategory {
    Distance getMeters() {
        new Distance(number: this)
    }
}

use (NumberCategory)  {
    assert 42.meters.toString() == '42m'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the <code>@Category</code> annotation has the advantage of being able to use instance methods without the target type as a
first parameter. The target type class is given as an argument to the annotation instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a distinct section on <code>@Category</code> in the <a href="#xform-Category">compile-time metaprogramming section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_metaclasses"><a class="anchor" href="#_metaclasses"></a><a class="link" href="#_metaclasses">Metaclasses</a></h5>
<div class="paragraph">
<p>As explained earlier, Metaclasses play a central role in method resolution.
For every method invocation from groovy code, Groovy will find the <code>MetaClass</code> for the given object
and delegate the method resolution to the metaclass via
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/?groovy/lang/MetaClass.html#invokeMethod(java.lang.Class,java.lang.Object,java.lang.String,java.lang.Object,boolean,boolean)">groovy.lang.MetaClass#invokeMethod(java.lang.Class,java.lang.Object,java.lang.String,java.lang.Object,boolean,boolean)</a>
which should not be confused with
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/?groovy/lang/GroovyObject.html#invokeMethod(java.lang.String,java.lang.Object)">groovy.lang.GroovyObject#invokeMethod(java.lang.String,java.lang.Object)</a>
which happens to be a method that the metaclass may eventually call.</p>
</div>
<div class="sect5">
<h6 id="_the_default_metaclass_metaclassimpl"><a class="anchor" href="#_the_default_metaclass_metaclassimpl"></a><a class="link" href="#_the_default_metaclass_metaclassimpl">The default metaclass <code>MetaClassImpl</code></a></h6>
<div class="paragraph">
<p>By default, objects get an instance of <code>MetaClassImpl</code> that implements the default method lookup.
This method lookup includes looking up of the method in the object class ("regular" method) but also if no
method is found this way it will resort to calling <code>methodMissing</code> and ultimately
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/?groovy/lang/GroovyObject.html#invokeMethod(java.lang.String,java.lang.Object)">groovy.lang.GroovyObject#invokeMethod(java.lang.String,java.lang.Object)</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo {}

def f = new Foo()

assert f.metaClass =~ /MetaClassImpl/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_custom_metaclasses"><a class="anchor" href="#_custom_metaclasses"></a><a class="link" href="#_custom_metaclasses">Custom metaclasses</a></h6>
<div class="paragraph">
<p>You can change the metaclass of any object or class and replace it with a
custom implementation of the <code>MetaClass</code> <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/MetaClass.html">groovy.lang.MetaClass</a>.
Usually you will want to extend one of the existing metaclasses such as
<code>MetaClassImpl</code>, <code>DelegatingMetaClass</code>, <code>ExpandoMetaClass</code>, or <code>ProxyMetaClass</code>;
otherwise you will need to implement the complete method lookup logic.
Before using a new metaclass instance you should call
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/?groovy/lang/MetaClass.html#initialize()">groovy.lang.MetaClass#initialize()</a>,
otherwise the metaclass may or may not behave as expected.</p>
</div>
<div class="sect6">
<h7 id="_delegating_metaclass"><a class="anchor" href="#_delegating_metaclass"></a><a class="link" href="#_delegating_metaclass">Delegating metaclass</a></h7>
<div class="paragraph">
<p>If you only need to decorate an existing metaclass the <code>DelegatingMetaClass</code> simplifies that use case.
The old metaclass implementation is still accessible via <code>super</code> making it easy to apply
pretransformations to the inputs, routing to other methods and postprocessing the outputs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo { def bar() { "bar" } }

class MyFooMetaClass extends DelegatingMetaClass {
  MyFooMetaClass(MetaClass metaClass) { super(metaClass) }
  MyFooMetaClass(Class theClass) { super(theClass) }

  Object invokeMethod(Object object, String methodName, Object[] args) {
     def result = super.invokeMethod(object,methodName.toLowerCase(), args)
     result.toUpperCase();
  }
}


def mc =  new MyFooMetaClass(Foo.metaClass)
mc.initialize()

Foo.metaClass = mc
def f = new Foo()

assert f.BAR() == "BAR" // the new metaclass routes .BAR() to .bar() and uppercases the result</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_magic_package"><a class="anchor" href="#_magic_package"></a><a class="link" href="#_magic_package">Magic package</a></h7>
<div class="paragraph">
<p>It is possible to change the metaclass at startup time by giving the metaclass a specially crafted (magic) class name  and package name. In order to change the metaclass for <code>java.lang.Integer</code> it&#8217;s enough to put a class <code>groovy.runtime.metaclass.java.lang.IntegerMetaClass</code> in the classpath. This is useful, for example,  when working with frameworks if you want to do metaclass changes before your code is executed by the framework. The general form of the magic package is <code>groovy.runtime.metaclass.[package].[class]MetaClass</code>. In the example below the <code>[package]</code> is <code>java.lang</code> and the <code>[class]</code> is <code>Integer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// file: IntegerMetaClass.groovy
package groovy.runtime.metaclass.java.lang;

class IntegerMetaClass extends DelegatingMetaClass {
  IntegerMetaClass(MetaClass metaClass) { super(metaClass) }
  IntegerMetaClass(Class theClass) { super(theClass) }
  Object invokeMethod(Object object, String name, Object[] args) {
    if (name =~ /isBiggerThan/) {
      def other = name.split(/isBiggerThan/)[1].toInteger()
      object &gt; other
    } else {
      return super.invokeMethod(object,name, args);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By compiling the above file with <code>groovyc IntegerMetaClass.groovy</code> a <code>./groovy/runtime/metaclass/java/lang/IntegerMetaClass.class</code> will be generated. The example below will use this new metaclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// File testInteger.groovy
def i = 10

assert i.isBiggerThan5()
assert !i.isBiggerThan15()

println i.isBiggerThan5()</code></pre>
</div>
</div>
<div class="paragraph">
<p>By running that file with <code>groovy -cp . testInteger.groovy</code> the <code>IntegerMetaClass</code> will be in the classpath and therefore it will become the metaclass for <code>java.lang.Integer</code> intercepting the method calls to <code>isBiggerThan*()</code> methods.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_per_instance_metaclass"><a class="anchor" href="#_per_instance_metaclass"></a><a class="link" href="#_per_instance_metaclass">Per instance metaclass</a></h6>
<div class="paragraph">
<p>You can change the metaclass of individual objects separately, so it&#8217;s possible to have multiple object of the same class with different metaclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo { def bar() { "bar" }}

class FooMetaClass extends DelegatingMetaClass {
  FooMetaClass(MetaClass metaClass) { super(metaClass) }
  Object invokeMethod(Object object, String name, Object[] args) {
      super.invokeMethod(object,name,args).toUpperCase()
  }
}

def f1 = new Foo()
def f2 = new Foo()
f2.metaClass = new FooMetaClass(f2.metaClass)

assert f1.bar() == "bar"
assert f2.bar() == "BAR"
assert f1.metaClass =~ /MetaClassImpl/
assert f2.metaClass =~ /FooMetaClass/
assert f1.class.toString() == "class Foo"
assert f2.class.toString() == "class Foo"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="metaprogramming_emc"><a class="anchor" href="#metaprogramming_emc"></a><a class="link" href="#metaprogramming_emc">ExpandoMetaClass</a></h6>
<div class="paragraph">
<p>Groovy comes with a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code>. It is special in that it allows for dynamically
adding or changing methods, constructors, properties and even static methods by using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Applying those modifications can be especially useful in mocking or stubbing scenarios as shown in the <a href="#testing_guide_emc">Testing Guide</a>.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied by Groovy with a special <code>metaClass</code> property that will give you a reference to an
<code>ExpandoMetaClass</code> instance. This instance can then be used to add methods or change the behaviour of already existing
ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default <code>ExpandoMetaClass</code> doesn&#8217;t do inheritance. To enable this you must call <code>ExpandoMetaClass#enableGlobally()</code>
before your app starts such as in the main method or servlet bootstrap.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into detail on how <code>ExpandoMetaClass</code> can be used in various scenarios.</p>
</div>
<div class="sect6">
<h7 id="_methods_4"><a class="anchor" href="#_methods_4"></a><a class="link" href="#_methods_4">Methods</a></h7>
<div class="paragraph">
<p>Once the <code>ExpandoMetaClass</code> is accessed by calling the <code>metaClass</code> property, methods can be added by using either the left shift
<code>&lt;&lt;</code> or the <code>=</code> operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the left shift operator is used to <em>append</em> a new method. If a public method with the same name and
parameter types is declared by the class or interface, including those inherited from superclasses and superinterfaces
but excluding those added to the <code>metaClass</code> at runtime, an exception will be thrown. If you want to <em>replace</em> a
method declared by the class or interface you can use the <code>=</code> operator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operators are applied on a non-existent property of <code>metaClass</code> passing an instance of a <code>Closure</code> code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
   String title
}

Book.metaClass.titleInUpperCase &lt;&lt; {-&gt; title.toUpperCase() }

def b = new Book(title:"The Stand")

assert "THE STAND" == b.titleInUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows how a new method can be added to a class by accessing the <code>metaClass</code> property and using the <code>&lt;&lt;</code> or
 <code>=</code> operator to assign a <code>Closure</code> code block. The <code>Closure</code> parameters are interpreted as method parameters. Parameterless methods
 can be added by using the <code>{&#8594; &#8230;&#8203;}</code> syntax.</p>
</div>
</div>
<div class="sect6">
<h7 id="_properties_2"><a class="anchor" href="#_properties_2"></a><a class="link" href="#_properties_2">Properties</a></h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> supports two mechanisms for adding or overriding properties.</p>
</div>
<div class="paragraph">
<p>Firstly, it has support for declaring a <em>mutable property</em> by simply assigning a value to a property of <code>metaClass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
   String title
}

Book.metaClass.author = "Stephen King"
def b = new Book()

assert "Stephen King" == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way is to add getter and/or setter methods by using the standard mechanisms for adding instance methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
  String title
}
Book.metaClass.getAuthor &lt;&lt; {-&gt; "Stephen King" }

def b = new Book()

assert "Stephen King" == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the source code example above the property is dictated by the closure and is a read-only property. It is feasible to add
an equivalent setter method but then the property value needs to be stored for later usage. This could be done as
shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
  String title
}

def properties = Collections.synchronizedMap([:])

Book.metaClass.setAuthor = { String value -&gt;
   properties[System.identityHashCode(delegate) + "author"] = value
}
Book.metaClass.getAuthor = {-&gt;
   properties[System.identityHashCode(delegate) + "author"]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not the only technique however. For example in a servlet container one way might be to store the values in
the currently executing request as request attributes (as is done in some cases in Grails).</p>
</div>
</div>
<div class="sect6">
<h7 id="_constructors_2"><a class="anchor" href="#_constructors_2"></a><a class="link" href="#_constructors_2">Constructors</a></h7>
<div class="paragraph">
<p>Constructors can be added by using a special <code>constructor</code> property. Either the <code>&lt;&lt;</code> or <code>=</code> operator can be used
to assign a <code>Closure</code> code block. The <code>Closure</code> arguments will become the constructor arguments when the code is
executed at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
    String title
}
Book.metaClass.constructor &lt;&lt; { String title -&gt; new Book(title:title) }

def book = new Book('Groovy in Action - 2nd Edition')
assert book.title == 'Groovy in Action - 2nd Edition'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be careful when adding constructors however, as it is very easy to get into stack overflow troubles.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_static_methods"><a class="anchor" href="#_static_methods"></a><a class="link" href="#_static_methods">Static Methods</a></h7>
<div class="paragraph">
<p>Static methods can be added using the same technique as instance methods with the addition of the <code>static</code> qualifier
before the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
   String title
}

Book.metaClass.static.create &lt;&lt; { String title -&gt; new Book(title:title) }

def b = Book.create("The Stand")</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_borrowing_methods"><a class="anchor" href="#_borrowing_methods"></a><a class="link" href="#_borrowing_methods">Borrowing Methods</a></h7>
<div class="paragraph">
<p>With <code>ExpandoMetaClass</code> it is possible to use Groovy&#8217;s method pointer syntax to borrow methods from other classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}
class MortgageLender {
   def borrowMoney() {
      "buy house"
   }
}

def lender = new MortgageLender()

Person.metaClass.buyHouse = lender.&amp;borrowMoney

def p = new Person()

assert "buy house" == p.buyHouse()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_dynamic_method_names"><a class="anchor" href="#_dynamic_method_names"></a><a class="link" href="#_dynamic_method_names">Dynamic Method Names</a></h7>
<div class="paragraph">
<p>Since Groovy allows you to use Strings as property names this in turns allows you to dynamically create method and
property names at runtime. To create a method with a dynamic name simply use the language feature of reference property
names as strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
   String name = "Fred"
}

def methodName = "Bob"

Person.metaClass."changeNameTo${methodName}" = {-&gt; delegate.name = "Bob" }

def p = new Person()

assert "Fred" == p.name

p.changeNameToBob()

assert "Bob" == p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same concept can be applied to static methods and properties.</p>
</div>
<div class="paragraph">
<p>One application of dynamic method names can be found in the Grails web application framework. The concept of "dynamic
codecs" is implemented by using dynamic method names.</p>
</div>
<div class="listingblock">
<div class="title"><code>HTMLCodec</code> Class</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class HTMLCodec {
    static encode = { theTarget -&gt;
        HtmlUtils.htmlEscape(theTarget.toString())
    }

    static decode = { theTarget -&gt;
    	HtmlUtils.htmlUnescape(theTarget.toString())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a codec implementation. Grails comes with various codec implementations each defined in a single class.
At runtime there will be multiple codec classes in the application classpath. At application startup the framework adds
a <code>encodeXXX</code> and a <code>decodeXXX</code> method to certain metaclasses where <code>XXX</code> is the first part of the codec class name (e.g.
<code>encodeHTML</code>). This mechanism is in the following shown in some Groovy pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def codecs = classes.findAll { it.name.endsWith('Codec') }

codecs.each { codec -&gt;
    Object.metaClass."encodeAs${codec.name-'Codec'}" = { codec.newInstance().encode(delegate) }
    Object.metaClass."decodeFrom${codec.name-'Codec'}" = { codec.newInstance().decode(delegate) }
}


def html = '&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;'

assert '&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;' == html.encodeAsHTML()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_runtime_discovery"><a class="anchor" href="#_runtime_discovery"></a><a class="link" href="#_runtime_discovery">Runtime Discovery</a></h7>
<div class="paragraph">
<p>At runtime it is often useful to know what other methods or properties exist at the time the method is executed. <code>ExpandoMetaClass</code>
provides the following methods as of this writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getMetaMethod</code></p>
</li>
<li>
<p><code>hasMetaMethod</code></p>
</li>
<li>
<p><code>getMetaProperty</code></p>
</li>
<li>
<p><code>hasMetaProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why can&#8217;t you just use reflection? Well because Groovy is different, it has the methods that are "real" methods and
methods that are available only at runtime. These are sometimes (but not always) represented as MetaMethods. The
MetaMethods tell you what methods are available at runtime, thus your code can adapt.</p>
</div>
<div class="paragraph">
<p>This is of particular use when overriding <code>invokeMethod</code>, <code>getProperty</code> and/or <code>setProperty</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_groovyobject_methods"><a class="anchor" href="#_groovyobject_methods"></a><a class="link" href="#_groovyobject_methods">GroovyObject Methods</a></h7>
<div class="paragraph">
<p>Another feature of <code>ExpandoMetaClass</code> is that it allows to override the methods <code>invokeMethod</code>, <code>getProperty</code> and
<code>setProperty</code>, all of them can be found in the <code>groovy.lang.GroovyObject</code> class.</p>
</div>
<div class="paragraph">
<p>The following example shows how to override <code>invokeMethod</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Stuff {
   def invokeMe() { "foo" }
}

Stuff.metaClass.invokeMethod = { String name, args -&gt;
   def metaMethod = Stuff.metaClass.getMetaMethod(name, args)
   def result
   if(metaMethod) result = metaMethod.invoke(delegate,args)
   else {
      result = "bar"
   }
   result
}

def stf = new Stuff()

assert "foo" == stf.invokeMe()
assert "bar" == stf.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step in the <code>Closure</code> code is to look up the <code>MetaMethod</code> for the given name and arguments. If the method
can be found everything is fine and it is delegated to. If not, a dummy value is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>MetaMethod</code> is a method that is known to exist on the <code>MetaClass</code> whether added at runtime or at compile-time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same logic can be used to override <code>setProperty</code> or <code>getProperty</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
   String name = "Fred"
}

Person.metaClass.getProperty = { String name -&gt;
   def metaProperty = Person.metaClass.getMetaProperty(name)
   def result
   if(metaProperty) result = metaProperty.getProperty(delegate)
   else {
      result = "Flintstone"
   }
   result
}

def p = new Person()

assert "Fred" == p.name
assert "Flintstone" == p.other</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important thing to note here is that instead of a <code>MetaMethod</code> a <code>MetaProperty</code> instance is looked up. If that exists
the <code>getProperty</code> method of the <code>MetaProperty</code> is called, passing the delegate.</p>
</div>
</div>
<div class="sect6">
<h7 id="_overriding_static_invokemethod"><a class="anchor" href="#_overriding_static_invokemethod"></a><a class="link" href="#_overriding_static_invokemethod">Overriding Static invokeMethod</a></h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> even allows for overriding static method with a special <code>invokeMethod</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Stuff {
   static invokeMe() { "foo" }
}

Stuff.metaClass.'static'.invokeMethod = { String name, args -&gt;
   def metaMethod = Stuff.metaClass.getStaticMetaMethod(name, args)
   def result
   if(metaMethod) result = metaMethod.invoke(delegate,args)
   else {
      result = "bar"
   }
   result
}

assert "foo" == Stuff.invokeMe()
assert "bar" == Stuff.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic that is used for overriding the static method is the same as we&#8217;ve seen before for overriding instance methods. The
only difference is the access to the <code>metaClass.static</code> property and the call to <code>getStaticMethodName</code> for retrieving
the static <code>MetaMethod</code> instance.</p>
</div>
</div>
<div class="sect6">
<h7 id="_extending_interfaces"><a class="anchor" href="#_extending_interfaces"></a><a class="link" href="#_extending_interfaces">Extending Interfaces</a></h7>
<div class="paragraph">
<p>It is possible to add methods onto interfaces with <code>ExpandoMetaClass</code>. To do this however, it <strong>must</strong> be enabled
globally using the <code>ExpandoMetaClass.enableGlobally()</code> method before application start-up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List.metaClass.sizeDoubled = {-&gt; delegate.size() * 2 }

def list = []

list &lt;&lt; 1
list &lt;&lt; 2

assert 4 == list.sizeDoubled()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_extension_modules"><a class="anchor" href="#_extension_modules"></a><a class="link" href="#_extension_modules">Extension modules</a></h5>
<div class="sect5">
<h6 id="_extending_existing_classes"><a class="anchor" href="#_extending_existing_classes"></a><a class="link" href="#_extending_existing_classes">Extending existing classes</a></h6>
<div class="paragraph">
<p>An extension module allows you to add new methods to existing classes, including classes which are precompiled, like
classes from the JDK. Those new methods, unlike those defined through a metaclass or using a category, are available
globally. For example, when you write:</p>
</div>
<div class="listingblock">
<div class="title">Standard extension method</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def file = new File(...)
def contents = file.getText('utf-8')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getText</code> method doesn’t exist on the <code>File</code> class. However, Groovy knows it because it is defined in a special
class, <code>ResourceGroovyMethods</code>:</p>
</div>
<div class="listingblock">
<div class="title">ResourceGroovyMethods.java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public static String getText(File file, String charset) throws IOException {
 return IOGroovyMethods.getText(newReader(file, charset));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may notice that the extension method is defined using a static method in a helper class (where various extension
methods are defined). The first argument of the <code>getText</code> method corresponds to the receiver, while additional parameters
correspond to the arguments of the extension method. So here, we are defining a method called <em>getText</em> on
the <code>File</code> class (because the first argument is of type <code>File</code>), which takes a single argument as a parameter (the encoding <code>String</code>).</p>
</div>
<div class="paragraph">
<p>The process of creating an extension module is simple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write an extension class like above</p>
</li>
<li>
<p>write a module descriptor file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you have to make the extension module visible to Groovy, which is as simple as having the extension module classes
and descriptor available on classpath. This means that you have the choice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either provide the classes and module descriptor directly on classpath</p>
</li>
<li>
<p>or bundle your extension module into a jar for reusability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An extension module may add two kind of methods to a class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>instance methods (to be called on an instance of a class)</p>
</li>
<li>
<p>static methods (to be called on the class itself)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_instance_methods"><a class="anchor" href="#_instance_methods"></a><a class="link" href="#_instance_methods">Instance methods</a></h6>
<div class="paragraph">
<p>To add an instance method to an existing class, you need to create an extension class. For example, let&#8217;s say you
want to add a <code>maxRetries</code> method on <code>Integer</code> which accepts a closure and executes it at most <em>n</em> times until no
exception is thrown. To do that, you only need to write the following:</p>
</div>
<div class="listingblock">
<div class="title">MaxRetriesExtension.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MaxRetriesExtension {                                     <i class="conum" data-value="1"></i><b>(1)</b>
    static void maxRetries(Integer self, Closure code) {        <i class="conum" data-value="2"></i><b>(2)</b>
        assert self &gt;= 0
        int retries = self
        Throwable e = null
        while (retries &gt; 0) {
            try {
                code.call()
                break
            } catch (Throwable err) {
                e = err
                retries--
            }
        }
        if (retries == 0 &amp;&amp; e) {
            throw e
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the receiver of the message, that is to say the extended instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, after <a href="#module-descriptor">having declared your extension class</a>, you can call it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">int i=0
5.maxRetries {
    i++
}
assert i == 1
i=0
try {
    5.maxRetries {
        i++
        throw new RuntimeException("oops")
    }
} catch (RuntimeException e) {
    assert i == 5
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_static_methods_2"><a class="anchor" href="#_static_methods_2"></a><a class="link" href="#_static_methods_2">Static methods</a></h6>
<div class="paragraph">
<p>It is also possible to add static methods to a class. In that case, the static method needs to be defined in its <strong>own</strong>
file. Static and instance extension methods <strong>cannot</strong> be present in the same class.</p>
</div>
<div class="listingblock">
<div class="title">StaticStringExtension.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class StaticStringExtension {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    static String greeting(String self) {                           <i class="conum" data-value="2"></i><b>(2)</b>
        'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The static extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the class being extended and is <strong>unused</strong></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In which case you can call it directly on the <code>String</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert String.greeting() == 'Hello, world!'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="module-descriptor"><a class="anchor" href="#module-descriptor"></a><a class="link" href="#module-descriptor">Module descriptor</a></h6>
<div class="paragraph">
<p>For Groovy to be able to load your extension methods, you must declare
your extension helper classes. You must create a file named
<code>org.codehaus.groovy.runtime.ExtensionModule</code> into the
<code>META-INF/groovy</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">org.codehaus.groovy.runtime.ExtensionModule</div>
<div class="content">
<pre>moduleName=Test module for specifications
moduleVersion=1.0-test
extensionClasses=support.MaxRetriesExtension
staticExtensionClasses=support.StaticStringExtension</pre>
</div>
</div>
<div class="paragraph">
<p>The module descriptor requires 4 keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>moduleName</em> : the name of your module</p>
</li>
<li>
<p><em>moduleVersion</em>: the version of your module. Note that version number
is only used to check that you don’t load the same module in two
different versions.</p>
</li>
<li>
<p><em>extensionClasses</em>: the list of extension helper classes for instance
methods. You can provide several classes, given that they are comma
separated.</p>
</li>
<li>
<p><em>staticExtensionClasses</em>: the list of extension helper classes for
static methods. You can provide several classes, given that they are
comma separated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that it is not required for a module to define both static helpers
and instance helpers, and that you may add several classes to a single
module. You can also extend different classes in a single module without
problem. It is even possible to use different classes in a single
extension class, but it is recommended to group extension methods into
classes by feature set.</p>
</div>
</div>
<div class="sect5">
<h6 id="_extension_modules_and_classpath"><a class="anchor" href="#_extension_modules_and_classpath"></a><a class="link" href="#_extension_modules_and_classpath">Extension modules and classpath</a></h6>
<div class="paragraph">
<p>It&#8217;s worth noting that you can&#8217;t use an extension which is compiled at the same time as code using it. That means that
to use an extension, it <strong>has</strong> to be available on classpath, as compiled classes, before the code using it gets compiled.
Usually, this means that you can&#8217;t have the <em>test</em> classes in the same source unit as the extension class itself. Since
in general, test sources are separated from normal sources and executed in another step of the build, this is not an issue.</p>
</div>
</div>
<div class="sect5">
<h6 id="_compatibility_with_type_checking"><a class="anchor" href="#_compatibility_with_type_checking"></a><a class="link" href="#_compatibility_with_type_checking">Compatibility with type checking</a></h6>
<div class="paragraph">
<p>Unlike categories, extension modules are compatible with type checking: if they are found on classpath, then the type
checker is aware of the extension methods and will not complain when you call them. It is also compatible with static
compilation.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compile_time_metaprogramming"><a class="anchor" href="#_compile_time_metaprogramming"></a><a class="link" href="#_compile_time_metaprogramming">3.4.2. Compile-time metaprogramming</a></h4>
<div class="paragraph">
<p>Compile-time metaprogramming in Groovy allows code generation at compile-time. Those transformations are altering the
Abstract Syntax Tree (AST) of a program, which is why in Groovy we call it AST transformations. AST transformations
allow you to hook into the compilation process, modify the AST and continue the compilation process to generate regular
bytecode. Compared to runtime metaprogramming, this has the advantage of making the changes visible in the class file
itself (that is to say, in the bytecode). Making it visible in the bytecode is important for example if you want the
transformations to be part of the class contract (implementing interfaces, extending abstract classes, &#8230;&#8203;) or even
if you need your class to be callable from Java (or other JVM languages). For example, an AST transformation can add
methods to a class. If you do it with runtime metaprogramming, the new method would only be visible from Groovy. If you
do the same using compile-time metaprogramming, the method would be visible from Java too. Last but not least, performance
would likely be better with compile-time metaprogramming (because no initialization phase is required).</p>
</div>
<div class="paragraph">
<p>In this section, we will start with explaining the various compile-time transformations that are bundled with the Groovy
distribution. In a subsequent section, we will describe how you can <a href="#developing-ast-xforms">implement your own AST transformations</a>
and what are the disadvantages of this technique.</p>
</div>
<div class="sect4">
<h5 id="_available_ast_transformations"><a class="anchor" href="#_available_ast_transformations"></a><a class="link" href="#_available_ast_transformations">Available AST transformations</a></h5>
<div class="paragraph">
<p>Groovy comes with various AST transformations covering different needs: reducing boilerplate (code generation), implementing
design patterns (delegation, &#8230;&#8203;), logging, declarative concurrency, cloning, safer scripting, tweaking the compilation,
implementing Swing patterns, testing and eventually managing dependencies. If none of those AST transformations cover
your needs, you can still implement your own, as show in section <a href="#developing-ast-xforms">Developing your own AST transformations</a>.</p>
</div>
<div class="paragraph">
<p>AST transformations can be separated into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>global AST transformations are applied transparently, globally, as soon as they are found on compile classpath</p>
</li>
<li>
<p>local AST transformations are applied by annotating the source code with markers. Unlike global AST transformations,
local AST transformations may support parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy doesn&#8217;t ship with any global AST transformation, but you can find a list of local AST transformations
available for you to use in your code here:</p>
</div>
<div class="sect5">
<h6 id="_code_generation_transformations"><a class="anchor" href="#_code_generation_transformations"></a><a class="link" href="#_code_generation_transformations">Code generation transformations</a></h6>
<div class="paragraph">
<p>This category of transformation includes AST transformations which help removing boilerplate code. This is typically
code that you have to write but that does not carry any useful information. By autogenerating this boilerplate code,
the code you have to write is left clean and concise and the chance of introducing an error by getting such
boilerplate code incorrect is reduced.</p>
</div>
<div class="sect6">
<h7 id="xform-ToString"><a class="anchor" href="#xform-ToString"></a><a class="link" href="#xform-ToString"><code>@groovy.transform.ToString</code></a></h7>
<div class="paragraph">
<p>The <code>@ToString</code> AST transformation generates a human-readable <code>toString</code> representation of the class. For example,
annotating the <code>Person</code> class like below will automatically generate the <code>toString</code> method for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ToString

@ToString
class Person {
    String firstName
    String lastName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, then the following assertion passes, meaning that a <code>toString</code> method taking the field values from
the class and printing them out has been generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Jack, Nicholson)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ToString</code> annotation accepts several parameters which are summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(excludes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker list (indicates all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should superclass be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString
class Id { long id }

@ToString(includeSuper=true)
class Person extends Id {
    String firstName
    String lastName
}

def p = new Person(id:1, firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Jack, Nicholson, Id(1))'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include names of properties in generated toString.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includeNames=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(firstName:Jack, lastName:Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in toString, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includeFields=true)
class Person {
    String firstName
    String lastName
    private int age
    void test() {
       age = 42
    }
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
p.test()
assert p.toString() == 'Person(Jack, Nicholson, 42)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}

@ToString(includeSuperProperties = true, includeNames = true)
class BandMember extends Person {
    String bandName
}

def bono = new BandMember(name:'Bono', bandName: 'U2').toString()

assert bono.toString() == 'BandMember(bandName:U2, name:Bono)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should visible super fields be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    protected String name
}

@ToString(includeSuperFields = true, includeNames = true)
@MapConstructor(includeSuperFields = true)
class BandMember extends Person {
    String bandName
}

def bono = new BandMember(name:'Bono', bandName: 'U2').toString()

assert bono.toString() == 'BandMember(bandName:U2, name:Bono)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreNulls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties/fields with null value be displayed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(ignoreNulls=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack')
assert p.toString() == 'Person(Jack)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includePackage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use fully qualified class name instead of simple name in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includePackage=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName:'Nicholson')
assert p.toString() == 'acme.Person(Jack, Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include all JavaBean properties in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includeNames=true)
class Person {
    String firstName
    String getLastName() { 'Nicholson' }
}

def p = new Person(firstName: 'Jack')
assert p.toString() == 'acme.Person(firstName:Jack, lastName:Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the toString string. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(cache=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName:'Nicholson')
def s1 = p.toString()
def s2 = p.toString()
assert s1 == s2
assert s1 == 'Person(Jack, Nicholson)'
assert s1.is(s2) // same instance</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included in the generated toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(allNames=true)
class Person {
    String $firstName
}

def p = new Person($firstName: "Jack")
assert p.toString() == 'acme.Person(Jack)'</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-EqualsAndHashCode"><a class="anchor" href="#xform-EqualsAndHashCode"></a><a class="link" href="#xform-EqualsAndHashCode"><code>@groovy.transform.EqualsAndHashCode</code></a></h7>
<div class="paragraph">
<p>The <code>@EqualsAndHashCode</code> AST transformation aims at generating <code>equals</code> and <code>hashCode</code> methods for you. The generated
hashcode follows the best practices as described in <em>Effective Java</em> by <em>Josh Bloch</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Jack', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several options available to tweak the behavior of <code>@EqualsAndHashCode</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode(excludes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Bob', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker list (indicating all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode(includes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Bob', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the hashCode computation. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode
import groovy.transform.Immutable

@Immutable
class SlowHashCode {
    static final SLEEP_PERIOD = 500

    int hashCode() {
        sleep SLEEP_PERIOD
        127
    }
}

@EqualsAndHashCode(cache=true)
@Immutable
class Person {
    SlowHashCode slowHashCode = new SlowHashCode()
}

def p = new Person()
p.hashCode()

def start = System.currentTimeMillis()
p.hashCode()
assert System.currentTimeMillis() - start &lt; SlowHashCode.SLEEP_PERIOD</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include super in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
class Living {
    String race
}

@EqualsAndHashCode(callSuper=true)
class Person extends Living {
    String firstName
    String lastName
}

def p1 = new Person(race:'Human', firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(race: 'Human being', firstName: 'Jack', lastName: 'Nicholson')

assert p1!=p2
assert p1.hashCode() != p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in equals/hashCode, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode(includeFields=true)
class Person {
    private String firstName

    Person(String firstName) {
        this.firstName = firstName
    }
}

def p1 = new Person('Jack')
def p2 = new Person('Jack')
def p3 = new Person('Bob')

assert p1 == p2
assert p1 != p3</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useCanEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should equals call canEqual helper method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="http://www.artima.com/lejava/articles/equality.html" class="bare">http://www.artima.com/lejava/articles/equality.html</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties be included in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@EqualsAndHashCode(allProperties=true, excludes='first, last')
class Person {
    String first, last
    String getInitials() { first[0] + last[0] }
}

def p1 = new Person(first: 'Jack', last: 'Smith')
def p2 = new Person(first: 'Jack', last: 'Spratt')
def p3 = new Person(first: 'Bob', last: 'Smith')

assert p1 == p2
assert p1.hashCode() == p2.hashCode()
assert p1 != p3
assert p1.hashCode() != p3.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode(allNames=true)
class Person {
    String $firstName
}

def p1 = new Person($firstName: 'Jack')
def p2 = new Person($firstName: 'Bob')

assert p1 != p2
assert p1.hashCode() != p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TupleConstructor"><a class="anchor" href="#xform-TupleConstructor"></a><a class="link" href="#xform-TupleConstructor"><code>@groovy.transform.TupleConstructor</code></a></h7>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> annotation aims at eliminating boilerplate code by generating constructors for you. A tuple
constructor is created having a parameter for each property (and possibly each field). Each parameter has a default value
(using the initial value of the property if present or otherwise Java&#8217;s default value according to the properties type).</p>
</div>
</div>
<div class="sect6">
<h7 id="_implementation_details"><a class="anchor" href="#_implementation_details"></a><a class="link" href="#_implementation_details">Implementation Details</a></h7>
<div class="paragraph">
<p>Normally you don&#8217;t need to understand the implementation details of the generated constructor(s); you just use them in the normal way.
However, if you want to add multiple constructors, understand Java integration options or meet requirements of some
dependency injection frameworks, then some details are useful.</p>
</div>
<div class="paragraph">
<p>As previously mentioned, the generated constructor has default values applied. In later compilation phases,
the Groovy compiler&#8217;s standard default value processing behavior is then applied.
The end result is that multiple constructors are placed within the bytecode of your class.
This provides a well understood semantics and is also useful for Java integration purposes. As an example, the
following code will generate 3 constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor
class Person {
    String firstName
    String lastName
}

// traditional map-style constructor
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
// generated tuple constructor
def p2 = new Person('Jack', 'Nicholson')
// generated tuple constructor with default value for second property
def p3 = new Person('Jack')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first constructor is a no-arg constructor which allows the traditional map-style construction so long as
you don&#8217;t have final properties. Groovy calls the no-arg constructor and then the relevant setters under the covers.
It is worth noting that if the first property (or field) has type LinkedHashMap or if there is a single Map,
AbstractMap or HashMap property (or field), then the map-style named arguments won&#8217;t be available.</p>
</div>
<div class="paragraph">
<p>The other constructors are generated by taking the properties in the order they are defined. Groovy will generate as
many constructors as there are properties (or fields, depending on the options).</p>
</div>
<div class="paragraph">
<p>Setting the <code>defaults</code> attribute (see the available configuration options table) to <code>false</code>, disables the normal default values behavior which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exactly one constructor will be produced</p>
</li>
<li>
<p>Attempting to use an initial value will produce an error</p>
</li>
<li>
<p>Map-style named arguments won&#8217;t be available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This attribute is normally only used in situations where another Java framework is
expecting exactly one constructor, e.g. injection frameworks or JUnit parameterized runners.</p>
</div>
</div>
<div class="sect6">
<h7 id="_immutability_support"><a class="anchor" href="#_immutability_support"></a><a class="link" href="#_immutability_support">Immutability support</a></h7>
<div class="paragraph">
<p>If the <code>@PropertyOptions</code> annotation is also found on the class with the <code>@TupleConstructor</code> annotation,
then the generated constructor may contain custom property handling logic.
The <code>propertyHandler</code> attribute on the <code>@PropertyOptions</code> annotation could for instance be set to
<code>ImmutablePropertyHandler</code> which will result in the addition of the necessary logic for immutable classes
(defensive copy in, cloning, etc.). This normally would happen automatically behind the scenes when you use
the <code>@Immutable</code> meta-annotation.
Some of the annotation attributes might not be supported by all property handlers.</p>
</div>
</div>
<div class="sect6">
<h7 id="_customization_options"><a class="anchor" href="#_customization_options"></a><a class="link" href="#_customization_options">Customization options</a></h7>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> AST transformation accepts several annotation attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(excludes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person('Jack')
try {
    // will fail because the second property is excluded
    def p3 = new Person('Jack', 'Nicholson')
} catch (e) {
    assert e.message.contains ('Could not find matching constructor')
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined list (indicates all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person('Jack')
try {
    // will fail because the second property is not included
    def p3 = new Person('Jack', 'Nicholson')
} catch (e) {
    assert e.message.contains ('Could not find matching constructor')
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includeProperties=false)
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

try {
    def p2 = new Person('Jack', 'Nicholson')
} catch(e) {
    // will fail because properties are not included
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in tuple constructor generation, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includeFields=true)
class Person {
    String firstName
    String lastName
    private String occupation
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson', occupation: 'Actor')
def p2 = new Person('Jack', 'Nicholson', 'Actor')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: Actor'
assert p1.toString() == p2.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

class Base {
    String occupation
}

@TupleConstructor(includeSuperProperties=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

def p2 = new Person('Actor', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: null'
assert p2.toString() == 'Jack Nicholson: Actor'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

class Base {
    protected String occupation
    public String occupation() { this.occupation }
}

@TupleConstructor(includeSuperFields=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: ${occupation()}"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson', occupation: 'Actor')

def p2 = new Person('Actor', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: Actor'
assert p2.toString() == p1.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be called within a call to the parent constructor rather than set as properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

class Base {
    String occupation
    Base() {}
    Base(String job) { occupation = job?.toLowerCase() }
}

@TupleConstructor(includeSuperProperties = true, callSuper=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

def p2 = new Person('ACTOR', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: null'
assert p2.toString() == 'Jack Nicholson: actor'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will do nothing if a constructor is already defined. Setting this attribute to
true, the constructor will be generated and it&#8217;s your responsibility to ensure that no duplicate constructor is defined.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@ToString @TupleConstructor(force=true)
final class Person {
    String name
    // explicit constructor would normally disable tuple constructor
    Person(String first, String last) { this("$first $last") }
}

assert new Person('john smith').toString() == 'Person(john smith)'
assert new Person('john', 'smith').toString() == 'Person(john smith)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaults</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that default value processing is enabled for constructor parameters.
Set to false to obtain exactly one constructor but with initial value support and named-arguments disabled.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString
@TupleConstructor(defaults=false)
class Musician {
  String name
  String instrument
  int born
}

assert new Musician('Jimi', 'Guitar', 1942).toString() == 'Musician(Jimi, Guitar, 1942)'
assert Musician.constructors.size() == 1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useSetters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will directly set the backing field of each property
from its corresponding constructor parameter. Setting this attribute to true, the constructor will instead call setters if
they exist. It&#8217;s usually deemed bad style from within a constructor to call setters that can be overridden. It&#8217;s your
responsibility to avoid such bad style.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@ToString @TupleConstructor(useSetters=true)
final class Foo {
    String bar
    void setBar(String bar) {
        this.bar = bar?.toUpperCase() // null-safe
    }
}

assert new Foo('cat').toString() == 'Foo(CAT)'
assert new Foo(bar: 'cat').toString() == 'Foo(CAT)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included within the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(allNames=true)
class Person {
    String $firstName
}

def p = new Person('Jack')

assert p.$firstName == 'Jack'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties be included within the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TupleConstructor(allProperties=true)
class Person {
    String first
    private String last
    void setLast(String last) {
        this.last = last
    }
    String getName() { "$first $last" }
}

assert new Person('john', 'smith').name == 'john smith'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A closure containing statements to be inserted at the start of the generated constructor(s)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor

@TupleConstructor(pre={ first = first?.toLowerCase() })
class Person {
    String first
}

def p = new Person('Jack')

assert p.first == 'jack'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A closure containing statements to be inserted at the end of the generated constructor(s)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.TupleConstructor
import static groovy.test.GroovyAssert.shouldFail

@TupleConstructor(post={ assert first })
class Person {
    String first
}

def jack = new Person('Jack')
shouldFail {
  def unknown = new Person()
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting the <code>defaults</code> annotation attribute to <code>false</code> and the <code>force</code> annotation attribute to <code>true</code> allows
multiple tuple constructors to be created by using different customization options for the different cases
(provided each case has a different type signature) as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Named {
  String name
}

@ToString(includeSuperProperties=true, ignoreNulls=true, includeNames=true, includeFields=true)
@TupleConstructor(force=true, defaults=false)
@TupleConstructor(force=true, defaults=false, includeFields=true)
@TupleConstructor(force=true, defaults=false, includeSuperProperties=true)
class Book extends Named {
  Integer published
  private Boolean fiction
  Book() {}
}

assert new Book("Regina", 2015).toString() == 'Book(published:2015, name:Regina)'
assert new Book(2015, false).toString() == 'Book(published:2015, fiction:false)'
assert new Book(2015).toString() == 'Book(published:2015)'
assert new Book().toString() == 'Book()'
assert Book.constructors.size() == 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, here is another example using different options for <code>includes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ToString(includeSuperProperties=true, ignoreNulls=true, includeNames=true, includeFields=true)
@TupleConstructor(force=true, defaults=false, includes='name,year')
@TupleConstructor(force=true, defaults=false, includes='year,fiction')
@TupleConstructor(force=true, defaults=false, includes='name,fiction')
class Book {
    String name
    Integer year
    Boolean fiction
}

assert new Book("Regina", 2015).toString() == 'Book(name:Regina, year:2015)'
assert new Book(2015, false).toString() == 'Book(year:2015, fiction:false)'
assert new Book("Regina", false).toString() == 'Book(name:Regina, fiction:false)'
assert Book.constructors.size() == 3</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-MapConstructor"><a class="anchor" href="#xform-MapConstructor"></a><a class="link" href="#xform-MapConstructor"><code>@groovy.transform.MapConstructor</code></a></h7>
<div class="paragraph">
<p>The <code>@MapConstructor</code> annotation aims at eliminating boilerplate code by generating a map constructor for you. A map
constructor is created such that each property in the class is set based on the value in the supplied map
having the key with the name of the property. Usage is as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@ToString
@MapConstructor
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack, Nicholson)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated constructor will be roughly like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public Person(Map args) {
    if (args.containsKey('firstName')) {
        this.firstName = args.get('firstName')
    }
    if (args.containsKey('lastName')) {
        this.lastName = args.get('lastName')
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Canonical"><a class="anchor" href="#xform-Canonical"></a><a class="link" href="#xform-Canonical"><code>@groovy.transform.Canonical</code></a></h7>
<div class="paragraph">
<p>The <code>@Canonical</code> meta-annotation combines the <a href="#xform-ToString">@ToString</a>,
<a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a> and <a href="#xform-TupleConstructor">@TupleConstructor</a>
annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Canonical

@Canonical
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack, Nicholson)' // Effect of @ToString

def p2 = new Person('Jack','Nicholson') // Effect of @TupleConstructor
assert p2.toString() == 'Person(Jack, Nicholson)'

assert p1==p2 // Effect of @EqualsAndHashCode
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode</code></pre>
</div>
</div>
<div class="paragraph">
<p>A similar immutable class can be generated using the <a href="#xform-Immutable">@Immutable</a> meta-annotation instead.
The <code>@Canonical</code> meta-annotation supports the configuration options found in the annotations
it aggregates. See those annotations for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Canonical

@Canonical(excludes=['lastName'])
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack)' // Effect of @ToString(excludes=['lastName'])

def p2 = new Person('Jack') // Effect of @TupleConstructor(excludes=['lastName'])
assert p2.toString() == 'Person(Jack)'

assert p1==p2 // Effect of @EqualsAndHashCode(excludes=['lastName'])
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode(excludes=['lastName'])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Canonical</code> meta-annotation can be used in conjunction with an explicit use one or more of its
component annotations, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Canonical

@Canonical(excludes=['lastName'])
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack)' // Effect of @ToString(excludes=['lastName'])

def p2 = new Person('Jack') // Effect of @TupleConstructor(excludes=['lastName'])
assert p2.toString() == 'Person(Jack)'

assert p1==p2 // Effect of @EqualsAndHashCode(excludes=['lastName'])
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode(excludes=['lastName'])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any applicable annotation attributes from <code>@Canonical</code> are passed along to the explicit annotation but
attributes already existing in the explicit annotation take precedence.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-InheritConstructors"><a class="anchor" href="#xform-InheritConstructors"></a><a class="link" href="#xform-InheritConstructors"><code>@groovy.transform.InheritConstructors</code></a></h7>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation aims at generating constructors matching super constructors for you. This
is in particular useful when overriding exception classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.InheritConstructors

@InheritConstructors
class CustomException extends Exception {}

// all those are generated constructors
new CustomException()
new CustomException("A custom message")
new CustomException("A custom message", new RuntimeException())
new CustomException(new RuntimeException())

// Java 7 only
// new CustomException("A custom message", new RuntimeException(), false, true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constructorAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor during copying</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.CONSTRUCTOR])
public @interface ConsAnno {}

class Base {
  @ConsAnno Base() {}
}

@InheritConstructors(constructorAnnotations=true)
class Child extends Base {}

assert Child.constructors[0].annotations[0].annotationType().name == 'groovy.transform.Generated'
assert Child.constructors[0].annotations[1].annotationType().name == 'ConsAnno'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor parameters when copying the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.PARAMETER])
public @interface ParamAnno {}

class Base {
  Base(@ParamAnno String name) {}
}

@InheritConstructors(parameterAnnotations=true)
class Child extends Base {}

assert Child.constructors[0].parameterAnnotations[0][0].annotationType().name == 'ParamAnno'</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Category"><a class="anchor" href="#xform-Category"></a><a class="link" href="#xform-Category"><code>@groovy.lang.Category</code></a></h7>
<div class="paragraph">
<p>The <code>@Category</code> AST transformation simplifies the creation of Groovy categories. Historically, a Groovy category was
written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TripleCategory {
    public static Integer triple(Integer self) {
        3*self
    }
}
use (TripleCategory) {
    assert 9 == 3.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Category</code> transformation lets you write the same using an instance-style class, rather than a static class style.
This removes the need for having the first argument of each method being the receiver. The category can be written like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Category(Integer)
class TripleCategory {
    public Integer triple() { 3*this }
}
use (TripleCategory) {
    assert 9 == 3.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the mixed in class can be referenced using <code>this</code> instead. It&#8217;s also worth noting that using instance fields
in a category class is inherently unsafe: categories are not stateful (like traits).</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-IndexedProperty"><a class="anchor" href="#xform-IndexedProperty"></a><a class="link" href="#xform-IndexedProperty"><code>@groovy.transform.IndexedProperty</code></a></h7>
<div class="paragraph">
<p>The <code>@IndexedProperty</code> annotation aims at generating indexed getters/setters for properties of list/array types.
This is in particular useful if you want to use a Groovy class from Java. While Groovy supports GPath to access properties,
this is not available from Java. The <code>@IndexedProperty</code> annotation will generate indexed properties of the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeBean {
    @IndexedProperty String[] someArray = new String[2]
    @IndexedProperty List someList = []
}

def bean = new SomeBean()
bean.setSomeArray(0, 'value')
bean.setSomeList(0, 123)

assert bean.someArray[0] == 'value'
assert bean.someList == [123]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Lazy"><a class="anchor" href="#xform-Lazy"></a><a class="link" href="#xform-Lazy"><code>@groovy.lang.Lazy</code></a></h7>
<div class="paragraph">
<p>The <code>@Lazy</code> AST transformation implements lazy initialization of fields. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeBean {
    @Lazy LinkedList myField
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will produce the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = new LinkedList()
        return $myField
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value which is used to initialize the field is the default constructor of the declaration type. It is possible
to define a default value by using a closure on the right hand side of the property assignment, as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class SomeBean {
    @Lazy LinkedList myField = { ['a','b','c']}()
}</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the generated code looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = { ['a','b','c']}()
        return $myField
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the field is declared volatile then initialization will be synchronized using the
<a href="http://en.wikipedia.org/wiki/Double-checked_locking">double-checked locking</a> pattern.</p>
</div>
<div class="paragraph">
<p>Using the <code>soft=true</code> parameter, the helper field will use a <code>SoftReference</code> instead, providing a simple way to
implement caching. In that case, if the garbage collector decides to collect the reference, initialization will occur
the next time the field is accessed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Newify"><a class="anchor" href="#xform-Newify"></a><a class="link" href="#xform-Newify"><code>@groovy.lang.Newify</code></a></h7>
<div class="paragraph">
<p>The <code>@Newify</code> AST transformation is used to bring alternative syntaxes to construct objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>Python</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree(Leaf('A'),Leaf('B'),Tree(Leaf('C')))
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>or using the <code>Ruby</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree.new(Leaf.new('A'),Leaf.new('B'),Tree.new(Leaf.new('C')))
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Ruby</code> version can be disabled by setting the <code>auto</code> flag to <code>false</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Sortable"><a class="anchor" href="#xform-Sortable"></a><a class="link" href="#xform-Sortable"><code>@groovy.transform.Sortable</code></a></h7>
<div class="paragraph">
<p>The <code>@Sortable</code> AST transformation is used to help write classes that are <code>Comparable</code> and easily sorted
typically by numerous properties. It is easy to use as shown in the following example where we annotate
the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Sortable

@Sortable class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated class has the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it implements the <code>Comparable</code> interface</p>
</li>
<li>
<p>it contains a <code>compareTo</code> method with an implementation based on the natural ordering of the <code>first</code>, <code>last</code> and <code>born</code> properties</p>
</li>
<li>
<p>it has three methods returning comparators: <code>comparatorByFirst</code>, <code>comparatorByLast</code> and <code>comparatorByBorn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public int compareTo(java.lang.Object obj) {
    if (this.is(obj)) {
        return 0
    }
    if (!(obj instanceof Person)) {
        return -1
    }
    java.lang.Integer value = this.first &lt;=&gt; obj.first
    if (value != 0) {
        return value
    }
    value = this.last &lt;=&gt; obj.last
    if (value != 0) {
        return value
    }
    value = this.born &lt;=&gt; obj.born
    if (value != 0) {
        return value
    }
    return 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of the generated comparators, the <code>comparatorByFirst</code> comparator will have a <code>compare</code> method that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public int compare(java.lang.Object arg0, java.lang.Object arg1) {
    if (arg0 == arg1) {
        return 0
    }
    if (arg0 != null &amp;&amp; arg1 == null) {
        return -1
    }
    if (arg0 == null &amp;&amp; arg1 != null) {
        return 1
    }
    return arg0.first &lt;=&gt; arg1.first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> class can be used wherever a <code>Comparable</code> is expected and the generated comparators
wherever a <code>Comparator</code> is expected as shown by these examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def people = [
    new Person(first: 'Johnny', last: 'Depp', born: 1963),
    new Person(first: 'Keira', last: 'Knightley', born: 1985),
    new Person(first: 'Geoffrey', last: 'Rush', born: 1951),
    new Person(first: 'Orlando', last: 'Bloom', born: 1977)
]

assert people[0] &gt; people[2]
assert people.sort()*.last == ['Rush', 'Depp', 'Knightley', 'Bloom']
assert people.sort(false, Person.comparatorByFirst())*.first == ['Geoffrey', 'Johnny', 'Keira', 'Orlando']
assert people.sort(false, Person.comparatorByLast())*.last == ['Bloom', 'Depp', 'Knightley', 'Rush']
assert people.sort(false, Person.comparatorByBorn())*.last == ['Rush', 'Depp', 'Bloom', 'Knightley']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, all properties are used in the generated <code>compareTo</code> method in the priority order in which they are defined.
You can include or exclude certain properties from the generated <code>compareTo</code> method by giving a list of property names
in the <code>includes</code> or <code>excludes</code> annotation attributes. If using <code>includes</code>, the order of the property names given will
determine the priority of properties when comparing. To illustrate, consider the following <code>Person</code> class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Sortable(includes='first,born') class Person {
    String last
    int born
    String first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will have two comparator methods <code>comparatorByFirst</code> and <code>comparatorByBorn</code> and the generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public int compareTo(java.lang.Object obj) {
    if (this.is(obj)) {
        return 0
    }
    if (!(obj instanceof Person)) {
        return -1
    }
    java.lang.Integer value = this.first &lt;=&gt; obj.first
    if (value != 0) {
        return value
    }
    value = this.born &lt;=&gt; obj.born
    if (value != 0) {
        return value
    }
    return 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Person</code> class can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def people = [
    new Person(first: 'Ben', last: 'Affleck', born: 1972),
    new Person(first: 'Ben', last: 'Stiller', born: 1965)
]

assert people.sort()*.last == ['Stiller', 'Affleck']</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Sortable</code> AST transformation can be further changed using the following additional parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties (ordered after native properties) be used</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@Canonical(includeFields = true)
@Sortable(allProperties = true, includes = 'nameSize')
class Player {
  String name
  int getNameSize() { name.size() }
}

def finalists = [
  new Player('Serena'),
  new Player('Venus'),
  new Player('CoCo'),
  new Player('Mirjana')
]

assert finalists.sort()*.name == ['CoCo', 'Venus', 'Serena', 'Mirjana']</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties with "internal" names be used</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*

@Canonical(allNames = true)
@Sortable(allNames = false)
class Player {
  String $country
  String name
}

def finalists = [
  new Player('USA', 'Serena'),
  new Player('USA', 'Venus'),
  new Player('USA', 'CoCo'),
  new Player('Croatian', 'Mirjana')
]

assert finalists.sort()*.name == ['Mirjana', 'CoCo', 'Serena', 'Venus']</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties also be used (ordered first)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
  String name
}

@Canonical(includeSuperProperties = true)
@Sortable(includeSuperProperties = true)
class Citizen extends Person {
  String country
}

def people = [
  new Citizen('Bob', 'Italy'),
  new Citizen('Cathy', 'Hungary'),
  new Citizen('Cathy', 'Egypt'),
  new Citizen('Bob', 'Germany'),
  new Citizen('Alan', 'France')
]

assert people.sort()*.name == ['Alan', 'Bob', 'Bob', 'Cathy', 'Cathy']
assert people.sort()*.country == ['France', 'Germany', 'Italy', 'Egypt', 'Hungary']</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Builder"><a class="anchor" href="#xform-Builder"></a><a class="link" href="#xform-Builder"><code>@groovy.transform.builder.Builder</code></a></h7>
<div class="paragraph">
<p>The <code>@Builder</code> AST transformation is used to help write classes that can be created using <em>fluent</em> api calls.
The transform supports multiple building strategies to cover a range of cases and there are a number
of configuration options to customize the building process. If you&#8217;re an AST hacker, you can also define your own
strategy class. The following table lists the available strategies that are bundled with Groovy and the
configuration options each strategy supports.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes/excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained setters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "set"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExternalStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">explicit builder class, class being built untouched</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "builder"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitializerStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class providing type-safe fluent creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "createInitializer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "create" but usually only used internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">SimpleStrategy</div>
<p>To use the <code>SimpleStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*

@Builder(builderStrategy=SimpleStrategy)
class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, just call the setters in a chained fashion as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p1 = new Person().setFirst('Johnny').setLast('Depp').setBorn(1963)
assert "$p1.first $p1.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each property, a generated setter will be created which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public Person setFirst(java.lang.String first) {
    this.first = first
    return this
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a prefix as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*

@Builder(builderStrategy=SimpleStrategy, prefix="")
class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And calling the chained setters would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p = new Person().first('Johnny').last('Depp').born(1963)
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>SimpleStrategy</code> in conjunction with <code>@TupleConstructor</code>. If your <code>@Builder</code>
annotation doesn&#8217;t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@TupleConstructor</code>
annotation does, the ones from <code>@TupleConstructor</code> will be re-used for <code>@Builder</code>. The same applies for any
annotation aliases which combine <code>@TupleConstructor</code> such as <code>@Canonical</code>.</p>
</div>
<div class="paragraph">
<p>The annotation attribute <code>useSetters</code> can be used if you have a setter which you want called as part of the
construction process. See the JavaDoc for details.</p>
</div>
<div class="paragraph">
<p>The annotation attributes <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>forClass</code> and <code>includeSuperProperties</code> are not supported for this strategy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy already has built-in building mechanisms. Don&#8217;t rush to using <code>@Builder</code> if the built-in mechanisms meet your needs. Some examples:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def p2 = new Person(first: 'Keira', last: 'Knightley', born: 1985)
def p3 = new Person().with {
    first = 'Geoffrey'
    last = 'Rush'
    born = 1951
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">ExternalStrategy</div>
<p>To use the <code>ExternalStrategy</code>, create and annotate a Groovy builder class using the <code>@Builder</code> annotation, specify the
class the builder is for using <code>forClass</code> and indicate use of the <code>ExternalStrategy</code>.
Suppose you have the following class you would like a builder for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String first
    String last
    int born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you explicitly create and use your builder class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*

@Builder(builderStrategy=ExternalStrategy, forClass=Person)
class PersonBuilder { }

def p = new PersonBuilder().first('Johnny').last('Depp').born(1963).build()
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the (normally empty) builder class you provide will be filled in with appropriate setters and a build method.
The generated build method will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public Person build() {
    Person _thePerson = new Person()
    _thePerson.first = first
    _thePerson.last = last
    _thePerson.born = born
    return _thePerson
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class you are creating the builder for can be any Java or Groovy class following the normal JavaBean conventions,
e.g. a no-arg constructor and setters for the properties. Here is an example using a Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*

@Builder(builderStrategy=ExternalStrategy, forClass=javax.swing.DefaultButtonModel)
class ButtonModelBuilder {}

def model = new ButtonModelBuilder().enabled(true).pressed(true).armed(true).rollover(true).selected(true).build()
assert model.isArmed()
assert model.isPressed()
assert model.isEnabled()
assert model.isSelected()
assert model.isRollover()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated builder can be customised using the <code>prefix</code>, <code>includes</code>, <code>excludes</code> and <code>buildMethodName</code> annotation attributes.
Here is an example illustrating various customisations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*
import groovy.transform.Canonical

@Canonical
class Person {
    String first
    String last
    int born
}

@Builder(builderStrategy=ExternalStrategy, forClass=Person, includes=['first', 'last'], buildMethodName='create', prefix='with')
class PersonBuilder { }

def p = new PersonBuilder().withFirst('Johnny').withLast('Depp').create()
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>builderMethodName</code> and <code>builderClassName</code> annotation attributes for <code>@Builder</code> aren&#8217;t applicable for this strategy.</p>
</div>
<div class="paragraph">
<p>You can use the <code>ExternalStrategy</code> in conjunction with <code>@TupleConstructor</code>. If your <code>@Builder</code> annotation doesn&#8217;t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but the <code>@TupleConstructor</code> annotation of the class you are creating
the builder for does, the ones from <code>@TupleConstructor</code> will be re-used for <code>@Builder</code>. The same applies for any
annotation aliases which combine <code>@TupleConstructor</code> such as <code>@Canonical</code>.</p>
</div>
<div class="paragraph">
<div class="title">DefaultStrategy</div>
<p>To use the <code>DefaultStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.Builder

@Builder
class Person {
    String firstName
    String lastName
    int age
}

def person = Person.builder().firstName("Robert").lastName("Lewandowski").age(21).build()
assert person.firstName == "Robert"
assert person.lastName == "Lewandowski"
assert person.age == 21</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want, you can customize various aspects of the building process
using the <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>prefix</code>, <code>includes</code> and <code>excludes</code> annotation attributes,
some of which are used in the example here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.Builder

@Builder(buildMethodName='make', builderMethodName='maker', prefix='with', excludes='age')
class Person {
    String firstName
    String lastName
    int age
}

def p = Person.maker().withFirstName("Robert").withLastName("Lewandowski").make()
assert "$p.firstName $p.lastName" == "Robert Lewandowski"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
Here is an example highlighting method and constructor usage (and also illustrating the renaming required for unique names).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*
import groovy.transform.*

@ToString
@Builder
class Person {
  String first, last
  int born

  Person(){}

  @Builder(builderClassName='MovieBuilder', builderMethodName='byRoleBuilder')
  Person(String roleName) {
     if (roleName == 'Jack Sparrow') {
         this.first = 'Johnny'; this.last = 'Depp'; this.born = 1963
     }
  }

  @Builder(builderClassName='NameBuilder', builderMethodName='nameBuilder', prefix='having', buildMethodName='fullName')
  static String join(String first, String last) {
      first + ' ' + last
  }

  @Builder(builderClassName='SplitBuilder', builderMethodName='splitBuilder')
  static Person split(String name, int year) {
      def parts = name.split(' ')
      new Person(first: parts[0], last: parts[1], born: year)
  }
}

assert Person.splitBuilder().name("Johnny Depp").year(1963).build().toString() == 'Person(Johnny, Depp, 1963)'
assert Person.byRoleBuilder().roleName("Jack Sparrow").build().toString() == 'Person(Johnny, Depp, 1963)'
assert Person.nameBuilder().havingFirst('Johnny').havingLast('Depp').fullName() == 'Johnny Depp'
assert Person.builder().first("Johnny").last('Depp').born(1963).build().toString() == 'Person(Johnny, Depp, 1963)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forClass</code> annotation attribute is not supported for this strategy.</p>
</div>
<div class="paragraph">
<div class="title">InitializerStrategy</div>
<p>To use the <code>InitializerStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*
import groovy.transform.*

@ToString
@Builder(builderStrategy=InitializerStrategy)
class Person {
    String firstName
    String lastName
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your class will be locked down to have a single public constructor taking a "fully set" initializer.
It will also have a factory method to create the initializer. These are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic
def firstLastAge() {
    assert new Person(Person.createInitializer().firstName("John").lastName("Smith").age(21)).toString() == 'Person(John, Smith, 21)'
}
firstLastAge()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any attempt to use the initializer which doesn&#8217;t involve setting all the properties (though order is not important) will result in
a compilation error. If you don&#8217;t need this level of strictness, you don&#8217;t need to use <code>@CompileStatic</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>InitializerStrategy</code> in conjunction with <code>@Canonical</code> and <code>@Immutable</code>. If your <code>@Builder</code> annotation
doesn&#8217;t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>. Here is an example using <code>@Builder</code> with <code>@Immutable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.builder.*
import groovy.transform.*
import static groovy.transform.options.Visibility.PRIVATE

@Builder(builderStrategy=InitializerStrategy)
@Immutable
@VisibilityOptions(PRIVATE)
class Person {
    String first
    String last
    int born
}

def publicCons = Person.constructors
assert publicCons.size() == 1

@CompileStatic
def createFirstLastBorn() {
  def p = new Person(Person.createInitializer().first('Johnny').last('Depp').born(1963))
  assert "$p.first $p.last $p.born" == 'Johnny Depp 1963'
}

createFirstLastBorn()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation attribute <code>useSetters</code> can be used if you have a setter which you want called as part of the
construction process. See the JavaDoc for details.</p>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
For an example of method and constructor usage but using the <code>DefaultStrategy</code> strategy, consult that strategy&#8217;s
documentation.</p>
</div>
<div class="paragraph">
<p>The annotation attribute <code>forClass</code> is not supported for this strategy.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-AutoImplement"><a class="anchor" href="#xform-AutoImplement"></a><a class="link" href="#xform-AutoImplement"><code>@groovy.transform.AutoImplement</code></a></h7>
<div class="paragraph">
<p>The <code>@AutoImplement</code> AST transformation supplies dummy implementations for any found abstract methods from
superclasses or interfaces. The dummy implementation is the same for all abstract methods found and can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>essentially empty (exactly true for void methods and for methods with a return type, returns the default value for
that type)</p>
</li>
<li>
<p>a statement that throws a specified exception (with optional message)</p>
</li>
<li>
<p>some user supplied code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first example illustrates the default case. Our class is annotated with <code>@AutoImplement</code>,
has a superclass and a single interface as can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoImplement

@AutoImplement
class MyNames extends AbstractList&lt;String&gt; implements Closeable { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>void close()</code> method from the
<code>Closeable</code> interface is supplied and left empty. Implementations are also supplied
for the three abstract methods from the super class. The <code>get</code>, <code>addAll</code> and <code>size</code> methods
have return types of <code>String</code>, <code>boolean</code> and <code>int</code> respectively with default values
<code>null</code>, <code>false</code> and <code>0</code>. We can use our class (and check the expected return type for one
of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new MyNames().size() == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyNames implements Closeable extends AbstractList&lt;String&gt; {

    String get(int param0) {
        return null
    }

    boolean addAll(Collection&lt;? extends String&gt; param0) {
        return false
    }

    void close() throws Exception {
    }

    int size() {
        return 0
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second example illustrates the simplest exception case. Our class is annotated with <code>@AutoImplement</code>,
has a superclass and an annotation attribute indicates that an <code>IOException</code> should be thrown if any of
our "dummy" methods are called. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@AutoImplement(exception=IOException)
class MyWriter extends Writer { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown for one
of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.test.GroovyAssert.shouldFail

shouldFail(IOException) {
  new MyWriter().flush()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where three void methods
have been provided all of which throw the supplied exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyWriter extends Writer {

    void flush() throws IOException {
        throw new IOException()
    }

    void write(char[] param0, int param1, int param2) throws IOException {
        throw new IOException()
    }

    void close() throws Exception {
        throw new IOException()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third example illustrates the exception case with a supplied message. Our class is annotated with <code>@AutoImplement</code>,
implements an interface, and has annotation attributes to indicate that an <code>UnsupportedOperationException</code> with
<code>Not supported by MyIterator</code> as the message should be thrown for any supplied methods. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@AutoImplement(exception=UnsupportedOperationException, message='Not supported by MyIterator')
class MyIterator implements Iterator&lt;String&gt; { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown and has the correct message
for one of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ex = shouldFail(UnsupportedOperationException) {
     new MyIterator().hasNext()
}
assert ex.message == 'Not supported by MyIterator'</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where three void methods
have been provided all of which throw the supplied exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyIterator implements Iterator&lt;String&gt; {

    boolean hasNext() {
        throw new UnsupportedOperationException('Not supported by MyIterator')
    }

    String next() {
        throw new UnsupportedOperationException('Not supported by MyIterator')
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fourth example illustrates the case of user supplied code. Our class is annotated with <code>@AutoImplement</code>,
implements an interface, has an explicitly overridden <code>hasNext</code> method, and has an annotation attribute containing the
supplied code for any supplied methods. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@AutoImplement(code = { throw new UnsupportedOperationException('Should never be called but was called on ' + new Date()) })
class EmptyIterator implements Iterator&lt;String&gt; {
    boolean hasNext() { false }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown and has a message of the expected form)
using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ex = shouldFail(UnsupportedOperationException) {
     new EmptyIterator().next()
}
assert ex.message.startsWith('Should never be called but was called on ')</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where the <code>next</code> method has been supplied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class EmptyIterator implements java.util.Iterator&lt;String&gt; {

    boolean hasNext() {
        false
    }

    String next() {
        throw new UnsupportedOperationException('Should never be called but was called on ' + new Date())
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-NullCheck"><a class="anchor" href="#xform-NullCheck"></a><a class="link" href="#xform-NullCheck"><code>@groovy.transform.NullCheck</code></a></h7>
<div class="paragraph">
<p>The <code>@NullCheck</code> AST transformation adds null-check guard statements to constructors and methods
which cause those methods to fail early when supplied with null arguments.
It can be seen as a form of defensive programming.
The annotation can be added to individual methods or constructors, or to the class
in which case it will apply to all methods/constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@NullCheck
String longerOf(String first, String second) {
    first.size() &gt;= second.size() ? first : second
}

assert longerOf('cat', 'canary') == 'canary'
def ex = shouldFail(IllegalArgumentException) {
    longerOf('cat', null)
}
assert ex.message == 'second cannot be null'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_class_design_annotations"><a class="anchor" href="#_class_design_annotations"></a><a class="link" href="#_class_design_annotations">Class design annotations</a></h6>
<div class="paragraph">
<p>This category of annotations are aimed at simplifying the implementation of well-known design patterns (delegation,
singleton, &#8230;&#8203;) by using a declarative style.</p>
</div>
<div class="sect6">
<h7 id="xform-BaseScript"><a class="anchor" href="#xform-BaseScript"></a><a class="link" href="#xform-BaseScript"><code>@groovy.transform.BaseScript</code></a></h7>
<div class="paragraph">
<p><code>@BaseScript</code> is used within scripts to indicate that the script should
extend from a custom script base class rather than <code>groovy.lang.Script</code>.
See the documentation for <a href="#dsl-basescript">domain specific languages</a> for further details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Delegate"><a class="anchor" href="#xform-Delegate"></a><a class="link" href="#xform-Delegate"><code>@groovy.lang.Delegate</code></a></h7>
<div class="paragraph">
<p>The <code>@Delegate</code> AST transformation aims at implementing the delegation design pattern. In the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Event {
    @Delegate Date when
    String title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>when</code> property is annotated with <code>@Delegate</code>, meaning that the <code>Event</code> class will delegate calls to <code>Date</code> methods
to the <code>when</code> property. In this case, the generated code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Event {
    Date when
    String title
    boolean before(Date other) {
        when.before(other)
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call the <code>before</code> method, for example, directly on the <code>Event</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ev = new Event(title:'Groovy keynote', when: Date.parse('yyyy/MM/dd', '2013/09/10'))
def now = new Date()
assert ev.before(now)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of annotating a property (or field), you can also annotate a method.
In this case, the method can be thought of as a getter or factory method for the delegate.
As an example, here is a class which (rather unusually) has a pool of delegates which are
accessed in a round-robin fashion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Test {
    private int robinCount = 0
    private List&lt;List&gt; items = [[0], [1], [2]]

    @Delegate
    List getRoundRobinList() {
        items[robinCount++ % items.size()]
    }

    void checkItems(List&lt;List&gt; testValue) {
        assert items == testValue
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example usage of that class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def t = new Test()
t &lt;&lt; 'fee'
t &lt;&lt; 'fi'
t &lt;&lt; 'fo'
t &lt;&lt; 'fum'
t.checkItems([[0, 'fee', 'fum'], [1, 'fi'], [2, 'fo']])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a standard list in this round-robin fashion would violate many expected properties of lists, so
don&#8217;t expect the above class to do anything useful beyond this trivial example.</p>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Delegate</code> AST transformation can be changed using the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the interfaces implemented by the field be implemented by the class too</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Greeter { void sayHello() }
class MyGreeter implements Greeter { void sayHello() { println 'Hello!'} }

class DelegatingGreeter { // no explicit interface
    @Delegate MyGreeter greeter = new MyGreeter()
}
def greeter = new DelegatingGreeter()
assert greeter instanceof Greeter // interface was added transparently</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, also delegates methods annotated with @Deprecated</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class WithDeprecation {
    @Deprecated
    void foo() {}
}
class WithoutDeprecation {
    @Deprecated
    void bar() {}
}
class Delegating {
    @Delegate(deprecated=true) WithDeprecation with = new WithDeprecation()
    @Delegate WithoutDeprecation without = new WithoutDeprecation()
}
def d = new Delegating()
d.foo() // passes thanks to deprecated=true
d.bar() // fails because of @Deprecated</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">methodAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the methods of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class WithAnnotations {
    @Transactional
    void method() {
    }
}
class DelegatingWithoutAnnotations {
    @Delegate WithAnnotations delegate
}
class DelegatingWithAnnotations {
    @Delegate(methodAnnotations = true) WithAnnotations delegate
}
def d1 = new DelegatingWithoutAnnotations()
def d2 = new DelegatingWithAnnotations()
assert d1.class.getDeclaredMethod('method').annotations.length==1
assert d2.class.getDeclaredMethod('method').annotations.length==2</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the method parameters of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class WithAnnotations {
    void method(@NotNull String str) {
    }
}
class DelegatingWithoutAnnotations {
    @Delegate WithAnnotations delegate
}
class DelegatingWithAnnotations {
    @Delegate(parameterAnnotations = true) WithAnnotations delegate
}
def d1 = new DelegatingWithoutAnnotations()
def d2 = new DelegatingWithAnnotations()
assert d1.class.getDeclaredMethod('method',String).parameterAnnotations[0].length==0
assert d2.class.getDeclaredMethod('method',String).parameterAnnotations[0].length==1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be excluded from delegation. For more fine-grained control, see also <code>excludeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Worker {
    void task1() {}
    void task2() {}
}
class Delegating {
    @Delegate(excludes=['task2']) Worker worker = new Worker()
}
def d = new Delegating()
d.task1() // passes
d.task2() // fails because method is excluded</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker array (indicates all methods)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be included in delegation. For more
fine-grained
control, see also <code>includeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Worker {
    void task1() {}
    void task2() {}
}
class Delegating {
    @Delegate(includes=['task1']) Worker worker = new Worker()
}
def d = new Delegating()
d.task1() // passes
d.task2() // fails because method is not included</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be excluded from delegation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface AppendStringSelector {
    StringBuilder append(String str)
}
class UpperStringBuilder {
    @Delegate(excludeTypes=AppendStringSelector)
    StringBuilder sb1 = new StringBuilder()

    @Delegate(includeTypes=AppendStringSelector)
    StringBuilder sb2 = new StringBuilder()

    String toString() { sb1.toString() + sb2.toString().toUpperCase() }
}
def usb = new UpperStringBuilder()
usb.append(3.5d)
usb.append('hello')
usb.append(true)
assert usb.toString() == '3.5trueHELLO'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker array (indicates no list be default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to
 be included in delegation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface AppendBooleanSelector {
    StringBuilder append(boolean b)
}
interface AppendFloatSelector {
    StringBuilder append(float b)
}
class NumberBooleanBuilder {
    @Delegate(includeTypes=AppendBooleanSelector, interfaces=false)
    StringBuilder nums = new StringBuilder()
    @Delegate(includeTypes=[AppendFloatSelector], interfaces=false)
    StringBuilder bools = new StringBuilder()
    String result() { "${nums.toString()} ~ ${bools.toString()}" }
}
def b = new NumberBooleanBuilder()
b.append(true)
b.append(3.14f)
b.append(false)
b.append(0.0f)
assert b.result() == "truefalse ~ 3.140.0"
b.append(3.5d) // would fail because we didn't include append(double)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the delegate pattern be also applied to methods with internal names</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Worker {
    void task$() {}
}
class Delegating {
    @Delegate(allNames=true) Worker worker = new Worker()
}
def d = new Delegating()
d.task$() //passes</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Immutable"><a class="anchor" href="#xform-Immutable"></a><a class="link" href="#xform-Immutable"><code>@groovy.transform.Immutable</code></a></h7>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation combines the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#xform-ToString">@ToString</a></p>
</li>
<li>
<p><a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a></p>
</li>
<li>
<p><a href="#xform-TupleConstructor">@TupleConstructor</a></p>
</li>
<li>
<p><a href="#xform-MapConstructor">@MapConstructor</a></p>
</li>
<li>
<p><a href="#xform-Final">@Final</a></p>
</li>
<li>
<p><a href="#xform-ImmutableBase">@ImmutableBase</a></p>
</li>
<li>
<p><a href="#xform-ImmutableOptions">@ImmutableOptions</a></p>
</li>
<li>
<p><a href="#xform-PropertyOptions">@PropertyOptions</a></p>
</li>
<li>
<p><a href="#xform-KnownImmutable">@KnownImmutable</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation simplifies the creation of immutable classes. Immutable classes are useful
since they are often easier to reason about and are inherently thread-safe.
See <a href="http://www.informit.com/store/effective-java-9780134685991">Effective Java, Minimize Mutability</a> for all the details
about how to achieve immutable classes in Java. The <code>@Immutable</code> meta-annotation does most of the things described
in <em>Effective Java</em> for you automatically.
To use the meta-annotation, all you have to do is annotate the class like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Immutable

@Immutable
class Point {
    int x
    int y
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the requirements for immutable classes is that there is no way to modify any state information within the class.
One requirement to achieve this is to use immutable classes for each property or alternatively perform special coding
such as defensive copy in and defensive copy out for any mutable properties within the constructors
and property getters. Between <code>@ImmutableBase</code>, <code>@MapConstructor</code> and <code>@TupleConstructor</code> properties
are either identified as immutable or the special coding for numerous known cases is handled automatically.
Various mechanisms are provided for you to extend the handled property types which are allowed. See
<code>@ImmutableOptions</code> and <code>@KnownImmutable</code> for details.</p>
</div>
<div class="paragraph">
<p>The results of applying <code>@Immutable</code> to a class are pretty similar to those of
applying the <a href="#xform-Canonical">@Canonical</a> meta-annotation but the generated class will have extra
logic to handle immutability. You will observe this by, for instance, trying to modify a property
which will result in a <code>ReadOnlyPropertyException</code> being thrown since the backing field for the property
will have been automatically made final.</p>
</div>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation supports the configuration options found in the annotations
it aggregates. See those annotations for more details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-ImmutableBase"><a class="anchor" href="#xform-ImmutableBase"></a><a class="link" href="#xform-ImmutableBase"><code>@groovy.transform.ImmutableBase</code></a></h7>
<div class="paragraph">
<p>Immutable classes generated with <code>@ImmutableBase</code> are automatically made final. Also, the type of each property is checked
and various checks are made on the class, for example, public instance fields currently aren&#8217;t allowed. It also generates
a <code>copyWith</code> constructor if desired.</p>
</div>
<div class="paragraph">
<p>The following annotation attribute is supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean whether to generate a <code>copyWith( Map )</code> method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Immutable

@Immutable( copyWith=true )
class User {
    String  name
    Integer age
}

def bob   = new User( 'bob', 43 )
def alice = bob.copyWith( name:'alice' )
assert alice.name == 'alice'
assert alice.age  == 43</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-PropertyOptions"><a class="anchor" href="#xform-PropertyOptions"></a><a class="link" href="#xform-PropertyOptions"><code>@groovy.transform.PropertyOptions</code></a></h7>
<div class="paragraph">
<p>This annotation allows you to specify a custom property handler to be used by transformations
during class construction. It is ignored by the main Groovy compiler but is referenced by other transformations
like <code>@TupleConstructor</code>, <code>@MapConstructor</code>, and <code>@ImmutableBase</code>. It is frequently used behind the
scenes by the <code>@Immutable</code> meta-annotation.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-VisibilityOptions"><a class="anchor" href="#xform-VisibilityOptions"></a><a class="link" href="#xform-VisibilityOptions"><code>@groovy.transform.VisibilityOptions</code></a></h7>
<div class="paragraph">
<p>This annotation allows you to specify a custom visibility for a construct generated by another transformation.
It is ignored by the main Groovy compiler but is referenced by other transformations
like <code>@TupleConstructor</code>, <code>@MapConstructor</code>, and <code>@NamedVariant</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-ImmutableOptions"><a class="anchor" href="#xform-ImmutableOptions"></a><a class="link" href="#xform-ImmutableOptions"><code>@groovy.transform.ImmutableOptions</code></a></h7>
<div class="paragraph">
<p>Groovy&#8217;s immutability support relies on a predefined list of known immutable classes (like <code>java.net.URI</code> or <code>java.lang.String</code>
and fails if you use a type which is not in that list, you are allowed to add to the list of known immutable types
thanks to the following annotation attributes of the <code>@ImmutableOptions</code> annotation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutableClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of classes which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Immutable
import groovy.transform.TupleConstructor

@TupleConstructor
final class Point {
    final int x
    final int y
    public String toString() { "($x,$y)" }
}

@Immutable(knownImmutableClasses=[Point])
class Triangle {
    Point a,b,c
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property names which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Immutable
import groovy.transform.TupleConstructor

@TupleConstructor
final class Point {
    final int x
    final int y
    public String toString() { "($x,$y)" }
}

@Immutable(knownImmutables=['a','b','c'])
class Triangle {
    Point a,b,c
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you deem a type as immutable and it isn&#8217;t one of the ones automatically handled, then it is up to you
to correctly code that class to ensure immutability.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-KnownImmutable"><a class="anchor" href="#xform-KnownImmutable"></a><a class="link" href="#xform-KnownImmutable"><code>@groovy.transform.KnownImmutable</code></a></h7>
<div class="paragraph">
<p>The <code>@KnownImmutable</code> annotation isn&#8217;t actually one that triggers any AST transformations. It is simply
a marker annotation. You can annotate your classes with the annotation (including Java classes) and they
will be recognized as acceptable types for members within an immutable class. This saves you having to
explicitly use the <code>knownImmutables</code> or <code>knownImmutableClasses</code> annotation attributes from <code>@ImmutableOptions</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Memoized"><a class="anchor" href="#xform-Memoized"></a><a class="link" href="#xform-Memoized"><code>@groovy.transform.Memoized</code></a></h7>
<div class="paragraph">
<p>The <code>@Memoized</code> AST transformations simplifies the implementation of caching by allowing the result of method calls
to be cached just by annotating the method with <code>@Memoized</code>. Let&#8217;s imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">long longComputation(int seed) {
    // slow computation
    Thread.sleep(100*seed)
    System.nanoTime()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This emulates a long computation, based on the actual parameters of the method. Without <code>@Memoized</code>, each method call
would take several seconds plus it would return a random result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = longComputation(1)
def y = longComputation(1)
assert x!=y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding <code>@Memoized</code> changes the semantics of the method by adding caching, based on the parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Memoized
long longComputation(int seed) {
    // slow computation
    Thread.sleep(100*seed)
    System.nanoTime()
}

def x = longComputation(1) // returns after 100 milliseconds
def y = longComputation(1) // returns immediately
def z = longComputation(2) // returns after 200 milliseconds
assert x==y
assert x!=z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The size of the cache can be configured using two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>protectedCacheSize</em>: the number of results which are guaranteed not to be cleared after garbage collection</p>
</li>
<li>
<p><em>maxCacheSize</em>: the maximum number of results that can be kept in memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the size of the cache is unlimited and no cache result is protected from garbage collection. Setting a
<em>protectedCacheSize&gt;0</em> would create an unlimited cache with some results protected. Setting <em>maxCacheSize&gt;0</em> would
 create a limited cache but without any protection from garbage protection. Setting both would create a limited,
 protected cache.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-TailRecursive"><a class="anchor" href="#xform-TailRecursive"></a><a class="link" href="#xform-TailRecursive"><code>@groovy.transform.TailRecursive</code></a></h7>
<div class="paragraph">
<p>The <code>@TailRecursive</code> annotation can be used to automatically transform a recursive call at the end of a method
into an equivalent iterative version of the same code. This avoids stack overflow due to too many recursive calls.
Below is an example of use when calculating factorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.CompileStatic
import groovy.transform.TailRecursive

@CompileStatic
class Factorial {

    @TailRecursive
    static BigInteger factorial( BigInteger i, BigInteger product = 1) {
        if( i == 1) {
            return product
        }
        return factorial(i-1, product*i)
    }
}

assert Factorial.factorial(1) == 1
assert Factorial.factorial(3) == 6
assert Factorial.factorial(5) == 120
assert Factorial.factorial(50000).toString().size() == 213237 // Big number and no Stack Overflow</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, the annotation will only work for self-recursive method calls, i.e. a single recursive call to the exact same method again.
Consider using Closures and <code>trampoline()</code> if you have a scenario involving simple mutual recursion.
Also note that only non-void methods are currently handled (void calls will result in a compilation error).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Currently, some forms of method overloading can trick the compiler,
and some non-tail recursive calls are erroneously treated as tail recursive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="xform-Singleton"><a class="anchor" href="#xform-Singleton"></a><a class="link" href="#xform-Singleton"><code>@groovy.lang.Singleton</code></a></h7>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation can be used to implement the singleton design pattern on a class. The singleton instance
is defined eagerly by default, using class initialization, or lazily, in which case the field is initialized using
double-checked locking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Singleton
class GreetingService {
    String greeting(String name) { "Hello, $name!" }
}
assert GreetingService.instance.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the singleton is created eagerly when the class is initialized and available through the <code>instance</code> property.
It is possible to change the name of the singleton using the <code>property</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Singleton(property='theOne')
class GreetingService {
    String greeting(String name) { "Hello, $name!" }
}

assert GreetingService.theOne.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And it is also possible to make initialization lazy using the <code>lazy</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Collaborator {
    public static boolean init = false
}
@Singleton(lazy=true,strict=false)
class GreetingService {
    static void init() {}
    GreetingService() {
        Collaborator.init = true
    }
    String greeting(String name) { "Hello, $name!" }
}
GreetingService.init() // make sure class is initialized
assert Collaborator.init == false
GreetingService.instance
assert Collaborator.init == true
assert GreetingService.instance.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we also set the <code>strict</code> parameter to false, which allows us to define our own constructor.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Mixin"><a class="anchor" href="#xform-Mixin"></a><a class="link" href="#xform-Mixin"><code>@groovy.lang.Mixin</code></a></h7>
<div class="paragraph">
<p>Deprecated. Consider using traits instead.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_logging_improvements"><a class="anchor" href="#_logging_improvements"></a><a class="link" href="#_logging_improvements">Logging improvements</a></h6>
<div class="paragraph">
<p>Groovy provides a family of AST transformations that help with integration of the most widely
used logging frameworks. There is a transform and associated annotation for each of the common frameworks.
These transforms provide a streamlined declarative approach to using the logging framework.
In each case, the transform will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add a static final <code>log</code> field to the annotated class corresponding to the logger</p>
</li>
<li>
<p>wrap all calls to <code>log.level()</code> into the appropriate <code>log.isLevelEnabled</code> guard, depending on the underlying framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those transformations support two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> (default <code>log</code>) corresponds to the name of the logger field</p>
</li>
<li>
<p><code>category</code> (defaults to the class name) is the name of the logger category</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that annotating a class with one of those annotations doesn&#8217;t
prevent you from using the logging framework using the normal long-hand approach.</p>
</div>
<div class="sect6">
<h7 id="xform-Log"><a class="anchor" href="#xform-Log"></a><a class="link" href="#xform-Log"><code>@groovy.util.logging.Log</code></a></h7>
<div class="paragraph">
<p>The first logging AST transformation available is the <code>@Log</code> annotation which relies on the JDK logging framework. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.Log
class Greeter {
    void greet() {
        log.info 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.logging.Level
import java.util.logging.Logger

class Greeter {
    private static final Logger log = Logger.getLogger(Greeter.name)
    void greet() {
        if (log.isLoggable(Level.INFO)) {
            log.info 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Commons"><a class="anchor" href="#xform-Commons"></a><a class="link" href="#xform-Commons"><code>@groovy.util.logging.Commons</code></a></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://commons.apache.org/proper/commons-logging/">Apache Commons Logging</a> framework using the
<code>@Commons</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.Commons
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.apache.commons.logging.LogFactory
import org.apache.commons.logging.Log

class Greeter {
    private static final Log log = LogFactory.getLog(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate commons-logging jar to your classpath.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j"><a class="anchor" href="#xform-Log4j"></a><a class="link" href="#xform-Log4j"><code>@groovy.util.logging.Log4j</code></a></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/1.2/">Apache Log4j 1.x</a> framework using the
<code>@Log4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.Log4j
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.apache.log4j.Logger

class Greeter {
    private static final Logger log = Logger.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate log4j jar to your classpath.
This annotation can also be used with the compatible <a href="https://reload4j.qos.ch/">reload4j</a> log4j
drop-in replacement, just use the jar from that project instead of a log4j jar.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j2"><a class="anchor" href="#xform-Log4j2"></a><a class="link" href="#xform-Log4j2"><code>@groovy.util.logging.Log4j2</code></a></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2.x</a> framework using the
<code>@Log4j2</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.Log4j2
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.apache.logging.log4j.LogManager
import org.apache.logging.log4j.Logger

class Greeter {
    private static final Logger log = LogManager.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate log4j2 jar to your classpath.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Slf4j"><a class="anchor" href="#xform-Slf4j"></a><a class="link" href="#xform-Slf4j"><code>@groovy.util.logging.Slf4j</code></a></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://www.slf4j.org/">Simple Logging Facade for Java (SLF4J)</a> framework using the
<code>@Slf4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.Slf4j
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.slf4j.LoggerFactory
import org.slf4j.Logger

class Greeter {
    private static final Logger log = LoggerFactory.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate slf4j jar(s) to your classpath.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-PlatformLog"><a class="anchor" href="#xform-PlatformLog"></a><a class="link" href="#xform-PlatformLog"><code>@groovy.util.logging.PlatformLog</code></a></h7>
<div class="paragraph">
<p>Groovy supports the <a href="https://openjdk.java.net/jeps/264">Java Platform Logging API and Service</a>
framework using the <code>@PlatformLog</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.util.logging.PlatformLog
class Greeter {
    void greet() {
        log.info 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.lang.System.Logger
import java.lang.System.LoggerFinder
import static java.lang.System.Logger.Level.INFO

class Greeter {
    private static final transient Logger log =
        LoggerFinder.loggerFinder.getLogger(Greeter.class.name, Greeter.class.module)
    void greet() {
        log.log INFO, 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to be using JDK 9+ to use this capability.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_declarative_concurrency"><a class="anchor" href="#_declarative_concurrency"></a><a class="link" href="#_declarative_concurrency">Declarative concurrency</a></h6>
<div class="paragraph">
<p>The Groovy language provides a set of annotations aimed at simplifying common concurrency patterns in a declarative
approach.</p>
</div>
<div class="sect6">
<h7 id="xform-Synchronized"><a class="anchor" href="#xform-Synchronized"></a><a class="link" href="#xform-Synchronized"><code>@groovy.transform.Synchronized</code></a></h7>
<div class="paragraph">
<p>The <code>@Synchronized</code> AST transformations works in a similar way to the <code>synchronized</code> keyword but locks on different
objects for safer concurrency. It can be applied on any method or static method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Synchronized

import java.util.concurrent.Executors
import java.util.concurrent.TimeUnit

class Counter {
    int cpt
    @Synchronized
    int incrementAndGet() {
        cpt++
    }
    int get() {
        cpt
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing this is equivalent to creating a lock object and wrapping the whole method into a synchronized block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Counter {
    int cpt
    private final Object $lock = new Object()

    int incrementAndGet() {
        synchronized($lock) {
            cpt++
        }
    }
    int get() {
        cpt
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>@Synchronized</code> creates a field named <code>$lock</code> (or <code>$LOCK</code> for a static method) but you can make it use any
field you want by specifying the value attribute, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.Synchronized

import java.util.concurrent.Executors
import java.util.concurrent.TimeUnit

class Counter {
    int cpt
    private final Object myLock = new Object()

    @Synchronized('myLock')
    int incrementAndGet() {
        cpt++
    }
    int get() {
        cpt
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-WithReadLock"><a class="anchor" href="#xform-WithReadLock"></a><a class="link" href="#xform-WithReadLock"><code>@groovy.transform.WithReadLock</code> and <code>@groovy.transform.WithWriteLock</code></a></h7>
<div class="paragraph">
<p>The <code>@WithReadLock</code> AST transformation works in conjunction with the <code>@WithWriteLock</code> transformation
to provide read/write synchronization using the <code>ReentrantReadWriteLock</code> facility that the JDK provides. The annotation
can be added to a method or a static method. It will transparently create a <code>$reentrantLock</code> final field (or
<code>$REENTRANTLOCK</code> for a static method) and proper synchronization code will be added. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.WithReadLock
import groovy.transform.WithWriteLock

class Counters {
    public final Map&lt;String,Integer&gt; map = [:].withDefault { 0 }

    @WithReadLock
    int get(String id) {
        map.get(id)
    }

    @WithWriteLock
    void add(String id, int num) {
        Thread.sleep(200) // emulate long computation
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.WithReadLock as WithReadLock
import groovy.transform.WithWriteLock as WithWriteLock

public class Counters {

    private final Map&lt;String, Integer&gt; map
    private final java.util.concurrent.locks.ReentrantReadWriteLock $reentrantlock

    public int get(java.lang.String id) {
        $reentrantlock.readLock().lock()
        try {
            map.get(id)
        }
        finally {
            $reentrantlock.readLock().unlock()
        }
    }

    public void add(java.lang.String id, int num) {
        $reentrantlock.writeLock().lock()
        try {
            java.lang.Thread.sleep(200)
            map.put(id, map.get(id) + num )
        }
        finally {
            $reentrantlock.writeLock().unlock()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>@WithReadLock</code> and <code>@WithWriteLock</code> support specifying an alternative lock object. In that case, the referenced
 field must be declared by the user, like in the following alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.WithReadLock
import groovy.transform.WithWriteLock

import java.util.concurrent.locks.ReentrantReadWriteLock

class Counters {
    public final Map&lt;String,Integer&gt; map = [:].withDefault { 0 }
    private final ReentrantReadWriteLock customLock = new ReentrantReadWriteLock()

    @WithReadLock('customLock')
    int get(String id) {
        map.get(id)
    }

    @WithWriteLock('customLock')
    void add(String id, int num) {
        Thread.sleep(200) // emulate long computation
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See Javadoc for <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/WithReadLock.html">groovy.transform.WithReadLock</a></p>
</li>
<li>
<p>See Javadoc for <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/WithWriteLock.html">groovy.transform.WithWriteLock</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_easier_cloning_and_externalizing"><a class="anchor" href="#_easier_cloning_and_externalizing"></a><a class="link" href="#_easier_cloning_and_externalizing">Easier cloning and externalizing</a></h6>
<div class="paragraph">
<p>Groovy provides two annotations aimed at facilitating the implementation of <code>Cloneable</code> and <code>Externalizable</code> interfaces,
respectively named <code>@AutoClone</code> and <code>@AutoExternalize</code>.</p>
</div>
<div class="sect6">
<h7 id="xform-AutoClone"><a class="anchor" href="#xform-AutoClone"></a><a class="link" href="#xform-AutoClone"><code>@groovy.transform.AutoClone</code></a></h7>
<div class="paragraph">
<p>The <code>@AutoClone</code> annotation is aimed at implementing the <code>@java.lang.Cloneable</code> interface using various strategies, thanks to the <code>style</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the default <code>AutoCloneStyle.CLONE</code> strategy calls <code>super.clone()</code> first then <code>clone()</code> on each cloneable property</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SIMPLE</code> strategy uses a regular constructor call and copies properties from the source to the clone</p>
</li>
<li>
<p>the <code>AutoCloneStyle.COPY_CONSTRUCTOR</code> strategy creates and uses a copy constructor</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SERIALIZATION</code> strategy uses serialization (or externalization) to clone the object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of those strategies have pros and cons which are discussed in the Javadoc for <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/AutoClone.html">groovy.transform.AutoClone</a> and <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/AutoCloneStyle.html">groovy.transform.AutoCloneStyle</a> .</p>
</div>
<div class="paragraph">
<p>For example, the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoClone

@AutoClone
class Book {
    String isbn
    String title
    List&lt;String&gt; authors
    Date publicationDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book implements Cloneable {
    String isbn
    String title
    List&lt;String&gt; authors
    Date publicationDate

    public Book clone() throws CloneNotSupportedException {
        Book result = super.clone()
        result.authors = authors instanceof Cloneable ? (List) authors.clone() : authors
        result.publicationDate = publicationDate.clone()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the String properties aren&#8217;t explicitly handled because Strings are immutable and the <code>clone()</code> method from <code>Object</code> will copy the String references. The same would apply to primitive fields and most of the concrete subclasses of <code>java.lang.Number</code>.</p>
</div>
<div class="paragraph">
<p>In addition to cloning styles, <code>@AutoClone</code> supports multiple options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from cloning. A string consisting of a comma-separated field/property names is also allowed.
See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/AutoClone.html#excludes">groovy.transform.AutoClone#excludes</a> for details</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoClone
import groovy.transform.AutoCloneStyle

@AutoClone(style=AutoCloneStyle.SIMPLE,excludes='authors')
class Book {
    String isbn
    String title
    List authors
    Date publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are cloned. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoClone
import groovy.transform.AutoCloneStyle

@AutoClone(style=AutoCloneStyle.SIMPLE,includeFields=true)
class Book {
    String isbn
    String title
    List authors
    protected Date publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-AutoExternalize"><a class="anchor" href="#xform-AutoExternalize"></a><a class="link" href="#xform-AutoExternalize"><code>@groovy.transform.AutoExternalize</code></a></h7>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> AST transformation will assist in the creation of <code>java.io.Externalizable</code> classes. It will
automatically add the interface to the class and generate the <code>writeExternal</code> and <code>readExternal</code> methods. For example, this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoExternalize

@AutoExternalize
class Book {
    String isbn
    String title
    float price
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book implements java.io.Externalizable {
    String isbn
    String title
    float price

    void writeExternal(ObjectOutput out) throws IOException {
        out.writeObject(isbn)
        out.writeObject(title)
        out.writeFloat( price )
    }

    public void readExternal(ObjectInput oin) {
        isbn = (String) oin.readObject()
        title = (String) oin.readObject()
        price = oin.readFloat()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> annotation supports two parameters which will let you slightly customize its behavior:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from externalizing. A string consisting of a comma-separated field/property names is also allowed.
See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/AutoExternalize.html#excludes">groovy.transform.AutoExternalize#excludes</a> for details</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoExternalize

@AutoExternalize(excludes='price')
class Book {
    String isbn
    String title
    float price
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are externalized. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoExternalize

@AutoExternalize(includeFields=true)
class Book {
    String isbn
    String title
    protected float price
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_safer_scripting"><a class="anchor" href="#_safer_scripting"></a><a class="link" href="#_safer_scripting">Safer scripting</a></h6>
<div class="paragraph">
<p>The Groovy language makes it easy to execute user scripts at runtime (for example using <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyShell.html">groovy.lang.GroovyShell</a>),
but how do you make sure that a script won&#8217;t eat all CPU (infinite loops) or that concurrent scripts won&#8217;t slowly consume
all available threads of a thread pool? Groovy provides several annotations which are aimed towards safer scripting,
generating code which will for example allow you to interrupt execution automatically.</p>
</div>
<div class="sect6">
<h7 id="xform-ThreadInterrupt"><a class="anchor" href="#xform-ThreadInterrupt"></a><a class="link" href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a></h7>
<div class="paragraph">
<p>One complicated situation in the JVM world is when a thread can&#8217;t be stopped. The <code>Thread#stop</code> method exists but is
deprecated (and isn&#8217;t reliable) so your only chance lies in <code>Thread#interrupt</code>. Calling the latter will set the
<code>interrupt</code> flag on the thread, but it will <strong>not</strong> stop the execution of the thread. This is problematic because it&#8217;s the
responsibility of the code executing in the thread to check the interrupt flag and properly exit. This makes sense when
you, as a developer, know that the code you are executing is meant to be run in an independent thread, but in general,
you don&#8217;t know it. It&#8217;s even worse with user scripts, who might not even know what a thread is (think of DSLs).</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> simplifies this by adding thread interruption checks at critical places in the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loops (for, while)</p>
</li>
<li>
<p>first instruction of a method</p>
</li>
<li>
<p>first instruction of a closure body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine the following user script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">while (true) {
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an obvious infinite loop. If this code executes in its own thread, interrupting wouldn&#8217;t help: if you <code>join</code> on
the thread, then the calling code would be able to continue, but the thread would still be alive, running in background
without any ability for you to stop it, slowly causing thread starvation.</p>
</div>
<div class="paragraph">
<p>One possibility to work around this is to set up your shell this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(ThreadInterrupt)
)
def binding = new Binding(i:0)
def shell = new GroovyShell(binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell is then configured to automatically apply the <code>@ThreadInterrupt</code> AST transformations on all scripts. This allows
you to execute user scripts this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(1000) // give at most 1000ms for the script to complete
if (t.alive) {
    t.interrupt()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation automatically modified user code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">while (true) {
    if (Thread.currentThread().interrupted) {
        throw new InterruptedException('The current thread has been interrupted.')
    }
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The check which is introduced inside the loop guarantees that if the <code>interrupt</code> flag is set on the current thread, an
exception will be thrown, interrupting the execution of the thread.</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if the thread is interrupted.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class BadException extends Exception {
    BadException(String message) { super(message) }
}

def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(thrown:BadException, ThreadInterrupt)
)
def binding = new Binding(i:0)
def shell = new GroovyShell(this.class.classLoader,binding,config)

def userCode = """
try {
    while (true) {
        i++
    }
} catch (BadException e) {
    i = -1
}
"""

def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(1000) // give at most 1s for the script to complete
assert binding.i &gt; 0
if (t.alive) {
    t.interrupt()
}
Thread.sleep(500)
assert binding.i == -1'''</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ThreadInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ThreadInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class A {
    @ThreadInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TimedInterrupt"><a class="anchor" href="#xform-TimedInterrupt"></a><a class="link" href="#xform-TimedInterrupt"><code>@groovy.transform.TimedInterrupt</code></a></h7>
<div class="paragraph">
<p>The <code>@TimedInterrupt</code> AST transformation tries to solve a slightly different problem from <a href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a>: instead of checking the <code>interrupt</code> flag of the thread, it will automatically
throw an exception if the thread has been running for too long.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This annotation does <strong>not</strong> spawn a monitoring thread. Instead, it works in a similar manner as <code>@ThreadInterrupt</code> by placing checks at appropriate places in the code. This means that if you
have a thread blocked by I/O, it will <strong>not</strong> be interrupted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine the following user code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def fib(int n) { n&lt;2?n:fib(n-1)+fib(n-2) }

result = fib(600)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the famous Fibonacci number computation here is far from optimized. If it is called with a high <code>n</code> value, it can take minutes to answer. With <code>@TimedInterrupt</code>, you can
choose how long a script is allowed to run. The following setup code will allow the user script to run for 1 second at max:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(value:1, TimedInterrupt)
)
def binding = new Binding(result:0)
def shell = new GroovyShell(this.class.classLoader, binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is equivalent to annotating a class with <code>@TimedInterrupt</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(value=1, unit=TimeUnit.SECONDS)
class MyClass {
    def fib(int n) {
        n&lt;2?n:fib(n-1)+fib(n-2)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TimedInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>unit</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(value=500L, unit= TimeUnit.MILLISECONDS, applyToAllClasses = false)
class Slow {
    def fib(n) { n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    result = new Slow().fib(500)
}
t.join(5000)
assert result == null
assert !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit.SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>value</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(value=500L, unit= TimeUnit.MILLISECONDS, applyToAllClasses = false)
class Slow {
    def fib(n) { n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    result = new Slow().fib(500)
}
t.join(5000)
assert result == null
assert !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.concurrent.TimeoutException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if timeout is reached.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(thrown=TooLongException, applyToAllClasses = false, value=1L)
class Slow {
    def fib(n) { Thread.sleep(100); n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    try {
        result = new Slow().fib(50)
    } catch (TooLongException e) {
        result = -1
    }
}
t.join(5000)
assert result == -1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TimedInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class A {
    @TimedInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@TimedInterrupt</code> is currently not compatible with static methods!
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="xform-ConditionalInterrupt"><a class="anchor" href="#xform-ConditionalInterrupt"></a><a class="link" href="#xform-ConditionalInterrupt"><code>@groovy.transform.ConditionalInterrupt</code></a></h7>
<div class="paragraph">
<p>The last annotation for safer scripting is the base annotation when you want to interrupt a script using a custom strategy. In particular, this is the annotation of choice if you
want to use resource management (limit the number of calls to an API, &#8230;&#8203;). In the following example, user code is using an infinite loop, but <code>@ConditionalInterrupt</code> will allow us
to check a quota manager and interrupt automatically the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ConditionalInterrupt({Quotas.disallow('user')})
class UserCode {
    void doSomething() {
        int i=0
        while (true) {
            println "Consuming resources ${++i}"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The quota checking is very basic here, but it can be any code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Quotas {
    static def quotas = [:].withDefault { 10 }
    static boolean disallow(String userName) {
        println "Checking quota for $userName"
        (quotas[userName]--)&lt;0
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can make sure <code>@ConditionalInterrupt</code> works properly using this test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert Quotas.quotas['user'] == 10
def t = Thread.start {
    new UserCode().doSomething()
}
t.join(5000)
assert !t.alive
assert Quotas.quotas['user'] &lt; 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, in practice, it is unlikely that <code>@ConditionalInterrupt</code> will be itself added by hand on user code. It can be injected in a similar manner as the example shown in the
<a href="#xform-ThreadInterrupt">ThreadInterrupt</a> section, using the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html">org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</a> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()
def checkExpression = new ClosureExpression(
        Parameter.EMPTY_ARRAY,
        new ExpressionStatement(
                new MethodCallExpression(new ClassExpression(ClassHelper.make(Quotas)), 'disallow', new ConstantExpression('user'))
        )
)
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(value: checkExpression, ConditionalInterrupt)
)

def shell = new GroovyShell(this.class.classLoader,new Binding(),config)

def userCode = """
        int i=0
        while (true) {
            println "Consuming resources \\${++i}"
        }
"""

assert Quotas.quotas['user'] == 10
def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(5000)
assert !t.alive
assert Quotas.quotas['user'] &lt; 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ConditionalInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The closure which will be called to check if execution is allowed. If the closure returns false, execution is allowed. If it returns true, then an exception will be thrown.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ConditionalInterrupt({ ... })</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if execution should be aborted.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.addCompilationCustomizers(
        new ASTTransformationCustomizer(thrown: QuotaExceededException,value: checkExpression, ConditionalInterrupt)
)
assert Quotas.quotas['user'] == 10
def t = Thread.start {
    try {
        shell.evaluate(userCode)
    } catch (QuotaExceededException) {
        Quotas.quotas['user'] = 'Quota exceeded'
    }
}
t.join(5000)
assert !t.alive
assert Quotas.quotas['user'] == 'Quota exceeded'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ConditionalInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@ConditionalInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class A {
    @ConditionalInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_compiler_directives"><a class="anchor" href="#_compiler_directives"></a><a class="link" href="#_compiler_directives">Compiler directives</a></h6>
<div class="paragraph">
<p>This category of AST transformations groups annotations which have a direct impact on the semantics of the code, rather
than focusing on code generation. With that regards, they can be seen as compiler directives that either change the
behavior of a program at compile time or runtime.</p>
</div>
<div class="sect6">
<h7 id="xform-Field"><a class="anchor" href="#xform-Field"></a><a class="link" href="#xform-Field"><code>@groovy.transform.Field</code></a></h7>
<div class="paragraph">
<p>The <code>@Field</code> annotation only makes sense in the context of a script and aims at solving a common scoping error with
scripts. The following example will for example fail at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x

String line() {
    "="*x
}

x=3
assert "===" == line()
x=5
assert "=====" == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error that is thrown may be difficult to interpret: groovy.lang.MissingPropertyException: No such property: x. The reason is that scripts are compiled
to classes and the script body is itself compiled as a single <em>run()</em> method. Methods which are defined in the scripts are independent, so the code above is
equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyScript extends Script {

    String line() {
        "="*x
    }

    public def run() {
        def x
        x=3
        assert "===" == line()
        x=5
        assert "=====" == line()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>def x</code> is effectively interpreted as a local variable, outside of the scope of the <code>line</code> method. The <code>@Field</code> AST transformation aims at fixing this
by changing the scope of the variable to a field of the enclosing script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Field def x

String line() {
    "="*x
}

x=3
assert "===" == line()
x=5
assert "=====" == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting, equivalent, code is now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyScript extends Script {

    def x

    String line() {
        "="*x
    }

    public def run() {
        x=3
        assert "===" == line()
        x=5
        assert "=====" == line()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-PackageScope"><a class="anchor" href="#xform-PackageScope"></a><a class="link" href="#xform-PackageScope"><code>@groovy.transform.PackageScope</code></a></h7>
<div class="paragraph">
<p>By default, Groovy visibility rules imply that if you create a field without specifying a modifier, then the field is interpreted as a property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name // this is a property
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you want to create a package private field instead of a property (private field+getter/setter), then annotate your field with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    @PackageScope String name // not a property anymore
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation can also be used for classes, methods and constructors. In addition, by specifying a list
of <code>PackageScopeTarget</code> values as the annotation attribute at the class level, all members within that class that don&#8217;t
have an explicit modifier and match the provided <code>PackageScopeTarget</code> will remain package protected. For example to apply
to fields within a class use the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.transform.PackageScopeTarget.FIELDS
@PackageScope(FIELDS)
class Person {
  String name     // not a property, package protected
  Date dob        // not a property, package protected
  private int age // explicit modifier, so won't be touched
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation is seldom used as part of normal Groovy conventions but is sometimes useful
for factory methods that should be visible internally within a package or for methods or constructors provided
for testing purposes, or when integrating with third-party libraries which require such visibility conventions.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Final"><a class="anchor" href="#xform-Final"></a><a class="link" href="#xform-Final"><code>@groovy.transform.Final</code></a></h7>
<div class="paragraph">
<p><code>@Final</code> is essentially an alias for the <code>final</code> modifier.
The intention is that you would almost never use the <code>@Final</code> annotation directly (just use <code>final</code>).
However, when creating meta-annotations that should apply
the final modifier to the node being annotated, you can mix in <code>@Final</code>, e.g..</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@AnnotationCollector([Singleton,Final]) @interface MySingleton {}

@MySingleton
class GreetingService {
    String greeting(String name) { "Hello, $name!" }
}
assert GreetingService.instance.greeting('Bob') == 'Hello, Bob!'
assert Modifier.isFinal(GreetingService.modifiers)</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-AutoFinal"><a class="anchor" href="#xform-AutoFinal"></a><a class="link" href="#xform-AutoFinal"><code>@groovy.transform.AutoFinal</code></a></h7>
<div class="paragraph">
<p>The <code>@AutoFinal</code> annotation instructs the compiler to automatically insert the final modifier
in numerous places within the annotated node. If applied on a method (or constructor), the parameters
for that method (or constructor) will be marked as final. If applied on a class definition, the same
treatment will occur for all declared methods and constructors within that class.</p>
</div>
<div class="paragraph">
<p>It is often considered bad practice to reassign parameters of a method or constructor with its body.
By adding the final modifier to all parameter declarations you can avoid this practice entirely.
Some programmers feel that adding final everywhere increases the amount of boilerplate code and makes the
method signatures somewhat noisy. An alternative might instead be to use a code review process or apply
a <a href="http://codenarc.org">codenarc</a> <a href="https://codenarc.github.io/CodeNarc/codenarc-rules-convention.html#parameterreassignment-rule">rule</a>
to give warnings if that practice is observed but these alternatives might lead to delayed feedback during
quality checking rather than within the IDE or during compilation. The <code>@AutoFinal</code> annotation aims to
maximise compiler/IDE feedback while retaining succinct code with minimum boilerplate noise.</p>
</div>
<div class="paragraph">
<p>The following example illustrates applying the annotation at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.AutoFinal

@AutoFinal
class Person {
    private String first, last

    Person(String first, String last) {
        this.first = first
        this.last = last
    }

    String fullName(String separator) {
        "$first$separator$last"
    }

    String greeting(String salutation) {
        "$salutation, $first"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the two parameters for the constructor and the single parameter for
both the <code>fullname</code> and <code>greeting</code> methods will be final. Attempts to modify those parameters within the
constructor or method bodies will be flagged by the compiler.</p>
</div>
<div class="paragraph">
<p>The following example illustrates applying the annotation at the method level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Calc {
    @AutoFinal
    int add(int a, int b) { a + b }

    int mult(int a, int b) { a * b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>add</code> method will have final parameters but the <code>mult</code> method will remain unchanged.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-AnnotationCollector"><a class="anchor" href="#xform-AnnotationCollector"></a><a class="link" href="#xform-AnnotationCollector"><code>@groovy.transform.AnnotationCollector</code></a></h7>
<div class="paragraph">
<p><code>@AnnotationCollector</code> allows the creation of meta-annotations, which are described in a <a href="core-object-orientation.html#_meta_annotations">dedicated section</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-TypeChecked"><a class="anchor" href="#xform-TypeChecked"></a><a class="link" href="#xform-TypeChecked"><code>@groovy.transform.TypeChecked</code></a></h7>
<div class="paragraph">
<p><code>@TypeChecked</code> activates compile-time type checking on your Groovy code. See <a href="#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileStatic"><a class="anchor" href="#xform-CompileStatic"></a><a class="link" href="#xform-CompileStatic"><code>@groovy.transform.CompileStatic</code></a></h7>
<div class="paragraph">
<p><code>@CompileStatic</code> activates static compilation on your Groovy code. See <a href="#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileDynamic"><a class="anchor" href="#xform-CompileDynamic"></a><a class="link" href="#xform-CompileDynamic"><code>@groovy.transform.CompileDynamic</code></a></h7>
<div class="paragraph">
<p><code>@CompileDynamic</code> disables static compilation on parts of your Groovy code. See <a href="#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-DelegatesTo"><a class="anchor" href="#xform-DelegatesTo"></a><a class="link" href="#xform-DelegatesTo"><code>@groovy.lang.DelegatesTo</code></a></h7>
<div class="paragraph">
<p><code>@DelegatesTo</code> is not, technically speaking, an AST transformation. It is aimed at documenting code and helping the compiler in case you are
using <a href="#xform-TypeChecked">type checking</a> or <a href="#xform-CompileStatic">static compilation</a>. The annotation is described thoroughly in the
<a href="#section-delegatesto">DSL section</a> of this guide.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-SelfType"><a class="anchor" href="#xform-SelfType"></a><a class="link" href="#xform-SelfType"><code>@groovy.transform.SelfType</code></a></h7>
<div class="paragraph">
<p><code>@SelfType</code> is not an AST transformation but rather a marker interface used
with traits. See the <a href="#traits-selftype">traits documentation</a> for further details.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_swing_patterns"><a class="anchor" href="#_swing_patterns"></a><a class="link" href="#_swing_patterns">Swing patterns</a></h6>
<div class="sect6">
<h7 id="xform-Bindable"><a class="anchor" href="#xform-Bindable"></a><a class="link" href="#xform-Bindable"><code>@groovy.beans.Bindable</code></a></h7>
<div class="paragraph">
<p><code>@Bindable</code> is an AST transformation that transforms a regular property into a bound property (according to the <a href="http://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans specification</a>).
The <code>@Bindable</code> annotation can be placed on a property or a class. To convert all properties of a class into bound properties, on can annotate the class like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.beans.Bindable

@Bindable
class Person {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.beans.PropertyChangeListener
import java.beans.PropertyChangeSupport

class Person {
    final private PropertyChangeSupport this$propertyChangeSupport

    String name
    int age

    public void addPropertyChangeListener(PropertyChangeListener listener) {
        this$propertyChangeSupport.addPropertyChangeListener(listener)
    }

    public void addPropertyChangeListener(String name, PropertyChangeListener listener) {
        this$propertyChangeSupport.addPropertyChangeListener(name, listener)
    }

    public void removePropertyChangeListener(PropertyChangeListener listener) {
        this$propertyChangeSupport.removePropertyChangeListener(listener)
    }

    public void removePropertyChangeListener(String name, PropertyChangeListener listener) {
        this$propertyChangeSupport.removePropertyChangeListener(name, listener)
    }

    public void firePropertyChange(String name, Object oldValue, Object newValue) {
        this$propertyChangeSupport.firePropertyChange(name, oldValue, newValue)
    }

    public PropertyChangeListener[] getPropertyChangeListeners() {
        return this$propertyChangeSupport.getPropertyChangeListeners()
    }

    public PropertyChangeListener[] getPropertyChangeListeners(String name) {
        return this$propertyChangeSupport.getPropertyChangeListeners(name)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> therefore removes a lot of boilerplate from your class, dramatically increasing readability. If the annotation is put on a single property, only that property is bound:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.beans.Bindable

class Person {
    String name
    @Bindable int age
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-ListenerList"><a class="anchor" href="#xform-ListenerList"></a><a class="link" href="#xform-ListenerList"><code>@groovy.beans.ListenerList</code></a></h7>
<div class="paragraph">
<p>The <code>@ListenerList</code> AST transformation generates code for adding, removing and getting the list of listeners to a class, just by annotating a collection property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.awt.event.ActionListener
import groovy.beans.ListenerList

class Component {
    @ListenerList
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transform will generate the appropriate add/remove methods based on the generic type of the list. In addition, it will also create <code>fireXXX</code> methods based on the public methods declared on the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.awt.event.ActionEvent
import java.awt.event.ActionListener as ActionListener
import groovy.beans.ListenerList as ListenerList

public class Component {

    @ListenerList
    private List&lt;ActionListener&gt; listeners

    public void addActionListener(ActionListener listener) {
        if ( listener == null) {
            return
        }
        if ( listeners == null) {
            listeners = []
        }
        listeners.add(listener)
    }

    public void removeActionListener(ActionListener listener) {
        if ( listener == null) {
            return
        }
        if ( listeners == null) {
            listeners = []
        }
        listeners.remove(listener)
    }

    public ActionListener[] getActionListeners() {
        Object __result = []
        if ( listeners != null) {
            __result.addAll(listeners)
        }
        return (( __result ) as ActionListener[])
    }

    public void fireActionPerformed(ActionEvent param0) {
        if ( listeners != null) {
            ArrayList&lt;ActionListener&gt; __list = new ArrayList&lt;ActionListener&gt;(listeners)
            for (def listener : __list ) {
                listener.actionPerformed(param0)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the suffix which will be appended to add/remove/&#8230;&#8203; methods is the simple class name of the generic type of the list.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Component {
    @ListenerList(name='item')
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, generated methods will be synchronized</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Component {
    @ListenerList(synchronize = true)
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Vetoable"><a class="anchor" href="#xform-Vetoable"></a><a class="link" href="#xform-Vetoable"><code>@groovy.beans.Vetoable</code></a></h7>
<div class="paragraph">
<p>The <code>@Vetoable</code> annotation works in a similar manner to <code>@Bindable</code> but generates constrained property according to the JavaBeans specification, instead of bound properties. The annotation
can be placed on a class, meaning that all properties will be converted to constrained properties, or on a single property. For example, annotating this class with <code>@Vetoable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.beans.Vetoable

import java.beans.PropertyVetoException
import java.beans.VetoableChangeListener

@Vetoable
class Person {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class Person {

    private String name
    private int age
    final private java.beans.VetoableChangeSupport this$vetoableChangeSupport

    public void addVetoableChangeListener(VetoableChangeListener listener) {
        this$vetoableChangeSupport.addVetoableChangeListener(listener)
    }

    public void addVetoableChangeListener(String name, VetoableChangeListener listener) {
        this$vetoableChangeSupport.addVetoableChangeListener(name, listener)
    }

    public void removeVetoableChangeListener(VetoableChangeListener listener) {
        this$vetoableChangeSupport.removeVetoableChangeListener(listener)
    }

    public void removeVetoableChangeListener(String name, VetoableChangeListener listener) {
        this$vetoableChangeSupport.removeVetoableChangeListener(name, listener)
    }

    public void fireVetoableChange(String name, Object oldValue, Object newValue) throws PropertyVetoException {
        this$vetoableChangeSupport.fireVetoableChange(name, oldValue, newValue)
    }

    public VetoableChangeListener[] getVetoableChangeListeners() {
        return this$vetoableChangeSupport.getVetoableChangeListeners()
    }

    public VetoableChangeListener[] getVetoableChangeListeners(String name) {
        return this$vetoableChangeSupport.getVetoableChangeListeners(name)
    }

    public void setName(String value) throws PropertyVetoException {
        this.fireVetoableChange('name', name, value)
        name = value
    }

    public void setAge(int value) throws PropertyVetoException {
        this.fireVetoableChange('age', age, value)
        age = value
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the annotation is put on a single property, only that property is made vetoable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.beans.Vetoable

class Person {
    String name
    @Vetoable int age
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_test_assistance"><a class="anchor" href="#_test_assistance"></a><a class="link" href="#_test_assistance">Test assistance</a></h6>
<div class="sect6">
<h7 id="xform-NotYetImplemented"><a class="anchor" href="#xform-NotYetImplemented"></a><a class="link" href="#xform-NotYetImplemented"><code>@groovy.test.NotYetImplemented</code></a></h7>
<div class="paragraph">
<p><code>@NotYetImplemented</code> is used to invert the result of a JUnit 3/4 test case. It is in particular useful if a feature is not yet implemented but the test is. In that case, it is expected
that the test fails. Marking it with <code>@NotYetImplemented</code> will inverse the result of the test, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.test.GroovyTestCase
import groovy.test.NotYetImplemented

class Maths {
    static int fib(int n) {
        // todo: implement later
    }
}

class MathsTest extends GroovyTestCase {
    @NotYetImplemented
    void testFib() {
        def dataTable = [
                1:1,
                2:1,
                3:2,
                4:3,
                5:5,
                6:8,
                7:13
        ]
        dataTable.each { i, r -&gt;
            assert Maths.fib(i) == r
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another advantage of using this technique is that you can write test cases for bugs before knowing how to fix them. If some time in the future, a modification in the code fixes a bug by side effect,
you&#8217;ll be notified because a test which was expected to fail passed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-ASTTest"><a class="anchor" href="#xform-ASTTest"></a><a class="link" href="#xform-ASTTest"><code>@groovy.transform.ASTTest</code></a></h7>
<div class="paragraph">
<p><code>@ASTTest</code> is a special AST transformation meant to help debugging other AST transformations or the Groovy compiler itself. It will let the developer "explore" the AST during compilation and
perform assertions on the AST rather than on the result of compilation. This means that this AST transformations gives access to the AST before the bytecode is produced. <code>@ASTTest</code> can be
placed on any annotable node and requires two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>phase</em>: sets at which phase at which <code>@ASTTest</code> will be triggered. The test code will work on the AST tree at the end of this phase.</p>
</li>
<li>
<p><em>value</em>: the code which will be executed once the phase is reached, on the annotated node</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Compile phase has to be chosen from one of <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/CompilePhase.html">org.codehaus.groovy.control.CompilePhase</a> . However, since it is not possible to annotate a node twice with the same annotation, you will
not be able to use <code>@ASTTest</code> on the same node at two distinct compile phases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>value</code> is a closure expression which has access to a special variable <code>node</code> corresponding to the annotated node, and a helper <code>lookup</code> method which will be discussed <a href="#asttest-lookup">here</a>.
For example, you can annotate a class node like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ASTTest
import org.codehaus.groovy.ast.ClassNode

@ASTTest(phase=CONVERSION, value={   <i class="conum" data-value="1"></i><b>(1)</b>
    assert node instanceof ClassNode <i class="conum" data-value="2"></i><b>(2)</b>
    assert node.name == 'Person'     <i class="conum" data-value="3"></i><b>(3)</b>
})
class Person {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we&#8217;re checking the state of the Abstract Syntax Tree after the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>node refers to the AST node which is annotated by @ASTTest</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>it can be used to perform assertions at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One interesting feature of <code>@ASTTest</code> is that if an assertion fails, then <strong>compilation will fail</strong>. Now imagine that we want to check the behavior of an AST transformation at compile time.
We will take <code>@PackageScope</code> here, and we will want to verify that a property annotated with <code>@PackageScope</code> becomes a package private field. For this, we have to know at which phase the
transform runs, which can be found in <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/PackageScopeASTTransformation.html">org.codehaus.groovy.transform.PackageScopeASTTransformation</a> : semantic analysis. Then a test can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ASTTest
import groovy.transform.PackageScope

@ASTTest(phase=SEMANTIC_ANALYSIS, value={
    def nameNode = node.properties.find { it.name == 'name' }
    def ageNode = node.properties.find { it.name == 'age' }
    assert nameNode
    assert ageNode == null // shouldn't be a property anymore
    def ageField = node.getDeclaredField 'age'
    assert ageField.modifiers == 0
})
class Person {
    String name
    @PackageScope int age
}</code></pre>
</div>
</div>
<div id="asttest-lookup" class="paragraph">
<p>The <code>@ASTTest</code> annotation can only be placed wherever the grammar allows it. Sometimes, you would like to test the contents of an AST node which is not annotable. In this case,
<code>@ASTTest</code> provides a convenient <code>lookup</code> method which will search the AST for nodes which are labelled with a special token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def list = lookup('anchor') <i class="conum" data-value="1"></i><b>(1)</b>
Statement stmt = list[0] <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns the list of AST nodes which label is 'anchor'</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is always necessary to choose which element to process since lookup always returns a list</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine, for example, that you want to test the declared type of a for loop variable. Then you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ASTTest
import groovy.transform.PackageScope
import org.codehaus.groovy.ast.ClassHelper
import org.codehaus.groovy.ast.expr.DeclarationExpression
import org.codehaus.groovy.ast.stmt.ForStatement

class Something {
    @ASTTest(phase=SEMANTIC_ANALYSIS, value={
        def forLoop = lookup('anchor')[0]
        assert forLoop instanceof ForStatement
        def decl = forLoop.collectionExpression.expressions[0]
        assert decl instanceof DeclarationExpression
        assert decl.variableExpression.name == 'i'
        assert decl.variableExpression.originType == ClassHelper.int_TYPE
    })
    void someMethod() {
        int x = 1;
        int y = 10;
        anchor: for (int i=0; i&lt;x+y; i++) {
            println "$i"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ASTTest</code> also exposes those variables inside the test closure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>node</code> corresponds to the annotated node, as usual</p>
</li>
<li>
<p><code>compilationUnit</code> gives access to the current <code>org.codehaus.groovy.control.CompilationUnit</code></p>
</li>
<li>
<p><code>compilePhase</code> returns the current compile phase (<code>org.codehaus.groovy.control.CompilePhase</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is interesting if you don&#8217;t specify the <code>phase</code> attribute. In that case, the closure will be executed after
each compile phase after (and including) <code>SEMANTIC_ANALYSIS</code>. The context of the transformation is kept after each phase,
giving you a chance to check what changed between two phases.</p>
</div>
<div class="paragraph">
<p>As an example, here is how you could dump the list of AST transformations registered on a class node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ASTTest
import groovy.transform.CompileStatic
import groovy.transform.Immutable
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.control.CompilePhase

@ASTTest(value={
    System.err.println "Compile phase: $compilePhase"
    ClassNode cn = node
    System.err.println "Global AST xforms: ${compilationUnit?.ASTTransformationsContext?.globalTransformNames}"
    CompilePhase.values().each {
        def transforms = cn.getTransforms(it)
        if (transforms) {
            System.err.println "Ast xforms for phase $it:"
            transforms.each { map -&gt;
                System.err.println(map)
            }
        }
    }
})
@CompileStatic
@Immutable
class Foo {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how you can memorize variables for testing between two phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.ASTTest
import groovy.transform.ToString
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.control.CompilePhase

@ASTTest(value={
    if (compilePhase == CompilePhase.INSTRUCTION_SELECTION) {           <i class="conum" data-value="1"></i><b>(1)</b>
        println "toString() was added at phase: ${added}"
        assert added == CompilePhase.CANONICALIZATION                   <i class="conum" data-value="2"></i><b>(2)</b>
    } else {
        if (node.getDeclaredMethods('toString') &amp;&amp; added == null) {     <i class="conum" data-value="3"></i><b>(3)</b>
            added = compilePhase                                        <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
})
@ToString
class Foo {
    String name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the current compile phase is instruction selection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then we want to make sure <code>toString</code> was added at <code>CANONICALIZATION</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>otherwise, if <code>toString</code> exists and that the variable from the context, <code>added</code> is null</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then it means that this compile phase is the one where <code>toString</code> was added</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_grape_handling"><a class="anchor" href="#_grape_handling"></a><a class="link" href="#_grape_handling">Grape handling</a></h6>
<div class="sect6">
<h7 id="xform-Grab"><a class="anchor" href="#xform-Grab"></a><a class="link" href="#xform-Grab"><code>@groovy.lang.Grab</code></a></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabConfig"><a class="anchor" href="#xform-GrabConfig"></a><a class="link" href="#xform-GrabConfig"><code>@groovy.lang.GrabConfig</code></a></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabExclude"><a class="anchor" href="#xform-GrabExclude"></a><a class="link" href="#xform-GrabExclude"><code>@groovy.lang.GrabExclude</code></a></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabResolver"><a class="anchor" href="#xform-GrabResolver"></a><a class="link" href="#xform-GrabResolver"><code>@groovy.lang.GrabResolver</code></a></h7>

</div>
<div class="sect6">
<h7 id="xform-Grapes"><a class="anchor" href="#xform-Grapes"></a><a class="link" href="#xform-Grapes"><code>@groovy.lang.Grapes</code></a></h7>
<div class="paragraph">
<p><code>Grape</code> is a dependency management engine embedded into Groovy, relying on several annotations which are described
thoroughly in this <a href="#section-grape">section of the guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="developing-ast-xforms"><a class="anchor" href="#developing-ast-xforms"></a><a class="link" href="#developing-ast-xforms">Developing AST transformations</a></h5>
<div class="paragraph">
<p>There are two kinds of transformations: global and local transformations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#transforms-global">Global transformations</a> are applied to by the compiler on the code being compiled,
wherever the transformation apply. Compiled classes that implement global transformations
are in a JAR added to the classpath of the compiler and contain service locator file
<code>META-INF/services/org.codehaus.groovy.transform.ASTTransformation</code> with a line with the name of the
transformation class. The transformation class must have a no-args constructor and implement the
<code>org.codehaus.groovy.transform.ASTTransformation</code> interface.
It will be run against <strong>every source in the compilation</strong>, so be sure to not create transformations which
scan all the AST in an expansive and time-consuming manner, to keep the compiler fast.</p>
</li>
<li>
<p><a href="#transforms-local">Local transformations</a> are transformations applied locally by annotating code elements you want to
transform. For this, we reuse the annotation notation, and those annotations should implement
<code>org.codehaus.groovy.transform.ASTTransformation</code>. The compiler will discover them and apply the
transformation on these code elements.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_compilation_phases_guide"><a class="anchor" href="#_compilation_phases_guide"></a><a class="link" href="#_compilation_phases_guide">Compilation phases guide</a></h6>
<div class="paragraph">
<p>Groovy AST transformations must be performed in one of the nine defined
compilation phases (<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/CompilePhase.html">org.codehaus.groovy.control.CompilePhase</a>).</p>
</div>
<div class="paragraph">
<p>Global transformations may be applied in any phase, but local
transformations may only be applied in the semantic analysis phase or
later. Briefly, the compiler phases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Initialization</em>: source files are opened and environment configured</p>
</li>
<li>
<p><em>Parsing</em>: the grammar is used to produce tree of tokens representing
the source code</p>
</li>
<li>
<p><em>Conversion</em>: An abstract syntax tree (AST) is created from token trees.</p>
</li>
<li>
<p><em>Semantic Analysis</em>: Performs consistency and validity checks that the
grammar can’t check for, and resolves classes.</p>
</li>
<li>
<p><em>Canonicalization</em>: Complete building the AST</p>
</li>
<li>
<p><em>Instruction Selection</em>: instruction set is chosen, for example Java 6 or Java 7 bytecode level</p>
</li>
<li>
<p><em>Class Generation</em>: creates the bytecode of the class in memory</p>
</li>
<li>
<p><em>Output</em>: write the binary output to the file system</p>
</li>
<li>
<p><em>Finalization</em>: Perform any last cleanup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generally speaking, there is more type information available later in
the phases. If your transformation is concerned with reading the AST,
then a later phase where information is more plentiful might be a good
choice. If your transformation is concerned with writing AST, then an
earlier phase where the tree is more sparse might be more convenient.</p>
</div>
</div>
<div class="sect5">
<h6 id="transforms-local"><a class="anchor" href="#transforms-local"></a><a class="link" href="#transforms-local">Local transformations</a></h6>
<div class="paragraph">
<p>Local AST transformations are relative to the context they are applied to. In
most cases, the context is defined by an annotation that will define the scope
of the transform. For example, annotating a field would mean that the transformation
<em>applies to</em> the field, while annotating the class would mean that the transformation
<em>applies to</em> the whole class.</p>
</div>
<div class="paragraph">
<p>As a naive and simple example, consider wanting to write a <code>@WithLogging</code>
transformation that would add console messages at the start and end of a
method invocation. So the following "Hello World" example would
actually print "Hello World" along with a start and stop message:</p>
</div>
<div class="listingblock">
<div class="title">Poor man&#8217;s aspect oriented programming</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@WithLogging
def greet() {
    println "Hello World"
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>A local AST transformation is an easy way to do this. It requires two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a definition of the <code>@WithLogging</code> annotation</p>
</li>
<li>
<p>an implementation of <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/ASTTransformation.html">org.codehaus.groovy.transform.ASTTransformation</a> that adds the logging
expressions to the method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>ASTTransformation</code> is a callback that gives you access to the
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/SourceUnit.html">org.codehaus.groovy.control.SourceUnit</a>,
through which you can get a reference to the
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/ast/ModuleNode.html">org.codehaus.groovy.ast.ModuleNode</a> (AST).</p>
</div>
<div class="paragraph">
<p>The AST (Abstract Syntax Tree) is a tree structure consisting mostly of
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/ast/expr/Expression.html">org.codehaus.groovy.ast.expr.Expression</a> (expressions) or
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/ast/expr/Statement.html">org.codehaus.groovy.ast.expr.Statement</a> (statements). An easy way to
learn about the AST is to explore it in a debugger. Once you have the AST,
you can analyze it to find out information about the code or rewrite it to add
new functionality.</p>
</div>
<div class="paragraph">
<p>The local transformation annotation is the simple part. Here is the
<code>@WithLogging</code> one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.transform.GroovyASTTransformationClass

import java.lang.annotation.ElementType
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy
import java.lang.annotation.Target

@Retention(RetentionPolicy.SOURCE)
@Target([ElementType.METHOD])
@GroovyASTTransformationClass(["gep.WithLoggingASTTransformation"])
public @interface WithLogging {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation retention can be <code>SOURCE</code> because you won’t need the annotation
past that. The element type here is <code>METHOD</code>, the <code>@WithLogging</code> because the annotation
applies to methods.</p>
</div>
<div class="paragraph">
<p>But the most important part is the
<code>@GroovyASTTransformationClass</code> annotation. This links the <code>@WithLogging</code>
annotation to the <code>ASTTransformation</code> class you will write.
<code>gep.WithLoggingASTTransformation</code> is the fully qualified class name of the
<code>ASTTransformation</code> we are going to write. This line wires the annotation to the transformation.</p>
</div>
<div class="paragraph">
<p>With this in place, the Groovy compiler is going to invoke
<code>gep.WithLoggingASTTransformation</code> every time an <code>@WithLogging</code> is found in a
source unit. Any breakpoint set within <code>LoggingASTTransformation</code> will now
be hit within the IDE when running the sample script.</p>
</div>
<div class="paragraph">
<p>The <code>ASTTransformation</code> class is a little more complex. Here is the
very simple, and very naive, transformation to add a method start and
stop message for <code>@WithLogging</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
@GroovyASTTransformation(phase=CompilePhase.SEMANTIC_ANALYSIS)                  <i class="conum" data-value="2"></i><b>(2)</b>
class WithLoggingASTTransformation implements ASTTransformation {               <i class="conum" data-value="3"></i><b>(3)</b>

    @Override
    void visit(ASTNode[] nodes, SourceUnit sourceUnit) {                        <i class="conum" data-value="4"></i><b>(4)</b>
        MethodNode method = (MethodNode) nodes[1]                               <i class="conum" data-value="5"></i><b>(5)</b>

        def startMessage = createPrintlnAst("Starting $method.name")            <i class="conum" data-value="6"></i><b>(6)</b>
        def endMessage = createPrintlnAst("Ending $method.name")                <i class="conum" data-value="7"></i><b>(7)</b>

        def existingStatements = ((BlockStatement)method.code).statements       <i class="conum" data-value="8"></i><b>(8)</b>
        existingStatements.add(0, startMessage)                                 <i class="conum" data-value="9"></i><b>(9)</b>
        existingStatements.add(endMessage)                                      <i class="conum" data-value="10"></i><b>(10)</b>

    }

    private static Statement createPrintlnAst(String message) {                 <i class="conum" data-value="11"></i><b>(11)</b>
        new ExpressionStatement(
            new MethodCallExpression(
                new VariableExpression("this"),
                new ConstantExpression("println"),
                new ArgumentListExpression(
                    new ConstantExpression(message)
                )
            )
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate with <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/GroovyASTTransformation.html">org.codehaus.groovy.transform.GroovyASTTransformation</a> to tell at which compilation phase the
transform needs to run. Here, it&#8217;s at the <em>semantic analysis</em> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implement the <code>ASTTransformation</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which only has a single <code>visit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>nodes</code> parameter is a 2 AST node array, for which the first one is the annotation node (<code>@WithLogging</code>) and
the second one is the annotated node (the method node)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>create a statement that will print a message when we enter the method</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>create a statement that will print a message when we exit the method</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>get the method body, which in this case is a <code>BlockStatement</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>add the enter method message before the first statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>append the exit method message after the last statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to notice that for the brevity of this example, we didn&#8217;t make the necessary checks, such as checking
that the annotated node is really a <code>MethodNode</code>, or that the method body is an instance of <code>BlockStatement</code>. This
exercise is left to the reader.</p>
</div>
<div class="paragraph">
<p>Note the creation of the new println statements in the
<code>createPrintlnAst(String)</code> method. Creating AST for code is not always
simple. In this case we need to construct a new method call, passing in
the receiver/variable, the name of the method, and an argument list.
When creating AST, it might be helpful to write the code you’re trying
to create in a Groovy file and then inspect the AST of that code in the
debugger to learn what to create. Then write a function like
<code>createPrintlnAst</code> using what you learned through the debugger.</p>
</div>
<div class="paragraph">
<p>In the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@WithLogging
def greet() {
    println "Hello World"
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Starting greet
Hello World
Ending greet</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that an AST transformation participates directly in the compilation process. A common
error by beginners is to have the AST transformation code in the same source tree as a class that uses the transformation.
Being in the same source tree in general means that they are compiled at the same time. Since the transformation itself
is going to be compiled in phases and that each compile phase processes all files of the same source unit before going
to the next one, there&#8217;s a direct consequence: the transformation will not be compiled before the class that uses it! In
conclusion, AST transformations need to be precompiled before you can use them. In general, it is as easy as having them
in a separate source tree.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="transforms-global"><a class="anchor" href="#transforms-global"></a><a class="link" href="#transforms-global">Global transformations</a></h6>
<div class="paragraph">
<p>Global AST transformation are similar to local one with a major difference: they do not need an annotation, meaning that
they are applied <em>globally</em>, that is to say on each class being compiled. It is therefore very important to limit their
use to last resort, because it can have a significant impact on the compiler performance.</p>
</div>
<div class="paragraph">
<p>Following the example of the <a href="#transforms-local">local AST transformation</a>, imagine that we would like to trace all
methods, and not only those which are annotated with <code>@WithLogging</code>. Basically, we need this code to behave the same
as the one annotated with <code>@WithLogging</code> before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def greet() {
    println "Hello World"
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work, there are two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create the <code>org.codehaus.groovy.transform.ASTTransformation</code> descriptor inside the <code>META-INF/services</code> directory</p>
</li>
<li>
<p>create the <code>ASTTransformation</code> implementation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The descriptor file is required and must be found on classpath. It will contain a single line:</p>
</div>
<div class="listingblock">
<div class="title">META-INF/services/org.codehaus.groovy.transform.ASTTransformation</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">gep.WithLoggingASTTransformation</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for the transformation looks similar to the local case, but instead of using the <code>ASTNode[]</code> parameter, we need
to use the <code>SourceUnit</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">gep/WithLoggingASTTransformation.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
@GroovyASTTransformation(phase=CompilePhase.SEMANTIC_ANALYSIS)                  <i class="conum" data-value="2"></i><b>(2)</b>
class WithLoggingASTTransformation implements ASTTransformation {               <i class="conum" data-value="3"></i><b>(3)</b>

    @Override
    void visit(ASTNode[] nodes, SourceUnit sourceUnit) {                        <i class="conum" data-value="4"></i><b>(4)</b>
        def methods = sourceUnit.AST.methods                                    <i class="conum" data-value="5"></i><b>(5)</b>
        methods.each { method -&gt;                                                <i class="conum" data-value="6"></i><b>(6)</b>
            def startMessage = createPrintlnAst("Starting $method.name")        <i class="conum" data-value="7"></i><b>(7)</b>
            def endMessage = createPrintlnAst("Ending $method.name")            <i class="conum" data-value="8"></i><b>(8)</b>

            def existingStatements = ((BlockStatement)method.code).statements   <i class="conum" data-value="9"></i><b>(9)</b>
            existingStatements.add(0, startMessage)                             <i class="conum" data-value="10"></i><b>(10)</b>
            existingStatements.add(endMessage)                                  <i class="conum" data-value="11"></i><b>(11)</b>
        }
    }

    private static Statement createPrintlnAst(String message) {                 <i class="conum" data-value="12"></i><b>(12)</b>
        new ExpressionStatement(
            new MethodCallExpression(
                new VariableExpression("this"),
                new ConstantExpression("println"),
                new ArgumentListExpression(
                    new ConstantExpression(message)
                )
            )
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate with <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/GroovyASTTransformation.html">org.codehaus.groovy.transform.GroovyASTTransformation</a> to tell at which compilation phase the
transform needs to run. Here, it&#8217;s at the <em>semantic analysis</em> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implement the <code>ASTTransformation</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which only has a single <code>visit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>sourceUnit</code> parameter gives access to the source being compiled, so we get the AST of the current source
and retrieve the list of methods from this file</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>we iterate on each method from the source file</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>create a statement that will print a message when we enter the method</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>create a statement that will print a message when we exit the method</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>get the method body, which in this case is a <code>BlockStatement</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>add the enter method message before the first statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>append the exit method message after the last statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_ast_api_guide"><a class="anchor" href="#_ast_api_guide"></a><a class="link" href="#_ast_api_guide">AST API guide</a></h6>
<div class="sect6">
<h7 id="_abstractasttransformation"><a class="anchor" href="#_abstractasttransformation"></a><a class="link" href="#_abstractasttransformation">AbstractASTTransformation</a></h7>
<div class="paragraph">
<p>While you have seen that you can directly implement the <code>ASTTransformation</code> interface, in almost all cases you will not
do this but extend the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/transform/AbstractASTTransformation.html">org.codehaus.groovy.transform.AbstractASTTransformation</a> class. This class provides several
utility methods that make AST transformations easier to write. Almost all AST transformations included in Groovy
extend this class.</p>
</div>
</div>
<div class="sect6">
<h7 id="_classcodeexpressiontransformer"><a class="anchor" href="#_classcodeexpressiontransformer"></a><a class="link" href="#_classcodeexpressiontransformer">ClassCodeExpressionTransformer</a></h7>
<div class="paragraph">
<p>It is a common use case to be able to transform an expression into another. Groovy provides a class which makes it
very easy to do this: <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/ast/ClassCodeExpressionTransformer.html">org.codehaus.groovy.ast.ClassCodeExpressionTransformer</a></p>
</div>
<div class="paragraph">
<p>To illustrate this, let&#8217;s create a <code>@Shout</code> transformation that will transform all <code>String</code> constants in method call
arguments into their uppercase version. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Shout
def greet() {
    println "Hello World"
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>should print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HELLO WORLD</pre>
</div>
</div>
<div class="paragraph">
<p>Then the code for the transformation can use the <code>ClassCodeExpressionTransformer</code> to make this easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic
@GroovyASTTransformation(phase=CompilePhase.SEMANTIC_ANALYSIS)
class ShoutASTTransformation implements ASTTransformation {

    @Override
    void visit(ASTNode[] nodes, SourceUnit sourceUnit) {
        ClassCodeExpressionTransformer trn = new ClassCodeExpressionTransformer() {         <i class="conum" data-value="1"></i><b>(1)</b>
            private boolean inArgList = false
            @Override
            protected SourceUnit getSourceUnit() {
                sourceUnit                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
            }

            @Override
            Expression transform(final Expression exp) {
                if (exp instanceof ArgumentListExpression) {
                    inArgList = true
                } else if (inArgList &amp;&amp;
                    exp instanceof ConstantExpression &amp;&amp; exp.value instanceof String) {
                    return new ConstantExpression(exp.value.toUpperCase())                  <i class="conum" data-value="3"></i><b>(3)</b>
                }
                def trn = super.transform(exp)
                inArgList = false
                trn
            }
        }
        trn.visitMethod((MethodNode)nodes[1])                                               <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Internally the transformation creates a <code>ClassCodeExpressionTransformer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The transformer needs to return the source unit</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if a constant expression of type string is detected inside an argument list, transform it into its upper case version</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>call the transformer on the method being annotated</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_ast_nodes"><a class="anchor" href="#_ast_nodes"></a><a class="link" href="#_ast_nodes">AST Nodes</a></h7>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Writing an AST transformation requires a deep knowledge of the internal Groovy API. In particular it requires
knowledge about the AST classes. Since those classes are internal, there are chances that the API will change in the
future, meaning that your transformations <em>could</em> break. Despite that warning, the AST has been very stable over time
and such a thing rarely happens.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Classes of the Abstract Syntax Tree belong to the <code>org.codehaus.groovy.ast</code> package. It is recommended to the reader
to use the Groovy Console, in particular the AST browser tool, to gain knowledge about those classes. However, a good
resource for learning is the <a href="https://github.com/apache/groovy/tree/master/src/test/org/codehaus/groovy/ast/builder">AST Builder</a>
test suite.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_macros"><a class="anchor" href="#_macros"></a><a class="link" href="#_macros">Macros</a></h6>
<div class="sect6">
<h7 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a><a class="link" href="#_introduction_2">Introduction</a></h7>
<div class="paragraph">
<p>Until version 2.5.0, when developing AST transformations, developers should have a deep knowledge about how the AST
(Abstract Syntax Tree) was built by the compiler in order to know how to add new expressions or statements during
compile time.</p>
</div>
<div class="paragraph">
<p>Although the use of <code>org.codehaus.groovy.ast.tool.GeneralUtils</code> static methods could mitigate the burden of creating
expressions and statements, it&#8217;s still a low-level way of writing those AST nodes directly.
We needed something to abstract us from writing the AST directly and that&#8217;s exactly what Groovy macros were made for.
They allow you to directly add code during compilation, without having to translate the code you had in mind to the
<code>org.codehaus.groovy.ast.*</code> node related classes.</p>
</div>
</div>
<div class="sect6">
<h7 id="_statements_and_expressions"><a class="anchor" href="#_statements_and_expressions"></a><a class="link" href="#_statements_and_expressions">Statements and expressions</a></h7>
<div class="paragraph">
<p>Let&#8217;s see an example, lets create a local AST transformation: <code>@AddMessageMethod</code>. When applied to a given class it
will add a new method called <code>getMessage</code> to that class. The method will return "42". The annotation is pretty
straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.SOURCE)
@Target([ElementType.TYPE])
@GroovyASTTransformationClass(["metaprogramming.AddMethodASTTransformation"])
@interface AddMethod { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What would the AST transformation look like without the use of a macro ? Something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class AddMethodASTTransformation extends AbstractASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[1]

        ReturnStatement code =
                new ReturnStatement(                              <i class="conum" data-value="1"></i><b>(1)</b>
                        new ConstantExpression("42"))             <i class="conum" data-value="2"></i><b>(2)</b>

        MethodNode methodNode =
                new MethodNode(
                        "getMessage",
                        ACC_PUBLIC,
                        ClassHelper.make(String),
                        [] as Parameter[],
                        [] as ClassNode[],
                        code)                                     <i class="conum" data-value="3"></i><b>(3)</b>

        classNode.addMethod(methodNode)                           <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a return statement</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a constant expression "42"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding the code to the new method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adding the new method to the annotated class</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;re not used to the AST API, that definitely doesn&#8217;t look like the code you had in mind. Now look how the
previous code simplifies with the use of macros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class AddMethodWithMacrosASTTransformation extends AbstractASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[1]

        ReturnStatement simplestCode = macro { return "42" }   <i class="conum" data-value="1"></i><b>(1)</b>

        MethodNode methodNode =
                new MethodNode(
                        "getMessage",
                        ACC_PUBLIC,
                        ClassHelper.make(String),
                        [] as Parameter[],
                        [] as ClassNode[],
                        simplestCode)                          <i class="conum" data-value="2"></i><b>(2)</b>

        classNode.addMethod(methodNode)                        <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Much simpler. You wanted to add a return statement that returned "42" and that&#8217;s exactly what you can read inside
the <code>macro</code> utility method. Your plain code will be translated for you to a <code>org.codehaus.groovy.ast.stmt.ReturnStatement</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adding the return statement to the new method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding the new code to the annotated class</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although the <code>macro</code> method is used in this example to create a <strong>statement</strong> the <code>macro</code> method could also be used to create
<strong>expressions</strong> as well, it depends on which <code>macro</code> signature you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>macro(Closure)</code>: Create a given statement with the code inside the closure.</p>
</li>
<li>
<p><code>macro(Boolean,Closure)</code>: if <strong>true</strong> wrap expressions inside the closure inside a statement, if <strong>false</strong> then return
an expression</p>
</li>
<li>
<p><code>macro(CompilePhase, Closure)</code>: Create a given statement with the code inside the closure in a specific compile phase</p>
</li>
<li>
<p><code>macro(CompilePhase, Boolean, Closure)</code>: Create a statement or an expression (true == statement, false == expression)
in a specific compilation phase.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All these signatures can be found at <code>org.codehaus.groovy.macro.runtime.MacroGroovyMethods</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes we could be only interested in creating a given expression, not the whole statement, in order to do that we
should use any of the <code>macro</code> invocations with a boolean parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class AddGetTwoASTTransformation extends AbstractASTTransformation {

    BinaryExpression onePlusOne() {
        return macro(false) { 1 + 1 }                                      <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        ClassNode classNode = nodes[1]
        BinaryExpression expression = onePlusOne()                         <i class="conum" data-value="2"></i><b>(2)</b>
        ReturnStatement returnStatement = GeneralUtils.returnS(expression) <i class="conum" data-value="3"></i><b>(3)</b>

        MethodNode methodNode =
                new MethodNode("getTwo",
                        ACC_PUBLIC,
                        ClassHelper.Integer_TYPE,
                        [] as Parameter[],
                        [] as ClassNode[],
                        returnStatement                                    <i class="conum" data-value="4"></i><b>(4)</b>
                )

        classNode.addMethod(methodNode)                                    <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We&#8217;re telling macro not to wrap the expression in a statement, we&#8217;re only interested in the expression</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assigning the expression</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creating a <code>ReturnStatement</code> using a method from <code>GeneralUtils</code> and returning the expression</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adding the code to the new method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Adding the method to the class</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_variable_substitution"><a class="anchor" href="#_variable_substitution"></a><a class="link" href="#_variable_substitution">Variable substitution</a></h7>
<div class="paragraph">
<p>Macros are great but we can&#8217;t create anything useful or reusable if our macros couldn&#8217;t receive parameters or resolve
surrounding variables.</p>
</div>
<div class="paragraph">
<p>In the following example we&#8217;re creating an AST transformation <code>@MD5</code> that when applied to a given String field will
add a method returning the MD5 value of that field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.SOURCE)
@Target([ElementType.FIELD])
@GroovyASTTransformationClass(["metaprogramming.MD5ASTTransformation"])
@interface MD5 { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the transformation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GroovyASTTransformation(phase = CompilePhase.CANONICALIZATION)
class MD5ASTTransformation extends AbstractASTTransformation {

    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        FieldNode fieldNode = nodes[1]
        ClassNode classNode = fieldNode.declaringClass
        String capitalizedName = fieldNode.name.capitalize()
        MethodNode methodNode = new MethodNode(
                "get${capitalizedName}MD5",
                ACC_PUBLIC,
                ClassHelper.STRING_TYPE,
                [] as Parameter[],
                [] as ClassNode[],
                buildMD5MethodCode(fieldNode))

        classNode.addMethod(methodNode)
    }

    BlockStatement buildMD5MethodCode(FieldNode fieldNode) {
        VariableExpression fieldVar = GeneralUtils.varX(fieldNode.name) <i class="conum" data-value="1"></i><b>(1)</b>

        return macro(CompilePhase.SEMANTIC_ANALYSIS, true) {            <i class="conum" data-value="2"></i><b>(2)</b>
            return java.security.MessageDigest
                    .getInstance('MD5')
                    .digest($v { fieldVar }.getBytes())                 <i class="conum" data-value="3"></i><b>(3)</b>
                    .encodeHex()
                    .toString()
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We need a reference to a variable expression</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If using a class outside the standard packages we should add any needed imports or use the qualified name. When
using the qualified name of a given static method you need to make sure it&#8217;s resolved in the proper compile phase. In
this particular case we&#8217;re instructing the macro to resolve it at the SEMANTIC_ANALYSIS phase, which is the first compile phase
with type information.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In order to substitute any <code>expression</code> inside the macro we need to use the <code>$v</code> method. <code>$v</code> receives a closure as an
argument, and the closure is only allowed to substitute expressions, meaning classes inheriting
<code>org.codehaus.groovy.ast.expr.Expression</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_macroclass"><a class="anchor" href="#_macroclass"></a><a class="link" href="#_macroclass">MacroClass</a></h7>
<div class="paragraph">
<p>As we mentioned earlier, the <code>macro</code> method is only capable of producing <code>statements</code> and <code>expressions</code>. But what if we
want to produce other types of nodes, such as a method, a field and so on?</p>
</div>
<div class="paragraph">
<p><code>org.codehaus.groovy.macro.transform.MacroClass</code> can be used to create <strong>classes</strong> (ClassNode instances) in our
transformations the same way we created statements and expressions with the <code>macro</code> method before.</p>
</div>
<div class="paragraph">
<p>The next example is a local transformation <code>@Statistics</code>. When applied to a given class, it will add two methods
<strong>getMethodCount()</strong> and <strong>getFieldCount()</strong> which return how many methods and fields within the class respectively. Here
is the marker annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.SOURCE)
@Target([ElementType.TYPE])
@GroovyASTTransformationClass(["metaprogramming.StatisticsASTTransformation"])
@interface Statistics {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the AST transformation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic
@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class StatisticsASTTransformation extends AbstractASTTransformation {

    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[1]
        ClassNode templateClass = buildTemplateClass(classNode)  <i class="conum" data-value="1"></i><b>(1)</b>

        templateClass.methods.each { MethodNode node -&gt;          <i class="conum" data-value="2"></i><b>(2)</b>
            classNode.addMethod(node)
        }
    }

    @CompileDynamic
    ClassNode buildTemplateClass(ClassNode reference) {          <i class="conum" data-value="3"></i><b>(3)</b>
        def methodCount = constX(reference.methods.size())       <i class="conum" data-value="4"></i><b>(4)</b>
        def fieldCount = constX(reference.fields.size())         <i class="conum" data-value="5"></i><b>(5)</b>

        return new MacroClass() {
            class Statistics {
                java.lang.Integer getMethodCount() {             <i class="conum" data-value="6"></i><b>(6)</b>
                    return $v { methodCount }
                }

                java.lang.Integer getFieldCount() {              <i class="conum" data-value="7"></i><b>(7)</b>
                    return $v { fieldCount }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating a template class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adding template class methods to the annotated class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Passing the reference class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Extracting reference class method count value expression</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Extracting reference class field count value expression</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Building the <strong>getMethodCount()</strong> method using reference&#8217;s method count value expression</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Building the <strong>getFieldCount()</strong> method using reference&#8217;s field count value expression</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Basically we&#8217;ve created the <strong>Statistics</strong> class as a template to avoid writing low level AST API, then we
copied methods created in the template class to their final destination.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Types inside the <code>MacroClass</code> implementation should be resolved inside, that&#8217;s why we had to write
<code>java.lang.Integer</code> instead of simply writing <code>Integer</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice that we&#8217;re using <code>@CompileDynamic</code>. That&#8217;s because the way we use <code>MacroClass</code> is like we
were actually implementing it. So if you were using <code>@CompileStatic</code> it will complain because an implementation of
an abstract class can&#8217;t be another different class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_macro_methods"><a class="anchor" href="#_macro_methods"></a><a class="link" href="#_macro_methods">@Macro methods</a></h7>
<div class="paragraph">
<p>You have seen that by using <code>macro</code> you can save yourself a lot of work but you might wonder where
that method came from. You didn&#8217;t declare it or static import it. You can think of it as a special
global method (or if you prefer, a method on every <code>Object</code>). This is much like how the <code>println</code>
extension method is defined. But unlike <code>println</code> which becomes a method selected for execution
later in the compilation process, <code>macro</code> expansion is done early in the compilation process.
The declaration of <code>macro</code> as one of the available methods for this early expansion is done
by annotating a <code>macro</code> method definition with the <code>@Macro</code> annotation and making that method
available using a similar mechanism for extension modules. Such methods are known as <em>macro</em> methods
and the good news is you can define your own.</p>
</div>
<div class="paragraph">
<p>To define your own macro method, create a class in a similar way to an extension module and
add a method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class ExampleMacroMethods {

    @Macro
    public static Expression safe(MacroContext macroContext, MethodCallExpression callExpression) {
        return ternaryX(
                notNullX(callExpression.getObjectExpression()),
                callExpression,
                constX(null)
        );
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you would register this as an extension module using a <code>org.codehaus.groovy.runtime.ExtensionModule</code>
file within the <code>META-INF/groovy</code> directory.</p>
</div>
<div class="paragraph">
<p>Now, assuming that the class and meta info file are on your classpath, you can use the
macro method in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nullObject = null
assert null == safe(safe(nullObject.hashcode()).toString())</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_testing_ast_transformations"><a class="anchor" href="#_testing_ast_transformations"></a><a class="link" href="#_testing_ast_transformations">Testing AST transformations</a></h6>
<div class="sect6">
<h7 id="_separating_source_trees"><a class="anchor" href="#_separating_source_trees"></a><a class="link" href="#_separating_source_trees">Separating source trees</a></h7>
<div class="paragraph">
<p>This section is about good practices in regard to testing AST transformations. Previous sections highlighted the fact
that to be able to execute an AST transformation, it has to be precompiled. It might sound obvious but a lot of people
get caught on this, trying to use an AST transformation in the same source tree as where it is defined.</p>
</div>
<div class="paragraph">
<p>The first tip for testing AST transformation is therefore to separate test sources from the sources of the transform.
Again, this is nothing but best practices, but you must make sure that your build too does actually compile them separately.
This is the case by default with both <a href="http://maven.apache.org">Apache Maven</a> and <a href="http://gradle.org">Gradle</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_debugging_ast_transformations"><a class="anchor" href="#_debugging_ast_transformations"></a><a class="link" href="#_debugging_ast_transformations">Debugging AST transformations</a></h7>
<div class="paragraph">
<p>It is very handy to be able to put a breakpoint in an AST transformation, so that you can debug your code in the IDE.
However, you might be surprised to see that your IDE doesn&#8217;t stop on the breakpoint. The reason is actually simple: if
your IDE uses the Groovy compiler to compile the unit tests for your AST transformation, then the compilation is triggered
from the IDE, but the process which will compile the files doesn&#8217;t have debugging options. It&#8217;s only when the test case
is executed that the debugging options are set on the virtual machine. In short: it is too late, the class has been compiled
already, and your transformation is already applied.</p>
</div>
<div class="paragraph">
<p>A very easy workaround is to use the <code>GroovyTestCase</code> class which provides an <code>assertScript</code> method. This means that
instead of writing this in a test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">static class Subject {
    @MyTransformToDebug
    void methodToBeTested() {}
}

void testMyTransform() {
    def c = new Subject()
    c.methodToBeTested()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testMyTransformWithBreakpoint() {
    assertScript '''
        import metaprogramming.MyTransformToDebug

        class Subject {
            @MyTransformToDebug
            void methodToBeTested() {}
        }
        def c = new Subject()
        c.methodToBeTested()
    '''
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is that when you use <code>assertScript</code>, the code in the <code>assertScript</code> block is compiled <strong>when the
unit test is executed</strong>. That is to say that this time, the <code>Subject</code> class will be compiled with debugging active, and
the breakpoint is going to be hit.</p>
</div>
</div>
<div class="sect6">
<h7 id="_astmatcher"><a class="anchor" href="#_astmatcher"></a><a class="link" href="#_astmatcher">ASTMatcher</a></h7>
<div class="paragraph">
<p>Sometimes you may want to make assertions over AST nodes; perhaps to filter the nodes, or to make sure a given
transformation has built the expected AST node.</p>
</div>
<div class="paragraph">
<p><strong>Filtering nodes</strong></p>
</div>
<div class="paragraph">
<p>For instance if you would like to apply a given transformation only to a specific set of AST nodes, you could
use <strong>ASTMatcher</strong> to filter these nodes. The following example shows how to transform a given expression to
another. Using <strong>ASTMatcher</strong> it looks for a specific expression <code>1 + 1</code> and it transforms it to <code>3</code>. That&#8217;s why
we called it the <code>@Joking</code> example.</p>
</div>
<div class="paragraph">
<p>First we create the <code>@Joking</code> annotation that only can be applied to methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Retention(RetentionPolicy.SOURCE)
@Target([ElementType.METHOD])
@GroovyASTTransformationClass(["metaprogramming.JokingASTTransformation"])
@interface Joking { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the transformation, that only applies an instance of <code>org.codehaus.groovy.ast.ClassCodeExpressionTransformer</code>
to all the expressions within the method code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@CompileStatic
@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class JokingASTTransformation extends AbstractASTTransformation {
    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        MethodNode methodNode = (MethodNode) nodes[1]

        methodNode
            .getCode()
            .visit(new ConvertOnePlusOneToThree(source))  <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the method&#8217;s code statement and apply the expression transformer</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And this is when the <strong>ASTMatcher</strong> is used to apply the transformation only to those expressions matching
the expression <code>1 + 1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class ConvertOnePlusOneToThree extends ClassCodeExpressionTransformer {
    SourceUnit sourceUnit

    ConvertOnePlusOneToThree(SourceUnit sourceUnit) {
        this.sourceUnit = sourceUnit
    }

    @Override
    Expression transform(Expression exp) {
        Expression ref = macro { 1 + 1 }     <i class="conum" data-value="1"></i><b>(1)</b>

        if (ASTMatcher.matches(ref, exp)) {  <i class="conum" data-value="2"></i><b>(2)</b>
            return macro { 3 }               <i class="conum" data-value="3"></i><b>(3)</b>
        }

        return super.transform(exp)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Builds the expression used as reference pattern</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checks the current expression evaluated matches the reference expression</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If it matches then replaces the current expression with the expression built with <code>macro</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you could test the implementation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package metaprogramming

class Something {
    @Joking
    Integer getResult() {
        return 1 + 1
    }
}

assert new Something().result == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Unit testing AST transforms</strong></p>
</div>
<div class="paragraph">
<p>Normally we test AST transformations just checking that the final use of the transformation does what we expect. But
it would be great if we could have an easy way to check, for example, that the nodes the transformation adds are what
we expected from the beginning.</p>
</div>
<div class="paragraph">
<p>The following transformation adds a new method <code>giveMeTwo</code> to an annotated class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GroovyASTTransformation(phase = CompilePhase.INSTRUCTION_SELECTION)
class TwiceASTTransformation extends AbstractASTTransformation {

    static final String VAR_X = 'x'

    @Override
    void visit(ASTNode[] nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[1]
        MethodNode giveMeTwo = getTemplateClass(sumExpression)
            .getDeclaredMethods('giveMeTwo')
            .first()

        classNode.addMethod(giveMeTwo)                  <i class="conum" data-value="1"></i><b>(1)</b>
    }

    BinaryExpression getSumExpression() {               <i class="conum" data-value="2"></i><b>(2)</b>
        return macro {
            $v{ varX(VAR_X) } +
            $v{ varX(VAR_X) }
        }
    }

    ClassNode getTemplateClass(Expression expression) { <i class="conum" data-value="3"></i><b>(3)</b>
        return new MacroClass() {
            class Template {
                java.lang.Integer giveMeTwo(java.lang.Integer x) {
                    return $v { expression }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding the method to the annotated class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Building a binary expression. The binary expression uses the same variable expression in both
sides of the <code>+</code> token (check <code>varX</code> method at <strong>org.codehaus.groovy.ast.tool.GeneralUtils</strong>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Builds a new <strong>ClassNode</strong> with a method called <code>giveMeTwo</code> which returns the result of an expression
passed as parameter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now instead of creating a test executing the transformation over a given sample code. I would like to check that
the construction of the binary expression is done properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testTestingSumExpression() {
    use(ASTMatcher) {                 <i class="conum" data-value="1"></i><b>(1)</b>
        TwiceASTTransformation sample = new TwiceASTTransformation()
        Expression referenceNode = macro {
            a + a                     <i class="conum" data-value="2"></i><b>(2)</b>
        }.withConstraints {           <i class="conum" data-value="3"></i><b>(3)</b>
            placeholder 'a'           <i class="conum" data-value="4"></i><b>(4)</b>
        }

        assert sample
            .sumExpression
            .matches(referenceNode)   <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using ASTMatcher as a category</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Build a template node</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Apply some constraints to that template node</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Tells compiler that <code>a</code> is a placeholder.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Asserts reference node and current node are equal</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course you can/should always check the actual execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testASTBehavior() {
    assertScript '''
    package metaprogramming

    @Twice
    class AAA {

    }

    assert new AAA().giveMeTwo(1) == 2
    '''
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_asttest"><a class="anchor" href="#_asttest"></a><a class="link" href="#_asttest">ASTTest</a></h7>
<div class="paragraph">
<p>Last but not least, testing an AST transformation is also about testing the state of the AST <strong>during compilation</strong>. Groovy
provides a tool named <code>@ASTTest</code> for this: it is an annotation that will let you add assertions on an abstract syntax
tree. Please check the <a href="#xform-ASTTest">documentation for ASTTest</a> for more details.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_external_references"><a class="anchor" href="#_external_references"></a><a class="link" href="#_external_references">External references</a></h6>
<div class="paragraph">
<p>If you are interested in a step-by-step tutorial about writing AST transformations, you can follow
<a href="http://melix.github.io/ast-workshop/">this workshop</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-grape"><a class="anchor" href="#section-grape"></a><a class="link" href="#section-grape">3.5. Dependency management with Grape</a></h3>
<div class="sect3">
<h4 id="_quick_start"><a class="anchor" href="#_quick_start"></a><a class="link" href="#_quick_start">3.5.1. Quick start</a></h4>
<div class="sect4">
<h5 id="_add_a_dependency"><a class="anchor" href="#_add_a_dependency"></a><a class="link" href="#_add_a_dependency">Add a Dependency</a></h5>
<div class="paragraph">
<p>Grape is a JAR dependency manager embedded into Groovy. Grape lets you quickly add maven repository dependencies to your
classpath, making scripting even easier. The simplest use is as simple as adding an annotation to your script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab(group='org.springframework', module='spring-orm', version='5.2.8.RELEASE')
import org.springframework.jdbc.core.JdbcTemplate</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Grab</code> also supports a shorthand notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.springframework:spring-orm:5.2.8.RELEASE')
import org.springframework.jdbc.core.JdbcTemplate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we are using an annotated import here, which is the recommended way. You can also search for
dependencies on <a href="http://mvnrepository.com">mvnrepository.com</a> and it will
provide you the <code>@Grab</code> annotation form of the <code>pom.xml</code> entry.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-SpecifyAdditionalRepositories"><a class="anchor" href="#Grape-SpecifyAdditionalRepositories"></a><a class="link" href="#Grape-SpecifyAdditionalRepositories">Specify Additional Repositories</a></h5>
<div class="paragraph">
<p>Not all dependencies are in maven central. You can add new ones like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GrabResolver(name='restlet', root='http://maven.restlet.org/')
@Grab(group='org.restlet', module='org.restlet', version='1.1.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MavenClassifiers"><a class="anchor" href="#Grape-MavenClassifiers"></a><a class="link" href="#Grape-MavenClassifiers">Maven Classifiers</a></h5>
<div class="paragraph">
<p>Some maven dependencies need classifiers in order to be able to resolve.
You can fix that like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab(group='net.sf.json-lib', module='json-lib', version='2.2.3', classifier='jdk15')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-ExcludingTransitiveDependencies"><a class="anchor" href="#Grape-ExcludingTransitiveDependencies"></a><a class="link" href="#Grape-ExcludingTransitiveDependencies">Excluding Transitive Dependencies</a></h5>
<div class="paragraph">
<p>Sometimes you will want to exclude transitive dependencies as you might
be already using a slightly different but compatible version of some
artifact. You can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('net.sourceforge.htmlunit:htmlunit:2.8')
@GrabExclude('xml-apis:xml-apis')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-JDBCDrivers"><a class="anchor" href="#Grape-JDBCDrivers"></a><a class="link" href="#Grape-JDBCDrivers">JDBC Drivers</a></h5>
<div class="paragraph">
<p>Because of the way JDBC drivers are loaded, you’ll need to configure
Grape to attach JDBC driver dependencies to the system class loader.
I.e:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GrabConfig(systemClassLoader=true)
@Grab(group='mysql', module='mysql-connector-java', version='5.1.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-UsingGrapeFromtheGroovyShell"><a class="anchor" href="#Grape-UsingGrapeFromtheGroovyShell"></a><a class="link" href="#Grape-UsingGrapeFromtheGroovyShell">Using Grape From the Groovy Shell</a></h5>
<div class="paragraph">
<p>From groovysh use the method call variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">groovy.grape.Grape.grab(group:'org.springframework', module:'spring', version:'2.5.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Proxysettings"><a class="anchor" href="#Grape-Proxysettings"></a><a class="link" href="#Grape-Proxysettings">Proxy settings</a></h5>
<div class="paragraph">
<p>If you are behind a firewall and/or need to use Groovy/Grape through a
proxy server, you can specify those settings on the command like via the
<code>http.proxyHost</code> and <code>http.proxyPort</code> system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 yourscript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>Or you can make this system-wide by adding these properties to your
JAVA_OPTS environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS = -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Logging"><a class="anchor" href="#Grape-Logging"></a><a class="link" href="#Grape-Logging">Logging</a></h5>
<div class="paragraph">
<p>If you want to see what Grape is doing set the system property
<code>groovy.grape.report.downloads</code> to <code>true</code> (e.g. add
<code>-Dgroovy.grape.report.downloads=true</code> to invocation or JAVA_OPTS) and Grape will
print the following infos to System.error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starting resolve of a dependency</p>
</li>
<li>
<p>Starting download of an artifact</p>
</li>
<li>
<p>Retrying download of an artifact</p>
</li>
<li>
<p>Download size and time for downloaded artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To log with even more verbosity, increase the Ivy log level
(defaults to <code>-1</code>). For example <code>-Divy.message.logger.level=4</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Detail"><a class="anchor" href="#Grape-Detail"></a><a class="link" href="#Grape-Detail">3.5.2. Detail</a></h4>
<div class="paragraph">
<p>Grape (The <em>Groovy Adaptable Packaging Engine</em> or <em>Groovy Advanced
Packaging Engine</em>) is the infrastructure enabling the grab() calls in
Groovy, a set of classes leveraging <a href="http://ant.apache.org/ivy/">Ivy</a> to allow for a repository driven
module system for Groovy. This allows a developer to write a script with
an essentially arbitrary library requirement, and ship just the script.
Grape will, at runtime, download as needed and link the named libraries
and all dependencies forming a transitive closure when the script is run
from existing repositories such as Maven Central.</p>
</div>
<div class="paragraph">
<p>Grape follows the Ivy conventions for module version identification,
with naming change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code> - Which module group the module comes from. Translates
directly to a Maven groupId or an Ivy Organization. Any group matching
<code>/groovy[x][\..*]^/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module</code> - The name of the module to load. Translated directly to a
Maven artifactId or an Ivy artifact.</p>
</li>
<li>
<p><code>version</code> - The version of the module to use. Either a literal version
`1.1-RC3' or an Ivy Range `[2.2.1,)' meaning 2.2.1 or any greater
version).</p>
</li>
<li>
<p><code>classifier</code> - The optional classifier to use (for example, <em>jdk15</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The downloaded modules will be stored according to Ivy’s standard
mechanism with a cache root of <code>~/.groovy/grapes</code></p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Usage"><a class="anchor" href="#Grape-Usage"></a><a class="link" href="#Grape-Usage">3.5.3. Usage</a></h4>
<div class="sect4">
<h5 id="Grape-Annotation"><a class="anchor" href="#Grape-Annotation"></a><a class="link" href="#Grape-Annotation">Annotation</a></h5>
<div class="paragraph">
<p>One or more <code>groovy.lang.Grab</code> annotations can be added at any place that
annotations are accepted to tell the compiler that this code relies on
the specific library. This will have the effect of adding the library to
the classloader of the groovy compiler. This annotation is detected and
evaluated before any other resolution of classes in the script, so
imported classes can be properly resolved by a <code>@Grab</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.jidesoft.swing.JideSplitButton
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,2.3.0)')
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An appropriate <code>grab(&#8230;&#8203;)</code> call will be added to the static initializer
of the class of the containing class (or script class in the case of an
annotated script element).</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MultipleGrapeAnnotations"><a class="anchor" href="#Grape-MultipleGrapeAnnotations"></a><a class="link" href="#Grape-MultipleGrapeAnnotations">Multiple Grape Annotations</a></h5>
<div class="paragraph">
<p>In early versions of Groovy, if you wanted to use a Grab annotation multiple times
on the same node you had to use the <code>@Grapes</code> annotation, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grapes([
   @Grab(group='commons-primitives', module='commons-primitives', version='1.0'),
   @Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='0.9.7')])
class Example {
// ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise you’d encounter the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot specify duplicate annotation on the same member</pre>
</div>
</div>
<div class="paragraph">
<p>But in recent versions, @Grapes is purely optional.</p>
</div>
<div class="paragraph">
<p>Technical notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Originally, Groovy stored the Grab annotations for access at runtime
and duplicates aren&#8217;t allowed in the bytecode. In current versions, @Grab has only
SOURCE retention, so the multiple occurrences aren&#8217;t an issue.</p>
</li>
<li>
<p>Future versions of Grape may support using the Grapes annotation to
provide a level of structuring, e.g. allowing a GrabExclude or GrabResolver
annotation to apply to only a subset of the Grab annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Methodcall"><a class="anchor" href="#Grape-Methodcall"></a><a class="link" href="#Grape-Methodcall">Method call</a></h5>
<div class="paragraph">
<p>Typically a call to grab will occur early in the script or in class
initialization. This is to ensure that the libraries are made available
to the ClassLoader before the groovy code relies on the code. A couple
of typical calls may appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.grape.Grape
// random maven library
Grape.grab(group:'com.jidesoft', module:'jide-oss', version:'[2.2.0,)')
Grape.grab([group:'org.apache.ivy', module:'ivy', version:'2.0.0-beta1', conf:['default', 'optional']],
     [group:'org.apache.ant', module:'ant', version:'1.7.0'])</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple calls to grab in the same context with the same parameters
should be idempotent. However, if the same code is called with a
different <code>ClassLoader</code> context then resolution may be re-run.</p>
</li>
<li>
<p>If the <code>args</code> map passed into the <code>grab</code> call has an attribute
<code>noExceptions</code> that evaluates true no exceptions will be thrown.</p>
</li>
<li>
<p><code>grab</code> requires that a <code>RootLoader</code> or <code>GroovyClassLoader</code> be specified or
be in the <code>ClassLoader</code> chain of the calling class. By default failure to
have such a <code>ClassLoader</code> available will result in module resolution and
an exception being thrown</p>
<div class="ulist">
<ul>
<li>
<p>The ClassLoader passed in via the <code>classLoader:</code> argument and its
parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the object passed in as the <code>referenceObject:</code>
argument, and its parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the class issuing the call to <code>grab</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="Grape-grabHashMapParameters"><a class="anchor" href="#Grape-grabHashMapParameters"></a><a class="link" href="#Grape-grabHashMapParameters">grab(HashMap) Parameters</a></h6>
<div class="ulist">
<ul>
<li>
<p><code>group:</code> - &lt;String&gt; - Which module group the module comes from.
Translates directly to a Maven groupId. Any group matching
<code>/groovy(|\..|x|x\..)/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module:</code> - &lt;String&gt; - The name of the module to load. Translated
directly to a Maven artifactId.</p>
</li>
<li>
<p><code>version:</code> - &lt;String&gt; and possibly &lt;Range&gt; - The version of the module
to use. Either a literal version `1.1-RC3' or an Ivy Range `[2.2.1,)'
meaning 2.2.1 or any greater version).</p>
</li>
<li>
<p><code>classifier:</code> - &lt;String&gt; - The Maven classifier to resolve by.</p>
</li>
<li>
<p><code>conf:</code> - &lt;String&gt;, default <code>default' - The configuration or scope of
the module to download. The default conf is `default:</code> which maps to the
maven <code>runtime</code> and <code>master</code> scopes.</p>
</li>
<li>
<p><code>force:</code>- &lt;boolean&gt;, defaults true - Used to indicate that this
revision must be used in case of conflicts, independently of</p>
</li>
<li>
<p>conflicts manager</p>
</li>
<li>
<p><code>changing:</code> - &lt;boolean&gt;, default false - Whether the artifact can
change without its version designation changing.</p>
</li>
<li>
<p><code>transitive:</code> - &lt;boolean&gt;, default true - Whether to resolve other
dependencies this module has or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two principal variants of <code>grab</code>, one with a single Map and
one with an arguments Map and multiple dependencies map. A call to the
single map grab is the same as calling grab with the same map passed in
twice, so grab arguments and dependencies can be mixed in the same map,
and grab can be called as a single method with named parameters.</p>
</div>
<div class="paragraph">
<p>There are synonyms for these parameters. Submitting more than one is a
runtime exception.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group:</code>, <code>groupId:</code>, <code>organisation:</code>, <code>organization:</code>, <code>org:</code></p>
</li>
<li>
<p><code>module:</code>, <code>artifactId:</code>, <code>artifact:</code></p>
</li>
<li>
<p><code>version:</code>, <code>revision:</code>, <code>rev:</code></p>
</li>
<li>
<p><code>conf:</code>, <code>scope:</code>, <code>configuration:</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="Grape-ArgumentsMaparguments"><a class="anchor" href="#Grape-ArgumentsMaparguments"></a><a class="link" href="#Grape-ArgumentsMaparguments">Arguments Map arguments</a></h6>
<div class="ulist">
<ul>
<li>
<p><code>classLoader:</code> - &lt;GroovyClassLoader&gt; or &lt;RootClassLoader&gt; - The
ClassLoader to add resolved Jars to</p>
</li>
<li>
<p><code>refObject:</code> - &lt;Object&gt; - The closest parent ClassLoader for the
object’s class will be treated as though it were passed in as
<code>classLoader:</code></p>
</li>
<li>
<p><code>validate:</code> - &lt;boolean&gt;, default false - Should poms or ivy files be
validated (true), or should we trust the cache (false).</p>
</li>
<li>
<p><code>noExceptions:</code> - &lt;boolean&gt;, default false - If ClassLoader resolution
or repository querying fails, should we throw an exception (false) or
fail silently (true).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-CommandLineTool"><a class="anchor" href="#Grape-CommandLineTool"></a><a class="link" href="#Grape-CommandLineTool">Command Line Tool</a></h5>
<div class="paragraph">
<p>Grape added a command line executable `grape' that allows for the
inspection and management of the local grape cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape install [-hv] &lt;group&gt; &lt;module&gt; [&lt;version&gt;] [&lt;classifier&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>This installs the specified groovy module or maven artifact. If a
version is specified that specific version will be installed, otherwise
the most recent version will be used (as if `*' we passed in).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape list</pre>
</div>
</div>
<div class="paragraph">
<p>Lists locally installed modules (with their full maven name in the case
of groovy modules) and versions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape resolve [-adhisv] (&lt;groupId&gt; &lt;artifactId&gt; &lt;version&gt;)+</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the file locations of the jars representing the artifacts
for the specified module(s) and the respective transitive dependencies.
You may optionally pass in -ant, -dos, or -shell to get the dependencies
expressed in a format applicable for an ant script, windows batch file,
or unix shell script respectively. -ivy may be passed to see the
dependencies expressed in an ivy like format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape uninstall [-hv] &lt;group&gt; &lt;module&gt; &lt;version&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This uninstalls a particular grape: it non-transitively removes the
respective jar file from the grape cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Advancedconfiguration"><a class="anchor" href="#Grape-Advancedconfiguration"></a><a class="link" href="#Grape-Advancedconfiguration">Advanced configuration</a></h5>
<div class="sect5">
<h6 id="Grape-RepositoryDirectory"><a class="anchor" href="#Grape-RepositoryDirectory"></a><a class="link" href="#Grape-RepositoryDirectory">Repository Directory</a></h6>
<div class="paragraph">
<p>If you need to change the directory grape uses for downloading libraries
you can specify the grape.root system property to change the default
(which is ~/.groovy/grapes)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dgrape.root=/repo/grapes yourscript.groovy</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Grape-CustomizeIvysettings"><a class="anchor" href="#Grape-CustomizeIvysettings"></a><a class="link" href="#Grape-CustomizeIvysettings">Customize Ivy settings</a></h6>
<div class="paragraph">
<p>You can customize the ivy settings that Grape uses by creating a
~/.groovy/grapeConfig.xml file. If no such file exists,
<a href="https://github.com/apache/groovy/blob/master/src/resources/groovy/grape/defaultGrapeConfig.xml">here</a>
are the default settings used by Grape.</p>
</div>
<div class="paragraph">
<p>For more information on how to customize these settings, please refer to
the <a href="https://ant.apache.org/ivy/history/latest-milestone/index.html">Ivy
documentation</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MoreExamples"><a class="anchor" href="#Grape-MoreExamples"></a><a class="link" href="#Grape-MoreExamples">More Examples</a></h5>
<div class="paragraph">
<p>Using Apache Commons Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// create and use a primitive array list
@Grab(group='commons-primitives', module='commons-primitives', version='1.0')
import org.apache.commons.collections.primitives.ArrayIntList

def createEmptyInts() { new ArrayIntList() }

def ints = createEmptyInts()
ints.add(0, 42)
assert ints.size() == 1
assert ints.get(0) == 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using TagSoup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// find the PDF links of the Java specifications
@Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='1.2.1')
def getHtml() {
    def parser = new XmlParser(new org.ccil.cowan.tagsoup.Parser())
    parser.parse("https://docs.oracle.com/javase/specs/")
}
html.body.'**'.a.@href.grep(~/.*\.pdf/).each{ println it }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Google Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.google.common.collect.HashBiMap
@Grab(group='com.google.code.google-collections', module='google-collect', version='snapshot-20080530')
def getFruit() { [grape:'purple', lemon:'yellow', orange:'orange'] as HashBiMap }
assert fruit.lemon == 'yellow'
assert fruit.inverse().yellow == 'lemon'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Launching a Jetty server to serve Groovy templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.eclipse.jetty.aggregate:jetty-server:8.1.19.v20160209')
@Grab('org.eclipse.jetty.aggregate:jetty-servlet:8.1.19.v20160209')
@Grab('javax.servlet:javax.servlet-api:3.0.1')
import org.eclipse.jetty.server.Server
import org.eclipse.jetty.servlet.ServletContextHandler
import groovy.servlet.TemplateServlet

def runServer(duration) {
    def server = new Server(8080)
    def context = new ServletContextHandler(server, "/", ServletContextHandler.SESSIONS)
    context.resourceBase = "."
    context.addServlet(TemplateServlet, "*.gsp")
    server.start()
    sleep duration
    server.stop()
}

runServer(10000)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grape will download Jetty and its dependencies on first launch of this
script, and cache them. We create a new Jetty Server on port 8080,
then expose Groovy’s TemplateServlet at the root of the context — Groovy
comes with its own powerful template engine mechanism. We start the
server and let it run for a certain duration. Each time someone will hit
http://localhost:8080/somepage.gsp, it will display the somepage.gsp
template to the user — those template pages should be situated in the
same directory as this server script.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_guide"><a class="anchor" href="#_testing_guide"></a><a class="link" href="#_testing_guide">3.6. Testing Guide</a></h3>
<div class="sect3">
<h4 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a><a class="link" href="#_introduction_3">3.6.1. Introduction</a></h4>
<div class="paragraph">
<p>The Groovy programming language comes with great support for writing tests. In addition to the language
features and test integration with state-of-the-art testing libraries and frameworks, the Groovy ecosystem has born
a rich set of testing libraries and frameworks.</p>
</div>
<div class="paragraph">
<p>This chapter will start with language specific testing features and continue with a closer look at JUnit
integration, Spock for specifications, and Geb for functional tests. Finally, we&#8217;ll do an overview of other testing
libraries known to be working with Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_language_features"><a class="anchor" href="#_language_features"></a><a class="link" href="#_language_features">3.6.2. Language Features</a></h4>
<div class="paragraph">
<p>Besides integrated support for JUnit, the Groovy programming language comes with features that have proven
to be very valuable for test-driven development. This section gives insight on them.</p>
</div>
<div class="sect4">
<h5 id="_power_assertions"><a class="anchor" href="#_power_assertions"></a><a class="link" href="#_power_assertions">Power Assertions</a></h5>
<div class="paragraph">
<p>Writing tests means formulating assumptions by using assertions. In Java this can be done by using the <code>assert</code>
keyword that has been added in J2SE 1.4. In Java, <code>assert</code> statements can be enabled via the JVM parameters <code>-ea</code>
(or <code>-enableassertions</code>) and <code>-da</code> (or <code>-disableassertions</code>). Assertion statements in Java are disabled by default.</p>
</div>
<div class="paragraph">
<p>Groovy comes with a rather <em>powerful variant</em> of <code>assert</code> also known as <em>power assertion statement</em>. Groovy&#8217;s power
<code>assert</code> differs from the Java version in its output given the boolean expression validates to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = 1
assert x == 2

// Output:             <i class="conum" data-value="1"></i><b>(1)</b>
//
// Assertion failed:
// assert x == 2
//        | |
//        1 false</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This section shows the std-err output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>java.lang.AssertionError</code> that is thrown whenever the assertion can not be validated successfully, contains
an extended version of the original exception message. The power assertion output shows evaluation results from
the outer to the inner expression.</p>
</div>
<div class="paragraph">
<p>The power assertion statements true power unleashes in complex Boolean statements, or statements with
collections or other <code>toString</code>-enabled classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def x = [1,2,3,4,5]
assert (x &lt;&lt; 6) == [6,7,8,9,10]

// Output:
//
// Assertion failed:
// assert (x &lt;&lt; 6) == [6,7,8,9,10]
//         | |     |
//         | |     false
//         | [1, 2, 3, 4, 5, 6]
//         [1, 2, 3, 4, 5, 6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important difference from Java is that in Groovy assertions are <em>enabled by default</em>. It has been a language design
decision to remove the possibility to deactivate assertions. Or, as Bertrand Meyer stated, <code>it makes no sense to take
off your swim ring if you put your feet into real water</code>.</p>
</div>
<div class="paragraph">
<p>One thing to be aware of are methods with side effects inside Boolean expressions in power assertion statements. As
the internal error message construction mechanism does only store references to instances under target,
 it happens that the error message text is invalid at rendering time in case of side-effecting methods involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]

// Output:
//
// Assertion failed:
// assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]
//                          |       |        |
//                          |       |        false
//                          |       [1, 2, 3, 4]
//                          [1, 2, 3, 4]           <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The error message shows the actual state of the collection, not the state before the <code>unique</code> method was applied</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you choose to provide a custom assertion error message this can be done by using the Java syntax <code>assert
expression1 : expression2</code> where <code>expression1</code> is the Boolean expression and <code>expression2</code> is the custom error message.
 Be aware though that this will disable the power assert and will fully fall back to custom
 error messages on assertion errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mocking_and_stubbing"><a class="anchor" href="#_mocking_and_stubbing"></a><a class="link" href="#_mocking_and_stubbing">Mocking and Stubbing</a></h5>
<div class="paragraph">
<p>Groovy has excellent built-in support for a range of mocking and stubbing alternatives. When using Java, dynamic mocking
frameworks are very popular. A key reason for this is that it is hard work creating custom hand-crafted mocks using Java.
Such frameworks can be used easily with Groovy if you choose but creating custom mocks is much easier in Groovy. You
can often get away with simple maps or closures to build your custom mocks.</p>
</div>
<div class="paragraph">
<p>The following sections show ways to create mocks and stubs with Groovy language features only.</p>
</div>
<div class="sect5">
<h6 id="_map_coercion"><a class="anchor" href="#_map_coercion"></a><a class="link" href="#_map_coercion">Map Coercion</a></h6>
<div class="paragraph">
<p>By using maps or expandos, we can incorporate desired behaviour of a collaborator very easily as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TranslationService {
    String convert(String key) {
        return "test"
    }
}

def service = [convert: { String key -&gt; 'some text' }] as TranslationService
assert 'some text' == service.convert('key.text')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>as</code> operator can be used to coerce a map to a particular class. The given map keys are interpreted as
method names and the values, being <code>groovy.lang.Closure</code> blocks, are interpreted as method code blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that map coercion can get into the way if you deal with custom <code>java.util.Map</code> descendant classes in combination
with the <code>as</code> operator. The map coercion mechanism is targeted directly at certain collection classes, it doesn&#8217;t take
custom classes into account.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_closure_coercion_2"><a class="anchor" href="#_closure_coercion_2"></a><a class="link" href="#_closure_coercion_2">Closure Coercion</a></h6>
<div class="paragraph">
<p>The 'as' operator can be used with closures in a neat way which is great for developer testing in simple scenarios.
We haven&#8217;t found this technique to be so powerful that we want to do away with dynamic mocking, but it can be very
useful in simple cases none-the-less.</p>
</div>
<div class="paragraph">
<p>Classes or interfaces holding a single method, including SAM (single abstract method) classes, can be used to coerce
a closure block to be an object of the given type. Be aware that for doing this, Groovy internally create a proxy object
descending for the given class. So the object will not be a direct instance of the given class. This important if, for
example, the generated proxy object&#8217;s metaclass is altered afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have an example on coercing a closure to be of a specific type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def service = { String key -&gt; 'some text' } as TranslationService
assert 'some text' == service.convert('key.text')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports a feature called implicit SAM coercion. This means that the <code>as</code> operator is not necessary in situations
where the runtime can infer the target SAM type. This type of coercion might be useful in tests to mock entire SAM
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class BaseService {
    abstract void doSomething()
}

BaseService service = { -&gt; println 'doing something' }
service.doSomething()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mockfor_and_stubfor"><a class="anchor" href="#_mockfor_and_stubfor"></a><a class="link" href="#_mockfor_and_stubfor">MockFor and StubFor</a></h6>
<div class="paragraph">
<p>The Groovy mocking and stubbing classes can be found in the <code>groovy.mock.interceptor</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>MockFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>strictly ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more collaborators. In such a scenario it is
often desirable to just test the business logic of the class under test. One strategy for doing that is to replace
the collaborator instances with simplified mock objects to help isolate out the logic in the test target. MockFor
allows such mocks to be created using meta-programming. The desired behavior of collaborators is defined as a behavior
specification. The behavior is enforced and checked automatically.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our target classes looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String first, last
}

class Family {
    Person father, mother
    def nameOfMother() { "$mother.first $mother.last" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>MockFor</code>, a mock expectation is always sequence dependent and its use automatically ends with a call to <code>verify</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def mock = new MockFor(Person)      <i class="conum" data-value="1"></i><b>(1)</b>
mock.demand.getFirst{ 'dummy' }
mock.demand.getLast{ 'name' }
mock.use {                          <i class="conum" data-value="2"></i><b>(2)</b>
    def mary = new Person(first:'Mary', last:'Smith')
    def f = new Family(mother:mary)
    assert f.nameOfMother() == 'dummy name'
}
mock.expect.verify()                <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new mock is created by a new instance of <code>MockFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the mocking functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a call to <code>verify</code> checks whether the sequence and number of method calls is as expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>loosely-ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more
collaborators. In such a scenario it is often desirable to just test the business logic of the CUT. One strategy for
doing that is to replace the collaborator instances with simplified stub objects to help isolate out the logic
in the target class. <code>StubFor</code> allows such stubs to be created using meta-programming. The desired behavior of
collaborators is defined as a behavior specification.</p>
</div>
<div class="paragraph">
<p>In contrast to <code>MockFor</code> the stub expectation checked with <code>verify</code> is sequence independent and its use is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def stub = new StubFor(Person)      <i class="conum" data-value="1"></i><b>(1)</b>
stub.demand.with {                  <i class="conum" data-value="2"></i><b>(2)</b>
    getLast{ 'name' }
    getFirst{ 'dummy' }
}
stub.use {                          <i class="conum" data-value="3"></i><b>(3)</b>
    def john = new Person(first:'John', last:'Smith')
    def f = new Family(father:john)
    assert f.father.first == 'dummy'
    assert f.father.last == 'name'
}
stub.expect.verify()                <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new stub is created by a new instance of <code>StubFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>with</code> method is used for delegating all calls inside the closure to the <code>StubFor</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the stubbing functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a call to <code>verify</code> (optional) checks whether the number of method calls is as expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>MockFor</code> and <code>StubFor</code> can not be used to test statically compiled classes e.g. for Java classes or Groovy classes that
make use of <code>@CompileStatic</code>. To stub and/or mock these classes you can use Spock or one of the Java mocking libraries.</p>
</div>
</div>
<div class="sect5">
<h6 id="testing_guide_emc"><a class="anchor" href="#testing_guide_emc"></a><a class="link" href="#testing_guide_emc">Expando Meta-Class (EMC)</a></h6>
<div class="paragraph">
<p>Groovy includes a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code> (EMC). It allows to dynamically add methods,
constructors, properties and static methods using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied with a special <code>metaClass</code> property that will give a reference to an
<code>ExpandoMetaClass</code> instance. The expando metaclass is not restricted to custom classes, it can be used for
JDK classes like for example <code>java.lang.String</code> as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String.metaClass.swapCase = {-&gt;
    def sb = new StringBuffer()
    delegate.each {
        sb &lt;&lt; (Character.isUpperCase(it as char) ? Character.toLowerCase(it as char) :
            Character.toUpperCase(it as char))
    }
    sb.toString()
}

def s = "heLLo, worLD!"
assert s.swapCase() == 'HEllO, WORld!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExpandoMetaClass</code> is a rather good candidate for mocking functionality as it allows for more advanced stuff
like mocking static methods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Book {
    String title
}

Book.metaClass.static.create &lt;&lt; { String title -&gt; new Book(title:title) }

def b = Book.create("The Stand")
assert b.title == 'The Stand'</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even constructors</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Book.metaClass.constructor &lt;&lt; { String title -&gt; new Book(title:title) }

def b = new Book("The Stand")
assert b.title == 'The Stand'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Mocking constructors might seem like a hack that&#8217;s better not even to be considered but even there might be valid
use cases. An example can be found in Grails where domain class constructors are added at run-time with the
help of <code>ExpandoMetaClass</code>. This lets the domain object register itself in the Spring application context and allows
for injection of services or other beans controlled by the dependency-injection container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to change the <code>metaClass</code> property on a per test method level you need to remove the changes that were
done to the metaclass, otherwise those changes would be persistent across test method calls. Changes are removed by
replacing the metaclass in the <code>GroovyMetaClassRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GroovySystem.metaClassRegistry.removeMetaClass(String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative is to register a <code>MetaClassRegistryChangeEventListener</code>, track the changed classes and remove
the changes in the cleanup method of your chosen testing runtime. A good example can be found
<a href="https://github.com/grails/grails-core/blob/master/grails-bootstrap/src/main/groovy/grails/build/support/MetaClassRegistryCleaner.java">in the Grails web
development framework</a>.</p>
</div>
<div class="paragraph">
<p>Besides using the <code>ExpandoMetaClass</code> on a class-level, there is also support for using the metaclass on a per-object
level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def b = new Book(title: "The Stand")
b.metaClass.getTitle {-&gt; 'My Title' }

assert b.title == 'My Title'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the metaclass change is related to the instance only. Depending on the test scenario this might be a better
fit than the global metaclass change.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_gdk_methods"><a class="anchor" href="#_gdk_methods"></a><a class="link" href="#_gdk_methods">GDK Methods</a></h5>
<div class="paragraph">
<p>The following section gives a brief overview on GDK methods that can be leveraged in test case scenarios, for example for
test data generation.</p>
</div>
<div class="sect5">
<h6 id="_iterablecombinations"><a class="anchor" href="#_iterablecombinations"></a><a class="link" href="#_iterablecombinations">Iterable#combinations</a></h6>
<div class="paragraph">
<p>The <code>combinations</code> method that is added on <code>java.lang.Iterable</code> compliant classes can be used to get a list of
combinations from a list containing two or more sub-lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testCombinations() {
    def combinations = [[2, 3],[4, 5, 6]].combinations()
    assert combinations == [[2, 4], [3, 4], [2, 5], [3, 5], [2, 6], [3, 6]]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in test case scenarios to generate all possible argument combinations for a specific method
call.</p>
</div>
</div>
<div class="sect5">
<h6 id="_iterableeachcombination"><a class="anchor" href="#_iterableeachcombination"></a><a class="link" href="#_iterableeachcombination">Iterable#eachCombination</a></h6>
<div class="paragraph">
<p>The <code>eachCombination</code> method that is added on <code>java.lang.Iterable</code> can be used to apply a function (or in this
 case a <code>groovy.lang.Closure</code>) to each if the combinations that has been built by the <code>combinations</code> method:</p>
</div>
<div class="paragraph">
<p><code>eachCombination</code> is a GDK method that is added to all classes conforming to the <code>java.lang.Iterable</code> interface.
It applies a function on each combination of the input lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testEachCombination() {
    [[2, 3],[4, 5, 6]].eachCombination { println it[0] + it[1] }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in the testing context to call methods with each of the generated combinations.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tool_support"><a class="anchor" href="#_tool_support"></a><a class="link" href="#_tool_support">Tool Support</a></h5>
<div class="sect5">
<h6 id="_test_code_coverage"><a class="anchor" href="#_test_code_coverage"></a><a class="link" href="#_test_code_coverage">Test Code Coverage</a></h6>
<div class="paragraph">
<p>Code coverage is a useful measure of the effectiveness of (unit) tests. A program with high code coverage has a
lower chance to hold critical bugs than a program with no or low coverage. To get code coverage metrics,
the generated byte-code usually needs to be instrumented before the tests are executed. One tool with Groovy support
 for this task is <a href="http://cobertura.github.io/cobertura/">Cobertura</a>.</p>
</div>
<div class="paragraph">
<p>Various frameworks and build tools come with Cobertura integration. For Grails, there is the <a href="http://grails.org/plugin/code-coverage">code coverage plugin</a> based
on Cobertura, for Gradle there is the <a href="https://github.com/eriwen/gradle-cobertura-plugin">gradle-cobertura plugin</a>, to name only two of them.</p>
</div>
<div class="paragraph">
<p>The following code listing shows an example on how to enable Cobertura test coverage reports in a Gradle build script from
a Groovy project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def pluginVersion = '&lt;plugin version&gt;'
def groovyVersion = '&lt;groovy version&gt;'
def junitVersion = '&lt;junit version&gt;'

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.eriwen:gradle-cobertura-plugin:${pluginVersion}'
    }
}

apply plugin: 'groovy'
apply plugin: 'cobertura'

repositories {
    mavenCentral()
}

dependencies {
    compile "org.codehaus.groovy:groovy-all:${groovyVersion}"
    testCompile "junit:junit:${junitVersion}"
}

cobertura {
    format = 'html'
    includes = ['**/*.java', '**/*.groovy']
    excludes = ['com/thirdparty/**/*.*']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several output formats can be chosen for Cobertura coverage reports and test code coverage reports can be added to
continuous integration build tasks.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_junit"><a class="anchor" href="#_testing_with_junit"></a><a class="link" href="#_testing_with_junit">3.6.3. Testing with JUnit</a></h4>
<div class="paragraph">
<p>Groovy simplifies JUnit testing in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You use the same overall practices as you would when testing with Java but you
can adopt much of Groovy&#8217;s concise syntax in your tests making them succinct. You can even use
the capabilities for writing testing domain specific languages (DSLs) if you feel so inclined.</p>
</li>
<li>
<p>There are numerous helper classes that simplify many testing activities. The details differ
in some cases depending on the version of JUnit you are using. We&#8217;ll cover those details shortly.</p>
</li>
<li>
<p>Groovy&#8217;s PowerAssert mechanism is wonderful to use in your tests</p>
</li>
<li>
<p>Groovy deems that tests are so important you should be able to run them as easily as scripts or classes.
This is why Groovy includes an automatic test runner when using the <code>groovy</code> command or the GroovyConsole.
This gives you some additional options over and above running your tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following sections we will have a closer look at JUnit 3, 4 and 5 Groovy integration.</p>
</div>
<div class="sect4">
<h5 id="_junit_3"><a class="anchor" href="#_junit_3"></a><a class="link" href="#_junit_3">JUnit 3</a></h5>
<div class="paragraph">
<p>Maybe one of the most prominent Groovy classes supporting JUnit 3 tests is the <code>GroovyTestCase</code> class. Being
derived from <code>junit.framework.TestCase</code> it offers a bunch of additional methods that make testing in Groovy a breeze.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although <code>GroovyTestCase</code> inherits from <code>TestCase</code> doesn&#8217;t mean you can&#8217;t use JUnit 4 features in your project. In fact,
the most recent Groovy versions come with a bundled JUnit 4 and that comes with a backwards compatible <code>TestCase</code>
implementation. There have been some discussion on the Groovy mailing-list on whether to use <code>GroovyTestCase</code> or JUnit 4
with the result that it is mostly a matter of taste, but with <code>GroovyTestCase</code> you get a bunch of methods for free that
make certain types of tests easier to write.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this section, we will have a look at some of the methods provided by <code>GroovyTestCase</code>. A full list of these can be
found in the JavaDoc documentation for <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/test/GroovyTestCase.html">groovy.test.GroovyTestCase</a> ,
don&#8217;t forget it is inherited from <code>junit.framework.TestCase</code> which inherits all the <code>assert*</code> methods.</p>
</div>
<div class="sect5">
<h6 id="_assertion_methods"><a class="anchor" href="#_assertion_methods"></a><a class="link" href="#_assertion_methods">Assertion Methods</a></h6>
<div class="paragraph">
<p><code>GroovyTestCase</code> is inherited from <code>junit.framework.TestCase</code> therefore it inherits a large number of assertion methods
being available to be called in every test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyTestCase extends GroovyTestCase {

    void testAssertions() {
        assertTrue(1 == 1)
        assertEquals("test", "test")

        def x = "42"
        assertNotNull "x must not be null", x
        assertNull null

        assertSame x, x
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen above, in contrast to Java it is possible to leave out the parenthesis in most situations which
leads to even more readability of JUnit assertion method call expressions.</p>
</div>
<div class="paragraph">
<p>An interesting assertion method that is added by <code>GroovyTestCase</code> is <code>assertScript</code>. It ensures that the given Groovy
code string succeeds without any exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testScriptAssertions() {
    assertScript '''
        def x = 1
        def y = 2

        assert x + y == 3
    '''
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_shouldfail_methods"><a class="anchor" href="#_shouldfail_methods"></a><a class="link" href="#_shouldfail_methods">shouldFail Methods</a></h6>
<div class="paragraph">
<p><code>shouldFail</code> can be used to check whether the given code block fails or not. In case it fails, the assertion does hold,
otherwise the assertion fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testInvalidIndexAccess1() {
    def numbers = [1,2,3,4]
    shouldFail {
        numbers.get(4)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses the basic <code>shouldFail</code> method interface that takes a <code>groovy.lang.Closure</code> as a single argument.
 The <code>Closure</code> instance holds the code that is supposed to be breaking during run-time.</p>
</div>
<div class="paragraph">
<p>If we wanted to assert <code>shouldFail</code> on a specific <code>java.lang.Exception</code> type we could have done so by using the <code>shouldFail</code>
implementation that takes the <code>Exception</code> class as first argument and the <code>Closure</code> as second argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testInvalidIndexAccess2() {
    def numbers = [1,2,3,4]
    shouldFail IndexOutOfBoundsException, {
        numbers.get(4)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything other than <code>IndexOutOfBoundsException</code> (or a descendant class of it) is thrown, the test case will fail.</p>
</div>
<div class="paragraph">
<p>A pretty nice feature of <code>shouldFail</code> hasn&#8217;t been visible so far: it returns the exception message. This is really
useful if you want to assert on the exception error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testInvalidIndexAccess3() {
    def numbers = [1,2,3,4]
    def msg = shouldFail IndexOutOfBoundsException, {
        numbers.get(4)
    }
    assert msg.contains('Index: 4, Size: 4') ||
        msg.contains('Index 4 out-of-bounds for length 4') ||
        msg.contains('Index 4 out of bounds for length 4')
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_notyetimplemented_method"><a class="anchor" href="#_notyetimplemented_method"></a><a class="link" href="#_notyetimplemented_method">notYetImplemented Method</a></h6>
<div class="paragraph">
<p>The <code>notYetImplemented</code> method has been greatly influenced by HtmlUnit. It allows to write a test method but mark it
as not yet implemented. As long as the test method fails and is marked with <code>notYetImplemented</code> the test goes green:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void testNotYetImplemented1() {
    if (notYetImplemented()) return   <i class="conum" data-value="1"></i><b>(1)</b>

    assert 1 == 2                     <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a call to <code>notYetImplemented</code> is necessary for <code>GroovyTestCase</code> to get the current method stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>as long as the test evaluates to <code>false</code> the test execution will be successful.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative to the <code>notYetImplemented</code> method is the <code>@NotYetImplemented</code> annotation. It allows for annotating a
method as not yet implemented, with the exact same behavior as <code>GroovyTestCase#notYetImplemented</code> but without the need
for the <code>notYetImplemented</code> method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@NotYetImplemented
void testNotYetImplemented2() {
    assert 1 == 2
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_junit_4"><a class="anchor" href="#_junit_4"></a><a class="link" href="#_junit_4">JUnit 4</a></h5>
<div class="paragraph">
<p>Groovy can be used to write JUnit 4 test cases without any restrictions. The <code>groovy.test.GroovyAssert</code> holds
various static methods that can be used as replacement for the <code>GroovyTestCase</code> methods in JUnit 4 tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.junit.Test

import static groovy.test.GroovyAssert.shouldFail

class JUnit4ExampleTests {

    @Test
    void indexOutOfBoundsAccess() {
        def numbers = [1,2,3,4]
        shouldFail {
            numbers.get(4)
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the example above, the static methods found in <code>GroovyAssert</code> are imported at the beginning of the
 class definition thus <code>shouldFail</code> can be used the same way it can be used in a <code>GroovyTestCase</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>groovy.test.GroovyAssert</code> descends from <code>org.junit.Assert</code> that means it inherits all JUnit assertion methods. However,
with the introduction of the power assertion statement, it turned out to be <em>good practice to rely on assertion statements</em>
instead of using the JUnit assertion methods with the improved message being the main reason.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth mentioning that <code>GroovyAssert.shouldFail</code> is not absolutely identical to <code>GroovyTestCase.shouldFail</code>. While
<code>GroovyTestCase.shouldFail</code> returns the exception message, <code>GroovyAssert.shouldFail</code> returns the exception itself. It
takes a few more keystrokes to get the message, but in return you can access other properties and methods of the
exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Test
void shouldFailReturn() {
    def e = shouldFail {
        throw new RuntimeException('foo',
                                   new RuntimeException('bar'))
    }
    assert e instanceof RuntimeException
    assert e.message == 'foo'
    assert e.cause.message == 'bar'
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_junit_5"><a class="anchor" href="#_junit_5"></a><a class="link" href="#_junit_5">JUnit 5</a></h5>
<div class="paragraph">
<p>Much of the approach and helper classes described under JUnit4 apply when using JUnit5 however JUnit5
uses some slightly different class annotations when writing your tests. See the <a href="https://junit.org">JUnit5</a> documentation
for more details.</p>
</div>
<div class="paragraph">
<p>Create your test classes as per normal JUnit5 guidelines as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyTest {
  @Test
  void streamSum() {
    assertTrue(Stream.of(1, 2, 3)
      .mapToInt(i -&gt; i)
      .sum() &gt; 5, () -&gt; "Sum should be greater than 5")
  }

  @RepeatedTest(value=2, name = "{displayName} {currentRepetition}/{totalRepetitions}")
  void streamSumRepeated() {
    assert Stream.of(1, 2, 3).mapToInt(i -&gt; i).sum() == 6
  }

  private boolean isPalindrome(s) { s == s.reverse()  }

  @ParameterizedTest                                                              <i class="conum" data-value="1"></i><b>(1)</b>
  @ValueSource(strings = [ "racecar", "radar", "able was I ere I saw elba" ])
  void palindromes(String candidate) {
    assert isPalindrome(candidate)
  }

  @TestFactory
  def dynamicTestCollection() {[
    dynamicTest("Add test") { -&gt; assert 1 + 1 == 2 },
    dynamicTest("Multiply Test", () -&gt; { assert 2 * 3 == 6 })
  ]}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This test requires the additional <code>org.junit.jupiter:junit-jupiter-params</code> dependency if not already in your project.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can run the tests in your IDE or build tool if it supports and is configured for JUnit5.
If you run the above test in the GroovyConsole or via the <code>groovy</code> command, you will see a short text summary of the
result of running the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JUnit5 launcher: passed=8, failed=0, skipped=0, time=246ms</pre>
</div>
</div>
<div class="paragraph">
<p>More detailed information is available at the <code>FINE</code> logging level. You can configure your logging to display such
information or do it programmatically as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@BeforeAll
static void init() {
  def logger = Logger.getLogger(LoggingListener.name)
  logger.level = Level.FINE
  logger.addHandler(new ConsoleHandler(level: Level.FINE))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_spock"><a class="anchor" href="#_testing_with_spock"></a><a class="link" href="#_testing_with_spock">3.6.4. Testing with Spock</a></h4>
<div class="paragraph">
<p>Spock is a testing and specification framework for Java and Groovy applications. What makes it stand out from the
crowd is its beautiful and highly expressive specification DSL. In practice, Spock specifications are written as
Groovy classes. Although written in Groovy they can be used to test Java classes. Spock can be used for unit,
integration or BDD (behavior-driven-development) testing, it doesn&#8217;t put itself into a specific category of testing
frameworks or libraries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Beside these awesome features Spock is a good example on how to leverage advanced Groovy programming
language features in third party libraries, for example, by using Groovy AST transformations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Spock, it should rather give an impression what Spock
is about and how it can be leveraged for unit, integration, functional or any other type of testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section we will have a first look at the anatomy of a Spock specification. It should give a
pretty good feeling on what Spock is up to.</p>
</div>
<div class="sect4">
<h5 id="_specifications"><a class="anchor" href="#_specifications"></a><a class="link" href="#_specifications">Specifications</a></h5>
<div class="paragraph">
<p>Spock lets you write specifications that describe features (properties, aspects) exhibited by a system of
interest. The "system" can be anything between a single class and an entire application, a more advanced term for it is
<em>system under specification</em>. The <em>feature description</em> starts from a specific snapshot of the system and its
collaborators, this snapshot is called the <em>feature&#8217;s fixture</em>.</p>
</div>
<div class="paragraph">
<p>Spock specification classes are derived from <code>spock.lang.Specification</code>. A concrete specification class might consist
of fields, fixture methods, features methods and helper methods.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at a simple specification with a single feature method for an imaginary <code>Stack</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class StackSpec extends Specification {

    def "adding an element leads to size increase"() {  <i class="conum" data-value="1"></i><b>(1)</b>
        setup: "a new stack instance is created"        <i class="conum" data-value="2"></i><b>(2)</b>
            def stack = new Stack()

        when:                                           <i class="conum" data-value="3"></i><b>(3)</b>
            stack.push 42

        then:                                           <i class="conum" data-value="4"></i><b>(4)</b>
            stack.size() == 1
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Feature method, is by convention named with a String literal.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setup block, here is where any setup work for this feature needs to be done.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When block describes a stimulus, a certain action under target by this feature specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then block any expressions that can be used to validate the result of the code that was triggered by the when block.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spock feature specifications are defined as methods inside a <code>spock.lang.Specification</code> class. They describe the feature
by using a String literal instead of a method name.</p>
</div>
<div class="paragraph">
<p>A feature method holds multiple blocks, in our example we used <code>setup</code>, <code>when</code> and <code>then</code>. The <code>setup</code> block is special
in that it is optional and allows to configure local variables visible inside the feature method. The <code>when</code> block
defines the stimulus and is a companion of the <code>then</code> block which describes the response to the stimulus.</p>
</div>
<div class="paragraph">
<p>Note that the <code>setup</code> method in the <code>StackSpec</code> above additionally
  has a description String. Description Strings are optional and can be added after block labels (like <code>setup</code>, <code>when</code>,
  <code>then</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_spock"><a class="anchor" href="#_more_spock"></a><a class="link" href="#_more_spock">More Spock</a></h5>
<div class="paragraph">
<p>Spock provides much more features like data tables or advanced mocking capabilities. Feel free to consult the
<a href="https://github.com/spockframework/spock">Spock GitHub page</a> for more documentation and download information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_functional_tests_with_geb"><a class="anchor" href="#_functional_tests_with_geb"></a><a class="link" href="#_functional_tests_with_geb">3.6.5. Functional Tests with Geb</a></h4>
<div class="paragraph">
<p>Geb is a functional web testing and scraper library that integrates with JUnit and Spock. It is based upon the
Selenium web drivers and, like Spock, provides a Groovy DSL to write functional tests for web applications.</p>
</div>
<div class="paragraph">
<p>Geb has great features that make it a good fit for a functional testing library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DOM access via a JQuery-like <code>$</code> function</p>
</li>
<li>
<p>implements the <em>page pattern</em></p>
</li>
<li>
<p>support for modularization of certain web components (e.g. menu-bars, etc.) with <em>modules</em></p>
</li>
<li>
<p>integration with JavaScript via the JS variable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Geb, it should rather give an impression what Geb
is about and how it can be leveraged functional testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section will give an example on how Geb can be used to write a functional test for a simple
 web page with a single search field.</p>
</div>
<div class="sect4">
<h5 id="_a_geb_script"><a class="anchor" href="#_a_geb_script"></a><a class="link" href="#_a_geb_script">A Geb Script</a></h5>
<div class="paragraph">
<p>Although Geb can be used standalone in a Groovy script, in many scenarios it&#8217;s used in combination with other testing
frameworks. Geb comes with various base classes that can be used in JUnit 3, 4, TestNG or Spock tests. The base classes
are part of additional Geb modules that need to be added as a dependency.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>@Grab</code> dependencies can be used to run Geb with the Selenium Firefox driver in
JUnit4 tests. The module that is needed for JUnit 3/4 support is <code>geb-junit4</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.gebish:geb-core:0.9.2')
@Grab('org.gebish:geb-junit4:0.9.2')
@Grab('org.seleniumhq.selenium:selenium-firefox-driver:2.26.0')
@Grab('org.seleniumhq.selenium:selenium-support:2.26.0')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The central class in Geb is the <code>geb.Browser</code> class. As its name implies it is used
 to browse pages and access DOM elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import geb.Browser
import org.openqa.selenium.firefox.FirefoxDriver

def browser = new Browser(driver: new FirefoxDriver(), baseUrl: 'http://myhost:8080/myapp')  <i class="conum" data-value="1"></i><b>(1)</b>
browser.drive {
    go "/login"                        <i class="conum" data-value="2"></i><b>(2)</b>

    $("#username").text = 'John'       <i class="conum" data-value="3"></i><b>(3)</b>
    $("#password").text = 'Doe'

    $("#loginButton").click()

    assert title == "My Application - Dashboard"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new <code>Browser</code> instance is created. In this case it uses the Selenium <code>FirefoxDriver</code> and sets the <code>baseUrl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>go</code> is used to navigate to a URL or relative URI</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>$</code> together with CSS selectors is used to access the <code>username</code> and <code>password</code> DOM fields.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Browser</code> class comes with a <code>drive</code> method that delegates all method/property calls to the current
<code>browser</code> instance. The <code>Browser</code> configuration must not be done inline, it can also be externalized in a
<code>GebConfig.groovy</code> configuration file for example. In practice, the usage of the <code>Browser</code> class is mostly hidden
by Geb test base classes. They delegate all missing properties and method calls to the current <code>browser</code> instance
that exists in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SearchTests extends geb.junit4.GebTest {

    @Test
    void executeSeach() {
        go 'http://somehost/mayapp/search'              <i class="conum" data-value="1"></i><b>(1)</b>
        $('#searchField').text = 'John Doe'             <i class="conum" data-value="2"></i><b>(2)</b>
        $('#searchButton').click()                      <i class="conum" data-value="3"></i><b>(3)</b>

        assert $('.searchResult a').first().text() == 'Mr. John Doe' <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Browser#go</code> takes a relative or absolute link and calls the page.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Browser#$</code> is used to access DOM content. Any CSS selectors supported by the underlying Selenium drivers are allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>click</code> is used to click a button.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>$</code> is used to get the first link out of the <code>searchResult</code> block</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above shows a simple Geb web test with the JUnit 4 base class <code>geb.junit4.GebTest</code>. Note that in this case
the <code>Browser</code> configuration is externalized. <code>GebTest</code> delegates methods like <code>go</code> and <code>$</code> to the underlying <code>browser</code>
 instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_geb"><a class="anchor" href="#_more_geb"></a><a class="link" href="#_more_geb">More Geb</a></h5>
<div class="paragraph">
<p>In the previous section we only scratched the surface of the available Geb features. More information on Geb can be found
at the <a href="http://gebish.org">project homepage</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tune_parsing_performance_of_parrot_parser"><a class="anchor" href="#_tune_parsing_performance_of_parrot_parser"></a><a class="link" href="#_tune_parsing_performance_of_parrot_parser">3.7. Tune parsing performance of Parrot parser</a></h3>
<div class="paragraph">
<p>The Parrot parser is based on antlr4 and introduced since Groovy 3.0.0. It provides the following options to tune parsing performance:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy.parallel.parse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsing groovy source files in parallel.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> util Groovy 4.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.5+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dgroovy.parallel.parse=true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy.antlr4.cache.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">antlr4 relies on DFA cache heavily for better performance, so antlr4 will not clear DFA cache, thus OutOfMemoryError will probably occur. Groovy trades off parsing performance and memory usage, when the count of Groovy source files parsed hits the cache threshold, the DFA cache will be cleared. <strong>Note:</strong> <code>0</code> means never clearing DFA cache, so requiring bigger JVM heap size. Or set a greater value, e.g. 200 to clear DFA cache if threshold hits. <strong>Note: </strong> the threshold specified is the count of groovy source files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.5+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dgroovy.antlr4.cache.threshold=200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy.antlr4.sll.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parrot parser will try SLL mode and then try LL mode if SLL failed. But the more tokens to parse, the more likely SLL will fail. If SLL threshold hits, SLL will be skipped. Setting the threshold to <code>0</code> means never trying SLL mode, which is not recommended at most cases because SLL is the fastest mode though SLL is less powerful than LL. <strong>Note: </strong> the threshold specified is the token count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code> (disabled by default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.9+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dgroovy.antlr4.sll.threshold=1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy.antlr4.clear.lexer.dfa.cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear the DFA cache for lexer. The DFA cache for lexer is always small and important for parsing performance, so it&#8217;s strongly recommended to leave it as it is until OutOfMemoryError will truly occur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.9+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dgroovy.antlr4.clear.lexer.dfa.cache=true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_processing_json"><a class="anchor" href="#_processing_json"></a><a class="link" href="#_processing_json">3.8. Processing JSON</a></h3>
<div class="paragraph">
<p>Groovy comes with integrated support for converting between Groovy objects and JSON. The classes dedicated to
JSON serialisation and parsing are found in the <code>groovy.json</code> package.</p>
</div>
<div class="sect3">
<h4 id="json_jsonslurper"><a class="anchor" href="#json_jsonslurper"></a><a class="link" href="#json_jsonslurper">3.8.1. JsonSlurper</a></h4>
<div class="paragraph">
<p><code>JsonSlurper</code> is a class that parses JSON text or reader content into Groovy data structures (objects) such as maps, lists and
primitive types like <code>Integer</code>, <code>Double</code>, <code>Boolean</code> and <code>String</code>.</p>
</div>
<div class="paragraph">
<p>The class comes with a bunch of overloaded <code>parse</code> methods plus some special methods such as <code>parseText</code>,
<code>parseFile</code> and others. For the next example we will use the <code>parseText</code> method. It parses a JSON <code>String</code> and recursively converts it to a
list or map of objects. The other <code>parse*</code> methods are similar in that they return a JSON <code>String</code> but for different parameter
types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jsonSlurper = new JsonSlurper()
def object = jsonSlurper.parseText('{ "name": "John Doe" } /* some comment */')

assert object instanceof Map
assert object.name == 'John Doe'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the result is a plain map and can be handled like a normal Groovy object instance. <code>JsonSlurper</code> parses the
given JSON as defined by the <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404 JSON Interchange Standard</a>
plus support for JavaScript comments and dates.</p>
</div>
<div class="paragraph">
<p>In addition to maps <code>JsonSlurper</code> supports JSON arrays which are converted to lists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jsonSlurper = new JsonSlurper()
def object = jsonSlurper.parseText('{ "myList": [4, 8, 15, 16, 23, 42] }')

assert object instanceof Map
assert object.myList instanceof List
assert object.myList == [4, 8, 15, 16, 23, 42]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON standard supports the following primitive data types: string, number, object, <code>true</code>, <code>false</code> and <code>null</code>. <code>JsonSlurper</code>
converts these JSON types into corresponding Groovy types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jsonSlurper = new JsonSlurper()
def object = jsonSlurper.parseText '''
    { "simple": 123,
      "fraction": 123.66,
      "exponential": 123e12
    }'''

assert object instanceof Map
assert object.simple.class == Integer
assert object.fraction.class == BigDecimal
assert object.exponential.class == BigDecimal</code></pre>
</div>
</div>
<div class="paragraph">
<p>As <code>JsonSlurper</code> is returning pure Groovy object instances without any special JSON classes in the back, its usage
is transparent. In fact, <code>JsonSlurper</code> results conform to GPath expressions. GPath is a powerful expression language
that is supported by multiple slurpers for different data formats (<code>XmlSlurper</code> for XML being one example).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details please have a look at the section on <a href="#gpath_expressions">GPath expressions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table gives an overview of the JSON types and the corresponding Groovy data types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON</th>
<th class="tableblock halign-left valign-top">Groovy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.BigDecimal</code> or <code>java.lang.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.ArrayList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code> based on the <code>yyyy-MM-dd&#8217;T&#8217;HH:mm:ssZ</code> date format</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever a value in JSON is <code>null</code>, <code>JsonSlurper</code> supplements it with the Groovy <code>null</code> value. This is in contrast to other
JSON parsers that represent a <code>null</code> value with a library-provided singleton object.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_parser_variants"><a class="anchor" href="#_parser_variants"></a><a class="link" href="#_parser_variants">Parser Variants</a></h5>
<div class="paragraph">
<p><code>JsonSlurper</code> comes with a couple of parser implementations. Each parser fits different requirements, it could well be that for certain
scenarios the <code>JsonSlurper</code> default parser is not the best bet for all situations. Here is an overview of the shipped parser implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>JsonParserCharArray</code> parser basically takes a JSON string and operates on the underlying character array. During value
conversion it copies character sub-arrays (a mechanism known as "chopping") and operates on them.</p>
</li>
<li>
<p>The <code>JsonFastParser</code> is a special variant of the <code>JsonParserCharArray</code> and is the fastest parser. However, it is not the
default parser for a reason. <code>JsonFastParser</code> is a so-called index-overlay parser. During parsing of the given JSON <code>String</code> it
tries as hard as possible to avoid creating new char arrays or <code>String</code> instances. It keeps pointers to
the underlying original character array only. In addition, it defers object creation as late as possible. If parsed maps are
put into long-term caches care must be taken as the map objects might not be created and still consist of pointer to the
original char buffer only. However, <code>JsonFastParser</code> comes with a special chop mode which dices up the char buffer
early to keep a small copy of the original buffer. Recommendation is to use the <code>JsonFastParser</code> for JSON buffers
under 2MB and keeping the long-term cache restriction in mind.</p>
</li>
<li>
<p>The <code>JsonParserLax</code> is a special variant of the <code>JsonParserCharArray</code> parser. It has similar performance characteristics as <code>JsonFastParser</code>
but differs in that it isn&#8217;t exclusively relying on the ECMA-404 JSON grammar. For example it allows for comments, no quote strings etc.</p>
</li>
<li>
<p>The <code>JsonParserUsingCharacterSource</code> is a special parser for very large files. It uses a technique called "character windowing" to
parse large JSON files (large means files over 2MB size in this case) with constant performance characteristics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default parser implementation for <code>JsonSlurper</code> is <code>JsonParserCharArray</code>. The <code>JsonParserType</code> enumeration contains constants for
the parser implementations described above:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Constant</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserCharArray</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#CHAR_BUFFER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonFastParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#INDEX_OVERLAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserLax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#LAX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserUsingCharacterSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#CHARACTER_SOURCE</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changing the parser implementation is as easy as setting the <code>JsonParserType</code> with a call to <code>JsonSlurper#setType()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jsonSlurper = new JsonSlurper(type: JsonParserType.INDEX_OVERLAY)
def object = jsonSlurper.parseText('{ "myList": [4, 8, 15, 16, 23, 42] }')

assert object instanceof Map
assert object.myList instanceof List
assert object.myList == [4, 8, 15, 16, 23, 42]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jsonoutput"><a class="anchor" href="#_jsonoutput"></a><a class="link" href="#_jsonoutput">3.8.2. JsonOutput</a></h4>
<div class="paragraph">
<p><code>JsonOutput</code> is responsible for serialising Groovy objects into JSON strings. It can be seen as companion object to
<a href="#json_jsonslurper">JsonSlurper</a>, being a JSON parser.</p>
</div>
<div class="paragraph">
<p><code>JsonOutput</code> comes with overloaded, static <code>toJson</code> methods. Each <code>toJson</code> implementation takes a different parameter type.
The static methods can either be used directly or by importing the methods with a static import statement.</p>
</div>
<div class="paragraph">
<p>The result of a <code>toJson</code> call is a <code>String</code> containing the JSON code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def json = JsonOutput.toJson([name: 'John Doe', age: 42])

assert json == '{"name":"John Doe","age":42}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>JsonOutput</code> does not only support primitive, maps or list data types to be serialized to JSON, it goes further and even
has support for serialising POGOs, that is, plain-old Groovy objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person { String name }

def json = JsonOutput.toJson([ new Person(name: 'John'), new Person(name: 'Max') ])

assert json == '[{"name":"John"},{"name":"Max"}]'</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_output"><a class="anchor" href="#_customizing_output"></a><a class="link" href="#_customizing_output">Customizing Output</a></h5>
<div class="paragraph">
<p>If you need control over the serialized output you can use a <code>JsonGenerator</code>.  The <code>JsonGenerator.Options</code> builder
can be used to create a customized generator.  One or more options can be set on this builder in order to alter
the resulting output.  When you are done setting the options simply call the <code>build()</code> method in order to get a fully
configured instance that will generate output based on the options selected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    String title
    int age
    String password
    Date dob
    URL favoriteUrl
}

Person person = new Person(name: 'John', title: null, age: 21, password: 'secret',
                            dob: Date.parse('yyyy-MM-dd', '1984-12-15'),
                            favoriteUrl: new URL('http://groovy-lang.org/'))

def generator = new JsonGenerator.Options()
    .excludeNulls()
    .dateFormat('yyyy@MM')
    .excludeFieldsByName('age', 'password')
    .excludeFieldsByType(URL)
    .build()

assert generator.toJson(person) == '{"name":"John","dob":"1984@12"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A closure can be used to transform a type.  These closure converters are registered for a given type and will be
called any time that type or a subtype is encountered.  The first parameter to the closure is an object matching the
type for which the converter is registered and this parameter is required. The closure may take an optional second
<code>String</code> parameter and this will be set to the key name if one is available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
    URL favoriteUrl
}

Person person = new Person(name: 'John', favoriteUrl: new URL('http://groovy-lang.org/json.html#_jsonoutput'))

def generator = new JsonGenerator.Options()
    .addConverter(URL) { URL u, String key -&gt;
        if (key == 'favoriteUrl') {
            u.getHost()
        } else {
            u
        }
    }
    .build()

assert generator.toJson(person) == '{"name":"John","favoriteUrl":"groovy-lang.org"}'

// No key available when generating a JSON Array
def list = [new URL('http://groovy-lang.org/json.html#_jsonoutput')]
assert generator.toJson(list) == '["http://groovy-lang.org/json.html#_jsonoutput"]'

// First parameter to the converter must match the type for which it is registered
shouldFail(IllegalArgumentException) {
    new JsonGenerator.Options()
        .addConverter(Date) { Calendar cal -&gt; }
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_formatted_output"><a class="anchor" href="#_formatted_output"></a><a class="link" href="#_formatted_output">Formatted Output</a></h6>
<div class="paragraph">
<p>As we saw in previous examples, the JSON output is not pretty printed per default. However, the <code>prettyPrint</code> method in <code>JsonOutput</code> comes
to rescue for this task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def json = JsonOutput.toJson([name: 'John Doe', age: 42])

assert json == '{"name":"John Doe","age":42}'

assert JsonOutput.prettyPrint(json) == '''\
{
    "name": "John Doe",
    "age": 42
}'''.stripIndent()</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>prettyPrint</code> takes a <code>String</code> as single parameter; therefore, it can be applied on arbitrary JSON <code>String</code> instances, not only the result of
<code>JsonOutput.toJson</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_builders"><a class="anchor" href="#_builders"></a><a class="link" href="#_builders">Builders</a></h5>
<div class="paragraph">
<p>Another way to create JSON from Groovy is to use <code>JsonBuilder</code> or <code>StreamingJsonBuilder</code>. Both builders provide a
DSL which allows to formulate an object graph which is then converted to JSON.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details on builders, have a look at the builders chapter which covers both <a href="#_jsonbuilder">JsonBuilder</a>
and <a href="#_streamingjsonbuilder">StreamingJsonBuilder</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="processing-sql"><a class="anchor" href="#processing-sql"></a><a class="link" href="#processing-sql">3.9. Interacting with a SQL database</a></h3>
<div class="paragraph">
<p>Groovy&#8217;s <code>groovy-sql</code> module provides a higher-level abstraction over Java&#8217;s JDBC technology. JDBC itself provides
a lower-level but fairly comprehensive API which provides uniform access to a whole variety of supported relational database systems.
We&#8217;ll use HSQLDB in our examples here but you can alternatively use Oracle, SQL Server, MySQL and a host of others.
The most frequently used class within the <code>groovy-sql</code> module is the <code>groovy.sql.Sql</code> class which raises the JDBC
abstractions up one level. We&#8217;ll cover that first.</p>
</div>
<div class="sect3">
<h4 id="_connecting_to_the_database"><a class="anchor" href="#_connecting_to_the_database"></a><a class="link" href="#_connecting_to_the_database">3.9.1. Connecting to the database</a></h4>
<div class="paragraph">
<p>Connecting to a database with Groovy&#8217;s <code>Sql</code> class requires four pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The database uniform resource locator (URL)</p>
</li>
<li>
<p>Username</p>
</li>
<li>
<p>Password</p>
</li>
<li>
<p>The driver class name (which can be derived automatically in some situations)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For our HSQLDB database, the values will be something like that shown in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc:hsqldb:mem:yourdb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sa (or your <em>username</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>yourPassword</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hsqldb.jdbcDriver</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Consult the documentation for the JDBC driver that you plan to use to determine the correct values for your situation.</p>
</div>
<div class="paragraph">
<p>The <code>Sql</code> class has a <code>newInstance</code> factory method which takes these parameters. You would typically use it as follows:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.sql.Sql

def url = 'jdbc:hsqldb:mem:yourDB'
def user = 'sa'
def password = ''
def driver = 'org.hsqldb.jdbcDriver'
def sql = Sql.newInstance(url, user, password, driver)

// use 'sql' instance ...

sql.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to have to handle resource handling yourself (i.e. call <code>close()</code> manually) then you can use the <code>withInstance</code> variation as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB (<code>withInstance</code> variation)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Sql.withInstance(url, user, password, driver) { sql -&gt;
  // use 'sql' instance ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_connecting_with_a_datasource"><a class="anchor" href="#_connecting_with_a_datasource"></a><a class="link" href="#_connecting_with_a_datasource">Connecting with a DataSource</a></h5>
<div class="paragraph">
<p>It is often preferred to use a DataSource. You may have one available to you from a connection pool.
Here we&#8217;ll use the one provided as part of the HSQLDB driver jar as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB with a DataSource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.sql.Sql
import org.hsqldb.jdbc.JDBCDataSource

def dataSource = new JDBCDataSource(
    database: 'jdbc:hsqldb:mem:yourDB', user: 'sa', password: '')
def sql = new Sql(dataSource)

// use then close 'sql' instance ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have your own connection pooling, the details will be different, e.g. for Apache Commons DBCP:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB with a DataSource using Apache Commons DBCP</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.apache.commons:commons-dbcp2:2.7.0')
import groovy.sql.Sql
import org.apache.commons.dbcp2.BasicDataSource

def ds = new BasicDataSource(driverClassName: "org.hsqldb.jdbcDriver",
    url: 'jdbc:hsqldb:mem:yourDB', username: 'sa', password: '')
def sql = new Sql(ds)
// use then close 'sql' instance ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_connecting_using_grab"><a class="anchor" href="#_connecting_using_grab"></a><a class="link" href="#_connecting_using_grab">Connecting using @Grab</a></h5>
<div class="paragraph">
<p>The previous examples assume that the necessary database driver jar is already on your classpath.
For a self-contained script you can add <code>@Grab</code> statements to the top of the script to automatically download the necessary jar as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB using @Grab</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.hsqldb:hsqldb:2.7.2:jdk8')
@GrabConfig(systemClassLoader=true)
// create, use, and then close sql instance ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@GrabConfig</code> statement is necessary to make sure the system classloader is used. This ensures that the driver classes and
system classes like <code>java.sql.DriverManager</code> are in the same classloader.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_sql"><a class="anchor" href="#_executing_sql"></a><a class="link" href="#_executing_sql">3.9.2. Executing SQL</a></h4>
<div class="paragraph">
<p>You can execute arbitrary SQL commands using the <code>execute()</code> method. Let&#8217;s have a look at using it to create a table.</p>
</div>
<div class="sect4">
<h5 id="_creating_tables"><a class="anchor" href="#_creating_tables"></a><a class="link" href="#_creating_tables">Creating tables</a></h5>
<div class="paragraph">
<p>The simplest way to execute SQL is to call the <code>execute()</code> method passing the SQL you wish to execute as a String as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Creating a table</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// ... create 'sql' instance
sql.execute '''
  CREATE TABLE Author (
    id          INTEGER GENERATED BY DEFAULT AS IDENTITY,
    firstname   VARCHAR(64),
    lastname    VARCHAR(64)
  );
'''
// close 'sql' instance ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a variant of this method which takes a GString and another with a list of parameters. There are also other variants with similar names: <code>executeInsert</code> and <code>executeUpdate</code>.
We&#8217;ll see examples of these variants in other examples in this section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_crud_operations"><a class="anchor" href="#_basic_crud_operations"></a><a class="link" href="#_basic_crud_operations">3.9.3. Basic CRUD operations</a></h4>
<div class="paragraph">
<p>The basic operations on a database are Create, Read, Update and Delete (the so-called CRUD operations). We&#8217;ll examine each of these in turn.</p>
</div>
<div class="sect4">
<h5 id="_creatinginserting_data"><a class="anchor" href="#_creatinginserting_data"></a><a class="link" href="#_creatinginserting_data">Creating/Inserting data</a></h5>
<div class="paragraph">
<p>You can use the same <code>execute()</code> statement we saw earlier but to insert a row by using a SQL insert statement as follows:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute "INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a special <code>executeInsert</code> method instead of <code>execute</code>. This will return a list of all keys generated.
Both the <code>execute</code> and <code>executeInsert</code> methods allow you to place '?' placeholders into your SQL string and supply a list of parameters.
In this case a PreparedStatement is used which avoids any risk of SQL injection. The following example illustrates <code>executeInsert</code> using placeholders and parameters:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row using executeInsert with placeholders and parameters</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def insertSql = 'INSERT INTO Author (firstname, lastname) VALUES (?,?)'
def params = ['Jon', 'Skeet']
def keys = sql.executeInsert insertSql, params
assert keys[0] == [1]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, both the <code>execute</code> and <code>executeInsert</code> methods allow you to use GStrings. Any '$' placeholders within the SQL are assumed
to be placeholders. An escaping mechanism exists if you want to supply part of the GString with a variable in a
position which isn&#8217;t where normal placeholders go within SQL. See the GroovyDoc for more details.
Also, <code>executeInsert</code> allows you to supply a list of key column names, when multiple keys are returned and you are only interested in some of them.
 Here is a fragment illustrating key name specification and GStrings:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row using executeInsert with a GString and specifying key names</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def first = 'Guillaume'
def last = 'Laforge'
def myKeyNames = ['ID']
def myKeys = sql.executeInsert """
  INSERT INTO Author (firstname, lastname)
  VALUES (${first}, ${last})
""", myKeyNames
assert myKeys[0] == [ID: 2]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reading_rows"><a class="anchor" href="#_reading_rows"></a><a class="link" href="#_reading_rows">Reading rows</a></h5>
<div class="paragraph">
<p>Reading rows of data from the database is accomplished using one of several available methods: <code>query</code>, <code>eachRow</code>, <code>firstRow</code> and <code>rows</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>query</code> method if you want to iterate through the <code>ResultSet</code> returned by the underlying JDBC API as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>query</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def expected = ['Dierk Koenig', 'Jon Skeet', 'Guillaume Laforge']

def rowNum = 0
sql.query('SELECT firstname, lastname FROM Author') { resultSet -&gt;
  while (resultSet.next()) {
    def first = resultSet.getString(1)
    def last = resultSet.getString('lastname')
    assert expected[rowNum++] == "$first $last"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>eachRow</code> method if you want a slightly higher-level abstraction which provides a Groovy friendly map-like abstraction for the <code>ResultSet</code> as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>eachRow</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">rowNum = 0
sql.eachRow('SELECT firstname, lastname FROM Author') { row -&gt;
  def first = row[0]
  def last = row.lastname
  assert expected[rowNum++] == "$first $last"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can use Groovy list-style and map-style notations when accessing the row of data.</p>
</div>
<div class="paragraph">
<p>Use the <code>firstRow</code> method if you for similar functionality as <code>eachRow</code> but returning only one row of data as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>firstRow</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def first = sql.firstRow('SELECT lastname, firstname FROM Author')
assert first.values().sort().join(',') == 'Dierk,Koenig'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>rows</code> method if you want to process a list of map-like data structures as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>rows</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">List authors = sql.rows('SELECT firstname, lastname FROM Author')
assert authors.size() == 3
assert authors.collect { "$it.FIRSTNAME ${it[-1]}" } == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the map-like abstraction has case-insensitive keys (hence we can use 'FIRSTNAME' or 'firstname' as the key) and
also that -ve indices (a standard Groovy feature) works when using an index value (to count column numbers from the right).</p>
</div>
<div class="paragraph">
<p>You can also use any of the above methods to return scalar values, though typically <code>firstRow</code> is all that is required in such cases. An example returning the count of rows is shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading scalar values</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert sql.firstRow('SELECT COUNT(*) AS num FROM Author').num == 3</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updating_rows"><a class="anchor" href="#_updating_rows"></a><a class="link" href="#_updating_rows">Updating rows</a></h5>
<div class="paragraph">
<p>Updating rows can again be done using the <code>execute()</code> method. Just use a SQL update statement as the argument to the method.
You can insert an author with just a lastname and then update the row to also have a firstname as follows:</p>
</div>
<div class="listingblock">
<div class="title">Updating a row</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute "INSERT INTO Author (lastname) VALUES ('Thorvaldsson')"
sql.execute "UPDATE Author SET firstname='Erik' where lastname='Thorvaldsson'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a special <code>executeUpdate</code> variant which returns the number of rows updated as a result of executing the SQL.
For example, you can change the lastname of an author as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using executeUpdate</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def updateSql = "UPDATE Author SET lastname='Pragt' where lastname='Thorvaldsson'"
def updateCount = sql.executeUpdate updateSql
assert updateCount == 1

def row = sql.firstRow "SELECT * FROM Author where firstname = 'Erik'"
assert "${row.firstname} ${row.lastname}" == 'Erik Pragt'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_deleting_rows"><a class="anchor" href="#_deleting_rows"></a><a class="link" href="#_deleting_rows">Deleting rows</a></h5>
<div class="paragraph">
<p>The <code>execute</code> method is also used for deleting rows as this example shows:</p>
</div>
<div class="listingblock">
<div class="title">Deleting rows</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert sql.firstRow('SELECT COUNT(*) as num FROM Author').num == 3
sql.execute "DELETE FROM Author WHERE lastname = 'Skeet'"
assert sql.firstRow('SELECT COUNT(*) as num FROM Author').num == 2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_sql_operations"><a class="anchor" href="#_advanced_sql_operations"></a><a class="link" href="#_advanced_sql_operations">3.9.4. Advanced SQL operations</a></h4>
<div class="sect4">
<h5 id="_working_with_transactions"><a class="anchor" href="#_working_with_transactions"></a><a class="link" href="#_working_with_transactions">Working with transactions</a></h5>
<div class="paragraph">
<p>The easiest way to perform database operations within a transaction is to include the database operation within a <code>withTransaction</code> closure as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A successful transaction</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert sql.firstRow('SELECT COUNT(*) as num FROM Author').num == 0
sql.withTransaction {
  sql.execute "INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"
  sql.execute "INSERT INTO Author (firstname, lastname) VALUES ('Jon', 'Skeet')"
}
assert sql.firstRow('SELECT COUNT(*) as num FROM Author').num == 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the database starts empty and has two rows after successful completion of the operation. Outside the scope of the
transaction, the database is never seen as having just one row.</p>
</div>
<div class="paragraph">
<p>If something goes wrong, any earlier operations within the <code>withTransaction</code> block are rolled back.
We can see that in operation in the following example where we use database metadata (more details coming up shortly) to find the
maximum allowable size of the <code>firstname</code> column and then attempt to enter a firstname one larger than that maximum value as shown here:</p>
</div>
<div class="listingblock">
<div class="title">A failed transaction will cause a rollback</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def maxFirstnameLength
def metaClosure = { meta -&gt; maxFirstnameLength = meta.getPrecision(1) }
def rowClosure = {}
def rowCountBefore = sql.firstRow('SELECT COUNT(*) as num FROM Author').num
try {
  sql.withTransaction {
    sql.execute "INSERT INTO Author (firstname) VALUES ('Dierk')"
    sql.eachRow "SELECT firstname FROM Author WHERE firstname = 'Dierk'", metaClosure, rowClosure
    sql.execute "INSERT INTO Author (firstname) VALUES (?)", 'X' * (maxFirstnameLength + 1)
  }
} catch(ignore) { println ignore.message }
def rowCountAfter = sql.firstRow('SELECT COUNT(*) as num FROM Author').num
assert rowCountBefore == rowCountAfter</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the first sql execute succeeds initially, it will be rolled back and the number of rows will remain the same.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_batches"><a class="anchor" href="#_using_batches"></a><a class="link" href="#_using_batches">Using batches</a></h5>
<div class="paragraph">
<p>When dealing with large volumes of data, particularly when inserting such data, it can be more efficient to chunk the data into batches. This is done
using the <code>withBatch</code> statement as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Batching SQL statements</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.withBatch(3) { stmt -&gt;
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Paul', 'King')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Guillaume', 'Laforge')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Hamlet', 'D''Arcy')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Cedric', 'Champeau')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Erik', 'Pragt')"
  stmt.addBatch "INSERT INTO Author (firstname, lastname) VALUES ('Jon', 'Skeet')"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing these statements, there will be 7 new rows in the database. In fact, they will have been added in batches
even though you can&#8217;t easily tell that after that fact. If you want to confirm what is going on under the covers, you can
add a little bit of extra logging into your program. Add the following lines before the <code>withBatch</code> statement:</p>
</div>
<div class="listingblock">
<div class="title">Logging additional SQL information</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.logging.*

// next line will add fine logging
Logger.getLogger('groovy.sql').level = Level.FINE
// also adjust logging.properties file in JRE_HOME/lib to have:
// java.util.logging.ConsoleHandler.level = FINE</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this extra logging turned on, and the changes made as per the above comment for the logging.properties file, you should see
output such as:</p>
</div>
<div class="listingblock">
<div class="title">SQL logging output with batching enable</div>
<div class="content">
<pre class="prettyprint highlight"><code>FINE: Successfully executed batch with 3 command(s)
Apr 19, 2015 8:38:42 PM groovy.sql.BatchingStatementWrapper processResult

FINE: Successfully executed batch with 3 command(s)
Apr 19, 2015 8:38:42 PM groovy.sql.BatchingStatementWrapper processResult

FINE: Successfully executed batch with 1 command(s)
Apr 19, 2015 8:38:42 PM groovy.sql.Sql getStatement</code></pre>
</div>
</div>
<div class="paragraph">
<p>We should also note, that any combination of SQL statements can be added to the batch. They don&#8217;t all have to be
inserting a new row to the same table.</p>
</div>
<div class="paragraph">
<p>We noted earlier that to avoid SQL injection, we encourage you to use prepared statements, this is achieved using the
variants of methods which take GStrings or a list of extra parameters. Prepared statements can be used in combination
with batches as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Batching prepared statements</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def qry = 'INSERT INTO Author (firstname, lastname) VALUES (?,?)'
sql.withBatch(3, qry) { ps -&gt;
  ps.addBatch('Dierk', 'Koenig')
  ps.addBatch('Paul', 'King')
  ps.addBatch('Guillaume', 'Laforge')
  ps.addBatch('Hamlet', "D'Arcy")
  ps.addBatch('Cedric', 'Champeau')
  ps.addBatch('Erik', 'Pragt')
  ps.addBatch('Jon', 'Skeet')
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides a much safer option if the data could come from a user such as via a script or a web form. Of course, given
that a prepared statement is being used, you are limited to a batch of the same SQL operation (insert in our example)
to the one table.</p>
</div>
</div>
<div class="sect4">
<h5 id="_performing_pagination"><a class="anchor" href="#_performing_pagination"></a><a class="link" href="#_performing_pagination">Performing pagination</a></h5>
<div class="paragraph">
<p>When presenting large tables of data to a user, it is often convenient to present information a page at
a time. Many of Groovy&#8217;s SQL retrieval methods have extra parameters which can be used to select a particular
page of interest. The starting position and page size are specified as integers as shown in the following example
using <code>rows</code>:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving pages of data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def qry = 'SELECT * FROM Author'
assert sql.rows(qry, 1, 3)*.firstname == ['Dierk', 'Paul', 'Guillaume']
assert sql.rows(qry, 4, 3)*.firstname == ['Hamlet', 'Cedric', 'Erik']
assert sql.rows(qry, 7, 3)*.firstname == ['Jon']</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fetching_metadata"><a class="anchor" href="#_fetching_metadata"></a><a class="link" href="#_fetching_metadata">Fetching metadata</a></h5>
<div class="paragraph">
<p>JDBC metadata can be retrieved in numerous ways. Perhaps the most basic approach is to extract the
metadata from any row as shown in the following example which examines the tablename, column names and column type names:</p>
</div>
<div class="listingblock">
<div class="title">Using row metadata</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.eachRow("SELECT * FROM Author WHERE firstname = 'Dierk'") { row -&gt;
  def md = row.getMetaData()
  assert md.getTableName(1) == 'AUTHOR'
  assert (1..md.columnCount).collect{ md.getColumnName(it) } == ['ID', 'FIRSTNAME', 'LASTNAME']
  assert (1..md.columnCount).collect{ md.getColumnTypeName(it) } == ['INTEGER', 'VARCHAR', 'VARCHAR']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And another slight variant to the previous example, this time also looking at the column label:</p>
</div>
<div class="listingblock">
<div class="title">Also using row metadata</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.eachRow("SELECT firstname AS first FROM Author WHERE firstname = 'Dierk'") { row -&gt;
  def md = row.getMetaData()
  assert md.getColumnName(1) == 'FIRSTNAME'
  assert md.getColumnLabel(1) == 'FIRST'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessing metadata is quite common, so Groovy also provides variants to many of its methods that let you
supply a closure that will be called once with the row metadata in addition to the normal row closure
which is called for each row. The following example illustrates the two closure variant for <code>eachRow</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using row and metadata closures</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def metaClosure = { meta -&gt; assert meta.getColumnName(1) == 'FIRSTNAME' }
def rowClosure = { row -&gt; assert row.FIRSTNAME == 'Dierk' }
sql.eachRow("SELECT firstname FROM Author WHERE firstname = 'Dierk'", metaClosure, rowClosure)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that our SQL query will only return one row, so we could have equally used <code>firstRow</code> for the previous example.</p>
</div>
<div class="paragraph">
<p>Finally, JDBC also provides metadata per connection (not just for rows). You can also access such metadata from Groovy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="title">Using connection metadata</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def md = sql.connection.metaData
assert md.driverName == 'HSQL Database Engine Driver'
assert md.databaseProductVersion == '2.7.2'
assert ['JDBCMajorVersion', 'JDBCMinorVersion'].collect{ md[it] } == [4, 2]
assert md.stringFunctions.tokenize(',').contains('CONCAT')
def rs = md.getTables(null, null, 'AUTH%', null)
assert rs.next()
assert rs.getString('TABLE_NAME').startsWith('AUTHOR')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the JavaDoc for your driver to find out what metadata information is available for you to access.</p>
</div>
</div>
<div class="sect4">
<h5 id="_named_and_named_ordinal_parameters"><a class="anchor" href="#_named_and_named_ordinal_parameters"></a><a class="link" href="#_named_and_named_ordinal_parameters">Named and named-ordinal parameters</a></h5>
<div class="paragraph">
<p>Groovy supports some additional alternative placeholder syntax variants. The GString variants
are typically preferred over these alternatives but the alternatives are useful for Java integration
purposes and sometimes in templating scenarios where GStrings might already be in heavy use as part
of a template. The named parameter variants are much like the String plus list of parameter variants but
instead of having a list of <code>?</code> placeholders followed by a list of parameters, you have one or more
placeholders having the form <code>:propName</code> or <code>?.propName</code> and a single map, named arguments or a
domain object as the parameter. The map or domain object should have a property named <code>propName</code>
corresponding to each supplied placeholder.</p>
</div>
<div class="paragraph">
<p>Here is an example using the colon form:</p>
</div>
<div class="listingblock">
<div class="title">Named parameters (colon form)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute "INSERT INTO Author (firstname, lastname) VALUES (:first, :last)", first: 'Dierk', last: 'Koenig'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And another example using the question mark form:</p>
</div>
<div class="listingblock">
<div class="title">Named parameters (question mark form)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute "INSERT INTO Author (firstname, lastname) VALUES (?.first, ?.last)", first: 'Jon', last: 'Skeet'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the information you need to supply is spread across multiple maps or domain objects you can
use the question mark form with an additional ordinal index as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Named-ordinal parameters</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Rockstar { String first, last }
def pogo = new Rockstar(first: 'Paul', last: 'McCartney')
def map = [lion: 'King']
sql.execute "INSERT INTO Author (firstname, lastname) VALUES (?1.first, ?2.lion)", pogo, map</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stored_procedures"><a class="anchor" href="#_stored_procedures"></a><a class="link" href="#_stored_procedures">Stored procedures</a></h5>
<div class="paragraph">
<p>The exact syntax for creating a stored procedure or function varies slightly between different databases.
For the HSQLDB database we are using, we can create a stored function which returns the initials of all authors in a table
as follows:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored function</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute """
  CREATE FUNCTION SELECT_AUTHOR_INITIALS()
  RETURNS TABLE (firstInitial VARCHAR(1), lastInitial VARCHAR(1))
  READS SQL DATA
  RETURN TABLE (
    SELECT LEFT(Author.firstname, 1) as firstInitial, LEFT(Author.lastname, 1) as lastInitial
    FROM Author
  )
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a SQL <code>CALL</code> statement to invoke the function using Groovy&#8217;s normal SQL retrieval methods.
Here is an example using <code>eachRow</code>.</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored procedure or function</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = []
sql.eachRow('CALL SELECT_AUTHOR_INITIALS()') {
  result &lt;&lt; "$it.firstInitial$it.lastInitial"
}
assert result == ['DK', 'JS', 'GL']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the code for creating another stored function, this one taking the lastname as a parameter:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored function with a parameter</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute """
  CREATE FUNCTION FULL_NAME (p_lastname VARCHAR(64))
  RETURNS VARCHAR(100)
  READS SQL DATA
  BEGIN ATOMIC
    DECLARE ans VARCHAR(100);
    SELECT CONCAT(firstname, ' ', lastname) INTO ans
    FROM Author WHERE lastname = p_lastname;
    RETURN ans;
  END
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the placeholder syntax to specify where the parameter belongs and note the special placeholder position to indicate the result:</p>
</div>
<div class="listingblock">
<div class="title">Using a stored function with a parameter</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = sql.firstRow("{? = call FULL_NAME(?)}", ['Koenig'])
assert result[0] == 'Dierk Koenig'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, here is a stored procedure with input and output parameters:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored procedure with input and output parameters</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute """
  CREATE PROCEDURE CONCAT_NAME (OUT fullname VARCHAR(100),
    IN first VARCHAR(50), IN last VARCHAR(50))
  BEGIN ATOMIC
    SET fullname = CONCAT(first, ' ', last);
  END
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the <code>CONCAT_NAME</code> stored procedure parameter, we make use of a special <code>call</code> method. Any input parameters are simply provided
as parameters to the method call. For output parameters, the resulting type must be specified as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Using a stored procedure with input and output parameters</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.call("{call CONCAT_NAME(?, ?, ?)}", [Sql.VARCHAR, 'Dierk', 'Koenig']) {
  fullname -&gt; assert fullname == 'Dierk Koenig'
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creating a stored procedure with an input/output parameter</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">sql.execute """
  CREATE PROCEDURE CHECK_ID_POSITIVE_IN_OUT ( INOUT p_err VARCHAR(64), IN pparam INTEGER, OUT re VARCHAR(15))
  BEGIN ATOMIC
    IF pparam &gt; 0 THEN
      set p_err = p_err || '_OK';
      set re = 'RET_OK';
    ELSE
      set p_err = p_err || '_ERROR';
      set re = 'RET_ERROR';
    END IF;
  END;
"""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using a stored procedure with an input/output parameter</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def scall = "{call CHECK_ID_POSITIVE_IN_OUT(?, ?, ?)}"
sql.call scall, [Sql.inout(Sql.VARCHAR("MESSAGE")), 1, Sql.VARCHAR], {
  res, p_err -&gt; assert res == 'MESSAGE_OK' &amp;&amp; p_err == 'RET_OK'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_datasets"><a class="anchor" href="#_using_datasets"></a><a class="link" href="#_using_datasets">3.9.5. Using DataSets</a></h4>
<div class="paragraph">
<p>Groovy provides a <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/sql/DataSet.html">groovy.sql.DataSet</a> class which enhances the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/sql/Sql.html">groovy.sql.Sql</a> class
with what can be thought of as mini <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> functionality.
Databases are accessed and queried using POGO fields and operators rather than JDBC-level API calls and RDBMS column names.</p>
</div>
<div class="paragraph">
<p>So, instead of a query like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def qry = """SELECT * FROM Author
  WHERE (firstname &gt; ?)
  AND (lastname &lt; ?)
  ORDER BY lastname DESC"""
def params = ['Dierk', 'Pragt']
def result = sql.rows(qry, params)
assert result*.firstname == ['Eric', 'Guillaume', 'Paul']</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def authorDS = sql.dataSet('Author')
def result = authorDS.findAll{ it.firstname &gt; 'Dierk' }
        .findAll{ it.lastname &lt; 'Pragt' }
        .sort{ it.lastname }
        .reverse()
assert result.rows()*.firstname == ['Eric', 'Guillaume', 'Paul']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have a helper "domain" class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Author {
    String firstname
    String lastname
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Database access and manipulation involves creating or working with
instances of the domain class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querying_collections_in_sql_like_style"><a class="anchor" href="#_querying_collections_in_sql_like_style"></a><a class="link" href="#_querying_collections_in_sql_like_style">3.10. Querying collections in SQL-like style</a></h3>
<div class="paragraph">
<p>Groovy&#8217;s <code>groovy-ginq</code> module provides a higher-level abstraction over collections.
It could perform queries against in-memory collections of objects in SQL-like style.
Also, querying XML, JSON, YAML, etc. could also be supported because they can be parsed into collections.
As GORM and jOOQ are powerful enough to support querying DB, we will cover collections first.</p>
</div>
<div class="sect3">
<h4 id="_ginq_a_k_a_groovy_integrated_query"><a class="anchor" href="#_ginq_a_k_a_groovy_integrated_query"></a><a class="link" href="#_ginq_a_k_a_groovy_integrated_query">3.10.1. GINQ a.k.a. Groovy-Integrated Query</a></h4>
<div class="paragraph">
<p>GINQ is a DSL for querying with SQL-like syntax, which consists of the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">GQ, i.e. abbreviation for GINQ
|__ from
|   |__ &lt;data_source_alias&gt; in &lt;data_source&gt;
|__ [join/innerjoin/leftjoin/rightjoin/fulljoin/crossjoin]*
|   |__ &lt;data_source_alias&gt; in &lt;data_source&gt;
|   |__ on &lt;condition&gt; ((&amp;&amp; | ||) &lt;condition&gt;)* (NOTE: `crossjoin` does not need `on` clause)
|__ [where]
|   |__ &lt;condition&gt; ((&amp;&amp; | ||) &lt;condition&gt;)*
|__ [groupby]
|   |__ &lt;expression&gt; [as &lt;alias&gt;] (, &lt;expression&gt; [as &lt;alias&gt;])*
|   |__ [having]
|       |__ &lt;condition&gt; ((&amp;&amp; | ||) &lt;condition&gt;)*
|__ [orderby]
|   |__ &lt;expression&gt; [in (asc|desc)] (, &lt;expression&gt; [in (asc|desc)])*
|__ [limit]
|   |__ [&lt;offset&gt;,] &lt;size&gt;
|__ select
    |__ &lt;expression&gt; [as &lt;alias&gt;] (, &lt;expression&gt; [as &lt;alias&gt;])*</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>[]</code> means the related clause is optional, <code>*</code> means zero or more times, and <code>+</code> means one or more times. Also, the clauses of GINQ are order sensitive,
so the order of clauses should be kept as the above structure
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we could see, the simplest GINQ consists of a <code>from</code> clause and a <code>select</code> clause, which looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
select n</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>ONLY ONE</em> <code>from</code> clause is required in GINQ. Also, GINQ supports multiple data sources through <code>from</code> and the related joins.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a DSL, GINQ should be wrapped with the following block to be executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GQ { /* GINQ CODE */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def numbers = [0, 1, 2]
assert [0, 1, 2] == GQ {
    from n in numbers
    select n
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.stream.Collectors

def numbers = [0, 1, 2]
assert '0#1#2' == GQ {
    from n in numbers
    select n
}.stream()
    .map(e -&gt; String.valueOf(e))
    .collect(Collectors.joining('#'))</code></pre>
</div>
</div>
<div class="paragraph">
<p>And it is strongly recommended to use <code>def</code> to define the variable for the result of GINQ execution,
which is a <code>Queryable</code> instance that is lazy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = GQ {
    /* GINQ CODE */
}
def stream = result.stream() // get the stream from GINQ result
def list = result.toList() // get the list from GINQ result</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Currently GINQ can not work well when STC is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also, GINQ could be written in a method marked with <code>@GQ</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GQ
def someGinqMethod() {
    /* GINQ CODE */
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mark the <code>ginq</code> method as a GINQ method with <code>@GQ</code> annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.ginq.transform.GQ
def ginq(list, b, e) {
    from n in list
    where b &lt; n &amp;&amp; n &lt; e
    select n
}

assert [3, 4] == ginq([1, 2, 3, 4, 5, 6], 2, 5).toList()</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the result type as <code>List</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.ginq.transform.GQ

@GQ(List)
def ginq(b, e) {
    from n in [1, 2, 3, 4, 5, 6]
    where b &lt; n &amp;&amp; n &lt; e
    select n
}

assert [3, 4] == ginq(2, 5)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GINQ supports many result types, e.g. <code>List</code>, <code>Set</code>, <code>Collection</code>, <code>Iterable</code>, <code>Iterator</code>, <code>java.util.stream.Stream</code> and array types.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable parallel querying:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.ginq.transform.GQ

@GQ(parallel=true)
def ginq(x) {
    from n in [1, 2, 3]
    where n &lt; x
    select n
}

assert [1] == ginq(2).toList()</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ginq_syntax"><a class="anchor" href="#_ginq_syntax"></a><a class="link" href="#_ginq_syntax">GINQ Syntax</a></h5>
<div class="sect5">
<h6 id="_data_source"><a class="anchor" href="#_data_source"></a><a class="link" href="#_data_source">Data Source</a></h6>
<div class="paragraph">
<p>The data source for GINQ could be specified by <code>from</code> clause, which is equivalent to SQL&#8217;s <code>FROM</code>.
Currently GINQ supports <code>Iterable</code>, <code>Stream</code>, array and GINQ result set as its data source:</p>
</div>
<div class="sect6">
<h7 id="_iterable_data_source"><a class="anchor" href="#_iterable_data_source"></a><a class="link" href="#_iterable_data_source"><code>Iterable</code> Data Source</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3] select n</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_stream_data_source"><a class="anchor" href="#_stream_data_source"></a><a class="link" href="#_stream_data_source"><code>Stream</code> Data Source</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3].stream() select n</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_array_data_source"><a class="anchor" href="#_array_data_source"></a><a class="link" href="#_array_data_source">Array Data Source</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in new int[] {1, 2, 3} select n</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_ginq_result_set_data_source"><a class="anchor" href="#_ginq_result_set_data_source"></a><a class="link" href="#_ginq_result_set_data_source">GINQ Result Set Data Source</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def vt = GQ {from m in [1, 2, 3] select m}
assert [1, 2, 3] == GQ {
    from n in vt select n
}.toList()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_projection"><a class="anchor" href="#_projection"></a><a class="link" href="#_projection">Projection</a></h6>
<div class="paragraph">
<p>The column names could be renamed with <code>as</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = GQ {
    from n in [1, 2, 3]
    select Math.pow(n, 2) as powerOfN
}
assert [[1, 1], [4, 4], [9, 9]] == result.stream().map(r -&gt; [r[0], r.powerOfN]).toList()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The renamed column could be referenced by its new name, e.g. <code>r.powerOfN</code>.
Also, it could be referenced by its index, e.g. <code>r[0]</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1], [2, 4], [3, 9]] == GQ {
    from v in (
        from n in [1, 2, 3]
        select n, Math.pow(n, 2) as powerOfN
    )
    select v.n, v.powerOfN
}.toList()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>select P1, P2, &#8230;&#8203;, Pn</code> is a simplified syntax of <code>select new NamedRecord(P1, P2, &#8230;&#8203;, Pn)</code> when and only when <code>n</code> &gt;= 2.
Also, <code>NamedRecord</code> instance will be created if <code>as</code> clause is used.
The values stored in the <code>NamedRecord</code> could be referenced by their names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Construct new objects as column values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.EqualsAndHashCode
class Person {
    String name
    Person(String name) {
        this.name = name
    }
}
def persons = [new Person('Daniel'), new Person('Paul'), new Person('Eric')]
assert persons == GQ {
    from n in ['Daniel', 'Paul', 'Eric']
    select new Person(n)
}.toList()</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_distinct"><a class="anchor" href="#_distinct"></a><a class="link" href="#_distinct">Distinct</a></h7>
<div class="paragraph">
<p><code>distinct</code> is equivalent to SQL&#8217;s <code>DISTINCT</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = GQ {
    from n in [1, 2, 2, 3, 3, 3]
    select distinct(n)
}
assert [1, 2, 3] == result.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = GQ {
    from n in [1, 2, 2, 3, 3, 3]
    select distinct(n, n + 1)
}
assert [[1, 2], [2, 3], [3, 4]] == result.toList()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_filtering"><a class="anchor" href="#_filtering"></a><a class="link" href="#_filtering">Filtering</a></h6>
<div class="paragraph">
<p><code>where</code> is equivalent to SQL&#8217;s <code>WHERE</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2, 3, 4, 5]
where n &gt; 0 &amp;&amp; n &lt;= 3
select n * 2</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_in"><a class="anchor" href="#_in"></a><a class="link" href="#_in">In</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where n in [1, 2]
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where n in (
    from m in [1, 2]
    select m
)
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.lang.Tuple.tuple
assert [0, 1] == GQ {
    from n in [0, 1, 2]
    where tuple(n, n + 1) in (
        from m in [1, 2]
        select m - 1, m
    )
    select n
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_not_in"><a class="anchor" href="#_not_in"></a><a class="link" href="#_not_in">Not In</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where n !in [1, 2]
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where n !in (
    from m in [1, 2]
    select m
)
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.lang.Tuple.tuple
assert [2] == GQ {
    from n in [0, 1, 2]
    where tuple(n, n + 1) !in (
        from m in [1, 2]
        select m - 1, m
    )
    select n
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_exists"><a class="anchor" href="#_exists"></a><a class="link" href="#_exists">Exists</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3]
where (
    from m in [2, 3]
    where m == n
    select m
).exists()
select n</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_not_exists"><a class="anchor" href="#_not_exists"></a><a class="link" href="#_not_exists">Not Exists</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3]
where !(
    from m in [2, 3]
    where m == n
    select m
).exists()
select n</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_joining"><a class="anchor" href="#_joining"></a><a class="link" href="#_joining">Joining</a></h6>
<div class="paragraph">
<p>More data sources for GINQ could be specified by join clauses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
join n2 in [1, 3] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>join</code> is preferred over <code>innerjoin</code> and <code>innerhashjoin</code> as it has better readability,
and it is smart enough to choose the correct concrete join(i.e. <code>innerjoin</code> or <code>innerhashjoin</code>) by its <code>on</code> clause.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
innerjoin n2 in [1, 3] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
leftjoin n2 in [2, 3, 4] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [2, 3, 4]
rightjoin n2 in [1, 2, 3] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
fulljoin n2 in [2, 3, 4] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
crossjoin n2 in [3, 4, 5]
select n1, n2</code></pre>
</div>
</div>
<div class="paragraph">
<p>hash join is especially efficient when data sources contain lots of objects</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
innerhashjoin n2 in [1, 3] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
lefthashjoin n2 in [2, 3, 4] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [2, 3, 4]
righthashjoin n2 in [1, 2, 3] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n1 in [1, 2, 3]
fullhashjoin n2 in [2, 3, 4] on n1 == n2
select n1, n2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only binary expressions(<code>==</code>, <code>&amp;&amp;</code>) are allowed in the <code>on</code> clause of hash join
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_grouping"><a class="anchor" href="#_grouping"></a><a class="link" href="#_grouping">Grouping</a></h6>
<div class="paragraph">
<p><code>groupby</code> is equivalent to SQL&#8217;s <code>GROUP BY</code>, and <code>having</code> is equivalent to SQL&#8217;s <code>HAVING</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, count(n)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
having n &gt;= 3
select n, count(n)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
having count() &lt; 3
select n, count()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The group columns could be renamed with <code>as</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['ab', 'ac', 'bd', 'acd', 'bcd', 'bef']
groupby s.size() as length, s[0] as firstChar
select length, firstChar, max(s)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['ab', 'ac', 'bd', 'acd', 'bcd', 'bef']
groupby s.size() as length, s[0] as firstChar
having length == 3 &amp;&amp; firstChar == 'b'
select length, firstChar, max(s)</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_aggregate_functions"><a class="anchor" href="#_aggregate_functions"></a><a class="link" href="#_aggregate_functions">Aggregate Functions</a></h7>
<div class="paragraph">
<p>GINQ provides some built-in aggregate functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Argument Type(s)</th>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">count()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of rows, similar to <code>count(*)</code> in SQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">count(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of rows for which the value of <em>expression</em> is not <code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Comparable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum value of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Comparable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum value of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">avg(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the average (arithmetic mean) of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the aggregated list of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">median(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value such that the number of non-null values above and below it is the same ("middle" value, not necessarily same as average or mean)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdev(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical standard deviation of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdevp(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical standard deviation for the population for all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical variance of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">varp(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical variance for the population for all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">agg(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">customizes the aggregation logic in <em>expression</em> and returns single value</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, count()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['a', 'b', 'cd', 'ef']
groupby s.size() as length
select length, min(s)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['a', 'b', 'cd', 'ef']
groupby s.size() as length
select length, max(s)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, sum(n)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, avg(n)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, median(n)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">assert [['A', ['APPLE', 'APRICOT']],
        ['B', ['BANANA']],
        ['C', ['CANTALOUPE']]] == GQL {
    from fruit in ['Apple', 'Apricot', 'Banana', 'Cantaloupe']
    groupby fruit[0] as firstChar
    select firstChar, list(fruit.toUpperCase()) as fruit_list
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">def persons = [new Person('Linda', 100, 'Female'),
               new Person('Daniel', 135, 'Male'),
               new Person('David', 122, 'Male')]
assert [['Male', ['Daniel', 'David']], ['Female', ['Linda']]] == GQL {
    from p in persons
    groupby p.gender
    select p.gender, list(p.name)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 1, 3, 3, 6, 6, 6]
groupby n
select n, agg(_g.stream().map(r -&gt; r.n).reduce(BigDecimal.ZERO, BigDecimal::add))</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>_g</code> is an implicit variable for <code>agg</code> aggregate function,
it represents the grouped <code>Queryable</code> object and its record(e.g. <code>r</code>) could reference the data source by alias(e.g. <code>n</code>)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from fruit in ['Apple', 'Apricot', 'Banana', 'Cantaloupe']
groupby fruit.substring(0, 1) as firstChar
select firstChar, agg(_g.stream().map(r -&gt; r.fruit).toList()) as fruit_list</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, we could apply the aggregate functions for the whole GINQ result, i.e. no <code>groupby</code> clause is needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [3] == GQ {
    from n in [1, 2, 3]
    select max(n)
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 3, 2, 2, 6, 3, 3, 6]] == GQ {
    from n in [1, 2, 3]
    select min(n), max(n), avg(n), median(n), sum(n), count(n), count(),
            agg(_g.stream().map(r -&gt; r.n).reduce(BigDecimal.ZERO, BigDecimal::add))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [0.816496580927726] == GQ {
    from n in [1, 2, 3]
    select stdev(n)
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1] == GQ {
    from n in [1, 2, 3]
    select stdevp(n)
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [0.6666666666666667] == GQ {
    from n in [1, 2, 3]
    select var(n)
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [1] == GQ {
    from n in [1, 2, 3]
    select varp(n)
}.toList()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sorting_2"><a class="anchor" href="#_sorting_2"></a><a class="link" href="#_sorting_2">Sorting</a></h6>
<div class="paragraph">
<p><code>orderby</code> is equivalent to SQL&#8217;s <code>ORDER BY</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 5, 2, 6]
orderby n
select n</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>in asc</code> is optional when sorting <code>in</code> ascending order
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 5, 2, 6]
orderby n in asc
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 5, 2, 6]
orderby n in desc
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['a', 'b', 'ef', 'cd']
orderby s.length() in desc, s in asc
select s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from s in ['a', 'b', 'ef', 'cd']
orderby s.length() in desc, s
select s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, null, 5, null, 2, 6]
orderby n in asc(nullslast)
select n</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>nullslast</code> is equivalent to SQL&#8217;s <code>NULLS LAST</code> and applied by default.
<code>nullsfirst</code> is equivalent to SQL&#8217;s <code>NULLS FIRST</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, null, 5, null, 2, 6]
orderby n in asc(nullsfirst)
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, null, 5, null, 2, 6]
orderby n in desc(nullslast)
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, null, 5, null, 2, 6]
orderby n in desc(nullsfirst)
select n</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_pagination"><a class="anchor" href="#_pagination"></a><a class="link" href="#_pagination">Pagination</a></h6>
<div class="paragraph">
<p><code>limit</code> is similar to the <code>limit</code> clause of MySQL, which could specify the <code>offset</code>(first argument) and <code>size</code>(second argument) for paginating,
or just specify the only one argument as <code>size</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3, 4, 5]
limit 3
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3, 4, 5]
limit 1, 3
select n</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_nested_ginq"><a class="anchor" href="#_nested_ginq"></a><a class="link" href="#_nested_ginq">Nested GINQ</a></h6>
<div class="sect6">
<h7 id="_nested_ginq_in_from_clause"><a class="anchor" href="#_nested_ginq_in_from_clause"></a><a class="link" href="#_nested_ginq_in_from_clause">Nested GINQ in <code>from</code> clause</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from v in (
    from n in [1, 2, 3]
    select n
)
select v</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_nested_ginq_in_where_clause"><a class="anchor" href="#_nested_ginq_in_where_clause"></a><a class="link" href="#_nested_ginq_in_where_clause">Nested GINQ in <code>where</code> clause</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where n in (
    from m in [1, 2]
    select m
)
select n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [0, 1, 2]
where (
    from m in [1, 2]
    where m == n
    select m
).exists()
select n</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_nested_ginq_in_select_clause"><a class="anchor" href="#_nested_ginq_in_select_clause"></a><a class="link" href="#_nested_ginq_in_select_clause">Nested GINQ in <code>select</code> clause</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [null, 2, 3] == GQ {
    from n in [1, 2, 3]
    select (
        from m in [2, 3, 4]
        where m == n
        limit 1
        select m
    )
}.toList()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It&#8217;s recommended to use <code>limit 1</code> to restrict the count of sub-query result
because <code>TooManyValuesException</code> will be thrown if more than one values returned
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We could use <code>as</code> clause to name the sub-query result</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, null], [2, 2], [3, 3]] == GQ {
    from n in [1, 2, 3]
    select n, (
        from m in [2, 3, 4]
        where m == n
        select m
    ) as sqr
}.toList()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_window_functions"><a class="anchor" href="#_window_functions"></a><a class="link" href="#_window_functions">Window Functions</a></h6>
<div class="paragraph">
<p>Window can be defined by <code>partitionby</code>, <code>orderby</code>, <code>rows</code> and <code>range</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">over(
    [partitionby &lt;expression&gt; (, &lt;expression&gt;)*]
    [orderby &lt;expression&gt; (, &lt;expression&gt;)*
       [rows &lt;lower&gt;, &lt;upper&gt; | range &lt;lower&gt;, &lt;upper&gt;]]
)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code> used as bound of <code>rows</code> and <code>range</code> clause is equivalent to SQL&#8217;s <code>CURRENT ROW</code>, and negative means <code>PRECEDING</code>, positive means <code>FOLLOWING</code></p>
</li>
<li>
<p><code>null</code> used as the lower bound of <code>rows</code> and <code>range</code> clause is equivalent to SQL&#8217;s <code>UNBOUNDED PRECEDING</code></p>
</li>
<li>
<p><code>null</code> used as the upper bound of <code>rows</code> and <code>range</code> clause is equivalent to SQL&#8217;s <code>UNBOUNDED FOLLOWING</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, GINQ provides some built-in window functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Argument Type(s)</th>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rowNumber()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of the current row within its partition, counting from <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rank()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rank of the current row with gaps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">denseRank()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rank of the current row without gaps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">percentRank()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">relative rank of the current row: (rank - 1) / (total rows - 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cumeDist()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">relative rank of the current row: (number of rows preceding or peer with current row) / (total rows)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntile(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bucket index ranging from <code>0</code> to <code>expression - 1</code>, dividing the partition as equally as possible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lead(<em>expression</em> [, <em>offset</em> [, <em>default</em>]])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any [, java.lang.Long [, same as <em>expression</em> type]]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as <em>expression</em> type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns <em>expression</em> evaluated at the row that is <em>offset</em> rows after the current row within the partition; if there is no such row, instead return <em>default</em> (which must be of the same type as <em>expression</em>). Both <em>offset</em> and <em>default</em> are evaluated with respect to the current row. If omitted, <em>offset</em> defaults to <code>1</code> and <em>default</em> to <code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lag(<em>expression</em> [, <em>offset</em> [, <em>default</em>]])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any [, java.lang.Long [, same as <em>expression</em> type]]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as <em>expression</em> type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns <em>expression</em> evaluated at the row that is <em>offset</em> rows before the current row within the partition; if there is no such row, instead return <em>default</em> (which must be of the same type as <em>expression</em>). Both <em>offset</em> and <em>default</em> are evaluated with respect to the current row. If omitted, <em>offset</em> defaults to <code>1</code> and <em>default</em> to <code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstValue(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same type as <em>expression</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns <em>expression</em> evaluated at the row that is the first row of the window frame</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastValue(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same type as <em>expression</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns <em>expression</em> evaluated at the row that is the last row of the window frame</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nthValue(<em>expression</em>, <em>n</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any, java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same type as <em>expression</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">returns <em>expression</em> evaluated at the row that is the <em>nth</em> row of the window frame</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">count()</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of rows, similar to <code>count(*)</code> in SQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">count(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of rows for which the value of <em>expression</em> is not <code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Comparable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum value of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Comparable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum value of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum of expression across all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">avg(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the average (arithmetic mean) of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">median(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value such that the number of non-null values above and below it is the same ("middle" value, not necessarily same as average or mean)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdev(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical standard deviation of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdevp(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical standard deviation for the population for all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">var(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical variance of all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">varp(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the statistical variance for the population for all non-null values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">agg(<em>expression</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>INCUBATING</strong>: customizes the aggregation logic in <em>expression</em> and returns single value</p></td>
</tr>
</tbody>
</table>
<div class="sect6">
<h7 id="_rownumber"><a class="anchor" href="#_rownumber"></a><a class="link" href="#_rownumber"><code>rowNumber</code></a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1, 1, 1], [1, 0, 0, 2], [null, 3, 3, 3], [3, 2, 2, 0]] == GQ {
    from n in [2, 1, null, 3]
    select n, (rowNumber() over(orderby n)),
              (rowNumber() over(orderby n in asc)),
              (rowNumber() over(orderby n in desc))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 0, 1, 2, 3], [2, 1, 2, 1, 2], [null, 3, 0, 3, 0], [3, 2, 3, 0, 1]] == GQ {
    from n in [1, 2, null, 3]
    select n, (rowNumber() over(orderby n in asc(nullslast))),
              (rowNumber() over(orderby n in asc(nullsfirst))),
              (rowNumber() over(orderby n in desc(nullslast))),
              (rowNumber() over(orderby n in desc(nullsfirst)))
}.toList()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parentheses around the window function is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_rank_denserank_percentrank_cumedist_and_ntile"><a class="anchor" href="#_rank_denserank_percentrank_cumedist_and_ntile"></a><a class="link" href="#_rank_denserank_percentrank_cumedist_and_ntile"><code>rank</code>, <code>denseRank</code>, <code>percentRank</code>, <code>cumeDist</code> and <code>ntile</code></a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', 1, 1], ['b', 2, 2], ['b', 2, 2],
        ['c', 4, 3], ['c', 4, 3], ['d', 6, 4],
        ['e', 7, 5]] == GQ {
    from s in ['a', 'b', 'b', 'c', 'c', 'd', 'e']
    select s,
        (rank() over(orderby s)),
        (denseRank() over(orderby s))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[60, 0, 0.4], [60, 0, 0.4], [80, 0.5, 0.8], [80, 0.5, 0.8], [100, 1, 1]] == GQ {
    from n in [60, 60, 80, 80, 100]
    select n,
        (percentRank() over(orderby n)),
        (cumeDist() over(orderby n))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 0], [2, 0], [3, 0],
        [4, 1], [5, 1],
        [6, 2], [7, 2],[8, 2],
        [9, 3], [10, 3]] == GQ {
    from n in 1..10
    select n, (ntile(4) over(orderby n))
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_lead_and_lag"><a class="anchor" href="#_lead_and_lag"></a><a class="link" href="#_lead_and_lag"><code>lead</code> and <code>lag</code></a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 2], [3, null]] == GQ {
    from n in [2, 1, 3]
    select n, (lead(n) over(orderby n))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 2], [3, null]] == GQ {
    from n in [2, 1, 3]
    select n, (lead(n) over(orderby n in asc))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', 'bc'], ['ab', null], ['b', 'a'], ['bc', 'ab']] == GQ {
    from s in ['a', 'ab', 'b', 'bc']
    select s, (lead(s) over(orderby s.length(), s in desc))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', null], ['ab', null], ['b', 'a'], ['bc', 'ab']] == GQ {
    from s in ['a', 'ab', 'b', 'bc']
    select s, (lead(s) over(partitionby s.length() orderby s.length(), s in desc))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1], [1, null], [3, 2]] == GQ {
    from n in [2, 1, 3]
    select n, (lag(n) over(orderby n))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 2], [3, null]] == GQ {
    from n in [2, 1, 3]
    select n, (lag(n) over(orderby n in desc))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', null], ['b', 'a'], ['aa', null], ['bb', 'aa']] == GQ {
    from s in ['a', 'b', 'aa', 'bb']
    select s, (lag(s) over(partitionby s.length() orderby s))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3, 1], [1, 2, null], [3, null, 2]] == GQ {
    from n in [2, 1, 3]
    select n, (lead(n) over(orderby n)), (lag(n) over(orderby n))
}.toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The offset can be specified other than the default offset <code>1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, null, null], [1, 3, null], [3, null, 1]] == GQ {
    from n in [2, 1, 3]
    select n, (lead(n, 2) over(orderby n)), (lag(n, 2) over(orderby n))
}.toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value can be returned when the index specified by offset is out of window, e.g. <code>'NONE'</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 'NONE', 'NONE'], [1, 3, 'NONE'], [3, 'NONE', 1]] == GQ {
    from n in [2, 1, 3]
    select n, (lead(n, 2, 'NONE') over(orderby n)), (lag(n, 2, 'NONE') over(orderby n))
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_firstvalue_lastvalue_and_nthvalue"><a class="anchor" href="#_firstvalue_lastvalue_and_nthvalue"></a><a class="link" href="#_firstvalue_lastvalue_and_nthvalue"><code>firstValue</code>, <code>lastValue</code> and <code>nthValue</code></a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1], [1, 1], [3, 2]] == GQ {
    from n in [2, 1, 3]
    select n, (firstValue(n) over(orderby n rows -1, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 2], [3, 3]] == GQ {
    from n in [2, 1, 3]
    select n, (lastValue(n) over(orderby n rows -1, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 2], [1, 1], [3, 3]] == GQ {
    from n in [2, 1, 3]
    select n, (firstValue(n) over(orderby n rows 0, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1], [1, null], [3, 1]] == GQ {
    from n in [2, 1, 3]
    select n, (firstValue(n) over(orderby n rows -2, -1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1], [1, null], [3, 2]] == GQ {
    from n in [2, 1, 3]
    select n, (lastValue(n) over(orderby n rows -2, -1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 3], [3, null]] == GQ {
    from n in [2, 1, 3]
    select n, (lastValue(n) over(orderby n rows 1, 2))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 2], [3, null]] == GQ {
    from n in [2, 1, 3]
    select n, (firstValue(n) over(orderby n rows 1, 2))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 2], [1, 1], [3, 3]] == GQ {
    from n in [2, 1, 3]
    select n, (lastValue(n) over(orderby n rows -1, 0))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 1], [1, 1], [3, 1]] == GQ {
    from n in [2, 1, 3]
    select n, (firstValue(n) over(orderby n rows null, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 3], [1, 3], [3, 3]] == GQ {
    from n in [2, 1, 3]
    select n, (lastValue(n) over(orderby n rows -1, null))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', 'a', 'b'], ['aa', 'aa', 'bb'], ['b', 'a', 'b'], ['bb', 'aa', 'bb']] == GQ {
    from s in ['a', 'aa', 'b', 'bb']
    select s, (firstValue(s) over(partitionby s.length() orderby s)),
            (lastValue(s) over(partitionby s.length() orderby s))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1, 2, 3, null], [2, 1, 2, 3, null], [3, 1, 2, 3, null]] == GQ {
    from n in 1..3
    select n, (nthValue(n, 0) over(orderby n)),
              (nthValue(n, 1) over(orderby n)),
              (nthValue(n, 2) over(orderby n)),
              (nthValue(n, 3) over(orderby n))
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_min_max_count_sum_avg_median_stdev_stdevp_var_varp_and_agg"><a class="anchor" href="#_min_max_count_sum_avg_median_stdev_stdevp_var_varp_and_agg"></a><a class="link" href="#_min_max_count_sum_avg_median_stdev_stdevp_var_varp_and_agg"><code>min</code>, <code>max</code>, <code>count</code>, <code>sum</code>, <code>avg</code>, <code>median</code>, <code>stdev</code>, <code>stdevp</code>, <code>var</code> ,<code>varp</code> and <code>agg</code></a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [['a', 'a', 'b'], ['b', 'a', 'b'], ['aa', 'aa', 'bb'], ['bb', 'aa', 'bb']] == GQ {
    from s in ['a', 'b', 'aa', 'bb']
    select s, (min(s) over(partitionby s.length())), (max(s) over(partitionby s.length()))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 2, 2, 2, 1, 1], [1, 2, 2, 2, 1, 1],
        [2, 2, 2, 4, 2, 2], [2, 2, 2, 4, 2, 2],
        [3, 2, 2, 6, 3, 3], [3, 2, 2, 6, 3, 3]] == GQ {
    from n in [1, 1, 2, 2, 3, 3]
    select n, (count() over(partitionby n)),
              (count(n) over(partitionby n)),
              (sum(n) over(partitionby n)),
              (avg(n) over(partitionby n)),
              (median(n) over(partitionby n))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 6, 3, 1, 3, 4], [1, 6, 3, 1, 3, 4],
        [3, 6, 3, 1, 3, 4], [null, 6, 3, 1, 3, 4]] == GQ {
    from n in [2, 1, 3, null]
    select n, (sum(n) over()),
              (max(n) over()),
              (min(n) over()),
              (count(n) over()),
              (count() over())
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1, 1], [2, 2, 3], [5, 2, 10], [5, 2, 10]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n range -2, 0)),
              (sum(n) over(orderby n range -2, 0))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 2, 3], [2, 1, 2], [5, 2, 10], [5, 2, 10]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n range 0, 1)),
              (sum(n) over(orderby n range 0, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 2, 3], [2, 2, 3], [5, 2, 10], [5, 2, 10]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n range -1, 1)),
              (sum(n) over(orderby n range -1, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1, 2], [2, 0, 0], [5, 0, 0], [5, 0, 0]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n in desc range 1, 2)),
              (sum(n) over(orderby n in desc range 1, 2))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 0, 0], [2, 1, 1], [5, 0, 0], [5, 0, 0]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n in desc range -2, -1)),
              (sum(n) over(orderby n in desc range -2, -1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 3, 12], [2, 2, 10], [5, 0, 0], [5, 0, 0]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n range 1, null)),
              (sum(n) over(orderby n range 1, null))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 2, 3], [2, 2, 3], [5, 4, 13], [5, 4, 13]] == GQ {
    from n in [1, 2, 5, 5]
    select n, (count() over(orderby n range null, 1)),
              (sum(n) over(orderby n range null, 1))
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 0.816496580927726],
        [2, 0.816496580927726],
        [3, 0.816496580927726]] == GQ {
    from n in [1, 2, 3]
    select n, (stdev(n) over())
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1], [2, 1], [3, 1]] == GQ {
    from n in [1, 2, 3]
    select n, (stdevp(n) over())
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 0.6666666666666667],
        [2, 0.6666666666666667],
        [3, 0.6666666666666667]] == GQ {
    from n in [1, 2, 3]
    select n, (var(n) over())
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1], [2, 1], [3, 1]] == GQ {
    from n in [1, 2, 3]
    select n, (varp(n) over())
}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 4], [2, 2], [3, 4]] == GQ {
    from n in [1, 2, 3]
    select n,
           (agg(_g.stream().map(r -&gt; r.n).reduce(BigDecimal.ZERO, BigDecimal::add)) over(partitionby n % 2))
}.toList()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ginq_tips"><a class="anchor" href="#_ginq_tips"></a><a class="link" href="#_ginq_tips">GINQ Tips</a></h5>
<div class="sect5">
<h6 id="_row_number"><a class="anchor" href="#_row_number"></a><a class="link" href="#_row_number">Row Number</a></h6>
<div class="paragraph">
<p><code>_rn</code> is the implicit variable representing row number for each record in the result set. It starts with <code>0</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from n in [1, 2, 3]
select _rn, n</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_comprehension"><a class="anchor" href="#_list_comprehension"></a><a class="link" href="#_list_comprehension">List Comprehension</a></h6>
<div class="paragraph">
<p>List comprehension is an elegant way to define and create lists based on existing lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [4, 16, 36, 64, 100] == GQ {from n in 1..&lt;11 where n % 2 == 0 select n ** 2}.toList()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [4, 16, 36, 64, 100] == GQ {from n in 1..&lt;11 where n % 2 == 0 select n ** 2} as List</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [4, 16, 36, 64, 100] == GQL {from n in 1..&lt;11 where n % 2 == 0 select n ** 2}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>GQL {&#8230;&#8203;}</code> is the abbreviation of <code>GQ {&#8230;&#8203;}.toList()</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GINQ could be used as list comprehension in the loops directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = []
for (def x : GQ {from n in 1..&lt;11 where n % 2 == 0 select n ** 2}) {
    result &lt;&lt; x
}
assert [4, 16, 36, 64, 100] == result</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_query_update"><a class="anchor" href="#_query_update"></a><a class="link" href="#_query_update">Query &amp; Update</a></h6>
<div class="paragraph">
<p>This is like <code>update</code> statement in SQL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.*
@TupleConstructor
@EqualsAndHashCode
@ToString
class Person {
    String name
    String nickname
}

def linda = new Person('Linda', null)
def david = new Person('David', null)
def persons = [new Person('Daniel', 'ShanFengXiaoZi'), linda, david]
def result = GQ {
    from p in persons
    where p.nickname == null
    select p
}.stream()
    .peek(p -&gt; { p.nickname = 'Unknown' }) // update `nickname`
    .toList()

def expected = [new Person('Linda', 'Unknown'), new Person('David', 'Unknown')]
assert expected == result
assert ['Unknown', 'Unknown'] == [linda, david]*.nickname // ensure the original objects are updated</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_for_with_clause"><a class="anchor" href="#_alternative_for_with_clause"></a><a class="link" href="#_alternative_for_with_clause">Alternative for <code>with</code> clause</a></h6>
<div class="paragraph">
<p>GINQ does not support <code>with</code> clause for now, but we could define a temporary variable to workaround:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def v = GQ { from n in [1, 2, 3] where n &lt; 3 select n }
def result = GQ {
    from n in v
    where n &gt; 1
    select n
}
assert [2] == result.toList()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_for_case_when"><a class="anchor" href="#_alternative_for_case_when"></a><a class="link" href="#_alternative_for_case_when">Alternative for <code>case-when</code></a></h6>
<div class="paragraph">
<p><code>case-when</code> of SQL could be replaced with switch expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert ['a', 'b', 'c', 'c'] == GQ {
    from n in [1, 2, 3, 4]
    select switch (n) {
        case 1 -&gt; 'a'
        case 2 -&gt; 'b'
        default -&gt; 'c'
    }
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_query_json"><a class="anchor" href="#_query_json"></a><a class="link" href="#_query_json">Query JSON</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.json.JsonSlurper
def json = new JsonSlurper().parseText('''
    {
        "fruits": [
            {"name": "Orange", "price": 11},
            {"name": "Apple", "price": 6},
            {"name": "Banana", "price": 4},
            {"name": "Mongo", "price": 29},
            {"name": "Durian", "price": 32}
        ]
    }
''')

def expected = [['Mongo', 29], ['Orange', 11], ['Apple', 6], ['Banana', 4]]
assert expected == GQ {
    from f in json.fruits
    where f.price &lt; 32
    orderby f.price in desc
    select f.name, f.price
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_parallel_querying"><a class="anchor" href="#_parallel_querying"></a><a class="link" href="#_parallel_querying">Parallel Querying</a></h6>
<div class="paragraph">
<p>Parallel querying is especially efficient when querying big data sources. It is disabled by default, but we could enable it by hand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[1, 1], [2, 2], [3, 3]] == GQ(parallel: true) {
    from n1 in 1..1000
    join n2 in 1..10000 on n2 == n1
    where n1 &lt;= 3 &amp;&amp; n2 &lt;= 5
    select n1, n2
}.toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>As parallel querying will use a shared thread pool, the following code can release resources after all GINQ statements execution are completed, and it will wait util all tasks of threads are completed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GQ {
    shutdown
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Once <code>shutdown</code> is issued, parallel querying can not work anymore.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code is equivalent to the above code, in other words, <code>immediate</code> is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GQ {
    shutdown immediate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Shutdown without waiting tasks to complete:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GQ {
    shutdown abort
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_customize_ginq"><a class="anchor" href="#_customize_ginq"></a><a class="link" href="#_customize_ginq">Customize GINQ</a></h6>
<div class="paragraph">
<p>For advanced users, you could customize GINQ behaviour by specifying your own target code generator.
For example, we could specify the qualified class name <code>org.apache.groovy.ginq.provider.collection.GinqAstWalker</code> as the target code generator to generate GINQ method calls for querying collections,
which is the default behaviour of GINQ:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [0, 1, 2] == GQ(astWalker: 'org.apache.groovy.ginq.provider.collection.GinqAstWalker') {
    from n in [0, 1, 2]
    select n
}.toList()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_optimize_ginq"><a class="anchor" href="#_optimize_ginq"></a><a class="link" href="#_optimize_ginq">Optimize GINQ</a></h6>
<div class="paragraph">
<p>GINQ optimizer is enabled by default for better performance. It will transform the GINQ AST to achieve better execution plan.
We could disable it by hand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert [[2, 2]] == GQ(optimize: false) {
    from n1 in [1, 2, 3]
    join n2 in [1, 2, 3] on n1 == n2
    where n1 &gt; 1 &amp;&amp;  n2 &lt; 3
    select n1, n2
}.toList()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ginq_examples"><a class="anchor" href="#_ginq_examples"></a><a class="link" href="#_ginq_examples">GINQ Examples</a></h5>
<div class="sect5">
<h6 id="_generate_multiplication_table"><a class="anchor" href="#_generate_multiplication_table"></a><a class="link" href="#_generate_multiplication_table">Generate Multiplication Table</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sql">from v in (
    from a in 1..9
    join b in 1..9 on a &lt;= b
    select a as f, b as s, "$a * $b = ${a * b}".toString() as r
)
groupby v.s
select max(v.f == 1 ? v.r : '') as v1,
       max(v.f == 2 ? v.r : '') as v2,
       max(v.f == 3 ? v.r : '') as v3,
       max(v.f == 4 ? v.r : '') as v4,
       max(v.f == 5 ? v.r : '') as v5,
       max(v.f == 6 ? v.r : '') as v6,
       max(v.f == 7 ? v.r : '') as v7,
       max(v.f == 8 ? v.r : '') as v8,
       max(v.f == 9 ? v.r : '') as v9</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_more_examples"><a class="anchor" href="#_more_examples"></a><a class="link" href="#_more_examples">More examples</a></h6>
<div class="paragraph">
<p>link: the latest <a href="https://github.com/apache/groovy/blob/master/subprojects/groovy-ginq/src/spec/test/org/apache/groovy/ginq/GinqTest.groovy">GINQ examples</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some examples in the above link require the latest SNAPSHOT version of Groovy to run.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="processing-xml"><a class="anchor" href="#processing-xml"></a><a class="link" href="#processing-xml">3.11. Processing XML</a></h3>
<div class="sect3">
<h4 id="_parsing_xml"><a class="anchor" href="#_parsing_xml"></a><a class="link" href="#_parsing_xml">3.11.1. Parsing XML</a></h4>
<div class="sect4">
<h5 id="_xmlparser_and_xmlslurper"><a class="anchor" href="#_xmlparser_and_xmlslurper"></a><a class="link" href="#_xmlparser_and_xmlslurper">XmlParser and XmlSlurper</a></h5>
<div class="paragraph">
<p>The most commonly used approach for parsing XML with Groovy is to use
one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groovy.xml.XmlParser</code></p>
</li>
<li>
<p><code>groovy.xml.XmlSlurper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both have the same approach to parse an XML. Both come with a bunch of
overloaded parse methods plus some special methods such as <code>parseText</code>,
parseFile and others. For the next example we will use the <code>parseText</code>
method. It parses an XML <code>String</code> and recursively converts it to a list
or map of objects.</p>
</div>
<div class="listingblock">
<div class="title">XmlSlurper</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = '''
    &lt;list&gt;
        &lt;technology&gt;
            &lt;name&gt;Groovy&lt;/name&gt;
        &lt;/technology&gt;
    &lt;/list&gt;
'''

def list = new XmlSlurper().parseText(text) <i class="conum" data-value="1"></i><b>(1)</b>

assert list instanceof groovy.xml.slurpersupport.GPathResult <i class="conum" data-value="2"></i><b>(2)</b>
assert list.technology.name == 'Groovy' <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML an returning the root node as a GPathResult</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking we&#8217;re using a GPathResult</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Traversing the tree in a GPath style</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">XmlParser</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = '''
    &lt;list&gt;
        &lt;technology&gt;
            &lt;name&gt;Groovy&lt;/name&gt;
        &lt;/technology&gt;
    &lt;/list&gt;
'''

def list = new XmlParser().parseText(text) <i class="conum" data-value="1"></i><b>(1)</b>

assert list instanceof groovy.util.Node <i class="conum" data-value="2"></i><b>(2)</b>
assert list.technology.name.text() == 'Groovy' <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML an returning the root node as a Node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking we&#8217;re using a Node</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Traversing the tree in a GPath style</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see the <strong>similarities</strong> between <code>XMLParser</code> and <code>XMLSlurper</code> first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both are based on <code>SAX</code> so they both are low memory footprint</p>
</li>
<li>
<p>Both can update/transform the XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But they have key <strong>differences</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XmlSlurper</code> evaluates the structure lazily. So if you update the xml
you&#8217;ll have to evaluate the whole tree again.</p>
</li>
<li>
<p><code>XmlSlurper</code> returns <code>GPathResult</code> instances when parsing XML</p>
</li>
<li>
<p><code>XmlParser</code> returns <code>Node</code> objects when parsing XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When to use one or the another?</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a discussion at
<a href="http://stackoverflow.com/questions/7558019/groovy-xmlslurper-vs-xmlparser">StackOverflow</a>. The
conclusions written here are based partially on this entry.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>If you want to transform an existing document to another</strong> then
<code>XmlSlurper</code> will be the choice</p>
</li>
<li>
<p><strong>If you want to update and read at the same time</strong> then <code>XmlParser</code> is
the choice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rationale behind this is that every time you create a node with
<code>XmlSlurper</code> it won&#8217;t be available until you parse the document again
with another <code>XmlSlurper</code> instance.  Need to read just a few nodes
XmlSlurper is for you ".</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>If you just have to read a few nodes</strong> <code>XmlSlurper</code> should be your
choice, since it will not have to create a complete structure in
memory"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general both classes perform similar way. Even the way of using
GPath expressions with them are the same (both use <code>breadthFirst()</code> and
<code>depthFirst()</code> expressions). So I guess it depends on the write/read
frequency.</p>
</div>
</div>
<div class="sect4">
<h5 id="_domcategory"><a class="anchor" href="#_domcategory"></a><a class="link" href="#_domcategory">DOMCategory</a></h5>
<div class="paragraph">
<p>There is another way of parsing XML documents with Groovy with the
use of <code>groovy.xml.dom.DOMCategory</code> which is a category class which
adds GPath style operations to Java&#8217;s DOM classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java has in-built support for DOM processing of XML using classes
representing the various parts of XML documents, e.g. <code>Document</code>,
<code>Element</code>, <code>NodeList</code>, <code>Attr</code> etc. For more information about these classes,
refer to the respective JavaDocs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Having an XML like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">static def CAR_RECORDS = '''
&lt;records&gt;
  &lt;car name='HSV Maloo' make='Holden' year='2006'&gt;
    &lt;country&gt;Australia&lt;/country&gt;
    &lt;record type='speed'&gt;Production Pickup Truck with speed of 271kph&lt;/record&gt;
  &lt;/car&gt;
  &lt;car name='P50' make='Peel' year='1962'&gt;
    &lt;country&gt;Isle of Man&lt;/country&gt;
    &lt;record type='size'&gt;Smallest Street-Legal Car at 99cm wide and 59 kg in weight&lt;/record&gt;
  &lt;/car&gt;
  &lt;car name='Royale' make='Bugatti' year='1931'&gt;
    &lt;country&gt;France&lt;/country&gt;
    &lt;record type='price'&gt;Most Valuable Car at $15 million&lt;/record&gt;
  &lt;/car&gt;
&lt;/records&gt;
'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can parse it using <code>groovy.xml.DOMBuilder</code> and
<code>groovy.xml.dom.DOMCategory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def reader = new StringReader(CAR_RECORDS)
def doc = DOMBuilder.parse(reader) <i class="conum" data-value="1"></i><b>(1)</b>
def records = doc.documentElement

use(DOMCategory) { <i class="conum" data-value="2"></i><b>(2)</b>
    assert records.car.size() == 3
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating <code>DOMCategory</code> scope to be able to use helper method calls</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gpath"><a class="anchor" href="#_gpath"></a><a class="link" href="#_gpath">3.11.2. GPath</a></h4>
<div class="paragraph">
<p>The most common way of querying XML in Groovy is using <code>GPath</code>:</p>
</div>
<div class="paragraph">
<p><em>GPath is a path expression language integrated into Groovy which
allows parts of nested structured data to be identified. In this
sense, it has similar aims and scope as XPath does for XML. The two
main places where you use GPath expressions is when dealing with
nested POJOs or when dealing with XML</em></p>
</div>
<div class="paragraph">
<p>It is similar to <a href="https://en.wikipedia.org/wiki/XPath">XPath</a>
expressions and you can use it not only with XML but also with POJO
classes. As an example, you can specify a path to an object or element
of interest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a.b.c</code> &#8594; for XML, yields all the <code>&lt;c&gt;</code> elements inside <code>&lt;b&gt;</code> inside <code>&lt;a&gt;</code></p>
</li>
<li>
<p><code>a.b.c</code> &#8594; all POJOs, yields the <code>&lt;c&gt;</code> properties for all the <code>&lt;b&gt;</code>
properties of <code>&lt;a&gt;</code> (sort of like a.getB().getC() in JavaBeans)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For XML, you can also specify attributes, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a["@href"]</code> &#8594; the href attribute of all the a elements</p>
</li>
<li>
<p><code>a.'@href'</code> &#8594; an alternative way of expressing this</p>
</li>
<li>
<p><code>a.@href</code> &#8594; an alternative way of expressing this when using XmlSlurper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate this with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">static final String books = '''
    &lt;response version-api="2.0"&gt;
        &lt;value&gt;
            &lt;books&gt;
                &lt;book available="20" id="1"&gt;
                    &lt;title&gt;Don Quixote&lt;/title&gt;
                    &lt;author id="1"&gt;Miguel de Cervantes&lt;/author&gt;
                &lt;/book&gt;
                &lt;book available="14" id="2"&gt;
                    &lt;title&gt;Catcher in the Rye&lt;/title&gt;
                   &lt;author id="2"&gt;JD Salinger&lt;/author&gt;
               &lt;/book&gt;
               &lt;book available="13" id="3"&gt;
                   &lt;title&gt;Alice in Wonderland&lt;/title&gt;
                   &lt;author id="3"&gt;Lewis Carroll&lt;/author&gt;
               &lt;/book&gt;
               &lt;book available="5" id="4"&gt;
                   &lt;title&gt;Don Quixote&lt;/title&gt;
                   &lt;author id="4"&gt;Miguel de Cervantes&lt;/author&gt;
               &lt;/book&gt;
           &lt;/books&gt;
       &lt;/value&gt;
    &lt;/response&gt;
'''</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_simply_traversing_the_tree"><a class="anchor" href="#_simply_traversing_the_tree"></a><a class="link" href="#_simply_traversing_the_tree">Simply traversing the tree</a></h5>
<div class="paragraph">
<p>First thing we could do is to get a value using POJO&#8217;s notation. Let&#8217;s
get the first book&#8217;s author&#8217;s name</p>
</div>
<div class="listingblock">
<div class="title">Getting node value</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)
def authorResult = response.value.books.book[0].author

assert authorResult.text() == 'Miguel de Cervantes'</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we parse the document with <code>XmlSlurper</code> and then we have to
consider the returning value as the root of the XML document, so in
this case is "response".</p>
</div>
<div class="paragraph">
<p>That&#8217;s why we start traversing the document from response and then
<code>value.books.book[0].author</code>. Note that in <code>XPath</code> the node arrays starts
in [1] instead of [0], but because <code>GPath</code> is Java-based it begins at
index 0.</p>
</div>
<div class="paragraph">
<p>In the end we&#8217;ll have the instance of the <code>author</code> node and because we
wanted the text inside that node we should be calling the <code>text()</code>
method.  The <code>author</code> node is an instance of <code>GPathResult</code> type and
<code>text()</code> a method giving us the content of that node as a String.</p>
</div>
<div class="paragraph">
<p>When using <code>GPath</code> with an XML parsed with <code>XmlSlurper</code> we&#8217;ll have as a
result a <code>GPathResult</code> object. <code>GPathResult</code> has many other convenient
methods to convert the text inside a node to any other type such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>toInteger()</code></p>
</li>
<li>
<p><code>toFloat()</code></p>
</li>
<li>
<p><code>toBigInteger()</code></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these methods try to convert a <code>String</code> to the appropriate type.</p>
</div>
<div class="paragraph">
<p>If we were using an XML parsed with <code>XmlParser</code> we could be dealing with
instances of type <code>Node</code>. But still all the actions applied to
<code>GPathResult</code> in these examples could be applied to a Node as
well. Creators of both parsers took into account <code>GPath</code> compatibility.</p>
</div>
<div class="paragraph">
<p>Next step is to get some values from a given node&#8217;s attribute. In the following sample
we want to get the first book&#8217;s author&#8217;s id. We&#8217;ll be using two different approaches. Let&#8217;s see the code first:</p>
</div>
<div class="listingblock">
<div class="title">Getting an attribute&#8217;s value</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

def book = response.value.books.book[0] <i class="conum" data-value="1"></i><b>(1)</b>
def bookAuthorId1 = book.@id <i class="conum" data-value="2"></i><b>(2)</b>
def bookAuthorId2 = book['@id'] <i class="conum" data-value="3"></i><b>(3)</b>

assert bookAuthorId1 == '1' <i class="conum" data-value="4"></i><b>(4)</b>
assert bookAuthorId1.toInteger() == 1 <i class="conum" data-value="5"></i><b>(5)</b>
assert bookAuthorId1 == bookAuthorId2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Getting the first book node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Getting the book&#8217;s id attribute <code>@id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Getting the book&#8217;s id attribute with <code>map notation</code> <code>['@id']</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Getting the value as a String</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Getting the value of the attribute as an <code>Integer</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see there are two types of notations to get attributes,
the</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>direct notation</em> with <code>@nameoftheattribute</code></p>
</li>
<li>
<p><em>map notation</em> using <code>['@nameoftheattribute']</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of them are equally valid.</p>
</div>
</div>
<div class="sect4">
<h5 id="_flexible_navigation_with_children_depthfirst_and_breadthfirst"><a class="anchor" href="#_flexible_navigation_with_children_depthfirst_and_breadthfirst"></a><a class="link" href="#_flexible_navigation_with_children_depthfirst_and_breadthfirst">Flexible navigation with children (*), depthFirst (**) and breadthFirst</a></h5>
<div class="paragraph">
<p>If you ever have used XPath, you may have used expressions like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/following-sibling::othernode</code> : Look for a node "othernode" in the same level</p>
</li>
<li>
<p><code>//</code> : Look everywhere</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More or less we have their counterparts in GPath with the shortcuts <code>*</code> (aka <code>children()</code>) and <code>**</code> (aka <code>depthFirst()</code>).</p>
</div>
<div class="paragraph">
<p>The first example shows a simple use of <code>*</code>, which only iterates over the direct children of the node.</p>
</div>
<div class="listingblock">
<div class="title">Using *</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

// .'*' could be replaced by .children()
def catcherInTheRye = response.value.books.'*'.find { node -&gt;
    // node.@id == 2 could be expressed as node['@id'] == 2
    node.name() == 'book' &amp;&amp; node.@id == '2'
}

assert catcherInTheRye.title.text() == 'Catcher in the Rye'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test searches for any child nodes of the "books" node matching the given
condition. In a bit more detail, the expression says: <em>Look for any node with
a tag name equal to 'book' having an id with a value of '2' directly under
the 'books' node</em>.</p>
</div>
<div class="paragraph">
<p>This operation roughly corresponds to the <code>breadthFirst()</code> method, except that
it only stops at <strong>one level</strong> instead of continuing to the inner levels.</p>
</div>
<div class="paragraph">
<p>What if we would like to look for a given value
without having to know exactly where it is. Let&#8217;s say that the
only thing we know is the id of the author "Lewis Carroll" . How are
we going to be able to find that book? Using <code>**</code> is the solution:</p>
</div>
<div class="listingblock">
<div class="title">Using **</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

// .'**' could be replaced by .depthFirst()
def bookId = response.'**'.find { book -&gt;
    book.author.text() == 'Lewis Carroll'
}.@id

assert bookId == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>**</code> is the same as looking for something <em>everywhere in the
tree from this point down</em>. In this case, we&#8217;ve used the method
<code>find(Closure cl)</code> to find just the first occurrence.</p>
</div>
<div class="paragraph">
<p>What if we want to collect all book&#8217;s titles? That&#8217;s easy, just use <code>findAll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

def titles = response.'**'.findAll { node -&gt; node.name() == 'title' }*.text()

assert titles.size() == 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last two examples, <code>**</code> is used as a shortcut for the <code>depthFirst()</code>
method. It goes as far down the tree as it can while navigating down the
tree from a given node. The <code>breadthFirst()</code> method finishes off all nodes
on a given level before traversing down to the next level.</p>
</div>
<div class="paragraph">
<p>The following example shows the difference between these two methods:</p>
</div>
<div class="listingblock">
<div class="title">depthFirst() vs .breadthFirst</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)
def nodeName = { node -&gt; node.name() }
def withId2or3 = { node -&gt; node.@id in [2, 3] }

assert ['book', 'author', 'book', 'author'] ==
        response.value.books.depthFirst().findAll(withId2or3).collect(nodeName)
assert ['book', 'book', 'author', 'author'] ==
        response.value.books.breadthFirst().findAll(withId2or3).collect(nodeName)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we search for any nodes with an id attribute with value 2 or 3.
There are both <code>book</code> and <code>author</code> nodes that match that criteria. The different
traversal orders will find the same nodes in each case but in different orders
corresponding to how the tree was traversed.</p>
</div>
<div class="paragraph">
<p>It is worth mentioning again that there are some useful methods
converting a node&#8217;s value to an integer, float, etc. Those methods
could be convenient when doing comparisons like this:</p>
</div>
<div class="listingblock">
<div class="title">helpers</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

def titles = response.value.books.book.findAll { book -&gt;
    /* You can use toInteger() over the GPathResult object */
    book.@id.toInteger() &gt; 2
}*.title

assert titles.size() == 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the number 2 has been hardcoded but imagine that value
could have come from any other source (database&#8230;&#8203; etc.).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_xml"><a class="anchor" href="#_creating_xml"></a><a class="link" href="#_creating_xml">3.11.3. Creating XML</a></h4>
<div class="paragraph">
<p>The most commonly used approach for creating XML with Groovy is to use
a builder, i.e. one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groovy.xml.MarkupBuilder</code></p>
</li>
<li>
<p><code>groovy.xml.StreamingMarkupBuilder</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_markupbuilder"><a class="anchor" href="#_markupbuilder"></a><a class="link" href="#_markupbuilder">MarkupBuilder</a></h5>
<div class="paragraph">
<p>Here is an example of using Groovy&#8217;s MarkupBuilder to create a new XML file:</p>
</div>
<div class="listingblock">
<div class="title">Creating Xml with MarkupBuilder</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def writer = new StringWriter()
def xml = new MarkupBuilder(writer) <i class="conum" data-value="1"></i><b>(1)</b>

xml.records() { <i class="conum" data-value="2"></i><b>(2)</b>
    car(name: 'HSV Maloo', make: 'Holden', year: 2006) {
        country('Australia')
        record(type: 'speed', 'Production Pickup Truck with speed of 271kph')
    }
    car(name: 'Royale', make: 'Bugatti', year: 1931) {
        country('France')
        record(type: 'price', 'Most Valuable Car at $15 million')
    }
}

def records = new XmlSlurper().parseText(writer.toString()) <i class="conum" data-value="3"></i><b>(3)</b>

assert records.car.first().name.text() == 'HSV Maloo'
assert records.car.last().name.text() == 'Royale'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>MarkupBuilder</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start creating the XML tree</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>XmlSlurper</code> to traverse and test the
generated XML</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look a little bit closer:</p>
</div>
<div class="listingblock">
<div class="title">Creating XML elements</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlString = "&lt;movie&gt;the godfather&lt;/movie&gt;" <i class="conum" data-value="1"></i><b>(1)</b>

def xmlWriter = new StringWriter() <i class="conum" data-value="2"></i><b>(2)</b>
def xmlMarkup = new MarkupBuilder(xmlWriter)

xmlMarkup.movie("the godfather") <i class="conum" data-value="3"></i><b>(3)</b>

assert xmlString == xmlWriter.toString() <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We&#8217;re creating a reference string to compare against</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>xmlWriter</code> instance is used by <code>MarkupBuilder</code> to convert the
xml representation to a String instance eventually</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>xmlMarkup.movie(&#8230;&#8203;)</code> call will create an XML node with a tag
called <code>movie</code> and with content <code>the godfather</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creating XML elements with attributes</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlString = "&lt;movie id='2'&gt;the godfather&lt;/movie&gt;"

def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter)

xmlMarkup.movie(id: "2", "the godfather") <i class="conum" data-value="1"></i><b>(1)</b>

assert xmlString == xmlWriter.toString()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time in order to create both attributes and node content you
can create as many map entries as you like and finally add a value
to set the node&#8217;s content</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The value could be any <code>Object</code>, the value will be serialized to its
<code>String</code> representation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creating XML nested elements</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter)

xmlMarkup.movie(id: 2) { <i class="conum" data-value="1"></i><b>(1)</b>
    name("the godfather")
}

def movie = new XmlSlurper().parseText(xmlWriter.toString())

assert movie.@id == 2
assert movie.name.text() == 'the godfather'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure represents the children elements of a given node. Notice
this time instead of using a String for the attribute we&#8217;re using a
number.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may want to use a specific namespace in your xml documents:</p>
</div>
<div class="listingblock">
<div class="title">Namespace aware</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter)

xmlMarkup
        .'x:movies'('xmlns:x': 'http://www.groovy-lang.org') { <i class="conum" data-value="1"></i><b>(1)</b>
    'x:movie'(id: 1, 'the godfather')
    'x:movie'(id: 2, 'ronin')
}

def movies =
        new XmlSlurper() <i class="conum" data-value="2"></i><b>(2)</b>
                .parseText(xmlWriter.toString())
                .declareNamespace(x: 'http://www.groovy-lang.org')

assert movies.'x:movie'.last().@id == 2
assert movies.'x:movie'.last().text() == 'ronin'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating a node with a given namespace <code>xmlns:x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating a <code>XmlSlurper</code> registering the namespace to be able to
test the XML we just created</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What about having some more meaningful example. We may want to
generate more elements, to have some logic when creating our XML:</p>
</div>
<div class="listingblock">
<div class="title">Mix code</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter)

xmlMarkup
        .'x:movies'('xmlns:x': 'http://www.groovy-lang.org') {
    (1..3).each { n -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        'x:movie'(id: n, "the godfather $n")
        if (n % 2 == 0) { <i class="conum" data-value="2"></i><b>(2)</b>
            'x:movie'(id: n, "the godfather $n (Extended)")
        }
    }
}

def movies =
        new XmlSlurper()
                .parseText(xmlWriter.toString())
                .declareNamespace(x: 'http://www.groovy-lang.org')

assert movies.'x:movie'.size() == 4
assert movies.'x:movie'*.text().every { name -&gt; name.startsWith('the') }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generating elements from a range</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using a conditional for creating a given element</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course the instance of a builder can be passed as a parameter to
refactor/modularize your code:</p>
</div>
<div class="listingblock">
<div class="title">Mix code</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter)

<i class="conum" data-value="1"></i><b>(1)</b>
Closure&lt;MarkupBuilder&gt; buildMovieList = { MarkupBuilder builder -&gt;
    (1..3).each { n -&gt;
        builder.'x:movie'(id: n, "the godfather $n")
        if (n % 2 == 0) {
            builder.'x:movie'(id: n, "the godfather $n (Extended)")
        }
    }

    return builder
}

xmlMarkup.'x:movies'('xmlns:x': 'http://www.groovy-lang.org') {
    buildMovieList(xmlMarkup) <i class="conum" data-value="2"></i><b>(2)</b>
}

def movies =
        new XmlSlurper()
                .parseText(xmlWriter.toString())
                .declareNamespace(x: 'http://www.groovy-lang.org')

assert movies.'x:movie'.size() == 4
assert movies.'x:movie'*.text().every { name -&gt; name.startsWith('the') }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case we&#8217;ve created a Closure to handle the creation of a list of movies</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Just using the <code>buildMovieList</code> function when necessary</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_streamingmarkupbuilder"><a class="anchor" href="#_streamingmarkupbuilder"></a><a class="link" href="#_streamingmarkupbuilder">StreamingMarkupBuilder</a></h5>
<div class="paragraph">
<p>The class <code>groovy.xml.StreamingMarkupBuilder</code> is a builder class for
creating XML markup. This implementation uses a
<code>groovy.xml.streamingmarkupsupport.StreamingMarkupWriter</code> to handle
output.</p>
</div>
<div class="listingblock">
<div class="title">Using StreamingMarkupBuilder</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xml = new StreamingMarkupBuilder().bind { <i class="conum" data-value="1"></i><b>(1)</b>
    records {
        car(name: 'HSV Maloo', make: 'Holden', year: 2006) { <i class="conum" data-value="2"></i><b>(2)</b>
            country('Australia')
            record(type: 'speed', 'Production Pickup Truck with speed of 271kph')
        }
        car(name: 'P50', make: 'Peel', year: 1962) {
            country('Isle of Man')
            record(type: 'size', 'Smallest Street-Legal Car at 99cm wide and 59 kg in weight')
        }
        car(name: 'Royale', make: 'Bugatti', year: 1931) {
            country('France')
            record(type: 'price', 'Most Valuable Car at $15 million')
        }
    }
}

def records = new XmlSlurper().parseText(xml.toString()) <i class="conum" data-value="3"></i><b>(3)</b>

assert records.car.size() == 3
assert records.car.find { it.@name == 'P50' }.country.text() == 'Isle of Man'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that <code>StreamingMarkupBuilder.bind</code> returns a <code>Writable</code>
instance that may be used to stream the markup to a Writer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;re capturing the output in a String to parse it again and check
the structure of the generated XML with <code>XmlSlurper</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_markupbuilderhelper"><a class="anchor" href="#_markupbuilderhelper"></a><a class="link" href="#_markupbuilderhelper">MarkupBuilderHelper</a></h5>
<div class="paragraph">
<p>The <code>groovy.xml.MarkupBuilderHelper</code> is, as its name reflects, a
helper for <code>groovy.xml.MarkupBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This helper normally can be accessed from within an instance of class
<code>groovy.xml.MarkupBuilder</code> or an instance of
<code>groovy.xml.StreamingMarkupBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This helper could be handy in situations when you may want to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Produce a comment in the output</p>
</li>
<li>
<p>Produce an XML processing instruction in the output</p>
</li>
<li>
<p>Produce an XML declaration in the output</p>
</li>
<li>
<p>Print data in the body of the current tag, escaping XML entities</p>
</li>
<li>
<p>Print data in the body of the current tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both <code>MarkupBuilder</code> and <code>StreamingMarkupBuilder</code> this helper is
accessed by the property <code>mkp</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using MarkupBuilder&#8217;s 'mkp'</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xmlWriter = new StringWriter()
def xmlMarkup = new MarkupBuilder(xmlWriter).rules {
    mkp.comment('THIS IS THE MAIN RULE') <i class="conum" data-value="1"></i><b>(1)</b>
    rule(sentence: mkp.yield('3 &gt; n')) <i class="conum" data-value="2"></i><b>(2)</b>
}

<i class="conum" data-value="3"></i><b>(3)</b>
assert xmlWriter.toString().contains('3 &amp;gt; n')
assert xmlWriter.toString().contains('&lt;!-- THIS IS THE MAIN RULE --&gt;')</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>mkp</code> to create a comment in the XML</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>mkp</code> to generate an escaped value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Checking both assumptions were true</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is another example to show the use of <code>mkp</code> property accessible
from within the <code>bind</code> method scope when using
<code>StreamingMarkupBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using StreamingMarkupBuilder&#8217;s 'mkp'</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xml = new StreamingMarkupBuilder().bind {
    records {
        car(name: mkp.yield('3 &lt; 5')) <i class="conum" data-value="1"></i><b>(1)</b>
        car(name: mkp.yieldUnescaped('1 &lt; 3')) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

assert xml.toString().contains('3 &amp;lt; 5')
assert xml.toString().contains('1 &lt; 3')</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If we want to generate an escaped value for the name attribute with
<code>mkp.yield</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking the values later on with <code>XmlSlurper</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_domtogroovy"><a class="anchor" href="#_domtogroovy"></a><a class="link" href="#_domtogroovy">DOMToGroovy</a></h5>
<div class="paragraph">
<p>Suppose we have an existing XML document and we want to automate
generation of the markup without having to type it all in? We just
need to use <code>org.codehaus.groovy.tools.xml.DOMToGroovy</code> as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="title">Building MarkupBuilder from DOMToGroovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def songs = """
    &lt;songs&gt;
      &lt;song&gt;
        &lt;title&gt;Here I go&lt;/title&gt;
        &lt;band&gt;Whitesnake&lt;/band&gt;
      &lt;/song&gt;
    &lt;/songs&gt;
"""

def builder =
        javax.xml.parsers.DocumentBuilderFactory.newInstance().newDocumentBuilder()

def inputStream = new ByteArrayInputStream(songs.bytes)
def document = builder.parse(inputStream)
def output = new StringWriter()
def converter = new DomToGroovy(new PrintWriter(output)) <i class="conum" data-value="1"></i><b>(1)</b>

converter.print(document) <i class="conum" data-value="2"></i><b>(2)</b>

String xmlRecovered =
        new GroovyShell()
                .evaluate("""
           def writer = new StringWriter()
           def builder = new groovy.xml.MarkupBuilder(writer)
           builder.${output}

           return writer.toString()
        """) <i class="conum" data-value="3"></i><b>(3)</b>

assert new XmlSlurper().parseText(xmlRecovered).song.title.text() == 'Here I go' <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating <code>DOMToGroovy</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Converts the XML to <code>MarkupBuilder</code> calls which are available in the output <code>StringWriter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using <code>output</code> variable to create the whole MarkupBuilder</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Back to XML string</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manipulating_xml"><a class="anchor" href="#_manipulating_xml"></a><a class="link" href="#_manipulating_xml">3.11.4. Manipulating XML</a></h4>
<div class="paragraph">
<p>In this chapter you&#8217;ll see the different ways of adding / modifying /
removing nodes using <code>XmlSlurper</code> or <code>XmlParser</code>. The xml we are going
to be handling is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def xml = """
&lt;response version-api="2.0"&gt;
    &lt;value&gt;
        &lt;books&gt;
            &lt;book id="2"&gt;
                &lt;title&gt;Don Quixote&lt;/title&gt;
                &lt;author id="1"&gt;Miguel de Cervantes&lt;/author&gt;
            &lt;/book&gt;
        &lt;/books&gt;
    &lt;/value&gt;
&lt;/response&gt;
"""</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_adding_nodes"><a class="anchor" href="#_adding_nodes"></a><a class="link" href="#_adding_nodes">Adding nodes</a></h5>
<div class="paragraph">
<p>The main difference between <code>XmlSlurper</code> and <code>XmlParser</code> is that when
former creates the nodes they won&#8217;t be available until the document&#8217;s
been evaluated again, so you should parse the transformed document
again in order to be able to see the new nodes. So keep that in mind
when choosing any of both approaches.</p>
</div>
<div class="paragraph">
<p>If you needed to see a node right after creating it then <code>XmlParser</code>
should be your choice, but if you&#8217;re planning to do many changes to
the XML and send the result to another process maybe <code>XmlSlurper</code> would
be more efficient.</p>
</div>
<div class="paragraph">
<p>You can&#8217;t create a new node directly using the <code>XmlSlurper</code> instance,
but you can with <code>XmlParser</code>. The way of creating a new node from
XmlParser is through its method <code>createNode(..)</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def parser = new XmlParser()
def response = parser.parseText(xml)
def numberOfResults = parser.createNode(
        response,
        new QName("numberOfResults"),
        [:]
)

numberOfResults.value = "1"
assert response.numberOfResults.text() == "1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createNode()</code> method receives the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>parent node (could be null)</p>
</li>
<li>
<p>The qualified name for the tag (In this case we only use the local
part without any namespace). We&#8217;re using an instance of
<code>groovy.namespace.QName</code></p>
</li>
<li>
<p>A map with the tag&#8217;s attributes (None in this particular case)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Anyway you won&#8217;t normally be creating a node from the parser instance
but from the parsed XML instance. That is from a <code>Node</code> or a
<code>GPathResult</code> instance.</p>
</div>
<div class="paragraph">
<p>Take a look at the next example. We are parsing the xml with <code>XmlParser</code>
and then creating a new node from the parsed document&#8217;s instance
(Notice the method here is slightly different in the way it receives
the parameters):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def parser = new XmlParser()
def response = parser.parseText(xml)

response.appendNode(
        new QName("numberOfResults"),
        [:],
        "1"
)

response.numberOfResults.text() == "1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>XmlSlurper</code>, <code>GPathResult</code> instances don&#8217;t have <code>createNode()</code>
method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_removing_nodes"><a class="anchor" href="#_modifying_removing_nodes"></a><a class="link" href="#_modifying_removing_nodes">Modifying / Removing nodes</a></h5>
<div class="paragraph">
<p>We know how to parse the document, add new nodes, now I want to change
a given node&#8217;s content. Let&#8217;s start using <code>XmlParser</code> and <code>Node</code>. This
example changes the first book information to actually another book.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlParser().parseText(xml)

/* Use the same syntax as groovy.xml.MarkupBuilder */
response.value.books.book[0].replaceNode { <i class="conum" data-value="1"></i><b>(1)</b>
    book(id: "3") {
        title("To Kill a Mockingbird")
        author(id: "3", "Harper Lee")
    }
}

def newNode = response.value.books.book[0]

assert newNode.name() == "book"
assert newNode.@id == "3"
assert newNode.title.text() == "To Kill a Mockingbird"
assert newNode.author.text() == "Harper Lee"
assert newNode.author.@id.first() == "3"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>replaceNode()</code> the closure we pass as parameter should
follow the same rules as if we were using <code>groovy.xml.MarkupBuilder</code>:</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the same example using <code>XmlSlurper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)

/* Use the same syntax as groovy.xml.MarkupBuilder */
response.value.books.book[0].replaceNode {
    book(id: "3") {
        title("To Kill a Mockingbird")
        author(id: "3", "Harper Lee")
    }
}

assert response.value.books.book[0].title.text() == "Don Quixote"

/* That mkp is a special namespace used to escape away from the normal building mode
   of the builder and get access to helper markup methods
   'yield', 'pi', 'comment', 'out', 'namespaces', 'xmlDeclaration' and
   'yieldUnescaped' */
def result = new StreamingMarkupBuilder().bind { mkp.yield response }.toString()
def changedResponse = new XmlSlurper().parseText(result)

assert changedResponse.value.books.book[0].title.text() == "To Kill a Mockingbird"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how using <code>XmlSlurper</code> we have to parse the transformed document
again in order to find the created nodes. In this particular example
could be a little bit annoying isn&#8217;t it?</p>
</div>
<div class="paragraph">
<p>Finally both parsers also use the same approach for adding a new
attribute to a given attribute. This time again the difference is
whether you want the new nodes to be available right away or
not. First <code>XmlParser</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def parser = new XmlParser()
def response = parser.parseText(xml)

response.@numberOfResults = "1"

assert response.@numberOfResults == "1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>XmlSlurper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlSlurper().parseText(books)
response.@numberOfResults = "2"

assert response.@numberOfResults == "2"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>XmlSlurper</code>, adding a new attribute does <strong>not</strong> require you to perform a new evaluation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_printing_xml"><a class="anchor" href="#_printing_xml"></a><a class="link" href="#_printing_xml">Printing XML</a></h5>
<div class="sect5">
<h6 id="_xmlutil"><a class="anchor" href="#_xmlutil"></a><a class="link" href="#_xmlutil">XmlUtil</a></h6>
<div class="paragraph">
<p>Sometimes is useful to get not only the value of a given node but the
node itself (for instance to add this node to another XML).</p>
</div>
<div class="paragraph">
<p>For that you can use <code>groovy.xml.XmlUtil</code> class. It has several static
methods to serialize the xml fragment from several type of sources
(Node, GPathResult, String&#8230;&#8203;)</p>
</div>
<div class="listingblock">
<div class="title">Getting a node as a string</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def response = new XmlParser().parseText(xml)
def nodeToSerialize = response.'**'.find { it.name() == 'author' }
def nodeAsText = XmlUtil.serialize(nodeToSerialize)

assert nodeAsText ==
        XmlUtil.serialize('&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;author id="1"&gt;Miguel de Cervantes&lt;/author&gt;')</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_yaml"><a class="anchor" href="#_processing_yaml"></a><a class="link" href="#_processing_yaml">3.12. Processing YAML</a></h3>
<div class="paragraph">
<p>Groovy has an optional <code>groovy-yaml</code> module which provides support for converting between Groovy objects and YAML. The classes dedicated to
YAML serialisation and parsing are found in the <code>groovy.yaml</code> package.</p>
</div>
<div class="sect3">
<h4 id="yaml_yamlslurper"><a class="anchor" href="#yaml_yamlslurper"></a><a class="link" href="#yaml_yamlslurper">3.12.1. YamlSlurper</a></h4>
<div class="paragraph">
<p><code>YamlSlurper</code> is a class that parses YAML text or reader content into Groovy data structures (objects) such as maps, lists and
primitive types like <code>Integer</code>, <code>Double</code>, <code>Boolean</code> and <code>String</code>.</p>
</div>
<div class="paragraph">
<p>The class comes with a bunch of overloaded <code>parse</code> methods plus some special methods such as <code>parseText</code>
and others. For the next example we will use the <code>parseText</code> method. It parses a YAML <code>String</code> and recursively converts it to a
list or map of objects. The other <code>parse*</code> methods are similar in that they return a YAML <code>String</code> but for different parameter
types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">        def ys = new YamlSlurper()
        def yaml = ys.parseText '''
language: groovy
sudo: required
dist: trusty

matrix:
  include:
    - jdk: openjdk10
    - jdk: oraclejdk9
    - jdk: oraclejdk8

before_script:
  - |
    unset _JAVA_OPTIONS

        '''

        assert 'groovy' == yaml.language
        assert 'required' == yaml.sudo
        assert 'trusty' == yaml.dist
        assert ['openjdk10', 'oraclejdk9', 'oraclejdk8'] ==  yaml.matrix.include.jdk
        assert ['unset _JAVA_OPTIONS'] == yaml.before_script*.trim()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the result is a plain map and can be handled like a normal Groovy object instance. <code>YamlSlurper</code> parses the
given YAML as defined by the <a href="http://yaml.org/spec/1.2/spec.html">YAML Ain’t Markup Language (YAML™)</a>.</p>
</div>
<div class="paragraph">
<p>As <code>YamlSlurper</code> is returning pure Groovy object instances without any special YAML classes in the back, its usage
is transparent. In fact, <code>YamlSlurper</code> results conform to GPath expressions. GPath is a powerful expression language
that is supported by multiple slurpers for different data formats (<code>XmlSlurper</code> for XML being one example).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details please have a look at the section on <a href="#gpath_expressions">GPath expressions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table gives an overview of the YAML types and the corresponding Groovy data types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">YAML</th>
<th class="tableblock halign-left valign-top">Groovy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.BigDecimal</code> or <code>java.lang.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.ArrayList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code> based on the <code>yyyy-MM-dd&#8217;T&#8217;HH:mm:ssZ</code> date format</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever a value in YAML is <code>null</code>, <code>YamlSlurper</code> supplements it with the Groovy <code>null</code> value. This is in contrast to other
YAML parsers that represent a <code>null</code> value with a library-provided singleton object.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_builders_2"><a class="anchor" href="#_builders_2"></a><a class="link" href="#_builders_2">Builders</a></h5>
<div class="paragraph">
<p>Another way to create YAML from Groovy is to use <code>YamlBuilder</code>. The builder provide a
DSL which allows to formulate an object graph which is then converted to YAML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">        def builder = new YamlBuilder()
        builder.records {
            car {
                name 'HSV Maloo'
                make 'Holden'
                year 2006
                country 'Australia'
                homepage new URL('http://example.org')
                record {
                    type 'speed'
                    description 'production pickup truck with speed of 271kph'
                }
            }
        }

        assert builder.toString() == '''---
records:
  car:
    name: "HSV Maloo"
    make: "Holden"
    year: 2006
    country: "Australia"
    homepage: "http://example.org"
    record:
      type: "speed"
      description: "production pickup truck with speed of 271kph"
'''</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_toml"><a class="anchor" href="#_processing_toml"></a><a class="link" href="#_processing_toml">3.13. Processing TOML</a></h3>
<div class="paragraph">
<p>Groovy has an optional <code>groovy-toml</code> module which provides support for converting between Groovy objects and TOML. The classes dedicated to
TOML serialisation and parsing are found in the <code>groovy.toml</code> package.</p>
</div>
<div class="sect3">
<h4 id="toml_tomlslurper"><a class="anchor" href="#toml_tomlslurper"></a><a class="link" href="#toml_tomlslurper">3.13.1. TomlSlurper</a></h4>
<div class="paragraph">
<p><code>TomlSlurper</code> is a class that parses TOML text or reader content into Groovy data structures (objects) such as maps, lists and
primitive types like <code>Integer</code>, <code>Double</code>, <code>Boolean</code> and <code>String</code>.</p>
</div>
<div class="paragraph">
<p>The class comes with a bunch of overloaded <code>parse</code> methods plus some special methods such as <code>parseText</code>
and others. For the next example we will use the <code>parseText</code> method. It parses a TOML <code>String</code> and recursively converts it to a
list or map of objects. The other <code>parse*</code> methods are similar in that they return a TOML <code>String</code> but for different parameter
types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">        def ts = new TomlSlurper()
        def toml = ts.parseText '''
language = "groovy"
sudo = "required"
dist = "trusty"
before_script = [ "unset _JAVA_OPTIONS\\n\\n    \\n" ]

[[matrix.include]]
jdk = "openjdk10"

[[matrix.include]]
jdk = "oraclejdk9"

[[matrix.include]]
jdk = "oraclejdk8"
'''

        assert 'groovy' == toml.language
        assert 'required' == toml.sudo
        assert 'trusty' == toml.dist
        assert ['openjdk10', 'oraclejdk9', 'oraclejdk8'] ==  toml.matrix.include.jdk
        assert ['unset _JAVA_OPTIONS'] == toml.before_script*.trim()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the result is a plain map and can be handled like a normal Groovy object instance. <code>TomlSlurper</code> parses the
given TOML as defined by the <a href="https://toml.io/en/v1.0.0-rc.3">Tom&#8217;s Obvious, Minimal Language</a>.</p>
</div>
<div class="paragraph">
<p>As <code>TomlSlurper</code> is returning pure Groovy object instances without any special TOML classes in the back, its usage
is transparent. In fact, <code>TomlSlurper</code> results conform to GPath expressions. GPath is a powerful expression language
that is supported by multiple slurpers for different data formats (<code>XmlSlurper</code> for XML being one example).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details please have a look at the section on <a href="#gpath_expressions">GPath expressions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table gives an overview of the TOML types and the corresponding Groovy data types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TOML</th>
<th class="tableblock halign-left valign-top">Groovy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.BigDecimal</code> or <code>java.lang.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.ArrayList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code> based on the <code>yyyy-MM-dd&#8217;T&#8217;HH:mm:ssZ</code> date format</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever a value in TOML is <code>null</code>, <code>TomlSlurper</code> supplements it with the Groovy <code>null</code> value. This is in contrast to other
TOML parsers that represent a <code>null</code> value with a library-provided singleton object.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_builders_3"><a class="anchor" href="#_builders_3"></a><a class="link" href="#_builders_3">Builders</a></h5>
<div class="paragraph">
<p>Another way to create TOML from Groovy is to use <code>TomlBuilder</code>. The builder provide a
DSL which allows to formulate an object graph which is then converted to TOML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">        def builder = new TomlBuilder()
        builder.records {
            car {
                name 'HSV Maloo'
                make 'Holden'
                year 2006
                country 'Australia'
                homepage new URL('http://example.org')
                record {
                    type 'speed'
                    description 'production pickup truck with speed of 271kph'
                }
            }
        }

        assert builder.toString() == '''\
records.car.name = 'HSV Maloo'
records.car.make = 'Holden'
records.car.year = 2006
records.car.country = 'Australia'
records.car.homepage = 'http://example.org'
records.car.record.type = 'speed'
records.car.record.description = 'production pickup truck with speed of 271kph'
'''</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_contracts_design_by_contract_support_for_groovy"><a class="anchor" href="#_groovy_contracts_design_by_contract_support_for_groovy"></a><a class="link" href="#_groovy_contracts_design_by_contract_support_for_groovy">3.14. Groovy Contracts – design by contract support for Groovy</a></h3>
<div class="paragraph">
<p>This module provides contract annotations that support the specification of class-invariants,
pre- and post-conditions on Groovy classes and interfaces.
Special support is provided so that post-conditions may refer to the old value of variables
or to the result value associated with calling a method.</p>
</div>
<div class="sect3">
<h4 id="_applying_invariant_requires_and_ensures"><a class="anchor" href="#_applying_invariant_requires_and_ensures"></a><a class="link" href="#_applying_invariant_requires_and_ensures">3.14.1. Applying @Invariant, @Requires and @Ensures</a></h4>
<div class="paragraph">
<p>With GContracts in your class-path, contracts can be applied on a Groovy class or interface by using one of the assertions found in package org.gcontracts.annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package acme

import groovy.contracts.*

@Invariant({ speed() &gt;= 0 })
class Rocket {
    int speed = 0
    boolean started = true

    @Requires({ isStarted() })
    @Ensures({ old.speed &lt; speed })
    def accelerate(inc) { speed += inc }

    def isStarted() { started }

    def speed() { speed }
}

def r = new Rocket()
r.accelerate(5)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_more_features"><a class="anchor" href="#_more_features"></a><a class="link" href="#_more_features">3.14.2. More Features</a></h4>
<div class="paragraph">
<p>GContracts supports the following feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>definition of class invariants, pre- and post-conditions via @Invariant, @Requires and @Ensures</p>
</li>
<li>
<p>inheritance of class invariants, pre- and post-conditions of concrete predecessor classes</p>
</li>
<li>
<p>inheritance of class invariants, pre- and post-conditions in implemented interfaces</p>
</li>
<li>
<p>usage of old and result variable in post-condition assertions</p>
</li>
<li>
<p>assertion injection in Plain Old Groovy Objects (POGOs)</p>
</li>
<li>
<p>human-readable assertion messages, based on Groovy power asserts</p>
</li>
<li>
<p>enabling contracts at package- or class-level with @AssertionsEnabled</p>
</li>
<li>
<p>enable or disable contract checking with Java&#8217;s -ea and -da VM parameters</p>
</li>
<li>
<p>annotation contracts: a way to reuse reappearing contract elements in a project domain model</p>
</li>
<li>
<p>detection of circular assertion method calls</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_the_stack_example"><a class="anchor" href="#_the_stack_example"></a><a class="link" href="#_the_stack_example">3.14.3. The Stack Example</a></h4>
<div class="paragraph">
<p>Currently, Groovy contracts supports 3 annotations: @Invariant, @Requires and @Ensures – all of them work
as annotations with closures, where closures allow you to specify arbitrary code pieces as annotation parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab(group='org.apache.groovy', module='groovy-contracts', version='4.0.0')
import groovy.contracts.*

@Invariant({ elements != null })
class Stack&lt;T&gt; {

    List&lt;T&gt; elements

    @Ensures({ is_empty() })
    def Stack()  {
        elements = []
    }

    @Requires({ preElements?.size() &gt; 0 })
    @Ensures({ !is_empty() })
    def Stack(List&lt;T&gt; preElements)  {
        elements = preElements
    }

    boolean is_empty()  {
        elements.isEmpty()
    }

    @Requires({ !is_empty() })
    T last_item()  {
        elements.get(count() - 1)
    }

    def count() {
        elements.size()
    }

    @Ensures({ result == true ? count() &gt; 0 : count() &gt;= 0  })
    boolean has(T item)  {
        elements.contains(item)
    }

    @Ensures({ last_item() == item })
    def push(T item)  {
       elements.add(item)
    }

    @Requires({ !is_empty() })
    @Ensures({ last_item() == item })
    def replace(T item)  {
        remove()
        elements.add(item)
    }

    @Requires({ !is_empty() })
    @Ensures({ result != null })
    T remove()  {
        elements.remove(count() - 1)
    }

    String toString() { elements.toString() }
}

def stack = new Stack&lt;Integer&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above specifies a class-invariant and methods with pre- and post-conditions.
Note, that preconditions may reference method arguments and post-conditions have access
to the method’s result with the result variable and old instance variables values with old.</p>
</div>
<div class="paragraph">
<p>Indeed, Groovy AST transformations change these assertion annotations into Java assertion
statements (can be turned on and off with a JVM param) and inject them at appropriate places,
e.g. class-invariants are used to check an object&#8217;s state before and after each method call.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scripting_ant_tasks"><a class="anchor" href="#_scripting_ant_tasks"></a><a class="link" href="#_scripting_ant_tasks">3.15. Scripting Ant tasks</a></h3>
<div class="paragraph">
<p>Groovy integrates very well with <a href="http://ant.apache.org">Apache Ant</a> thanks to <a href="#antbuilder">AntBuilder</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_groovy_ant_task"><a class="anchor" href="#_the_groovy_ant_task"></a><a class="link" href="#_the_groovy_ant_task">3.16. The &lt;groovy&gt; Ant Task</a></h3>
<div class="sect3">
<h4 id="groovy-ant-task-using"><a class="anchor" href="#groovy-ant-task-using"></a><a class="link" href="#groovy-ant-task-using">3.16.1. <code>&lt;groovy&gt;</code></a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here we describe an Ant task for using Groovy
from within an Ant build file.
You may also be interested in
Ant&#8217;s built-in <a href="https://ant.apache.org/manual/Tasks/script.html"><code>script</code></a> task
which supports Groovy and other languages, or
<a href="#antbuilder"><code>AntBuilder</code></a> which lets you write Ant build scripts
in Groovy rather than XML.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Executes a series of Groovy statements from <a href="https://ant.apache.org/">Apache Ant</a>.
Statements can either be read in from a resource or as direct text between the enclosing Groovy tags.</p>
</div>
</div>
<div class="sect3">
<h4 id="_required_taskdef"><a class="anchor" href="#_required_taskdef"></a><a class="link" href="#_required_taskdef">3.16.2. Required taskdef</a></h4>
<div class="paragraph">
<p>Assuming all the groovy jars you need are in <em>my.classpath</em> (this will be <code>groovy-VERSION.jar</code>,
<code>groovy-ant-VERSION.jar</code> plus any modules and transitive dependencies you might be using)
you will need to declare this task at some point in the <code>build.xml</code> prior to
the <code>groovy</code> task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;taskdef name="groovy"
         classname="org.codehaus.groovy.ant.Groovy"
         classpathref="my.classpath"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can simply place statements between the <code>groovy</code> tags like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
...
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can supply the Groovy source script as a resource. You can specify the pathname using the <code>src</code> attribute like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy src="/some/path/MyGroovyScript.groovy" otherAttributes="..."&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or as a nested <code>fileset</code> like this (though the fileset definition is expected to select just one file):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
    &lt;fileset file="MyGroovyScript.groovy"/&gt;
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or as a nested single element <a href="https://ant.apache.org/manual/Types/resources.html#collection">resource collection</a> which could look like any of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
    &lt;file file="MyGroovyScript.groovy"/&gt;
&lt;/groovy&gt;

&lt;groovy&gt;
    &lt;url url="https://some.domain/some/path/to/MyGroovyScript.groovy"/&gt;
&lt;/groovy&gt;

&lt;groovy&gt;
    &lt;javaconstant name="some.packagename.SomeClass.MY_CODE_FRAGMENT"/&gt;
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also supply a <a href="https://ant.apache.org/manual/Types/filterchain.html">filter chain</a> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
    &lt;fileset file="MyGroovyScript.groovy"/&gt;
    &lt;!-- take 5 lines after skipping 18 lines, just as an example --&gt;
    &lt;filterchain&gt;
        &lt;headfilter lines="5" skip="18"/&gt;
    &lt;/filterchain&gt;
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might need to use the <em>contextClassLoader</em> attribute (see below) if any of your modules load services via the classpath, e.g. <code>groovy-json</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovy_attributes"><a class="anchor" href="#_groovy_attributes"></a><a class="link" href="#_groovy_attributes">3.16.3. &lt;groovy&gt; attributes</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File containing Groovy statements. The directory containing the file is added to the classpath.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, unless statements enclosed within tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use, given as reference to a PATH defined elsewhere.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the output file; defaults to the Ant log.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled and output is to a file, append to existing file rather than overwrite. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled the script will be executed in a forked JVM process (disabled by default).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the base class for scripts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates metadata for reflection on method parameter names on JDK 8 and above. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useGroovyShell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled a new GroovyShell is used to run the script. Special variables won&#8217;t be available but you don&#8217;t need Ant in the classpath. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled the system classpath will be included on the classpath when forking. Defaults to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled a stacktrace will be reported if an error occurs during compilation. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the configuration script for the groovy compiler configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextClassLoader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, the contextClassLoader to be set with the classLoader of the shell used to run the script. Not used if fork is true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_specified_as_nested_elements"><a class="anchor" href="#_parameters_specified_as_nested_elements"></a><a class="link" href="#_parameters_specified_as_nested_elements">3.16.4. Parameters specified as nested elements</a></h4>
<div class="sect4">
<h5 id="_classpath"><a class="anchor" href="#_classpath"></a><a class="link" href="#_classpath">&lt;classpath&gt;</a></h5>
<div class="paragraph">
<p>Groovy&#8217;s classpath attribute is a PATH like structure and can also be set via a nested classpath element.</p>
</div>
</div>
<div class="sect4">
<h5 id="_arg"><a class="anchor" href="#_arg"></a><a class="link" href="#_arg">&lt;arg&gt;</a></h5>
<div class="paragraph">
<p>Arguments can be set via one or more nested &lt;arg&gt; elements using the standard Ant <a href="https://ant.apache.org/manual/using.html#arg">command line conventions</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_available_bindings"><a class="anchor" href="#_available_bindings"></a><a class="link" href="#_available_bindings">3.16.5. Available bindings</a></h4>
<div class="paragraph">
<p>A number of bindings are in scope for use within your Groovy statements.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an instance of <code>AntBuilder</code> that knows about the current ant project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the current ant project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a <code>Map</code> of ant properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the owning target that invoked this groovy script</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the wrapping task, can access anything needed in <code>org.apache.tools.ant.Task</code></p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">command line arguments, if any</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a><a class="link" href="#_examples_2">3.16.6. Examples</a></h4>
<div class="paragraph">
<p>Hello world, version 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
println "Hello World"
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hello world, version 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
ant.echo "Hello World"
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>List all xml files in the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
xmlfiles = new File(".").listFiles().findAll{ it =~ "\.xml$" }
xmlfiles.sort().each { println it.toString() }
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>List all xml files within a jar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;zipfileset id="found" src="foobar.jar"
            includes="**/*.xml"/&gt;
&lt;groovy&gt;
    project.references.found.each {
        println it.name
    }
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy src="/some/directory/some/file.groovy"&gt;
  &lt;classpath&gt;
    &lt;pathelement location="/my/groovy/classes/directory"/&gt;
  &lt;/classpath&gt;
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find all <code>Builder</code> classes having an <code>org.*</code> package within a directory of jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;property name="local.target" value="C:/Projects/GroovyExamples"/&gt;
&lt;groovy&gt;
import java.util.jar.JarFile
def classes = []
def resourceNamePattern = /org\/.*\/.*Builder.class/
def jarNamePattern = /.*(beta|commons).*jar$/

def libdir = new File("${properties['local.target']}/lib")
libdir.listFiles().grep(~jarNamePattern).each { candidate -&gt;
    new JarFile(candidate).entries().each { entry -&gt;
        if (entry.name ==~ resourceNamePattern) classes += entry.name
    }
}
properties["builder-classes"] = classes.join(' ')
&lt;/groovy&gt;
&lt;echo message='${builder-classes}'/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which might result in something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>org/apache/commons/cli/PatternOptionBuilder.class org/apache/commons/cli/OptionBuilder.class org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.class org/custommonkey/xmlunit/HTMLDocumentBuilder.class org/custommonkey/xmlunit/TolerantSaxDocumentBuilder.class</code></pre>
</div>
</div>
<div class="paragraph">
<p>FileScanner version of above (with a slight variation on collecting the names):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovy&gt;
import java.util.jar.JarFile
def resourceNamePattern = /org\/.*\/.*Builder.class/
def candidates = ant.fileScanner {
    fileset(dir: '${local.target}/lib') {
        include(name: '*beta*.jar')
        include(name: '*commons*.jar')
    }
}
def classes = candidates.collect {
    new JarFile(it).entries().collect { it.name }.findAll {
        it ==~ resourceNamePattern
    }
}.flatten()
properties["builder-classes"] = classes.join(' ')
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling out to a web service from your Ant script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="SOAP example" default="main" basedir="."&gt;
    &lt;property environment="env"/&gt;
    &lt;property name="celsius" value="0"/&gt;
    &lt;target name="main"&gt;
        &lt;taskdef name="groovy" classname="org.codehaus.groovy.ant.Groovy"&gt;
            &lt;classpath&gt;
                &lt;fileset dir="${env.GROOVY_HOME}" includes="lib/groovy-*.jar,lib/ivy*.jar"/&gt;
            &lt;/classpath&gt;
        &lt;/taskdef&gt;
        &lt;groovy&gt;
            @Grab('org.codehaus.groovy.modules:groovyws:0.5.1')
            import groovyx.net.ws.WSClient
            def url = 'http://www.w3schools.com/webservices/tempconvert.asmx?WSDL'
            def proxy = new WSClient(url, this.class.classLoader)
            proxy.initialize()
            ant.echo "I'm freezing at ${properties.celsius} degrees Celsius"
            properties.result = proxy.CelsiusToFahrenheit(properties.celsius)
        &lt;/groovy&gt;
        &lt;antcall target="results"/&gt;
    &lt;/target&gt;
    &lt;target name="results"&gt;
        &lt;echo message="I'm freezing at ${result} degrees Fahrenheit"/&gt;
    &lt;/target&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will output the following (along with some informational messages):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>main:
     ...
     [echo] I'm freezing at 0 degrees Celsius
results:
     [echo] I'm freezing at 32 degrees Fahrenheit

BUILD SUCCESSFUL</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;target name="run"&gt;
    &lt;groovy&gt;
        &lt;arg line="1 2 3"/&gt;
        &lt;arg value="4 5"/&gt;
        println args.size()
        println args[2]
        args.each{ ant.echo(message:it) }
    &lt;/groovy&gt;
&lt;/target&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Buildfile: build.xml

run:
   [groovy] 4
   [groovy] 3
     [echo] 1
     [echo] 2
     [echo] 3
     [echo] 4 5

BUILD SUCCESSFUL</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_groovyc_ant_task"><a class="anchor" href="#_the_groovyc_ant_task"></a><a class="link" href="#_the_groovyc_ant_task">3.17. The &lt;groovyc&gt; Ant Task</a></h3>
<div class="sect3">
<h4 id="groovyc-ant-task-using"><a class="anchor" href="#groovyc-ant-task-using"></a><a class="link" href="#groovyc-ant-task-using">3.17.1. <code>&lt;groovyc&gt;</code></a></h4>
<div class="sect4">
<h5 id="groovyc-ant-task-description"><a class="anchor" href="#groovyc-ant-task-description"></a><a class="link" href="#groovyc-ant-task-description">Description</a></h5>
<div class="paragraph">
<p>Compiles Groovy source files and, if joint compilation option is used, Java source files from <a href="http://ant.apache.org/">Apache Ant</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="groovyc-ant-task-taskdef"><a class="anchor" href="#groovyc-ant-task-taskdef"></a><a class="link" href="#groovyc-ant-task-taskdef">Required taskdef</a></h5>
<div class="paragraph">
<p>Assuming the groovy jars are in <em>groovy.libs</em>, you will need to declare this task
at some point in the <code>build.xml</code> prior to the <code>groovyc</code> task being invoked.
Consider also adding any additional Groovy module jars, libraries and potentially transitive dependencies you might be using.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;taskdef name="groovyc" classname="org.codehaus.groovy.ant.Groovyc"&gt;
  &lt;classpath&gt;
    &lt;fileset file="${groovy.libs}/groovy-ant-VERSION.jar"/&gt;
    &lt;fileset file="${groovy.libs}/groovy-VERSION.jar"/&gt;
  &lt;/classpath&gt;
&lt;/taskdef&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovyc-ant-task-attributes"><a class="anchor" href="#groovyc-ant-task-attributes"></a><a class="link" href="#groovyc-ant-task-attributes">&lt;groovyc&gt; Attributes</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Groovy (and possibly Java) source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use given as a path references.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use given as a path reference.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asks the compiler for verbose output; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Ant run-time libraries in the
classpath; defaults to yes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeJavaRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the default run-time libraries
from the executing VM in the classpath; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeDestClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property controls whether to include the destination
classes directory in the classpath given to the compiler. The default value is "true".</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to execute groovyc using a spawned instance of the JVM;
defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryInitialSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryMaximumSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failonerror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether compilation errors will fail the build;
defaults to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proceed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverse alias for <em>failonerror</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listfiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the source files to be compiled will be
listed; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if true each compile error message will contain a
stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable compilation with the ``invoke dynamic'' support when using
Groovy 2.0 and beyond and running on JDK 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the base class for Groovy scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the stub directory into which the Java source stub files should be generated.
The directory need not exist and will not be deleted automatically - though its contents
will be cleared unless 'keepStubs' is true. Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keepStubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the keepStubs flag. Defaults to false. Set to true for debugging.
Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forceLookupUnnamedFiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Groovyc Ant task is frequently used in the context of a build system
that knows the complete list of source files to be compiled. In such a
context, it is wasteful for the Groovy compiler to go searching the
classpath when looking for source files and hence by default the
Groovyc Ant task calls the compiler in a special mode with such searching
turned off. If you wish the compiler to search for source files then
you need to set this flag to true. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the configuration file used to customize the compilation configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates metadata for reflection on method parameter names on JDK 8 and above.
Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">previewFeatures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the JEP preview features on JDK 12 and above.
Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetBytecode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the bytecode compatibility level.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javahome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <code>java.home</code> value to use, default is the current JDK&#8217;s home.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the java executable to use when invoking the compiler in forked mode,
ignored otherwise.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptExtension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the extension to use when searching for Groovy source files.
Accepts extensions in the form *.groovy, .groovy or groovy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">updatedProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property to set on compilation success. This property will not be set if
the compilation fails, or if there are no files to compile.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property to set on compilation failure. This property will be set if
the compilation fails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;path id="classpath.main"&gt;
  &lt;fileset dir="${groovy.libs}" includes="*.jar" excludes="groovy-ant-*.jar"/&gt;
  ...
&lt;/path&gt;
&lt;groovyc srcdir="${dir.sources}" destdir="${dir.classes}" classpathref="classpath.main"
         fork="true" includeantruntime="false" configscript="config.groovy" targetBytecode="1.8"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovyc-ant-task-nested-elements"><a class="anchor" href="#groovyc-ant-task-nested-elements"></a><a class="link" href="#groovyc-ant-task-nested-elements">&lt;groovyc&gt; Nested Elements</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">element</th>
<th class="tableblock halign-left valign-top">kind</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Replaces Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (unless srcdir is used)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath or classpathref</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>For path structures see for example
<a href="https://ant.apache.org/manual/using.html#path" class="bare">https://ant.apache.org/manual/using.html#path</a></p>
</li>
<li>
<p>For usages of the <code>javac</code> task see
<a href="https://ant.apache.org/manual/Tasks/javac.html" class="bare">https://ant.apache.org/manual/Tasks/javac.html</a></p>
</li>
<li>
<p>The nested <code>javac</code> task behaves more or less as documented for the top-level
<code>javac</code> task. <code>srcdir</code>, <code>destdir</code>, <code>classpath</code>, <code>encoding</code> and <code>parameters</code>
for the nested <code>javac</code> task are taken from the enclosing <code>groovyc</code> task. If
these attributes are specified then they are added, they do not replace. In fact,
you should not attempt to overwrite the destination. Other attributes and nested
elements are unaffected, for example <code>fork</code>, <code>memoryMaximumSize</code>, etc. may be
used freely.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="groovyc-ant-task-joint-compilation"><a class="anchor" href="#groovyc-ant-task-joint-compilation"></a><a class="link" href="#groovyc-ant-task-joint-compilation">Joint Compilation</a></h5>
<div class="paragraph">
<p>Joint compilation is enabled by using an embedded <code>javac</code> element, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;groovyc srcdir="${testSourceDirectory}" destdir="${testClassesDirectory}" targetBytecode="1.8"&gt;
  &lt;classpath&gt;
    &lt;pathelement path="${mainClassesDirectory}"/&gt;
    &lt;pathelement path="${testClassesDirectory}"/&gt;
    &lt;path refid="testPath"/&gt;
  &lt;/classpath&gt;
  &lt;javac debug="true" source="1.8" target="1.8" /&gt;
&lt;/groovyc&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>More details about joint compilation can be found in the <a href="#section-jointcompilation">joint compilation</a> section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_template_engines"><a class="anchor" href="#_template_engines"></a><a class="link" href="#_template_engines">3.18. Template engines</a></h3>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a><a class="link" href="#_introduction_4">3.18.1. Introduction</a></h4>
<div class="paragraph">
<p>Groovy supports multiple ways to generate text dynamically including <code>GStrings</code>, <code>printf</code> and <a href="#_markupbuilder">MarkupBuilder</a> just to name a few.
In addition to these, there is a dedicated template framework which is well-suited to applications where the text to be generated follows the form of a static template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_template_framework"><a class="anchor" href="#_template_framework"></a><a class="link" href="#_template_framework">3.18.2. Template framework</a></h4>
<div class="paragraph">
<p>The template framework in Groovy consists of a <code>TemplateEngine</code> abstract base class that engines must implement
and a <code>Template</code> interface that the resulting templates they generate must implement.</p>
</div>
<div class="paragraph">
<p>Included with Groovy are several template engines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTemplateEngine</code> - for basic templates</p>
</li>
<li>
<p><code>StreamingTemplateEngine</code> - functionally equivalent to <code>SimpleTemplateEngine</code>, but can handle strings larger than 64k</p>
</li>
<li>
<p><code>GStringTemplateEngine</code> - stores the template as writeable closures (useful for streaming scenarios)</p>
</li>
<li>
<p><code>XmlTemplateEngine</code> - works well when the template and output are valid XML</p>
</li>
<li>
<p><code>MarkupTemplateEngine</code> - a very complete, optimized, template engine</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_simpletemplateengine"><a class="anchor" href="#_simpletemplateengine"></a><a class="link" href="#_simpletemplateengine">3.18.3. SimpleTemplateEngine</a></h4>
<div class="paragraph">
<p>Shown here is the <code>SimpleTemplateEngine</code> that allows you to use JSP-like scriptlets (see example below), script, and EL expressions
in your template in order to generate parametrized text. Here is an example of using the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = 'Dear "$firstname $lastname",\nSo nice to meet you in &lt;% print city %&gt;.\nSee you in ${month},\n${signed}'

def binding = ["firstname":"Sam", "lastname":"Pullara", "city":"San Francisco", "month":"December", "signed":"Groovy-Dev"]

def engine = new groovy.text.SimpleTemplateEngine()
def template = engine.createTemplate(text).make(binding)

def result = 'Dear "Sam Pullara",\nSo nice to meet you in San Francisco.\nSee you in December,\nGroovy-Dev'

assert result == template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>While it is generally not deemed good practice to mix processing logic in your template (or view), sometimes very simple logic can be useful.
E.g. in the example above, we could change this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">$firstname</code></pre>
</div>
</div>
<div class="paragraph">
<p>to this (assuming we have set up a static import for capitalize <strong>inside</strong> the template):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">${firstname.capitalize()}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">&lt;% print city %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">&lt;% print city == "New York" ? "The Big Apple" : city %&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_usage_note"><a class="anchor" href="#_advanced_usage_note"></a><a class="link" href="#_advanced_usage_note">Advanced Usage Note</a></h5>
<div class="paragraph">
<p>If you happen to be embedding your template directly in your script (as we did above) you have to be careful about backslash escaping.
Because the template string itself will be parsed by Groovy before it is passed to the templating framework, you have to
escape any backslashes inside GString expressions or scriptlet 'code' that are entered as part of a Groovy program.
E.g. if we wanted quotes around <em>The Big Apple</em> above, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">&lt;% print city == "New York" ? "\\"The Big Apple\\"" : city %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we wanted a newline, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">\\n</code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code' that appears inside a Groovy script. A normal &#8220;\n&#8221; is fine within
the static template text itself or if the entire template itself is in an external template file.
Similarly, to represent an actual backslash in your text you would need</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">\\\\</code></pre>
</div>
</div>
<div class="paragraph">
<p>in an external file or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">\\\\</code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code'. (Note: the necessity to have this extra slash may go away
in a future version of Groovy if we can find an easy way to support such a change.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_streamingtemplateengine"><a class="anchor" href="#_streamingtemplateengine"></a><a class="link" href="#_streamingtemplateengine">3.18.4. StreamingTemplateEngine</a></h4>
<div class="paragraph">
<p>The <code>StreamingTemplateEngine</code> engine is functionally equivalent to the <code>SimpleTemplateEngine</code>,
but creates the template using writable closures making it more scalable for large templates.
Specifically this template engine can handle strings larger than 64k.</p>
</div>
<div class="paragraph">
<p>It uses JSP style &lt;% %&gt; script and &lt;%= %&gt; expression syntax or GString style expressions.
The variable 'out' is bound to the writer that the template is being written to.</p>
</div>
<div class="paragraph">
<p>Frequently, the template source will be a file but here we show a simple example providing the template as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def text = '''\
Dear &lt;% out.print firstname %&gt; ${lastname},

We &lt;% if (accepted) out.print 'are pleased' else out.print 'regret' %&gt; \
to inform you that your paper entitled
'$title' was ${ accepted ? 'accepted' : 'rejected' }.

The conference committee.'''

def template = new groovy.text.StreamingTemplateEngine().createTemplate(text)

def binding = [
    firstname : "Grace",
    lastname  : "Hopper",
    accepted  : true,
    title     : 'Groovy for COBOL programmers'
]

String response = template.make(binding)

assert response == '''Dear Grace Hopper,

We are pleased to inform you that your paper entitled
'Groovy for COBOL programmers' was accepted.

The conference committee.'''</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gstringtemplateengine"><a class="anchor" href="#_gstringtemplateengine"></a><a class="link" href="#_gstringtemplateengine">3.18.5. GStringTemplateEngine</a></h4>
<div class="paragraph">
<p>As an example of using the <code>GStringTemplateEngine</code>, here is the example above done again (with a few changes to show some other options).
First we will store the template in a file this time:</p>
</div>
<div class="listingblock">
<div class="title">test.template</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Dear "$firstname $lastname",
So nice to meet you in &lt;% out &lt;&lt; (city == "New York" ? "\\"The Big Apple\\"" : city) %&gt;.
See you in ${month},
${signed}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we used <code>out</code> instead of <code>print</code> to support the streaming nature of <code>GStringTemplateEngine</code>.
Because we have the template in a separate file, there is no need to escape the backslashes. Here is how we call it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def f = new File('test.template')
def engine = new groovy.text.GStringTemplateEngine()
def template = engine.createTemplate(f).make(binding)
println template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Dear "Sam Pullara",
So nice to meet you in "The Big Apple".
See you in December,
Groovy-Dev</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmltemplateengine"><a class="anchor" href="#_xmltemplateengine"></a><a class="link" href="#_xmltemplateengine">3.18.6. XmlTemplateEngine</a></h4>
<div class="paragraph">
<p><code>XmlTemplateEngine</code> for use in templating scenarios where both the template source and the expected output are intended to be XML.
Templates may use the normal <code>${expression}</code> and <code>$variable</code> notations to insert an arbitrary expression into the template.
In addition, support is also provided for special tags: <code>&lt;gsp:scriptlet&gt;</code> (for inserting code fragments) and <code>&lt;gsp:expression&gt;</code>
(for code fragments which produce output).</p>
</div>
<div class="paragraph">
<p>Comments and processing instructions will be removed as part of processing and special XML characters such
as <code>&lt;</code>, <code>&gt;</code>, <code>"</code> and <code>'</code> will be escaped using the respective XML notation.
The output will also be indented using standard XML pretty printing.</p>
</div>
<div class="paragraph">
<p>The xmlns namespace definition for gsp: tags will be removed but other namespace definitions will be preserved
(but may change to an equivalent position within the XML tree).</p>
</div>
<div class="paragraph">
<p>Normally, the template source will be in a file but here is a simple example providing the XML template as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def binding = [firstname: 'Jochen', lastname: 'Theodorou', nickname: 'blackdrag', salutation: 'Dear']
def engine = new groovy.text.XmlTemplateEngine()
def text = '''\
    &lt;document xmlns:gsp='http://groovy.codehaus.org/2005/gsp' xmlns:foo='baz' type='letter'&gt;
        &lt;gsp:scriptlet&gt;def greeting = "${salutation}est"&lt;/gsp:scriptlet&gt;
        &lt;gsp:expression&gt;greeting&lt;/gsp:expression&gt;
        &lt;foo:to&gt;$firstname "$nickname" $lastname&lt;/foo:to&gt;
        How are you today?
    &lt;/document&gt;
'''
def template = engine.createTemplate(text).make(binding)
println template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will produce this output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;document type='letter'&gt;
  Dearest
  &lt;foo:to xmlns:foo='baz'&gt;
    Jochen &amp;quot;blackdrag&amp;quot; Theodorou
  &lt;/foo:to&gt;
  How are you today?
&lt;/document&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_markuptemplateengine"><a class="anchor" href="#_the_markuptemplateengine"></a><a class="link" href="#_the_markuptemplateengine">3.18.7. The MarkupTemplateEngine</a></h4>
<div class="paragraph">
<p>This template engine is a template engine primarily aimed at generating XML-like markup (XML, XHTML, HTML5, &#8230;&#8203;), but that
can be used to generate any text based content. Unlike traditional template engines, this one relies on a DSL that uses the
builder syntax. Here is a sample template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">xmlDeclaration()
cars {
   cars.each {
       car(make: it.make, model: it.model)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you feed it with the following model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">model = [cars: [new Car(make: 'Peugeot', model: '508'), new Car(make: 'Toyota', model: 'Prius')]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would be rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version='1.0'?&gt;
&lt;cars&gt;&lt;car make='Peugeot' model='508'/&gt;&lt;car make='Toyota' model='Prius'/&gt;&lt;/cars&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key features of this template engine are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>markup builder like</em> syntax</p>
</li>
<li>
<p>templates are compiled into bytecode</p>
</li>
<li>
<p>fast rendering</p>
</li>
<li>
<p>optional type checking of the model</p>
</li>
<li>
<p>includes</p>
</li>
<li>
<p>internationalization support</p>
</li>
<li>
<p>fragments/layouts</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_the_template_format"><a class="anchor" href="#_the_template_format"></a><a class="link" href="#_the_template_format">The template format</a></h5>
<div class="sect5">
<h6 id="_basics"><a class="anchor" href="#_basics"></a><a class="link" href="#_basics">Basics</a></h6>
<div class="paragraph">
<p>Templates consist of Groovy code. Let&#8217;s explore the first example more thoroughly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">xmlDeclaration()                                <i class="conum" data-value="1"></i><b>(1)</b>
cars {                                          <i class="conum" data-value="2"></i><b>(2)</b>
   cars.each {                                  <i class="conum" data-value="3"></i><b>(3)</b>
       car(make: it.make, model: it.model)      <i class="conum" data-value="4"></i><b>(4)</b>
   }                                            <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>renders the XML declaration string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>opens a <code>cars</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>cars</code> is a variable found in the <em>template model</em>, which is a list of <code>Car</code> instances</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>for each item, we create a <code>car</code> tag with the attributes from the <code>Car</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>closes the <code>cars</code> tag</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, regular Groovy code can be used in the template. Here, we are calling <code>each</code> on a list (retrieved from the model), allowing us to
render one <code>car</code> tag per entry.</p>
</div>
<div class="paragraph">
<p>In a similar fashion, rendering HTML code is as simple as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">yieldUnescaped '&lt;!DOCTYPE html&gt;'                                                    <i class="conum" data-value="1"></i><b>(1)</b>
html(lang:'en') {                                                                   <i class="conum" data-value="2"></i><b>(2)</b>
    head {                                                                          <i class="conum" data-value="3"></i><b>(3)</b>
        meta('http-equiv':'"Content-Type" content="text/html; charset=utf-8"')      <i class="conum" data-value="4"></i><b>(4)</b>
        title('My page')                                                            <i class="conum" data-value="5"></i><b>(5)</b>
    }                                                                               <i class="conum" data-value="6"></i><b>(6)</b>
    body {                                                                          <i class="conum" data-value="7"></i><b>(7)</b>
        p('This is an example of HTML contents')                                    <i class="conum" data-value="8"></i><b>(8)</b>
    }                                                                               <i class="conum" data-value="9"></i><b>(9)</b>
}                                                                                   <i class="conum" data-value="10"></i><b>(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>renders the HTML doctype special tag</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>opens the <code>html</code> tag with an attribute</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>opens the <code>head</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>renders a <code>meta</code> tag with one <code>http-equiv</code> attribute</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>renders the <code>title</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>closes the <code>head</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>opens the <code>body</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>renders a <code>p</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>closes the <code>body</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>closes the <code>html</code> tag</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;&lt;html lang='en'&gt;&lt;head&gt;&lt;meta http-equiv='"Content-Type" content="text/html; charset=utf-8"'/&gt;&lt;title&gt;My page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;This is an example of HTML contents&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With some <a href="#markuptemplate-config">configuration</a>, you can have the output pretty printed, with newlines and indent automatically added.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_support_methods"><a class="anchor" href="#_support_methods"></a><a class="link" href="#_support_methods">Support methods</a></h6>
<div class="paragraph">
<p>In the previous example, the doctype declaration was rendered using the <code>yieldUnescaped</code> method. We have also seen the <code>xmlDeclaration</code> method.
The template engine provides several support methods that will help you render contents appropriately:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yield</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders contents, but escapes it before rendering</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">yield 'Some text with &lt;angle brackets&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Some text with &amp;lt;angle brackets&amp;gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yieldUnescaped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders raw contents. The argument is rendered as is, without escaping.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">yieldUnescaped 'Some text with &lt;angle brackets&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Some text with &lt;angle brackets&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xmlDeclaration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders an XML declaration String. If the encoding is specified in the configuration, it is written in the declaration.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">xmlDeclaration()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;?xml version='1.0'?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>TemplateConfiguration#getDeclarationEncoding</code> is not null:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders raw contents inside an XML comment</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">comment 'This is &lt;a href="foo.html"&gt;commented out&lt;/a&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!--This is &lt;a href="foo.html"&gt;commented out&lt;/a&gt;--&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">newLine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders a new line. See also <code>TemplateConfiguration#setAutoNewLine</code> and <code>TemplateConfiguration#setNewLineString</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p('text')
newLine()
p('text on new line')</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;text&lt;/p&gt;
&lt;p&gt;text on new line&lt;/p&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders an XML processing instruction.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">pi("xml-stylesheet":[href:"mystyle.css", type:"text/css"])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml-stylesheet href='mystyle.css' type='text/css'?&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tryEscape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns an escaped string for an object, if it is a <code>String</code> (or any type derived from <code>CharSequence</code>). Otherwise returns the object itself.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">yieldUnescaped tryEscape('Some text with &lt;angle brackets&gt;')</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Some text with &amp;lt;angle brackets&amp;gt;</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_includes"><a class="anchor" href="#_includes"></a><a class="link" href="#_includes">Includes</a></h6>
<div class="paragraph">
<p>The <code>MarkupTemplateEngine</code> supports inclusion of contents from another file. Included contents may be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>another template</p>
</li>
<li>
<p>raw contents</p>
</li>
<li>
<p>contents to be escaped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Including another template can be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">include template: 'other_template.tpl'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Including a file as raw contents, without escaping it, can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">include unescaped: 'raw.txt'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, inclusion of text that should be escaped before rendering can be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">include escaped: 'to_be_escaped.txt'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the following helper methods instead:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>includeGroovy(&lt;name&gt;)</code> to include another template</p>
</li>
<li>
<p><code>includeEscaped(&lt;name&gt;)</code> to include another file with escaping</p>
</li>
<li>
<p><code>includeUnescaped(&lt;name&gt;)</code> to include another file without escaping</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calling those methods instead of the <code>include xxx:</code> syntax can be useful if the name of the file to be included is dynamic (stored in a variable for example).
Files to be included (independently of their type, template or text) are found on <strong>classpath</strong>. This is one of the reasons why the <code>MarkupTemplateEngine</code> takes
an optional <code>ClassLoader</code> as constructor argument (the other reason being that you can include code referencing other classes in a template).</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want your templates to be on classpath, the <code>MarkupTemplateEngine</code> accepts a convenient constructor that lets you define the directory where
templates are to be found.</p>
</div>
</div>
<div class="sect5">
<h6 id="_fragments"><a class="anchor" href="#_fragments"></a><a class="link" href="#_fragments">Fragments</a></h6>
<div class="paragraph">
<p>Fragments are nested templates. They can be used to provide improved composition in a single template. A fragment consists of
a string, the inner template, and a model, used to render this template. Consider the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">ul {
    pages.each {
        fragment "li(line)", line:it
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fragment</code> element creates a nested template, and renders it with a model which is specific to this template. Here,
we have the <code>li(line)</code> fragment, where <code>line</code> is bound to <code>it</code>. Since <code>it</code> corresponds to the iteration of <code>pages</code>,
we will generate a single <code>li</code> element for each page in our model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;ul&gt;&lt;li&gt;Page 1&lt;/li&gt;&lt;li&gt;Page 2&lt;/li&gt;&lt;/ul&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fragments are interesting to factorize template elements. They come at the price of the compilation of a fragment per template, and they cannot
be externalized.</p>
</div>
</div>
<div class="sect5">
<h6 id="_layouts"><a class="anchor" href="#_layouts"></a><a class="link" href="#_layouts">Layouts</a></h6>
<div class="paragraph">
<p>Layouts, unlike fragments, refer to other templates. They can be used to compose templates and share common structures. This is often
interesting if you have, for example, a common HTML page setup, and that you only want to replace the body. This can be done easily
with a <em>layout</em>. First of all, you need to create a layout template:</p>
</div>
<div class="listingblock">
<div class="title">layout-main.tpl</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">html {
    head {
        title(title)                <i class="conum" data-value="1"></i><b>(1)</b>
    }
    body {
        bodyContents()              <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>title</code> variable (inside the title tag) is a layout variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>bodyContents</code> call will render the body</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then what you need is a template that includes the layout:</p>
</div>
<div id="example-layout-simple" class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">layout 'layout-main.tpl',                                   <i class="conum" data-value="1"></i><b>(1)</b>
    title: 'Layout example',                                <i class="conum" data-value="2"></i><b>(2)</b>
    bodyContents: contents { p('This is the body') }        <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use the <code>main-layout.tpl</code> layout file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the <code>title</code> variable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set the <code>bodyContents</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, <code>bodyContents</code> will be rendered inside the layout, thanks to the <code>bodyContents()</code> call in the layout file. As
a result, the template will be rendered as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;&lt;head&gt;&lt;title&gt;Layout example&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;This is the body&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The call to the <code>contents</code> method is used to tell the template engine that the block of code is in fact a specification of a
template, instead of a helper function to be rendered directly. If you don&#8217;t add <code>contents</code> before your specification, then
the contents would be rendered, but you would also see a random string generated, corresponding to the result value of the block.</p>
</div>
<div class="paragraph">
<p>Layouts are a powerful way to share common elements across multiple
templates, without having to rewrite everything or use includes.</p>
</div>
<div class="paragraph">
<p>Layouts use, by default, a model which is independent from the model of the page where they are used. It is however possible
to make them inherit from the parent model. Imagine that the model is defined like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">model = new HashMap&lt;String,Object&gt;();
model.put('title','Title from main model');</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">layout 'layout-main.tpl', true,                             <i class="conum" data-value="1"></i><b>(1)</b>
    bodyContents: contents { p('This is the body') }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>note the use of <code>true</code> to enable model inheritance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then it is not necessary to pass the <code>title</code> value to the layout as in the <a href="#example-layout-simple">previous example</a>. The result will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;&lt;head&gt;&lt;title&gt;Title from main model&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;This is the body&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to override a value from the parent model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">layout 'layout-main.tpl', true,                             <i class="conum" data-value="1"></i><b>(1)</b>
    title: 'overridden title',                               <i class="conum" data-value="2"></i><b>(2)</b>
    bodyContents: contents { p('This is the body') }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>true</code> means inherit from the parent model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>but <code>title</code> is overridden</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;&lt;head&gt;&lt;title&gt;overridden title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;This is the body&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rendering_contents"><a class="anchor" href="#_rendering_contents"></a><a class="link" href="#_rendering_contents">Rendering contents</a></h5>
<div class="sect5">
<h6 id="_creation_of_a_template_engine"><a class="anchor" href="#_creation_of_a_template_engine"></a><a class="link" href="#_creation_of_a_template_engine">Creation of a template engine</a></h6>
<div class="paragraph">
<p>On the server side, rendering templates require an instance of <code>groovy.text.markup.MarkupTemplateEngine</code> and a
<code>groovy.text.markup.TemplateConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">TemplateConfiguration config = new TemplateConfiguration();         <i class="conum" data-value="1"></i><b>(1)</b>
MarkupTemplateEngine engine = new MarkupTemplateEngine(config);     <i class="conum" data-value="2"></i><b>(2)</b>
Template template = engine.createTemplate("p('test template')");    <i class="conum" data-value="3"></i><b>(3)</b>
Map&lt;String, Object&gt; model = new HashMap&lt;&gt;();                        <i class="conum" data-value="4"></i><b>(4)</b>
Writable output = template.make(model);                             <i class="conum" data-value="5"></i><b>(5)</b>
output.writeTo(writer);                                             <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a template configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a template engine with this configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>creates a template instance from a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>creates a model to be used in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>bind the model to the template instance</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>render output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several possible options to parse templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from a <code>String</code>, using <code>createTemplate(String)</code></p>
</li>
<li>
<p>from a <code>Reader</code>, using <code>createTemplate(Reader)</code></p>
</li>
<li>
<p>from a <code>URL</code>, using <code>createTemplate(URL)</code></p>
</li>
<li>
<p>given a template name, using <code>createTemplateByPath(String)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last version should in general be preferred:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Template template = engine.createTemplateByPath("main.tpl");
Writable output = template.make(model);
output.writeTo(writer);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-config"><a class="anchor" href="#markuptemplate-config"></a><a class="link" href="#markuptemplate-config">Configuration options</a></h6>
<div class="paragraph">
<p>The behavior of the engine can be tweaked with several configuration options accessible through the <code>TemplateConfiguration</code> class:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">declarationEncoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the value of the encoding to be written when <code>xmlDeclaration</code> is called. It does <strong>not</strong> influence the writer you are using as output.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">xmlDeclaration()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;?xml version='1.0'?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>TemplateConfiguration#getDeclarationEncoding</code> is not null:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expandEmptyElements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, empty tags are rendered in their expanded form.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>expandEmptyElements</code> is true:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;&lt;/p&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useDoubleQuotes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, use double quotes for attributes instead of simple quotes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">tag(attr:'value')</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;tag attr='value'/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>useDoubleQuotes</code> is true:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;tag attr="value"/&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">newLineString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System default (system property <code>line.separator</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to choose what string is used when a new line is rendered</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p('foo')
newLine()
p('baz')</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>newLineString='BAR'</code>:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;foo&lt;/p&gt;BAR&lt;p&gt;baz&lt;/p&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoEscape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, variables from models are automatically escaped before rendering.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-autoescape">the auto escape section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoIndent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, performs automatic indentation after new lines</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoIndentString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">four (4) spaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string to be used as indent.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoNewLine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, performs automatic insertion of new lines</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseTemplateClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovy.text.markup.BaseTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the super class of compiled templates. This can be used to provide application specific templates.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-basetemplate">the custom templates section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the default locale for templates.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="#markuptemplate-i18n">the internationalization section</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Once the template engine has been created, it is <strong>unsafe</strong> to change the configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-autoformat"><a class="anchor" href="#markuptemplate-autoformat"></a><a class="link" href="#markuptemplate-autoformat">Automatic formatting</a></h6>
<div class="paragraph">
<p>By default, the template engine will render output without any specific formatting. Some <a href="#markuptemplate-config">configuration options</a> can improve the situation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>autoIndent</code> is responsible for auto-indenting after a new line is inserted</p>
</li>
<li>
<p><code>autoNewLine</code> is responsible for automatically inserting new lines based on the original formatting of the template source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, it is recommended to set both <code>autoIndent</code> and <code>autoNewLine</code> to true if you want human-readable, pretty printed, output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">config.setAutoNewLine(true);
config.setAutoIndent(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">html {
    head {
        title('Title')
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will now be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Title&lt;/title&gt;
    &lt;/head&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can slightly change the template so that the <code>title</code> instruction is found on the same line as the <code>head</code> one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">html {
    head { title('Title')
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the output will reflect that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;
    &lt;head&gt;&lt;title&gt;Title&lt;/title&gt;
    &lt;/head&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>New lines are <strong>only</strong> inserted where curly braces for tags are found, and the insertion corresponds to where the nested content is found. This means that
tags in the body of another tag will <strong>not</strong> trigger new lines unless they use curly braces themselves:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">html {
    head {
        meta(attr:'value')          <i class="conum" data-value="1"></i><b>(1)</b>
        title('Title')              <i class="conum" data-value="2"></i><b>(2)</b>
        newLine()                   <i class="conum" data-value="3"></i><b>(3)</b>
        meta(attr:'value2')         <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new line is inserted because <code>meta</code> is not on the same line as <code>head</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no new line is inserted, because we&#8217;re on the same depth as the previous tag</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can force rendering of a new line by explicitly calling <code>newLine</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and this tag will be rendered on a separate line</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This time, the output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;meta attr='value'/&gt;&lt;title&gt;Title&lt;/title&gt;
        &lt;meta attr='value2'/&gt;
    &lt;/head&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the renderer uses four(4) spaces as indent, but you can change it by setting the <code>TemplateConfiguration#autoIndentString</code> property.</p>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-autoescape"><a class="anchor" href="#markuptemplate-autoescape"></a><a class="link" href="#markuptemplate-autoescape">Automatic escaping</a></h6>
<div class="paragraph">
<p>By default, contents which is read from the model is rendered <strong>as is</strong>. If this contents comes from user input, it can be sensible, and you might
want to escape it by default, for example to avoid XSS injection. For that, the template configuration provides an option which will automatically
escape objects from the model, as long as they inherit from <code>CharSequence</code> (typically, `String`s).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine the following setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.setAutoEscape(false);
model = new HashMap&lt;String,Object&gt;();
model.put("unsafeContents", "I am an &lt;html&gt; hacker.");</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">html {
    body {
        div(unsafeContents)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you wouldn&#8217;t want the HTML from <code>unsafeContents</code> to be rendered as is, because of potential security issues:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;&lt;body&gt;&lt;div&gt;I am an &lt;html&gt; hacker.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Automatic escaping will fix this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">config.setAutoEscape(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now the output is properly escaped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;&lt;body&gt;&lt;div&gt;I am an &amp;lt;html&amp;gt; hacker.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that using automatic escaping doesn&#8217;t prevent you from including unescaped contents from the model. To do this, your template should then explicitly
mention that a model variable should not be escaped by prefixing it with <code>unescaped.</code>, like in this example:</p>
</div>
<div class="listingblock">
<div class="title">Explicit bypass of automatic escaping</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">html {
    body {
        div(unescaped.unsafeContents)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-gotchas"><a class="anchor" href="#markuptemplate-gotchas"></a><a class="link" href="#markuptemplate-gotchas">Common gotchas</a></h6>
<div class="sect6">
<h7 id="_strings_containing_markup"><a class="anchor" href="#_strings_containing_markup"></a><a class="link" href="#_strings_containing_markup">Strings containing markup</a></h7>
<div class="paragraph">
<p>Say that you want to generate a <code>&lt;p&gt;</code> tag which contains a string containing markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p {
    yield "This is a "
    a(href:'target.html', "link")
    yield " to another page"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and generates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;This is a &lt;a href='target.html'&gt;link&lt;/a&gt; to another page&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can&#8217;t this be written shorter? A naive alternative would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p {
    yield "This is a ${a(href:'target.html', "link")} to another page"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but the result will not look as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">&lt;p&gt;&lt;a href='target.html'&gt;link&lt;/a&gt;This is a  to another page&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that the markup template engine is a <em>streaming</em> engine. In the original version, the first <code>yield</code> call
generates a string which is streamed to the output, then the <code>a</code> link is generated and streamed, and then the last <code>yield</code>
call is streamed, leading in an execution <strong>in order</strong>. But with the string version above, the order of execution is different:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>yield</code> call requires an argument, a <em>string</em></p>
</li>
<li>
<p>that arguments need to be evaluated <em>before</em> the <em>yield</em> call is generated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>so evaluating the string leads to an execution of the <code>a(href:&#8230;&#8203;)</code> call <strong>before</strong> <code>yield</code> is itself called. This is not
what you want to do. Instead, you want to generate a <em>string</em> which contains markup, which is then passed to the <code>yield</code>
call. This can be done this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p("This is a ${stringOf {a(href:'target.html', "link")}} to another page")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>stringOf</code> call, which basically tells the markup template engine that the underlying markup needs to be rendered
separately and exported as a string. Note that for simple expressions, <code>stringOf</code> can be replaced by an alternate tag
notation that starts with a <em>dollar</em> sign:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">p("This is a ${$a(href:'target.html', "link")} to another page")</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is worth noting that using <code>stringOf</code> or the special <code>$tag</code> notation triggers the creation of a distinct string writer
which is then used to render the markup. It is slower than using the version with calls to <code>yield</code> which perform direct
streaming of the markup instead.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-i18n"><a class="anchor" href="#markuptemplate-i18n"></a><a class="link" href="#markuptemplate-i18n">Internationalization</a></h6>
<div class="paragraph">
<p>The template engine has native support for internationalization. For that, when you create the <code>TemplateConfiguration</code>, you can provide
a <code>Locale</code> which is the default locale to be used for templates. Each template may have different versions, one for each locale. The
name of the template makes the difference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file.tpl</code>: default template file</p>
</li>
<li>
<p><code>file_fr_FR.tpl</code>: french version of the template</p>
</li>
<li>
<p><code>file_en_US.tpl</code>: american english version of the template</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a template is rendered or included, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the template name or include name <strong>explicitly</strong> sets a locale, the <strong>specific</strong> version is included, or the default version if not found</p>
</li>
<li>
<p>if the template name doesn&#8217;t include a locale, the version for the <code>TemplateConfiguration</code> locale is used, or the default version if not found</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, imagine the default locale is set to <code>Locale.ENGLISH</code> and that the main template includes:</p>
</div>
<div class="listingblock">
<div class="title">Use an explicit locale in include</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">include template: 'locale_include_fr_FR.tpl'</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the template is rendered using the specific template:</p>
</div>
<div class="listingblock">
<div class="title">Bypass the template configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Texte en français</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using an include without specifying a locale will make the template engine look for a template with the configured locale, and if not, fallback to the default, like here:</p>
</div>
<div class="listingblock">
<div class="title">Don&#8217;t use a locale in include</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">include template: 'locale_include.tpl'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Fallback to the default template</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Default text</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, changing the default locale of the template engine to <code>Locale.FRANCE</code> will change the output, because the template engine will now look for a file
with the <code>fr_FR</code> locale:</p>
</div>
<div class="listingblock">
<div class="title">Don&#8217;t fall back to the default template because a locale specific template was found</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Texte en français</code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy lets you translate your templates one by one, by relying on default templates, for which no locale is set in the file name.</p>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-basetemplate"><a class="anchor" href="#markuptemplate-basetemplate"></a><a class="link" href="#markuptemplate-basetemplate">Custom template classes</a></h6>
<div class="paragraph">
<p>By default, templates created inherit the <code>groovy.text.markup.BaseTemplate</code> class. It may be interesting for an application to provide a different
template class, for example to provide additional helper methods which are aware of the application, or customized rendering primitives (for HTML,
for example).</p>
</div>
<div class="paragraph">
<p>The template engine provides this ability by setting an alternative <code>baseTemplateClass</code> in the <code>TemplateConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">config.setBaseTemplateClass(MyTemplate.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom base class has to extend <code>BaseClass</code> like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public abstract class MyTemplate extends BaseTemplate {
    private List&lt;Module&gt; modules
    public MyTemplate(
            final MarkupTemplateEngine templateEngine,
            final Map model,
            final Map&lt;String, String&gt; modelTypes,
            final TemplateConfiguration configuration) {
        super(templateEngine, model, modelTypes, configuration)
    }

    List&lt;Module&gt; getModules() {
        return modules
    }

    void setModules(final List&lt;Module&gt; modules) {
        this.modules = modules
    }

    boolean hasModule(String name) {
        modules?.any { it.name == name }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows a class which provides an additional method named <code>hasModule</code>, which can then be used directly in the template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (hasModule('foo')) {
    p 'Found module [foo]'
} else {
    p 'Module [foo] not found'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_type_checked_templates"><a class="anchor" href="#_type_checked_templates"></a><a class="link" href="#_type_checked_templates">Type checked templates</a></h5>
<div class="sect5">
<h6 id="_optional_type_checking"><a class="anchor" href="#_optional_type_checking"></a><a class="link" href="#_optional_type_checking">Optional type checking</a></h6>
<div class="paragraph">
<p>Even if templates are not type checked, they are statically compiled. This means that once the templates are compiled, performance should be very good. For some
applications, it might be good to make sure that templates are valid before they are actually rendered. This means failing template compilation, for example, if
a method on a model variable doesn&#8217;t exist.</p>
</div>
<div class="paragraph">
<p>The <code>MarkupTemplateEngine</code> provides such a facility. Templates can be optionally type checked. For that, the developer must provide additional information at
template creation time, which is the types of the variables found in the model. Imagine a model exposing a list of pages, where a page is defined as:</p>
</div>
<div class="listingblock">
<div class="title">Page.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public class Page {

    Long id
    String title
    String body
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a list of pages can be exposed in the model, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Page p = new Page();
p.setTitle("Sample page");
p.setBody("Page body");
List&lt;Page&gt; pages = new LinkedList&lt;&gt;();
pages.add(p);
model = new HashMap&lt;String,Object&gt;();
model.put("pages", pages);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A template can use it easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">pages.each { page -&gt;                    <i class="conum" data-value="1"></i><b>(1)</b>
    p("Page title: $page.title")        <i class="conum" data-value="2"></i><b>(2)</b>
    p(page.text)                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>iterate on pages from the model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>page.title</code> is valid</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>page.text</code> is <strong>not</strong> (should be <code>page.body</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Without type checking, the compilation of the template succeeds, because the template engine doesn&#8217;t know about the model until a page
is actually rendered. This means that the problem would only surface at runtime, once the page is rendered:</p>
</div>
<div class="listingblock">
<div class="title">Runtime error</div>
<div class="content">
<pre>No such property: text</pre>
</div>
</div>
<div class="paragraph">
<p>In some situations, this can be complicated to sort out or even notice. By declaring the type of the <code>pages</code> to the template engine, we&#8217;re now capable of failing at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">modelTypes = new HashMap&lt;String,String&gt;();                                          <i class="conum" data-value="1"></i><b>(1)</b>
modelTypes.put("pages", "List&lt;Page&gt;");                                              <i class="conum" data-value="2"></i><b>(2)</b>
Template template = engine.createTypeCheckedModelTemplate("main.tpl", modelTypes)   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a map which will hold the model types</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare the type of the <code>pages</code> variables (note the use of a string for the type)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use <code>createTypeCheckedModelTemplate</code> instead of <code>createTemplate</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This time, when the template is compiled at the last line, an error occurs:</p>
</div>
<div class="listingblock">
<div class="title">Template compilation time error</div>
<div class="content">
<pre>[Static type checking] - No such property: text for class: Page</pre>
</div>
</div>
<div class="paragraph">
<p>This means that you don&#8217;t need to wait for the page to be rendered to see an error. The use of <code>createTypeCheckedModelTemplate</code> is mandatory.</p>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_declaration_of_types"><a class="anchor" href="#_alternative_declaration_of_types"></a><a class="link" href="#_alternative_declaration_of_types">Alternative declaration of types</a></h6>
<div class="paragraph">
<p>Alternatively, if the developer is also the one who writes the templates, it is possible to declare the types of the expected variables
directly in the template. In this case, even if you call <code>createTemplate</code>, it will be type checked:</p>
</div>
<div class="listingblock">
<div class="title">Inline declaration of types</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">modelTypes = {                          <i class="conum" data-value="1"></i><b>(1)</b>
    List&lt;Page&gt; pages                    <i class="conum" data-value="2"></i><b>(2)</b>
}

pages.each { page -&gt;
    p("Page title: $page.title")
    p(page.text)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>types need to be declared in the <code>modelTypes</code> header</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare one variable per object in the model</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_performance_of_type_checked_templates"><a class="anchor" href="#_performance_of_type_checked_templates"></a><a class="link" href="#_performance_of_type_checked_templates">Performance of type checked templates</a></h6>
<div class="paragraph">
<p>An additional interest of using type checked models is that performance should improve. By telling the type checker what are the expected types,
you also let the compiler generate optimized code for that, so if you are looking for the best performance, consider using type checked templates.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_solutions"><a class="anchor" href="#_other_solutions"></a><a class="link" href="#_other_solutions">3.18.8. Other solutions</a></h4>
<div class="paragraph">
<p>Also, there are other templating solutions that can be used along with Groovy,
such as <a href="http://freemarker.org">FreeMarker</a>, <a href="http://velocity.apache.org">Velocity</a>, <a href="http://stringtemplate.org">StringTemplate</a> and others.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servlet_support"><a class="anchor" href="#_servlet_support"></a><a class="link" href="#_servlet_support">3.19. Servlet support</a></h3>
<div class="paragraph">
<p>You can write (Java) Servlets in Groovy (called Groovlets).</p>
</div>
<div class="paragraph">
<p>There is also a <code>GroovyServlet</code>.</p>
</div>
<div class="paragraph">
<p>This feature will automatically compile your .groovy source files, turn them into bytecode, load the Class and cache it until you change the source file.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example to show you the kind of things you can do from a Groovlet.</p>
</div>
<div class="paragraph">
<p>Notice the use of implicit variables to access the session, output and request. Also notice that this is more like a script as it does not have a class wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (!session) {
  session = request.getSession(true)
}

if (!session.counter) {
  session.counter = 1
}

println """
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Groovy Servlet&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;
Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}
        &lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
"""
session.counter = session.counter + 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, do the same thing using MarkupBuilder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (!session) {
    session = request.getSession(true)
}

if (!session.counter) {
    session.counter = 1
}

html.html { // html is implicitly bound to new MarkupBuilder(out)
  head {
      title('Groovy Servlet')
  }
  body {
    p("Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}")
  }
}
session.counter = session.counter + 1</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_implicit_variables"><a class="anchor" href="#_implicit_variables"></a><a class="link" href="#_implicit_variables">3.19.1. Implicit variables</a></h4>
<div class="paragraph">
<p>The following variables are ready for use in Groovlets:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">variable name</th>
<th class="tableblock halign-left valign-top">bound to</th>
<th class="tableblock halign-left valign-top">note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletRequest</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletResponse</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getSession(false)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>can be null! see &lt;1&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>a Map object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>a Map object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getWriter()</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getOutputStream()</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new MarkupBuilder(out)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new StreamingJsonBuilder(out)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The session variable is only set, if there was already a session object. See the <code>if (session == null)</code> checks in the examples above.</p>
</li>
<li>
<p>These variables cannot be re-assigned inside a <code>Groovlet</code>. They are bound on first access, allowing to e.g. calling methods on the <code>response</code> object before using <code>out</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_groovlets"><a class="anchor" href="#_setting_up_groovlets"></a><a class="link" href="#_setting_up_groovlets">3.19.2. Setting up groovlets</a></h4>
<div class="paragraph">
<p>Add the following to your <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;servlet&gt;
    &lt;servlet-name&gt;Groovy&lt;/servlet-name&gt;
    &lt;servlet-class&gt;groovy.servlet.GroovyServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Groovy&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.groovy&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then put the required groovy jar files into <code>WEB-INF/lib</code>.</p>
</div>
<div class="paragraph">
<p>Now put the .groovy files in, say, the root directory (i.e. where you would put your html files). The <code>GroovyServlet</code> takes care of compiling the .groovy files.</p>
</div>
<div class="paragraph">
<p>So for example using tomcat you could edit <code>tomcat/conf/server.xml</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;Context path="/groovy" docBase="c:/groovy-servlet"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then access it with <a href="http://localhost:8080/groovy/hello.groovy" class="bare">http://localhost:8080/groovy/hello.groovy</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_groovy_in_a_java_application"><a class="anchor" href="#_integrating_groovy_in_a_java_application"></a><a class="link" href="#_integrating_groovy_in_a_java_application">3.20. Integrating Groovy in a Java application</a></h3>
<div class="sect3">
<h4 id="_groovy_integration_mechanisms"><a class="anchor" href="#_groovy_integration_mechanisms"></a><a class="link" href="#_groovy_integration_mechanisms">3.20.1. Groovy integration mechanisms</a></h4>
<div class="paragraph">
<p>The Groovy language proposes several ways to integrate itself into applications (Java or even Groovy) at runtime, from
the most basic, simple code execution to the most complete, integrating caching and compiler customization.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All the examples written in this section are using Groovy, but the same integration mechanisms can be used from
Java.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="integ-eval"><a class="anchor" href="#integ-eval"></a><a class="link" href="#integ-eval">Eval</a></h5>
<div class="paragraph">
<p>The <code>groovy.util.Eval</code> class is the simplest way to execute Groovy dynamically at runtime. This can be done by calling the <code>me</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.util.Eval

assert Eval.me('33*3') == 99
assert Eval.me('"foo".toUpperCase()') == 'FOO'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Eval</code> supports multiple variants that accept parameters for simple evaluation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert Eval.x(4, '2*x') == 8                <i class="conum" data-value="1"></i><b>(1)</b>
assert Eval.me('k', 4, '2*k') == 8          <i class="conum" data-value="2"></i><b>(2)</b>
assert Eval.xy(4, 5, 'x*y') == 20           <i class="conum" data-value="3"></i><b>(3)</b>
assert Eval.xyz(4, 5, 6, 'x*y+z') == 26     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple evaluation with one bound parameter named <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Same evaluation, with a custom bound parameter named <code>k</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Simple evaluation with two bound parameters named <code>x</code> and <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Simple evaluation with three bound parameters named <code>x</code>, <code>y</code> and <code>z</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Eval</code> class makes it very easy to evaluate simple scripts, but doesn&#8217;t scale: there is no caching of the script, and
it isn&#8217;t meant to evaluate more than one-liners.</p>
</div>
</div>
<div class="sect4">
<h5 id="integ-groovyshell"><a class="anchor" href="#integ-groovyshell"></a><a class="link" href="#integ-groovyshell">GroovyShell</a></h5>
<div class="sect5">
<h6 id="_multiple_sources"><a class="anchor" href="#_multiple_sources"></a><a class="link" href="#_multiple_sources">Multiple sources</a></h6>
<div class="paragraph">
<p>The <code>groovy.lang.GroovyShell</code> class is the preferred way to evaluate scripts with the ability to cache the resulting
script instance. Although the <code>Eval</code> class returns the result of the execution of the compiled script, the <code>GroovyShell</code>
class offers more options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def shell = new GroovyShell()                           <i class="conum" data-value="1"></i><b>(1)</b>
def result = shell.evaluate '3*5'                       <i class="conum" data-value="2"></i><b>(2)</b>
def result2 = shell.evaluate(new StringReader('3*5'))   <i class="conum" data-value="3"></i><b>(3)</b>
assert result == result2
def script = shell.parse '3*5'                          <i class="conum" data-value="4"></i><b>(4)</b>
assert script instanceof groovy.lang.Script
assert script.run() == 15                               <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyShell</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be used as <code>Eval</code> with direct execution of the code</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>can read from multiple sources (<code>String</code>, <code>Reader</code>, <code>File</code>, <code>InputStream</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>can defer execution of the script. <code>parse</code> returns a <code>Script</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>Script</code> defines a <code>run</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sharing_data_between_a_script_and_the_application"><a class="anchor" href="#_sharing_data_between_a_script_and_the_application"></a><a class="link" href="#_sharing_data_between_a_script_and_the_application">Sharing data between a script and the application</a></h6>
<div class="paragraph">
<p>It is possible to share data between the application and the script using a <code>groovy.lang.Binding</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sharedData = new Binding()                          <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(sharedData)                 <i class="conum" data-value="2"></i><b>(2)</b>
def now = new Date()
sharedData.setProperty('text', 'I am shared data!')     <i class="conum" data-value="3"></i><b>(3)</b>
sharedData.setProperty('date', now)                     <i class="conum" data-value="4"></i><b>(4)</b>

String result = shell.evaluate('"At $date, $text"')     <i class="conum" data-value="5"></i><b>(5)</b>

assert result == "At $now, I am shared data!"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> that will contain shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a <code>GroovyShell</code> using this shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>add a string to the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>add a date to the binding (you are not limited to simple types)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>evaluate the script</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that it is also possible to write from the script into the binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sharedData = new Binding()                          <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(sharedData)                 <i class="conum" data-value="2"></i><b>(2)</b>

shell.evaluate('foo=123')                               <i class="conum" data-value="3"></i><b>(3)</b>

assert sharedData.getProperty('foo') == 123             <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a new <code>GroovyShell</code> using that shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use an <strong>undeclared</strong> variable to store the result into the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>read the result from the caller</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to understand that you need to use an undeclared variable if you want to write into the binding. Using
<code>def</code> or an <code>explicit</code> type like in the example below would fail because you would then create a <em>local variable</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def sharedData = new Binding()
def shell = new GroovyShell(sharedData)

shell.evaluate('int foo=123')

try {
    assert sharedData.getProperty('foo')
} catch (MissingPropertyException e) {
    println "foo is defined as a local variable"
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must be very careful when using shared data in a multithreaded environment. The <code>Binding</code> instance that
you pass to <code>GroovyShell</code> is <strong>not</strong> thread safe, and shared by all scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to work around the shared instance of <code>Binding</code> by leveraging the <code>Script</code> instance which is returned
by <code>parse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def shell = new GroovyShell()

def b1 = new Binding(x:3)                       <i class="conum" data-value="1"></i><b>(1)</b>
def b2 = new Binding(x:4)                       <i class="conum" data-value="2"></i><b>(2)</b>
def script = shell.parse('x = 2*x')
script.binding = b1
script.run()
script.binding = b2
script.run()
assert b1.getProperty('x') == 6
assert b2.getProperty('x') == 8
assert b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will store the <code>x</code> variable inside <code>b1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>will store the <code>x</code> variable inside <code>b2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, you must be aware that you are still sharing the <strong>same instance</strong> of a script. So this technique cannot be
used if you have two threads working on the same script. In that case, you must make sure of creating two distinct
script instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def shell = new GroovyShell()

def b1 = new Binding(x:3)
def b2 = new Binding(x:4)
def script1 = shell.parse('x = 2*x')            <i class="conum" data-value="1"></i><b>(1)</b>
def script2 = shell.parse('x = 2*x')            <i class="conum" data-value="2"></i><b>(2)</b>
assert script1 != script2
script1.binding = b1                            <i class="conum" data-value="3"></i><b>(3)</b>
script2.binding = b2                            <i class="conum" data-value="4"></i><b>(4)</b>
def t1 = Thread.start { script1.run() }         <i class="conum" data-value="5"></i><b>(5)</b>
def t2 = Thread.start { script2.run() }         <i class="conum" data-value="6"></i><b>(6)</b>
[t1,t2]*.join()                                 <i class="conum" data-value="7"></i><b>(7)</b>
assert b1.getProperty('x') == 6
assert b2.getProperty('x') == 8
assert b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create an instance of script for thread 1</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an instance of script for thread 2</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>assign first binding to script 1</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>assign second binding to script 2</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>start first script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>start second script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>wait for completion</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case you need thread safety like here, it is more advisable to use the <a href="#groovyclassloader">GroovyClassLoader</a>
directly instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="_custom_script_class"><a class="anchor" href="#_custom_script_class"></a><a class="link" href="#_custom_script_class">Custom script class</a></h6>
<div class="paragraph">
<p>We have seen that the <code>parse</code> method returns an instance of <code>groovy.lang.Script</code>, but it is possible to use a custom
class, given that it extends <code>Script</code> itself. It can be used to provide additional behavior to the script like in
the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class MyScript extends Script {
    String name

    String greet() {
        "Hello, $name!"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom class defines a property called <code>name</code> and a new method called <code>greet</code>. This class can be used as the script
base class by using a custom configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.CompilerConfiguration

def config = new CompilerConfiguration()                                    <i class="conum" data-value="1"></i><b>(1)</b>
config.scriptBaseClass = 'MyScript'                                         <i class="conum" data-value="2"></i><b>(2)</b>

def shell = new GroovyShell(this.class.classLoader, new Binding(), config)  <i class="conum" data-value="3"></i><b>(3)</b>
def script = shell.parse('greet()')                                         <i class="conum" data-value="4"></i><b>(4)</b>
assert script instanceof MyScript
script.setName('Michel')
assert script.run() == 'Hello, Michel!'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a <code>CompilerConfiguration</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instruct it to use <code>MyScript</code> as the base class for scripts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then use the compiler configuration when you create the shell</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the script now has access to the new method <code>greet</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You are not limited to the sole <em>scriptBaseClass</em> configuration. You can use any of the compiler configuration
tweaks, including the <a href="#compilation-customizers">compilation customizers</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovyclassloader"><a class="anchor" href="#groovyclassloader"></a><a class="link" href="#groovyclassloader">GroovyClassLoader</a></h5>
<div class="paragraph">
<p>In the <a href="#integ-groovyshell">previous section</a>, we have shown that <code>GroovyShell</code> was an easy tool to execute scripts, but
it makes it complicated to compile anything but scripts. Internally, it makes use of the <code>groovy.lang.GroovyClassLoader</code>,
which is at the heart of the compilation and loading of classes at runtime.</p>
</div>
<div class="paragraph">
<p>By leveraging the <code>GroovyClassLoader</code> instead of <code>GroovyShell</code>, you will be able to load classes, instead of instances
of scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.lang.GroovyClassLoader

def gcl = new GroovyClassLoader()                                           <i class="conum" data-value="1"></i><b>(1)</b>
def clazz = gcl.parseClass('class Foo { void doIt() { println "ok" } }')    <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz.name == 'Foo'                                                  <i class="conum" data-value="3"></i><b>(3)</b>
def o = clazz.newInstance()                                                 <i class="conum" data-value="4"></i><b>(4)</b>
o.doIt()                                                                    <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyClassLoader</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>parseClass</code> will return an instance of <code>Class</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can check that the class which is returns is really the one defined in the script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and you can create a new instance of the class, which is not a script</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>then call any method on it</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A GroovyClassLoader keeps a reference of all the classes it created, so it is easy to create a memory leak. In
particular, if you execute the same script twice, if it is a String, then you obtain two distinct classes!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.lang.GroovyClassLoader

def gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass('class Foo { }')                                <i class="conum" data-value="1"></i><b>(1)</b>
def clazz2 = gcl.parseClass('class Foo { }')                                <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz1.name == 'Foo'                                                 <i class="conum" data-value="3"></i><b>(3)</b>
assert clazz2.name == 'Foo'
assert clazz1 != clazz2                                                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>dynamically create a class named "Foo"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an identical looking class, using a separate <code>parseClass</code> call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure both classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but they are actually different!</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason is that a <code>GroovyClassLoader</code> doesn&#8217;t keep track of the source text. If you want to have the same instance,
then the source <strong>must</strong> be a file, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass(file)                                           <i class="conum" data-value="1"></i><b>(1)</b>
def clazz2 = gcl.parseClass(new File(file.absolutePath))                    <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz1.name == 'Foo'                                                 <i class="conum" data-value="3"></i><b>(3)</b>
assert clazz2.name == 'Foo'
assert clazz1 == clazz2                                                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>parse a class from a <code>File</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>parse a class from a distinct file instance, but pointing to the same physical file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure our classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but now, they are the same instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using a <code>File</code> as input, the <code>GroovyClassLoader</code> is capable of <strong>caching</strong> the generated class file, which avoids
creating multiple classes at runtime for the same source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groovyscriptengine"><a class="anchor" href="#_groovyscriptengine"></a><a class="link" href="#_groovyscriptengine">GroovyScriptEngine</a></h5>
<div class="paragraph">
<p>The <code>groovy.util.GroovyScriptEngine</code> class provides a flexible foundation for applications which rely on script
reloading and script dependencies. While <code>GroovyShell</code> focuses on standalone <code>Script</code>s and <code>GroovyClassLoader</code> handles
dynamic compilation and loading of any Groovy class, the <code>GroovyScriptEngine</code> will add a layer on top of <code>GroovyClassLoader</code>
to handle both script dependencies and reloading.</p>
</div>
<div class="paragraph">
<p>To illustrate this, we will create a script engine and execute code in an infinite loop. First of all, you need to create
a directory with the following script inside:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Greeter {
    String sayHello() {
        def greet = "Hello, world!"
        greet
    }
}

new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can execute this code using a <code>GroovyScriptEngine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def binding = new Binding()
def engine = new GroovyScriptEngine([tmpDir.toURI().toURL()] as URL[])          <i class="conum" data-value="1"></i><b>(1)</b>

while (true) {
    def greeter = engine.run('ReloadingTest.groovy', binding)                   <i class="conum" data-value="2"></i><b>(2)</b>
    println greeter.sayHello()                                                  <i class="conum" data-value="3"></i><b>(3)</b>
    Thread.sleep(1000)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a script engine which will look for sources into our source directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>execute the script, which will return an instance of <code>Greeter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>print the greeting message</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point, you should see a message printed every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
Hello, world!
...</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Without</strong> interrupting the script execution, now replace the contents of the <code>ReloadingTest</code> file with:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Greeter {
    String sayHello() {
        def greet = "Hello, Groovy!"
        greet
    }
}

new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
...
Hello, Groovy!
Hello, Groovy!
...</pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to have a dependency on another script. To illustrate this, create the following file into
the same directory, without interrupting the executing script:</p>
</div>
<div class="listingblock">
<div class="title">Dependency.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Dependency {
    String message = 'Hello, dependency 1'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and update the <code>ReloadingTest</code> script like this:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import Dependency

class Greeter {
    String sayHello() {
        def greet = new Dependency().message
        greet
    }
}

new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this time, the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Groovy!
...
Hello, dependency 1!
Hello, dependency 1!
...</pre>
</div>
</div>
<div class="paragraph">
<p>And as a last test, you can update the <code>Dependency.groovy</code> file without touching the <code>ReloadingTest</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Dependency.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Dependency {
    String message = 'Hello, dependency 2'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should observe that the dependent file was reloaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, dependency 1!
...
Hello, dependency 2!
Hello, dependency 2!</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compilationunit"><a class="anchor" href="#_compilationunit"></a><a class="link" href="#_compilationunit">CompilationUnit</a></h5>
<div class="paragraph">
<p>Ultimately, it is possible to perform more operations during compilation by relying directly on the
<code>org.codehaus.groovy.control.CompilationUnit</code> class. This class is responsible for determining the various steps of
compilation and would let you introduce new steps or even stop compilation at various phases. This is for example how
stub generation is done, for the joint compiler.</p>
</div>
<div class="paragraph">
<p>However, overriding <code>CompilationUnit</code> is not recommended and should only be done if no other standard solution works.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jsr223"><a class="anchor" href="#jsr223"></a><a class="link" href="#jsr223">3.20.2. JSR 223 javax.script API</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
JSR-223 is a standard API for calling scripting frameworks in Java. It is available since Java 6 and aims at
providing a common framework for calling multiple languages from Java. Groovy provides its own richer integration mechanisms,
and if you don&#8217;t plan to use multiple languages in the same application, it is recommended that you use the Groovy
integration mechanisms instead of the limited JSR-223 API.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is how you need to initialize the JSR-223 engine to talk to Groovy from Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;
...
ScriptEngineManager factory = new ScriptEngineManager();
ScriptEngine engine = factory.getEngineByName("groovy");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can execute Groovy scripts easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Integer sum = (Integer) engine.eval("(1..10).sum()");
assertEquals(Integer.valueOf(55), sum);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to share variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">engine.put("first", "HELLO");
engine.put("second", "world");
String result = (String) engine.eval("first.toLowerCase() + ' ' + second.toUpperCase()");
assertEquals("hello WORLD", result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This next example illustrates calling an invokable function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import javax.script.Invocable;
...
ScriptEngineManager factory = new ScriptEngineManager();
ScriptEngine engine = factory.getEngineByName("groovy");
String fact = "def factorial(n) { n == 1 ? 1 : n * factorial(n - 1) }";
engine.eval(fact);
Invocable inv = (Invocable) engine;
Object[] params = {5};
Object result = inv.invokeFunction("factorial", params);
assertEquals(Integer.valueOf(120), result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine keeps per default hard references to the script functions. To
change this you should set an engine level scoped attribute to the script
context of the name <code>#jsr223.groovy.engine.keep.globals</code> with a
String being <code>phantom</code> to use phantom references, <code>weak</code> to use weak
references or <code>soft</code> to use soft references - casing is ignored. Any
other string will cause the use of hard references.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a><a class="link" href="#_domain_specific_languages">3.21. Domain-Specific Languages</a></h3>
<div class="sect3">
<h4 id="_command_chains"><a class="anchor" href="#_command_chains"></a><a class="link" href="#_command_chains">3.21.1. Command chains</a></h4>
<div class="paragraph">
<p>Groovy lets you omit parentheses around the arguments of a
method call for top-level statements. "command chain" feature extends this by allowing us to chain such
parentheses-free method calls, requiring neither parentheses around arguments, nor dots between the chained calls.
The general idea is that a call like <code>a b c d</code> will actually be equivalent to <code>a(b).c(d)</code>. This
also works with multiple arguments, closure arguments, and even named arguments. Furthermore, such command chains can
also appear on the right-hand side of assignments. Let’s have a look at some examples
supported by this new syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// equivalent to: turn(left).then(right)
turn left then right

// equivalent to: take(2.pills).of(chloroquinine).after(6.hours)
take 2.pills of chloroquinine after 6.hours

// equivalent to: paint(wall).with(red, green).and(yellow)
paint wall with red, green and yellow

// with named parameters too
// equivalent to: check(that: margarita).tastes(good)
check that: margarita tastes good

// with closures as parameters
// equivalent to: given({}).when({}).then({})
given { } when { } then { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use methods in the chain which take no arguments,
but in that case, the parentheses are needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// equivalent to: select(all).unique().from(names)
select all unique() from names</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your command chain contains an odd number of elements, the chain will
be composed of method / arguments, and will finish by a final property
access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// equivalent to: take(3).cookies
// and also this: take(3).getCookies()
take 3 cookies</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command chain approach opens up interesting possibilities in terms of the much wider range of DSLs which
can now be written in Groovy.</p>
</div>
<div class="paragraph">
<p>The above examples illustrate using a command chain based DSL but not how to create one. There are various strategies
that you can use, but to illustrate creating such a DSL, we will show a couple of examples - first using maps and Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">show = { println it }
square_root = { Math.sqrt(it) }

def please(action) {
  [the: { what -&gt;
    [of: { n -&gt; action(what(n)) }]
  }]
}

// equivalent to: please(show).the(square_root).of(100)
please show the square_root of 100
// ==&gt; 10.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a second example, consider how you might write a DSL for simplifying
one of your existing APIs. Maybe you need to put this code in front of
customers, business analysts or testers who might be not hard-core Java
developers. We’ll use the <code>Splitter</code> from the Google
<a href="https://github.com/google/guava">Guava libraries</a> project as it
already has a nice Fluent API. Here is how we might use it out of the
box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('com.google.guava:guava:r09')
import com.google.common.base.*
def result = Splitter.on(',').trimResults(CharMatcher.is('_' as char)).split("_a ,_b_ ,c__").iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>It reads fairly well for a Java developer but if that is not your target
audience or you have many such statements to write, it could be
considered a little verbose. Again, there are many options for writing a
DSL. We’ll keep it simple with Maps and Closures. We’ll first write a
helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('com.google.guava:guava:r09')
import com.google.common.base.*
def split(string) {
  [on: { sep -&gt;
    [trimming: { trimChar -&gt;
      Splitter.on(sep).trimResults(CharMatcher.is(trimChar as char)).split(string).iterator().toList()
    }]
  }]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>now instead of this line from our original example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = Splitter.on(',').trimResults(CharMatcher.is('_' as char)).split("_a ,_b_ ,c__").iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = split "_a ,_b_ ,c__" on ',' trimming '_\'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_overloading"><a class="anchor" href="#_operator_overloading"></a><a class="link" href="#_operator_overloading">3.21.2. Operator overloading</a></h4>
<div class="paragraph">
<p>Various operators in Groovy are mapped onto regular method calls on objects.</p>
</div>
<div class="paragraph">
<p>This allows you to provide your own Java or Groovy objects which can take advantage of operator overloading. The following table describes the operators supported in Groovy and the methods they map to.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a + b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a - b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a * b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ** b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a / b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a % b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a | b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &amp; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ^ b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a++</code> or <code>++a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a--</code> or <code>--a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;&lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShiftUnsigned(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>switch(a) { case(b) : }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b.isCase(a)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>if(a)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asBoolean()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a as b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asType(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a == b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a != b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">! a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;=&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt;= 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a \&lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt;= 0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_script_base_classes"><a class="anchor" href="#_script_base_classes"></a><a class="link" href="#_script_base_classes">3.21.3. Script base classes</a></h4>
<div class="sect4">
<h5 id="_the_script_class"><a class="anchor" href="#_the_script_class"></a><a class="link" href="#_the_script_class">The Script class</a></h5>
<div class="paragraph">
<p>Groovy scripts are always compiled to classes. For example, a script as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println 'Hello from Groovy'</code></pre>
</div>
</div>
<div class="paragraph">
<p>is compiled to a class extending the abstract <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/Script.html">groovy.lang.Script</a> class. This class contains a single abstract
method called <em>run</em>. When a script is compiled, then its body will become the <em>run</em> method, while the other methods
found in the script are found in the implementing class. The <code>Script</code> class provides base support for integration
with your application through the <code>Binding</code> object, as illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def binding = new Binding()             <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(binding)    <i class="conum" data-value="2"></i><b>(2)</b>
binding.setVariable('x',1)              <i class="conum" data-value="3"></i><b>(3)</b>
binding.setVariable('y',3)
shell.evaluate 'z=2*x+y'                <i class="conum" data-value="4"></i><b>(4)</b>
assert binding.getVariable('z') == 5    <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a binding is used to share data between the script and the calling class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>GroovyShell</code> can be used with this binding</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>input variables are set from the calling class inside the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then the script is evaluated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and the <code>z</code> variable has been "exported" into the binding</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a very practical way to share data between the caller and the script, however it may be insufficient or not
practical in some cases. For that purpose, Groovy allows you to set your own base script class. A base script class
has to extend <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/Script.html">groovy.lang.Script</a> and be a single abstract method type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class MyBaseClass extends Script {
    String name
    public void greet() { println "Hello, $name!" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the custom script base class can be declared in the compiler configuration, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def config = new CompilerConfiguration()                                <i class="conum" data-value="1"></i><b>(1)</b>
config.scriptBaseClass = 'MyBaseClass'                                  <i class="conum" data-value="2"></i><b>(2)</b>
def shell = new GroovyShell(this.class.classLoader, config)             <i class="conum" data-value="3"></i><b>(3)</b>
shell.evaluate """
    setName 'Judith'                                                    <i class="conum" data-value="4"></i><b>(4)</b>
    greet()
"""</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a custom compiler configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the base script class to our custom base script class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then create a <code>GroovyShell</code> using that configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the script will then extend the base script class, giving direct access to the <code>name</code> property and <code>greet</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="dsl-basescript"><a class="anchor" href="#dsl-basescript"></a><a class="link" href="#dsl-basescript">The @BaseScript annotation</a></h5>
<div class="paragraph">
<p>As an alternative, it is also possible to use the <code>@BaseScript</code> annotation directly into a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.transform.BaseScript

@BaseScript MyBaseClass baseScript
setName 'Judith'
greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>@BaseScript</code> should annotate a variable which type is the class of the base script. Alternatively, you can set
the base script class as a member of the <code>@BaseScript</code> annotation itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@BaseScript(MyBaseClass)
import groovy.transform.BaseScript

setName 'Judith'
greet()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_alternate_abstract_method"><a class="anchor" href="#_alternate_abstract_method"></a><a class="link" href="#_alternate_abstract_method">Alternate abstract method</a></h5>
<div class="paragraph">
<p>We have seen that the base script class is a single abstract method type that needs to implement the <code>run</code> method. The
<code>run</code> method is executed by the script engine automatically. In some circumstances it may be interesting to have a base
class which implements the <code>run</code> method, but provides an alternative abstract method to be used for the script body.
For example, the base script <code>run</code> method might perform some initialization before the <code>run</code> method is executed. This
is possible by doing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class MyBaseClass extends Script {
    int count
    abstract void scriptBody()                              <i class="conum" data-value="1"></i><b>(1)</b>
    def run() {
        count++                                             <i class="conum" data-value="2"></i><b>(2)</b>
        scriptBody()                                        <i class="conum" data-value="3"></i><b>(3)</b>
        count                                               <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the base script class should define one (and only one) abstract method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>run</code> method can be overridden and perform a task before executing the script body</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>run</code> calls the abstract <code>scriptBody</code> method which will delegate to the user script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then it can return something else than the value from the script</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you execute this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def result = shell.evaluate """
    println 'Ok'
"""
assert result == 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you will see that the script is executed, but the result of the evaluation is <code>1</code> as returned by the <code>run</code>
method of the base class. It is even clearer if you use <code>parse</code> instead of <code>evaluate</code>, because it would allow you to
execute the <code>run</code> method several times on the same script instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def script = shell.parse("println 'Ok'")
assert script.run() == 1
assert script.run() == 2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_properties_to_numbers"><a class="anchor" href="#_adding_properties_to_numbers"></a><a class="link" href="#_adding_properties_to_numbers">3.21.4. Adding properties to numbers</a></h4>
<div class="paragraph">
<p>In Groovy number types are considered equal to any other types. As such, it is possible to enhance numbers by adding
properties or methods to them. This can be very handy when dealing with measurable quantities for example. Details about
how existing classes can be enhanced in Groovy are found in the <a href="core-metaprogramming.html#_extension_modules">extension
modules</a> section or the <a href="core-metaprogramming.html#categories">categories</a> section.</p>
</div>
<div class="paragraph">
<p>An illustration of this can be found in Groovy using the <code>TimeCategory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">use(TimeCategory)  {
    println 1.minute.from.now       <i class="conum" data-value="1"></i><b>(1)</b>
    println 10.hours.ago

    def someDate = new Date()       <i class="conum" data-value="2"></i><b>(2)</b>
    println someDate - 3.months
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using the <code>TimeCategory</code>, a property <code>minute</code> is added to the <code>Integer</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>similarly, the <code>months</code> method returns a <code>groovy.time.DatumDependentDuration</code> which can be used in calculus</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Categories are lexically bound, making them a great fit for internal DSLs.</p>
</div>
</div>
<div class="sect3">
<h4 id="section-delegatesto"><a class="anchor" href="#section-delegatesto"></a><a class="link" href="#section-delegatesto">3.21.5. @DelegatesTo</a></h4>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DSLsmadeeasy"><a class="anchor" href="#TheDelegatesToannotation-DSLsmadeeasy"></a><a class="link" href="#TheDelegatesToannotation-DSLsmadeeasy">Explaining delegation strategy at compile time</a></h5>
<div class="paragraph">
<p><code>@groovy.lang.DelegatesTo</code> is a documentation and compile-time annotation aimed at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>documenting APIs that use closures as arguments</p>
</li>
<li>
<p>providing type information for the static type checker and compiler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy language is a platform of choice for building DSLs. Using
closures, it’s quite easy to create custom control structures, as well
as it is simple to create builders. Imagine that you have the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">email {
    from 'dsl-guru@mycompany.com'
    to 'john.doe@waitaminute.com'
    subject 'The pope has resigned!'
    body {
        p 'Really, the pope has resigned!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One way of implementing this is using the builder strategy, which
implies a method, named <code>email</code> which accepts a closure as an argument.
The method may delegate subsequent calls to an object that implements
the <code>from</code>, <code>to</code>, <code>subject</code> and <code>body</code> methods. Again, <code>body</code> is a
method which accepts a closure as an argument and that uses the builder
strategy.</p>
</div>
<div class="paragraph">
<p>Implementing such a builder is usually done the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def email(Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>EmailSpec</code> class implements the <code>from</code>, <code>to</code>, … methods. By
calling <code>rehydrate</code>, we’re creating a copy of the closure for which we
set the <code>delegate</code>, <code>owner</code> and <code>thisObject</code> values. Setting the owner
and the <code>this</code> object is not very important here since we will use the
<code>DELEGATE_ONLY</code> strategy which says that the method calls will be
resolved only against the delegate of the closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class EmailSpec {
    void from(String from) { println "From: $from"}
    void to(String... to) { println "To: $to"}
    void subject(String subject) { println "Subject: $subject"}
    void body(Closure body) {
        def bodySpec = new BodySpec()
        def code = body.rehydrate(bodySpec, this, this)
        code.resolveStrategy = Closure.DELEGATE_ONLY
        code()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EmailSpec</code> class has itself a <code>body</code> method accepting a closure that is cloned and executed. This is what
we call the builder pattern in Groovy.</p>
</div>
<div class="paragraph">
<p>One of the problems with the code that we’ve shown is that the user of
the <code>email</code> method doesn’t have any information about the methods that
he’s allowed to call inside the closure. The only possible information
is from the method documentation. There are two issues with this: first
of all, documentation is not always written, and if it is, it’s not
always available (javadoc not downloaded, for example). Second, it
doesn’t help IDEs. What would be really interesting, here, is for IDEs
to help the developer by suggesting, once they are in the closure body,
methods that exist on the <code>email</code> class.</p>
</div>
<div class="paragraph">
<p>Moreover, if the user calls a method in the closure which is not defined
by the <code>EmailSpec</code> class, the IDE should at least issue a warning (because
it’s very likely that it will break at runtime).</p>
</div>
<div class="paragraph">
<p>One more problem with the code above is that it is not compatible with static type checking. Type checking would let
the user know if a method call is authorized at compile time instead of runtime, but if you try to perform type
checking on this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">email {
    from 'dsl-guru@mycompany.com'
    to 'john.doe@waitaminute.com'
    subject 'The pope has resigned!'
    body {
        p 'Really, the pope has resigned!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the type checker will know that there’s an <code>email</code> method accepting
a <code>Closure</code>, but it will complain about every method call <strong>inside</strong> the
closure, because <code>from</code>, for example, is not a method which is defined
in the class. Indeed, it’s defined in the <code>EmailSpec</code> class and it has
absolutely no hint to help it knowing that the closure delegate will, at
runtime, be of type <code>EmailSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.TypeChecked
void sendEmail() {
    email {
        from 'dsl-guru@mycompany.com'
        to 'john.doe@waitaminute.com'
        subject 'The pope has resigned!'
        body {
            p 'Really, the pope has resigned!'
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will fail compilation with errors like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method MyScript#from(java.lang.String). Please check if the declared type is correct and if the method exists.
 @ line 31, column 21.
                       from 'dsl-guru@mycompany.com'</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DelegatesTo"><a class="anchor" href="#TheDelegatesToannotation-DelegatesTo"></a><a class="link" href="#TheDelegatesToannotation-DelegatesTo">@DelegatesTo</a></h5>
<div class="paragraph">
<p>For those reasons, Groovy 2.1 introduced a new annotation
named <code>@DelegatesTo</code>. The goal of this annotation is to solve both the
documentation issue, that will let your IDE know about the expected
methods in the closure body, and it will also solve the type checking
issue, by giving hints to the compiler about what are the potential
receivers of method calls in the closure body.</p>
</div>
<div class="paragraph">
<p>The idea is to annotate the <code>Closure</code> parameter of the <code>email</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def email(@DelegatesTo(EmailSpec) Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we’ve done here is telling the compiler (or the IDE) that when the
method will be called with a closure, the delegate of this closure will
be set to an object of type <code>email</code>. But there is still a problem: the
default delegation strategy is not the one which is used in our method.
So we will give more information and tell the compiler (or the IDE) that
the delegation strategy is also changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def email(@DelegatesTo(strategy=Closure.DELEGATE_ONLY, value=EmailSpec) Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, both the IDE and the type checker (if you are using <code>@TypeChecked</code>)
will be aware of the delegate and the delegation strategy. This is very
nice because it will both allow the IDE to provide smart completion, but
it will also remove errors at compile time that exist only because the
behaviour of the program is normally only known at runtime!</p>
</div>
<div class="paragraph">
<p>The following code will now pass compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TypeChecked
void doEmail() {
    email {
        from 'dsl-guru@mycompany.com'
        to 'john.doe@waitaminute.com'
        subject 'The pope has resigned!'
        body {
            p 'Really, the pope has resigned!'
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DelegatesTomodes"><a class="anchor" href="#TheDelegatesToannotation-DelegatesTomodes"></a><a class="link" href="#TheDelegatesToannotation-DelegatesTomodes">DelegatesTo modes</a></h5>
<div class="paragraph">
<p><code>@DelegatesTo</code> supports multiple modes that we will describe with examples
in this section.</p>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Simpledelegation"><a class="anchor" href="#TheDelegatesToannotation-Simpledelegation"></a><a class="link" href="#TheDelegatesToannotation-Simpledelegation">Simple delegation</a></h6>
<div class="paragraph">
<p>In this mode, the only mandatory parameter is the <em>value</em> which says to
which class we delegate calls. Nothing more. We’re telling the compiler
that the type of the delegate will <strong>always</strong> be of the type documented
by <code>@DelegatesTo</code> (note that it can be a subclass, but if it is, the
methods defined by the subclass will not be visible to the type
checker).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void body(@DelegatesTo(BodySpec) Closure cl) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Delegationstrategy"><a class="anchor" href="#TheDelegatesToannotation-Delegationstrategy"></a><a class="link" href="#TheDelegatesToannotation-Delegationstrategy">Delegation strategy</a></h6>
<div class="paragraph">
<p>In this mode, you must specify both the delegate class <strong>and</strong> a
delegation strategy. This must be used if the closure will not be called
with the default delegation strategy, which is <code>Closure.OWNER_FIRST</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void body(@DelegatesTo(strategy=Closure.DELEGATE_ONLY, value=BodySpec) Closure cl) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Delegatetoparameter"><a class="anchor" href="#TheDelegatesToannotation-Delegatetoparameter"></a><a class="link" href="#TheDelegatesToannotation-Delegatetoparameter">Delegate to parameter</a></h6>
<div class="paragraph">
<p>In this variant, we will tell the compiler that we are delegating to
another parameter of the method. Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def exec(Object target, Closure code) {
   def clone = code.rehydrate(target, this, this)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the delegate which will be used is <strong>not</strong> created inside the <code>exec</code>
method. In fact, we take an argument of the method and delegate to it.
Usage may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def email = new Email()
exec(email) {
   from '...'
   to '...'
   send()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the method calls are delegated to the <code>email</code> parameter. This is
a widely used pattern which is also supported by <code>@DelegatesTo</code> using a
companion annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def exec(@DelegatesTo.Target Object target, @DelegatesTo Closure code) {
   def clone = code.rehydrate(target, this, this)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A closure is annotated with <code>@DelegatesTo</code>, but this time, without
specifying any class. Instead, we’re annotating another parameter
with <code>@DelegatesTo.Target</code>. The type of the delegate is then determined
at compile time. One could think that we are using the parameter type,
which in this case is <code>Object</code> but this is not true. Take this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Greeter {
   void sayHello() { println 'Hello' }
}
def greeter = new Greeter()
exec(greeter) {
   sayHello()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that this works out of the box <strong>without</strong> having to annotate
with <code>@DelegatesTo</code>. However, to make the IDE aware of the delegate
type, or the <strong>type checker</strong> aware of it, we need to add <code>@DelegatesTo</code>.
And in this case, it will know that the <code>Greeter</code> variable is of
type <code>Greeter</code>, so it will not report errors on the <em>sayHello</em>
method <strong>even if the exec method doesn’t explicitly define the target as
of type Greeter</strong>. This is a very powerful feature, because it prevents
you from writing multiple versions of the same <code>exec</code> method for
different receiver types!</p>
</div>
<div class="paragraph">
<p>In this mode, the <code>@DelegatesTo</code> annotation also supports the <code>strategy</code>
parameter that we’ve described upper.</p>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Multipleclosures"><a class="anchor" href="#TheDelegatesToannotation-Multipleclosures"></a><a class="link" href="#TheDelegatesToannotation-Multipleclosures">Multiple closures</a></h6>
<div class="paragraph">
<p>In the previous example, the <code>exec</code> method accepted only one closure,
but you may have methods that take multiple closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void fooBarBaz(Closure foo, Closure bar, Closure baz) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then nothing prevents you from annotating each closure
with <code>@DelegatesTo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Foo { void foo(String msg) { println "Foo ${msg}!" } }
class Bar { void bar(int x) { println "Bar ${x}!" } }
class Baz { void baz(Date d) { println "Baz ${d}!" } }

void fooBarBaz(@DelegatesTo(Foo) Closure foo, @DelegatesTo(Bar) Closure bar, @DelegatesTo(Baz) Closure baz) {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But more importantly, if you have multiple closures <strong>and</strong> multiple
arguments, you can use several targets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void fooBarBaz(
    @DelegatesTo.Target('foo') foo,
    @DelegatesTo.Target('bar') bar,
    @DelegatesTo.Target('baz') baz,

    @DelegatesTo(target='foo') Closure cl1,
    @DelegatesTo(target='bar') Closure cl2,
    @DelegatesTo(target='baz') Closure cl3) {
    cl1.rehydrate(foo, this, this).call()
    cl2.rehydrate(bar, this, this).call()
    cl3.rehydrate(baz, this, this).call()
}

def a = new Foo()
def b = new Bar()
def c = new Baz()
fooBarBaz(
    a, b, c,
    { foo('Hello') },
    { bar(123) },
    { baz(new Date()) }
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this point, you may wonder why we don’t use the parameter names as
references. The reason is that the information (the parameter name) is
not always available (it’s a debug-only information), so it’s a
limitation of the JVM.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_delegating_to_a_generic_type"><a class="anchor" href="#_delegating_to_a_generic_type"></a><a class="link" href="#_delegating_to_a_generic_type">Delegating to a generic type</a></h6>
<div class="paragraph">
<p>In some situations, it is interesting to instruct the IDE or the compiler that the delegate type will not be a parameter
but a generic type. Imagine a configurator that runs on a list of elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public &lt;T&gt; void configure(List&lt;T&gt; elements, Closure configuration) {
   elements.each { e-&gt;
      def clone = configuration.rehydrate(e, this, this)
      clone.resolveStrategy = Closure.DELEGATE_FIRST
      clone.call()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this method can be called with any list like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@groovy.transform.ToString
class Realm {
   String name
}
List&lt;Realm&gt; list = []
3.times { list &lt;&lt; new Realm() }
configure(list) {
   name = 'My Realm'
}
assert list.every { it.name == 'My Realm' }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To let the type checker and the IDE know that the <code>configure</code> method calls the closure on each element of the list, you
 need to use <code>@DelegatesTo</code> differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">public &lt;T&gt; void configure(
    @DelegatesTo.Target List&lt;T&gt; elements,
    @DelegatesTo(strategy=Closure.DELEGATE_FIRST, genericTypeIndex=0) Closure configuration) {
   def clone = configuration.rehydrate(e, this, this)
   clone.resolveStrategy = Closure.DELEGATE_FIRST
   clone.call()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@DelegatesTo</code> takes an optional <code>genericTypeIndex</code> argument that tells what is the index of the generic type that will
be used as the delegate type. This <strong>must</strong> be used in conjunction with <code>@DelegatesTo.Target</code> and the index starts at 0. In
the example above, that means that the delegate type is resolved against <code>List&lt;T&gt;</code>, and since the generic type at index
0 is <code>T</code> and inferred as a <code>Realm</code>, the type checker infers that the delegate type will be of type <code>Realm</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We&#8217;re using a <code>genericTypeIndex</code> instead of a placeholder (<code>T</code>) because of JVM limitations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_delegating_to_an_arbitrary_type"><a class="anchor" href="#_delegating_to_an_arbitrary_type"></a><a class="link" href="#_delegating_to_an_arbitrary_type">Delegating to an arbitrary type</a></h6>
<div class="paragraph">
<p>It is possible that none of the options above can represent the type you want to delegate to. For example, let&#8217;s define
a mapper class which is parametrized with an object and defines a map method which returns an object of another type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Mapper&lt;T,U&gt; {                             <i class="conum" data-value="1"></i><b>(1)</b>
    final T value                               <i class="conum" data-value="2"></i><b>(2)</b>
    Mapper(T value) { this.value = value }
    U map(Closure&lt;U&gt; producer) {                <i class="conum" data-value="3"></i><b>(3)</b>
        producer.delegate = value
        producer()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The mapper class takes two generic type arguments: the source type and the target type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The source object is stored in a final field</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>map</code> method asks to convert the source object to a target object</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, the method signature from <code>map</code> does not give any information about what object will
be manipulated by the closure. Reading the method body, we know that it will be the <code>value</code> which is
of type <code>T</code>, but <code>T</code> is not found in the method signature, so we are facing a case where none of the
available options for <code>@DelegatesTo</code> is suitable. For example, if we try to statically compile this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def mapper = new Mapper&lt;String,Integer&gt;('Hello')
assert mapper.map { length() } == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the compiler will fail with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Static type checking] - Cannot find matching method TestScript0#length()</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, you can use the <code>type</code> member of the <code>@DelegatesTo</code> annotation to reference <code>T</code> as a type token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Mapper&lt;T,U&gt; {
    final T value
    Mapper(T value) { this.value = value }
    U map(@DelegatesTo(type="T") Closure&lt;U&gt; producer) {  <i class="conum" data-value="1"></i><b>(1)</b>
        producer.delegate = value
        producer()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@DelegatesTo</code> annotation references a generic type which is not found in the method signature</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that you are not limited to generic type tokens. The <code>type</code> member can be used to represent complex types, such
as <code>List&lt;T&gt;</code> or <code>Map&lt;T,List&lt;U&gt;&gt;</code>. The reason why you should use that in last resort is that the type is only checked
when the type checker finds usage of <code>@DelegatesTo</code>, not when the annotated method itself is compiled. This means that
type safety is only ensured at the call site. Additionally, compilation will be slower (though probably unnoticeable for
most cases).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compilation-customizers"><a class="anchor" href="#compilation-customizers"></a><a class="link" href="#compilation-customizers">3.21.6. Compilation customizers</a></h4>
<div class="sect4">
<h5 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a><a class="link" href="#_introduction_5">Introduction</a></h5>
<div class="paragraph">
<p>Whether you are using <code>groovyc</code> to compile classes or a <code>GroovyShell</code>,
for example, to execute scripts, under the hood, a <em>compiler configuration</em> is used. This configuration holds information
like the source encoding or the classpath but it can also be used to perform more operations like adding imports by
default, applying AST transformations transparently or disabling global AST transformations.</p>
</div>
<div class="paragraph">
<p>The goal of compilation customizers is to make those common tasks easy to implement. For that, the <code>CompilerConfiguration</code>
class is the entry point. The general schema will always be based on the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.CompilerConfiguration
// create a configuration
def config = new CompilerConfiguration()
// tweak the configuration
config.addCompilationCustomizers(...)
// run your script
def shell = new GroovyShell(config)
shell.evaluate(script)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compilation customizers must extend the <em>org.codehaus.groovy.control.customizers.CompilationCustomizer</em> class. A customizer works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on a specific compilation phase</p>
</li>
<li>
<p>on <em>every</em> class node being compiled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can implement your own compilation customizer but Groovy includes some of the most common operations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_import_customizer"><a class="anchor" href="#_import_customizer"></a><a class="link" href="#_import_customizer">Import customizer</a></h5>
<div class="paragraph">
<p>Using this compilation customizer, your code will have imports added
transparently. This is in particular useful for scripts implementing a
DSL where you want to avoid users from having to write imports. The
import customizer will let you add all the variants of imports the
Groovy language allows, that is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class imports, optionally aliased</p>
</li>
<li>
<p>star imports</p>
</li>
<li>
<p>static imports, optionally aliased</p>
</li>
<li>
<p>static star imports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.customizers.ImportCustomizer

def icz = new ImportCustomizer()
// "normal" import
icz.addImports('java.util.concurrent.atomic.AtomicInteger', 'java.util.concurrent.ConcurrentHashMap')
// "aliases" import
icz.addImport('CHM', 'java.util.concurrent.ConcurrentHashMap')
// "static" import
icz.addStaticImport('java.lang.Math', 'PI') // import static java.lang.Math.PI
// "aliased static" import
icz.addStaticImport('pi', 'java.lang.Math', 'PI') // import static java.lang.Math.PI as pi
// "star" import
icz.addStarImports 'java.util.concurrent' // import java.util.concurrent.*
// "static star" import
icz.addStaticStars 'java.lang.Math' // import static java.lang.Math.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>A detailed description of all shortcuts can be found in <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/ImportCustomizer.html">org.codehaus.groovy.control.customizers.ImportCustomizer</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_ast_transformation_customizer"><a class="anchor" href="#_ast_transformation_customizer"></a><a class="link" href="#_ast_transformation_customizer">AST transformation customizer</a></h5>
<div class="paragraph">
<p>The AST transformation customizer is meant to apply AST transformations
transparently. Unlike global AST transformations that apply on every
class being compiled as long as the transform is found on classpath
(which has drawbacks like increasing the compilation time or side
effects due to transformations applied where they should not), the
customizer will allow you to selectively apply a transform only for
specific scripts or classes.</p>
</div>
<div class="paragraph">
<p>As an example, let’s say you want to be able to use <code>@Log</code> in a script.
The problem is that <code>@Log</code> is normally applied on a class node and a
script, by definition, doesn’t require one. But implementation wise,
scripts are classes, it’s just that you cannot annotate this implicit
class node with <code>@Log</code>. Using the AST customizer, you have a workaround
to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.customizers.ASTTransformationCustomizer
import groovy.util.logging.Log

def acz = new ASTTransformationCustomizer(Log)
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all! Internally, the <code>@Log</code> AST transformation is applied to
every class node in the compilation unit. This means that it will be
applied to the script, but also to classes defined within the script.</p>
</div>
<div class="paragraph">
<p>If the AST transformation that you are using accepts parameters, you can
use parameters in the constructor too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def acz = new ASTTransformationCustomizer(Log, value: 'LOGGER')
// use name 'LOGGER' instead of the default 'log'
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the AST transformation customizers works with objects instead of AST
nodes, not all values can be converted to AST transformation parameters.
For example, primitive types are converted to <code>ConstantExpression</code> (that
is <code>LOGGER</code> is converted to <code>new ConstantExpression('LOGGER')</code>, but if
your AST transformation takes a closure as an argument, then you have to
give it a <code>ClosureExpression</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def configuration = new CompilerConfiguration()
def expression = new AstBuilder().buildFromCode(CompilePhase.CONVERSION) { -&gt; true }.expression[0]
def customizer = new ASTTransformationCustomizer(ConditionalInterrupt, value: expression, thrown: SecurityException)
configuration.addCompilationCustomizers(customizer)
def shell = new GroovyShell(configuration)
shouldFail(SecurityException) {
    shell.evaluate("""
        // equivalent to adding @ConditionalInterrupt(value={true}, thrown: SecurityException)
        class MyClass {
            void doIt() { }
        }
        new MyClass().doIt()
    """)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of options, please refer to <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html">org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_secure_ast_customizer"><a class="anchor" href="#_secure_ast_customizer"></a><a class="link" href="#_secure_ast_customizer">Secure AST customizer</a></h5>
<div class="paragraph">
<p>This customizer will allow the developer of a DSL to restrict the
<strong>grammar</strong> of the language, for example, to prevent users from using particular constructs.
It is only ``secure'' in that one aspect, i.e. limiting the allowable constructs within a DSL.
It does <strong>not</strong> replace a security manager which might additionally
be needed as an orthogonal aspect of overall security.
The only reason for it to exist is to limit the expressiveness of the
language. This customizer only works at the AST (abstract syntax tree)
level, not at runtime! It can be strange at first glance, but it makes
much more sense if you think of Groovy as a platform to build DSLs. You
may not want a user to have a complete language at hand. In the example
below, we will demonstrate it using an example of language that only
allows arithmetic operations, but this customizer allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow/disallow creation of closures</p>
</li>
<li>
<p>allow/disallow imports</p>
</li>
<li>
<p>allow/disallow package definition</p>
</li>
<li>
<p>allow/disallow definition of methods</p>
</li>
<li>
<p>restrict the receivers of method calls</p>
</li>
<li>
<p>restrict the kind of AST expressions a user can use</p>
</li>
<li>
<p>restrict the tokens (grammar-wise) a user can use</p>
</li>
<li>
<p>restrict the types of the constants that can be used in code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For all those features, the secure AST customizer works using either an
allowed list (list of elements that are permitted) <strong>or</strong> a disallowed list (list of
elements that are not permitted). For each type of feature (imports,
tokens, …) you have the choice to use either an allowed or disallowed list,
but you can mix dis/allowed lists for distinct features. Typically,
you will choose allowed lists (which permits only the constructs listed and disallows all others).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.customizers.SecureASTCustomizer
import static org.codehaus.groovy.syntax.Types.* <i class="conum" data-value="1"></i><b>(1)</b>

def scz = new SecureASTCustomizer()
scz.with {
    closuresAllowed = false // user will not be able to write closures
    methodDefinitionAllowed = false // user will not be able to define methods
    allowedImports = [] // empty allowed list means imports are disallowed
    allowedStaticImports = [] // same for static imports
    allowedStaticStarImports = ['java.lang.Math'] // only java.lang.Math is allowed
    // the list of tokens the user can find
    // constants are defined in org.codehaus.groovy.syntax.Types
    allowedTokens = [ <i class="conum" data-value="1"></i><b>(1)</b>
            PLUS,
            MINUS,
            MULTIPLY,
            DIVIDE,
            MOD,
            POWER,
            PLUS_PLUS,
            MINUS_MINUS,
            COMPARE_EQUAL,
            COMPARE_NOT_EQUAL,
            COMPARE_LESS_THAN,
            COMPARE_LESS_THAN_EQUAL,
            COMPARE_GREATER_THAN,
            COMPARE_GREATER_THAN_EQUAL,
    ].asImmutable()
    // limit the types of constants that a user can define to number types only
    allowedConstantTypesClasses = [ <i class="conum" data-value="2"></i><b>(2)</b>
            Integer,
            Float,
            Long,
            Double,
            BigDecimal,
            Integer.TYPE,
            Long.TYPE,
            Float.TYPE,
            Double.TYPE
    ].asImmutable()
    // method calls are only allowed if the receiver is of one of those types
    // be careful, it's not a runtime type!
    allowedReceiversClasses = [ <i class="conum" data-value="2"></i><b>(2)</b>
            Math,
            Integer,
            Float,
            Double,
            Long,
            BigDecimal
    ].asImmutable()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use for token types from <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/syntax/Types.html">org.codehaus.groovy.syntax.Types</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you can use class literals here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If what the secure AST customizer provides out of the box isn’t enough
for your needs, before creating your own compilation customizer, you
might be interested in the expression and statement checkers that the
AST customizer supports. Basically, it allows you to add custom checks
on the AST tree, on expressions (expression checkers) or statements
(statement checkers). For this, you must
implement <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</code>
or <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</code>.</p>
</div>
<div class="paragraph">
<p>Those interfaces define a single method called <code>isAuthorized</code>, returning
a boolean, and taking a <code>Statement</code> (or <code>Expression</code>) as a parameter. It
allows you to perform complex logic over expressions or statements to
tell if a user is allowed to do it or not.</p>
</div>
<div class="paragraph">
<p>For example, there&#8217;s no predefined configuration flag in the customizer which
will let you prevent people from using an attribute expression. Using a custom
checker, it is trivial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def scz = new SecureASTCustomizer()
def checker = { expr -&gt;
    !(expr instanceof AttributeExpression)
} as SecureASTCustomizer.ExpressionChecker
scz.addExpressionCheckers(checker)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can make sure that this works by evaluating a simple script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new GroovyShell(config).evaluate '''
    class A {
        int val
    }

    def a = new A(val: 123)
    a.@val <i class="conum" data-value="1"></i><b>(1)</b>
'''</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will fail compilation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Statements can be checked using <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/StatementChecker.html">org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</a>
Expressions can be checked using <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/ExpressionChecker.html">org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_source_aware_customizer"><a class="anchor" href="#_source_aware_customizer"></a><a class="link" href="#_source_aware_customizer">Source aware customizer</a></h5>
<div class="paragraph">
<p>This customizer may be used as a filter on other customizers. The
filter, in that case, is the <code>org.codehaus.groovy.control.SourceUnit</code>.
For this, the source aware customizer takes another customizer as a
delegate, and it will apply customization of that delegate only and only
if predicates on the source unit match.</p>
</div>
<div class="paragraph">
<p><code>SourceUnit</code> gives you access to multiple things but in particular the
file being compiled (if compiling from a file, of course). It gives
you the potential to perform operation based on the file name, for
example. Here is how you would create a source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.customizers.SourceAwareCustomizer
import org.codehaus.groovy.control.customizers.ImportCustomizer

def delegate = new ImportCustomizer()
def sac = new SourceAwareCustomizer(delegate)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use predicates on the source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// the customizer will only be applied to classes contained in a file name ending with 'Bean'
sac.baseNameValidator = { baseName -&gt;
    baseName.endsWith 'Bean'
}

// the customizer will only be applied to files which extension is '.spec'
sac.extensionValidator = { ext -&gt; ext == 'spec' }

// source unit validation
// allow compilation only if the file contains at most 1 class
sac.sourceUnitValidator = { SourceUnit sourceUnit -&gt; sourceUnit.AST.classes.size() == 1 }

// class validation
// the customizer will only be applied to classes ending with 'Bean'
sac.classValidator = { ClassNode cn -&gt; cn.endsWith('Bean') }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizer_builder"><a class="anchor" href="#_customizer_builder"></a><a class="link" href="#_customizer_builder">Customizer builder</a></h5>
<div class="paragraph">
<p>If you are using compilation customizers in Groovy code (like the
examples above) then you can use an alternative syntax to customize compilation.
A builder (<code>org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder</code>)
simplifies the creation of customizers using a hierarchical DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.codehaus.groovy.control.CompilerConfiguration
import static org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder.withConfig <i class="conum" data-value="1"></i><b>(1)</b>

def conf = new CompilerConfiguration()
withConfig(conf) {
    // ... <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>static import of the builder method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>configuration goes here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code sample above shows how to use the builder. A static
method, <em>withConfig</em>, takes a closure corresponding to the builder code,
and automatically registers compilation customizers to the
configuration. Every compilation customizer available in the distribution
can be configured this way:</p>
</div>
<div class="sect5">
<h6 id="_import_customizer_2"><a class="anchor" href="#_import_customizer_2"></a><a class="link" href="#_import_customizer_2">Import customizer</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(configuration) {
   imports { // imports customizer
      normal 'my.package.MyClass' // a normal import
      alias 'AI', 'java.util.concurrent.atomic.AtomicInteger' // an aliased import
      star 'java.util.concurrent' // star imports
      staticMember 'java.lang.Math', 'PI' // static import
      staticMember 'pi', 'java.lang.Math', 'PI' // aliased static import
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ast_transformation_customizer_2"><a class="anchor" href="#_ast_transformation_customizer_2"></a><a class="link" href="#_ast_transformation_customizer_2">AST transformation customizer</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(conf) {
   ast(Log) <i class="conum" data-value="1"></i><b>(1)</b>
}

withConfig(conf) {
   ast(Log, value: 'LOGGER') <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply @Log transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply @Log with a different name for the logger</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_secure_ast_customizer_2"><a class="anchor" href="#_secure_ast_customizer_2"></a><a class="link" href="#_secure_ast_customizer_2">Secure AST customizer</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(conf) {
   secureAst {
       closuresAllowed = false
       methodDefinitionAllowed = false
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_source_aware_customizer_2"><a class="anchor" href="#_source_aware_customizer_2"></a><a class="link" href="#_source_aware_customizer_2">Source aware customizer</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(configuration){
    source(extension: 'sgroovy') {
        ast(CompileStatic) <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

withConfig(configuration){
    source(extensions: ['sgroovy','sg']) {
        ast(CompileStatic) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

withConfig(configuration) {
    source(extensionValidator: { it.name in ['sgroovy','sg']}) {
        ast(CompileStatic) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

withConfig(configuration) {
    source(basename: 'foo') {
        ast(CompileStatic) <i class="conum" data-value="3"></i><b>(3)</b>
    }
}

withConfig(configuration) {
    source(basenames: ['foo', 'bar']) {
        ast(CompileStatic) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}

withConfig(configuration) {
    source(basenameValidator: { it in ['foo', 'bar'] }) {
        ast(CompileStatic) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}

withConfig(configuration) {
    source(unitValidator: { unit -&gt; !unit.AST.classes.any { it.name == 'Baz' } }) {
        ast(CompileStatic) <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply CompileStatic AST annotation on .sgroovy files</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply CompileStatic AST annotation on .sgroovy or .sg files</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>apply CompileStatic AST annotation on files whose name is 'foo'</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>apply CompileStatic AST annotation on files whose name is 'foo' or 'bar'</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>apply CompileStatic AST annotation on files that do not contain a class named 'Baz'</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_inlining_a_customizer"><a class="anchor" href="#_inlining_a_customizer"></a><a class="link" href="#_inlining_a_customizer">Inlining a customizer</a></h6>
<div class="paragraph">
<p>Inlined customizer allows you to write a compilation customizer
directly, without having to create a class for it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(configuration) {
    inline(phase:'CONVERSION') { source, context, classNode -&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
        println "visiting $classNode"                           <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an inlined customizer which will execute at the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the name of the class node being compiled</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_customizers"><a class="anchor" href="#_multiple_customizers"></a><a class="link" href="#_multiple_customizers">Multiple customizers</a></h6>
<div class="paragraph">
<p>Of course, the builder allows you to define multiple customizers at
once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(configuration) {
   ast(ToString)
   ast(EqualsAndHashCode)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_configscript_commandline_parameter"><a class="anchor" href="#_the_configscript_commandline_parameter"></a><a class="link" href="#_the_configscript_commandline_parameter">The <code>configscript</code> commandline parameter</a></h5>
<div class="paragraph">
<p>So far, we have described how you can customize compilation using
a <code>CompilationConfiguration</code> class, but this is only possible if you
embed Groovy and that you create your own instances
of <code>CompilerConfiguration</code> (then use it to create a
<code>GroovyShell</code>, <code>GroovyScriptEngine</code>, …).</p>
</div>
<div class="paragraph">
<p>If you want it to be applied on the classes you compile with the normal
Groovy compiler (that is to say with <code>groovyc</code>, <code>ant</code> or <code>gradle</code>,
for example), it is possible to use a commandline parameter named <code>configscript</code>
that takes a Groovy configuration script as argument.</p>
</div>
<div class="paragraph">
<p>This script gives you access to the <code>CompilerConfiguration</code> instance <strong>before</strong>
the files are compiled (exposed into the configuration script as a variable named <code>configuration</code>),
so that you can tweak it.</p>
</div>
<div class="paragraph">
<p>It also transparently integrates the compiler configuration builder above. As an example, let&#8217;s see
how you would activate static compilation by default on all classes.</p>
</div>
<div class="sect5">
<h6 id="_configscript_example_static_compilation_by_default"><a class="anchor" href="#_configscript_example_static_compilation_by_default"></a><a class="link" href="#_configscript_example_static_compilation_by_default">Configscript example: Static compilation by default</a></h6>
<div class="paragraph">
<p>Normally, classes in Groovy are compiled with a dynamic runtime. You can activate static compilation
by placing an annotation named <code>@CompileStatic</code> on any class. Some people would like to have this
mode activated by default, that is to say not having to annotate (potentially many) classes.
Using <code>configscript</code>,  makes this possible.
First of all, you need to create a file named <code>config.groovy</code> into say <code>src/conf</code> with
the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withConfig(configuration) { <i class="conum" data-value="1"></i><b>(1)</b>
   ast(groovy.transform.CompileStatic)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>configuration</em> references a <code>CompilerConfiguration</code> instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That is actually all you need. You don’t have to import the builder, it’s automatically
exposed in the script. Then, compile your files using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc -configscript src/conf/config.groovy src/main/groovy/MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>We strongly recommend you to separate configuration files from classes,
hence why we suggest using the <code>src/main</code> and <code>src/conf</code> directories above.</p>
</div>
</div>
<div class="sect5">
<h6 id="_configscript_example_setting_system_properties"><a class="anchor" href="#_configscript_example_setting_system_properties"></a><a class="link" href="#_configscript_example_setting_system_properties">Configscript example: Setting system properties</a></h6>
<div class="paragraph">
<p>In a configuration script you can also set system properties, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">System.setProperty('spock.iKnowWhatImDoing.disableGroovyVersionCheck', 'true')</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have numerous system properties to set, then using a configuration file
will reduce the need to set a bunch of system properties with a long command line
or appropriately defined environment variable.
You can also share all the settings by simply sharing the config file.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ast_transformations"><a class="anchor" href="#_ast_transformations"></a><a class="link" href="#_ast_transformations">AST transformations</a></h5>
<div class="paragraph">
<p>If:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>runtime metaprogramming doesn&#8217;t allow you to do what you want</p>
</li>
<li>
<p>you need to improve the performance of the execution of your DSLs</p>
</li>
<li>
<p>you want to leverage the same syntax as Groovy but with different semantics</p>
</li>
<li>
<p>you want to improve support for type checking in your DSLs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then AST transformations are the way to go. Unlike the techniques used so far, AST transformations are meant to
change or generate code before it is compiled to bytecode. AST transformations are capable of adding new methods at
compile time for example, or totally changing the body of a method based on your needs. They are a very powerful tool
but also come at the price of not being easy to write. For more information about AST transformations, please take
a look at the <a href="https://docs.groovy-lang.org/latest/html/documentation/index.html#_compile_time_metaprogramming">compile-time
metaprogramming</a> section of this manual.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_type_checking_extensions"><a class="anchor" href="#_custom_type_checking_extensions"></a><a class="link" href="#_custom_type_checking_extensions">3.21.7. Custom type checking extensions</a></h4>
<div class="paragraph">
<p>It may be interesting, in some circumstances, to provide feedback about wrong code to the user as soon as possible,
that is to say when the DSL script is compiled, rather than having to wait for the execution of the script. However,
this is not often possible with dynamic code. Groovy actually provides a practical answer to this known as
<a href="type-checking-extensions.html">type checking extensions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_builders_4"><a class="anchor" href="#_builders_4"></a><a class="link" href="#_builders_4">3.21.8. Builders</a></h4>
<div class="paragraph">
<p>Many tasks require building things and the builder pattern is one technique
used by developers to make building things easier, especially building
of structures which are hierarchical in nature.
This pattern is so ubiquitous that Groovy has special built-in support.
Firstly, there are many built-in builders. Secondly, there are
classes which make it easier to write your own builders.</p>
</div>
<div class="sect4">
<h5 id="_existing_builders"><a class="anchor" href="#_existing_builders"></a><a class="link" href="#_existing_builders">Existing builders</a></h5>
<div class="paragraph">
<p>Groovy comes with many built-in builders. Let&#8217;s look at some of them.</p>
</div>
<div class="sect5">
<h6 id="_markupbuilder_2"><a class="anchor" href="#_markupbuilder_2"></a><a class="link" href="#_markupbuilder_2">MarkupBuilder</a></h6>
<div class="paragraph">
<p>See <a href="#_markupbuilder">Creating Xml - MarkupBuilder</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_streamingmarkupbuilder_2"><a class="anchor" href="#_streamingmarkupbuilder_2"></a><a class="link" href="#_streamingmarkupbuilder_2">StreamingMarkupBuilder</a></h6>
<div class="paragraph">
<p>See <a href="#_streamingmarkupbuilder">Creating Xml - StreamingMarkupBuilder</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_saxbuilder"><a class="anchor" href="#_saxbuilder"></a><a class="link" href="#_saxbuilder">SaxBuilder</a></h6>
<div class="paragraph">
<p>A builder for generating <a href="https://en.wikipedia.org/wiki/Simple_API_for_XML">Simple API for XML (SAX)</a> events.</p>
</div>
<div class="paragraph">
<p>If you have the following SAX handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class LogHandler extends org.xml.sax.helpers.DefaultHandler {

    String log = ''

    void startElement(String uri, String localName, String qName, org.xml.sax.Attributes attributes) {
        log += "Start Element: $localName, "
    }

    void endElement(String uri, String localName, String qName) {
        log += "End Element: $localName, "
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>SaxBuilder</code> to generate SAX events for the handler like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def handler = new LogHandler()
def builder = new groovy.xml.SAXBuilder(handler)

builder.root() {
    helloWorld()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then check that everything worked as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert handler.log == 'Start Element: root, Start Element: helloWorld, End Element: helloWorld, End Element: root, '</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_staxbuilder"><a class="anchor" href="#_staxbuilder"></a><a class="link" href="#_staxbuilder">StaxBuilder</a></h6>
<div class="paragraph">
<p>A Groovy builder that works with <a href="https://en.wikipedia.org/wiki/StAX">Streaming API for XML (StAX)</a> processors.</p>
</div>
<div class="paragraph">
<p>Here is a simple example using the StAX implementation of Java to generate XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def factory = javax.xml.stream.XMLOutputFactory.newInstance()
def writer = new StringWriter()
def builder = new groovy.xml.StaxBuilder(factory.createXMLStreamWriter(writer))

builder.root(attribute:1) {
    elem1('hello')
    elem2('world')
}

assert writer.toString() == '&lt;?xml version="1.0" ?&gt;&lt;root attribute="1"&gt;&lt;elem1&gt;hello&lt;/elem1&gt;&lt;elem2&gt;world&lt;/elem2&gt;&lt;/root&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p>An external library such as <a href="https://github.com/jettison-json/jettison">Jettison</a> can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.codehaus.jettison:jettison:1.3.3')
@GrabExclude('stax:stax-api') // part of Java 6 and later
import org.codehaus.jettison.mapped.*

def writer = new StringWriter()
def mappedWriter = new MappedXMLStreamWriter(new MappedNamespaceConvention(), writer)
def builder = new groovy.xml.StaxBuilder(mappedWriter)

builder.root(attribute:1) {
     elem1('hello')
     elem2('world')
}

assert writer.toString() == '{"root":{"@attribute":"1","elem1":"hello","elem2":"world"}}'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dombuilder"><a class="anchor" href="#_dombuilder"></a><a class="link" href="#_dombuilder">DOMBuilder</a></h6>
<div class="paragraph">
<p>A builder for parsing HTML, XHTML and XML into a <a href="https://en.wikipedia.org/wiki/Document_Object_Model">W3C DOM</a> tree.</p>
</div>
<div class="paragraph">
<p>For example this XML <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String recordsXML = '''
    &lt;records&gt;
      &lt;car name='HSV Maloo' make='Holden' year='2006'&gt;
        &lt;country&gt;Australia&lt;/country&gt;
        &lt;record type='speed'&gt;Production Pickup Truck with speed of 271kph&lt;/record&gt;
      &lt;/car&gt;
      &lt;car name='P50' make='Peel' year='1962'&gt;
        &lt;country&gt;Isle of Man&lt;/country&gt;
        &lt;record type='size'&gt;Smallest Street-Legal Car at 99cm wide and 59 kg in weight&lt;/record&gt;
      &lt;/car&gt;
      &lt;car name='Royale' make='Bugatti' year='1931'&gt;
        &lt;country&gt;France&lt;/country&gt;
        &lt;record type='price'&gt;Most Valuable Car at $15 million&lt;/record&gt;
      &lt;/car&gt;
    &lt;/records&gt;'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be parsed into a DOM tree with a <code>DOMBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def reader = new StringReader(recordsXML)
def doc = groovy.xml.DOMBuilder.parse(reader)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then processed further e.g. by using <a href="#_domcategory">DOMCategory</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def records = doc.documentElement
use(groovy.xml.dom.DOMCategory) {
    assert records.car.size() == 3
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_nodebuilder"><a class="anchor" href="#_nodebuilder"></a><a class="link" href="#_nodebuilder">NodeBuilder</a></h6>
<div class="paragraph">
<p><code>NodeBuilder</code> is used for creating nested trees of <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/util/Node.html">groovy.util.Node</a> objects for handling arbitrary data.
To create a simple user list you use a <code>NodeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nodeBuilder = new NodeBuilder()
def userlist = nodeBuilder.userlist {
    user(id: '1', firstname: 'John', lastname: 'Smith') {
        address(type: 'home', street: '1 Main St.', city: 'Springfield', state: 'MA', zip: '12345')
        address(type: 'work', street: '2 South St.', city: 'Boston', state: 'MA', zip: '98765')
    }
    user(id: '2', firstname: 'Alice', lastname: 'Doe')
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can process the data further, e.g. by using <a href="#gpath_expressions">GPath expressions</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert userlist.user.@firstname.join(', ') == 'John, Alice'
assert userlist.user.find { it.@lastname == 'Smith' }.address.size() == 2</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jsonbuilder"><a class="anchor" href="#_jsonbuilder"></a><a class="link" href="#_jsonbuilder">JsonBuilder</a></h6>
<div class="paragraph">
<p>Groovy&#8217;s <code>JsonBuilder</code> makes it easy to create Json. For example to create this Json string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String carRecords = '''
    {
        "records": {
        "car": {
            "name": "HSV Maloo",
            "make": "Holden",
            "year": 2006,
            "country": "Australia",
            "record": {
              "type": "speed",
              "description": "production pickup truck with speed of 271kph"
            }
          }
      }
    }
'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can use a <code>JsonBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">JsonBuilder builder = new JsonBuilder()
builder.records {
  car {
        name 'HSV Maloo'
        make 'Holden'
        year 2006
        country 'Australia'
        record {
            type 'speed'
            description 'production pickup truck with speed of 271kph'
        }
  }
}
String json = JsonOutput.prettyPrint(builder.toString())</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <a href="https://github.com/lukas-krecan/JsonUnit">JsonUnit</a> to check that the builder produced the expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">JsonAssert.assertJsonEquals(json, carRecords)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to customize the generated output you can pass a <code>JsonGenerator</code> instance when creating a <code>JsonBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.json.*

def generator = new JsonGenerator.Options()
        .excludeNulls()
        .excludeFieldsByName('make', 'country', 'record')
        .excludeFieldsByType(Number)
        .addConverter(URL) { url -&gt; "http://groovy-lang.org" }
        .build()

JsonBuilder builder = new JsonBuilder(generator)
builder.records {
  car {
        name 'HSV Maloo'
        make 'Holden'
        year 2006
        country 'Australia'
        homepage new URL('http://example.org')
        record {
            type 'speed'
            description 'production pickup truck with speed of 271kph'
        }
  }
}

assert builder.toString() == '{"records":{"car":{"name":"HSV Maloo","homepage":"http://groovy-lang.org"}}}'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_streamingjsonbuilder"><a class="anchor" href="#_streamingjsonbuilder"></a><a class="link" href="#_streamingjsonbuilder">StreamingJsonBuilder</a></h6>
<div class="paragraph">
<p>Unlike <code>JsonBuilder</code> which creates a data structure in memory, which is handy in those situations where you want to alter the structure programmatically before output,
<code>StreamingJsonBuilder</code> directly streams to a writer without any intermediate memory data structure.
If you do not need to modify the structure and want a more memory-efficient approach, use <code>StreamingJsonBuilder</code>.</p>
</div>
<div class="paragraph">
<p>The usage of <code>StreamingJsonBuilder</code> is similar to <code>JsonBuilder</code>. In order to create this Json string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String carRecords = """
    {
      "records": {
        "car": {
          "name": "HSV Maloo",
          "make": "Holden",
          "year": 2006,
          "country": "Australia",
          "record": {
            "type": "speed",
            "description": "production pickup truck with speed of 271kph"
          }
        }
      }
    }
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>you use a <code>StreamingJsonBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">StringWriter writer = new StringWriter()
StreamingJsonBuilder builder = new StreamingJsonBuilder(writer)
builder.records {
    car {
        name 'HSV Maloo'
        make 'Holden'
        year 2006
        country 'Australia'
        record {
            type 'speed'
            description 'production pickup truck with speed of 271kph'
        }
    }
}
String json = JsonOutput.prettyPrint(writer.toString())</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <a href="https://github.com/lukas-krecan/JsonUnit">JsonUnit</a> to check the expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">JsonAssert.assertJsonEquals(json, carRecords)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to customize the generated output you can pass a <code>JsonGenerator</code> instance when creating a <code>StreamingJsonBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def generator = new JsonGenerator.Options()
        .excludeNulls()
        .excludeFieldsByName('make', 'country', 'record')
        .excludeFieldsByType(Number)
        .addConverter(URL) { url -&gt; "http://groovy-lang.org" }
        .build()

StringWriter writer = new StringWriter()
StreamingJsonBuilder builder = new StreamingJsonBuilder(writer, generator)

builder.records {
    car {
        name 'HSV Maloo'
        make 'Holden'
        year 2006
        country 'Australia'
        homepage new URL('http://example.org')
        record {
            type 'speed'
            description 'production pickup truck with speed of 271kph'
        }
    }
}

assert writer.toString() == '{"records":{"car":{"name":"HSV Maloo","homepage":"http://groovy-lang.org"}}}'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="swingbuilder"><a class="anchor" href="#swingbuilder"></a><a class="link" href="#swingbuilder">SwingBuilder</a></h6>
<div class="paragraph">
<p><code>SwingBuilder</code> allows you to create full-fledged Swing GUIs in a declarative and concise fashion. It accomplishes this by employing a common idiom in Groovy, builders.
Builders handle the busywork of creating complex objects for you, such as instantiating children, calling Swing methods, and attaching these children to their parents.
As a consequence, your code is much more readable and maintainable, while still allowing you to access to the full range of Swing components.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of using <code>SwingBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.swing.SwingBuilder
import java.awt.BorderLayout as BL

count = 0
new SwingBuilder().edt {
  frame(title: 'Frame', size: [250, 75], show: true) {
    borderLayout()
    textlabel = label(text: 'Click the button!', constraints: BL.NORTH)
    button(text:'Click Me',
         actionPerformed: {count++; textlabel.text = "Clicked ${count} time(s)."; println "clicked"}, constraints:BL.SOUTH)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what it will look like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./assets/img/SwingBuilder001.png" alt="SwingBuilder001"></span></p>
</div>
<div class="paragraph">
<p>This hierarchy of components would normally be created through a series of repetitive instantiations, setters, and finally attaching this child to its respective parent.
Using <code>SwingBuilder</code>, however, allows you to define this hierarchy in its native form, which makes the interface design understandable simply by reading the code.</p>
</div>
<div class="paragraph">
<p>The flexibility shown here is made possible by leveraging the many programming features built-in to Groovy, such as closures, implicit constructor calling, import aliasing, and string interpolation.
Of course, these do not have to be fully understood in order to use <code>SwingBuilder</code>; as you can see from the code above, their uses are intuitive.</p>
</div>
<div class="paragraph">
<p>Here is a slightly more involved example, with an example of <code>SwingBuilder</code> code re-use via a closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.swing.SwingBuilder
import javax.swing.*
import java.awt.*

def swing = new SwingBuilder()

def sharedPanel = {
     swing.panel() {
        label("Shared Panel")
    }
}

count = 0
swing.edt {
    frame(title: 'Frame', defaultCloseOperation: JFrame.EXIT_ON_CLOSE, pack: true, show: true) {
        vbox {
            textlabel = label('Click the button!')
            button(
                text: 'Click Me',
                actionPerformed: {
                    count++
                    textlabel.text = "Clicked ${count} time(s)."
                    println "Clicked!"
                }
            )
            widget(sharedPanel())
            widget(sharedPanel())
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s another variation that relies on observable beans and binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.swing.SwingBuilder
import groovy.beans.Bindable

class MyModel {
   @Bindable int count = 0
}

def model = new MyModel()
new SwingBuilder().edt {
  frame(title: 'Java Frame', size: [100, 100], locationRelativeTo: null, show: true) {
    gridLayout(cols: 1, rows: 2)
    label(text: bind(source: model, sourceProperty: 'count', converter: { v -&gt;  v? "Clicked $v times": ''}))
    button('Click me!', actionPerformed: { model.count++ })
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#xform-Bindable">@Bindable</a> is one of the core AST Transformations. It generates all the required boilerplate code to turn a simple bean into an observable one. The <code>bind()</code> node creates appropriate <code>PropertyChangeListeners</code> that will update the interested parties whenever a <code>PropertyChangeEvent</code> is fired.</p>
</div>
</div>
<div class="sect5">
<h6 id="antbuilder"><a class="anchor" href="#antbuilder"></a><a class="link" href="#antbuilder">AntBuilder</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here we describe <code>AntBuilder</code> which lets you write Ant build scripts
in Groovy rather than XML. You may also be interested in using Groovy
from Ant using the <a href="#groovy-ant-task-using">Groovy Ant task</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Despite being primarily a build tool, <a href="https://ant.apache.org/">Apache Ant</a> is
a very practical tool for manipulating files including zip files, copy, resource processing, and more.
But if ever you’ve been working with a <code>build.xml</code> file or some <em>Jelly script</em>
and found yourself a little restricted by all those pointy brackets, or
found it a bit weird using XML as a scripting language and wanted
something a little cleaner and more straight forward, then maybe Ant
scripting with Groovy might be what you&#8217;re after.</p>
</div>
<div class="paragraph">
<p>Groovy has a helper class called <code>AntBuilder</code> which makes the scripting
of Ant tasks really easy; allowing a real scripting language to be used
for programming constructs (variables, methods, loops, logical
branching, classes etc). It still looks like a neat concise version of
Ant&#8217;s XML without all those pointy brackets; though you can mix and
match this markup inside your script. Ant itself is a collection of jar
files. By adding them to your classpath, you can easily use them within
Groovy as is. We believe using <code>AntBuilder</code> leads to more concise and
readily understood syntax.</p>
</div>
<div class="paragraph">
<p><code>AntBuilder</code> exposes Ant tasks directly using the convenient builder notation that
we are used to in Groovy. Here is the most basic example, which is printing a message
on the standard output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ant = new groovy.ant.AntBuilder()          <i class="conum" data-value="1"></i><b>(1)</b>
ant.echo('hello from Ant!')         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates an instance of <code>AntBuilder</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the <code>echo</code> task with the message in parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine that you need to create a ZIP file. It can be as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ant = new AntBuilder()
ant.zip(destfile: 'sources.zip', basedir: 'src')</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next example, we demonstrate the use of <code>AntBuilder</code> to copy a list of files
using a classical Ant pattern directly in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// let's just call one task
ant.echo("hello")

// here is an example of a block of Ant inside GroovyMarkup
ant.sequential {
    echo("inside sequential")
    def myDir = "build/AntTest/"
    mkdir(dir: myDir)
    copy(todir: myDir) {
        fileset(dir: "src/test") {
            include(name: "**/*.groovy")
        }
    }
    echo("done")
}

// now let's do some normal Groovy again
def file = new File(ant.project.baseDir,"build/AntTest/some/pkg/MyTest.groovy")
assert file.exists()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example would be iterating over a list of files matching a specific pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// let's create a scanner of filesets
def scanner = ant.fileScanner {
    fileset(dir:"src/test") {
        include(name:"**/My*.groovy")
    }
}

// now let's iterate over
def found = false
for (f in scanner) {
    println("Found file $f")
    found = true
    assert f instanceof File
    assert f.name.endsWith(".groovy")
}
assert found</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or executing a JUnit test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">ant.junit {
    classpath { pathelement(path: '.') }
    test(name:'some.pkg.MyTest')
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can even go further by compiling and executing a Java file directly from Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">ant.echo(file:'Temp.java', '''
    class Temp {
        public static void main(String[] args) {
            System.out.println("Hello");
        }
    }
''')
ant.javac(srcdir:'.', includes:'Temp.java', fork:'true')
ant.java(classpath:'.', classname:'Temp', fork:'true')
ant.echo('Done')</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth mentioning that <code>AntBuilder</code> is included in <a href="https://gradle.org/">Gradle</a>, so you can use it in Gradle
just like you would in Groovy. Additional documentation can be found in the
<a href="https://gradle.org/docs/current/userguide/ant.html">Gradle manual</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_clibuilder"><a class="anchor" href="#_clibuilder"></a><a class="link" href="#_clibuilder">CliBuilder</a></h6>
<div class="paragraph">
<p><code>CliBuilder</code> provides a compact way to specify the available options for a commandline application and then
automatically parse the application&#8217;s commandline parameters according to that specification. By convention,
a distinction is made between <em>option</em> commandline parameters and any remaining parameters which are passed
to an application as its arguments. Typically, several types of options might be supported such as <code>-V</code> or
<code>--tabsize=4</code>. <code>CliBuilder</code> removes the burden of developing lots of code for commandline processing.
Instead, it supports a somewhat declarative approach to declaring your options and then provides a single call
to parse the commandline parameters with a simple mechanism to interrogate the options (you can think of this
as a simple model for your options).</p>
</div>
<div class="paragraph">
<p>Even though the details of each commandline you create could be quite different, the same main steps are
followed each time. First, a <code>CliBuilder</code> instance is created. Then, allowed commandline options are defined.
This can be done using a <em>dynamic api</em> style or an <em>annotation</em> style.
The commandline parameters are then parsed according to the options specification resulting in a
collection of options which are then interrogated.</p>
</div>
<div class="paragraph">
<p>Here is a simple example <code>Greeter.groovy</code> script illustrating usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import of CliBuilder not shown                          <i class="conum" data-value="1"></i><b>(1)</b>
// specify parameters
def cli = new CliBuilder(usage: 'groovy Greeter [option]') <i class="conum" data-value="2"></i><b>(2)</b>
cli.a(longOpt: 'audience', args: 1, 'greeting audience')   <i class="conum" data-value="3"></i><b>(3)</b>
cli.h(longOpt: 'help', 'display usage')                    <i class="conum" data-value="4"></i><b>(4)</b>

// parse and process parameters
def options = cli.parse(args)                              <i class="conum" data-value="5"></i><b>(5)</b>
if (options.h) cli.usage()                                 <i class="conum" data-value="6"></i><b>(6)</b>
else println "Hello ${options.a ? options.a : 'World'}"    <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Earlier versions of Groovy had a CliBuilder in the <code>groovy.util</code> package and no import was necessary.
In Groovy 2.5, this approach became deprecated: applications should instead choose the <code>groovy.cli.picocli</code> or <code>groovy.cli.commons</code> version.
The groovy.util version in Groovy 2.5 points to the commons-cli version for backwards compatibility but has been removed in Groovy 3.0.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>define a new <code>CliBuilder</code> instance specifying an optional usage string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>specify a <code>-a</code> option taking a single argument with an optional long variant <code>--audience</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>specify a <code>-h</code> option taking no arguments with an optional long variant <code>--help</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>parse the commandline parameters supplied to the script</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>if the <code>h</code> option is found display a usage message</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>display a standard greeting or, if the <code>a</code> option is found, a customized greeting</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running this script with no commandline parameters, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">&gt; groovy Greeter</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello World</pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>-h</code> as the single commandline parameter, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">&gt; groovy Greeter -h</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>usage: groovy Greeter [option]
 -a,--audience &lt;arg&gt;   greeting audience
 -h,--help             display usage</pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>--audience Groovologist</code> as the commandline parameters, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">&gt; groovy Greeter --audience Groovologist</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello Groovologist</pre>
</div>
</div>
<div class="paragraph">
<p>When creating the <code>CliBuilder</code> instance in the above example, we set the optional <code>usage</code> property
within the constructor call. This follows Groovy&#8217;s normal ability to set additional properties
of the instance during construction. There are numerous other properties which can be set
such as <code>header</code> and <code>footer</code>. For the complete set of available properties, see the
available properties for the <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/util/CliBuilder.html">groovy.util.CliBuilder</a> class.</p>
</div>
<div class="paragraph">
<p>When defining an allowed commandline option, both a short name (e.g. "h" for the <code>help</code> option shown previously)
and a short description (e.g. "display usage" for the <code>help</code> option) must be supplied.
In our example above, we also set some
additional properties such as <code>longOpt</code> and <code>args</code>. The following additional
properties are supported when specifying an allowed commandline option:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">argName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the argument for this option used in output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">longOpt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the long representation or long name of the option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of argument values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code> or <code>String</code> &#160; &#160; (1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optionalArg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the argument value is optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the option is mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the type of this option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueSeparator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the character that is the value separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char</code> &#160; &#160; (2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a default value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">convert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts the incoming String to the required type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Closure</code> &#160; &#160; (1)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(1) More details later<br>
(2) Single character Strings are coerced to chars in special cases in Groovy</p>
</div>
<div class="paragraph">
<p>If you have an option with only a <code>longOpt</code> variant, you can use the special shortname of '_'
to specify the option, e.g. : <code>cli._(longOpt: 'verbose', 'enable verbose logging')</code>.
Some of the remaining named parameters should be fairly self-explanatory while others deserve
a bit more explanation. But before further explanations, let&#8217;s look at ways of using
<code>CliBuilder</code> with annotations.</p>
</div>
<div class="sect6">
<h7 id="_using_annotations_and_an_interface"><a class="anchor" href="#_using_annotations_and_an_interface"></a><a class="link" href="#_using_annotations_and_an_interface">Using Annotations and an interface</a></h7>
<div class="paragraph">
<p>Rather than making a series of method calls (albeit in a very declarative mini-DSL form)
to specify the allowable options, you can provide an interface specification of the allowable options where
annotations are used to indicate and provide details for those options and for how unprocessed
parameters are handled. Two annotations are used: <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/cli/Option.html">groovy.cli.Option</a> and <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/cli/Unparsed.html">groovy.cli.Unparsed</a>.</p>
</div>
<div class="paragraph">
<p>Here is how such a specification can be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface GreeterI {
    @Option(shortName='h', description='display usage') Boolean help()        <i class="conum" data-value="1"></i><b>(1)</b>
    @Option(shortName='a', description='greeting audience') String audience() <i class="conum" data-value="2"></i><b>(2)</b>
    @Unparsed(description = "positional parameters") List remaining()         <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify a Boolean option set using <code>-h</code> or <code>--help</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify a String option set using <code>-a</code> or <code>--audience</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify where any remaining parameters will be stored</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note how the long name is automatically determined from the interface method name.
You can use the <code>longName</code> annotation attribute to override that behavior and specify
a custom long name if you wish or use a longName of '_' to indicate that no long name
is to be provided. You will need to specify a shortName in such a case.</p>
</div>
<div class="paragraph">
<p>Here is how you could use the interface specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import CliBuilder not shown
def cli = new CliBuilder(usage: 'groovy Greeter')  <i class="conum" data-value="1"></i><b>(1)</b>
def argz = '--audience Groovologist'.split()
def options = cli.parseFromSpec(GreeterI, argz)             <i class="conum" data-value="2"></i><b>(2)</b>
assert options.audience() == 'Groovologist'                 <i class="conum" data-value="3"></i><b>(3)</b>

argz = '-h Some Other Args'.split()
options = cli.parseFromSpec(GreeterI, argz)                 <i class="conum" data-value="4"></i><b>(4)</b>
assert options.help()
assert options.remaining() == ['Some', 'Other', 'Args']     <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>CliBuilder</code> instance as before with optional properties</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Parse parameters using the interface specification</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Interrogate options using the methods from the interface</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Parse a different set of parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Interrogate the remaining parameters</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>parseFromSpec</code> is called, <code>CliBuilder</code> automatically creates an instance implementing the interface
and populates it. You simply call the interface methods to interrogate the option values.</p>
</div>
</div>
<div class="sect6">
<h7 id="_using_annotations_and_an_instance"><a class="anchor" href="#_using_annotations_and_an_instance"></a><a class="link" href="#_using_annotations_and_an_instance">Using Annotations and an instance</a></h7>
<div class="paragraph">
<p>Alternatively, perhaps you already have a domain class containing the option information.
You can simply annotate properties or setters from that class to enable <code>CliBuilder</code> to appropriately
populate your domain object. Each annotation both describes that option&#8217;s properties through the annotation
attributes and indicates the setter the <code>CliBuilder</code> will use to populate that option in your domain object.</p>
</div>
<div class="paragraph">
<p>Here is how such a specification can be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class GreeterC {
    @Option(shortName='h', description='display usage')
    Boolean help                        <i class="conum" data-value="1"></i><b>(1)</b>

    private String audience
    @Option(shortName='a', description='greeting audience')
    void setAudience(String audience) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.audience = audience
    }
    String getAudience() { audience }

    @Unparsed(description = "positional parameters")
    List remaining                      <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Indicate that a Boolean property is an option</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicate that a String property (with explicit setter) is an option</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify where any remaining args will be stored</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And here is how you could use the specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import CliBuilder not shown
def cli = new CliBuilder(usage: 'groovy Greeter [option]') <i class="conum" data-value="1"></i><b>(1)</b>
def options = new GreeterC()                               <i class="conum" data-value="2"></i><b>(2)</b>
def argz = '--audience Groovologist foo'.split()
cli.parseFromInstance(options, argz)                       <i class="conum" data-value="3"></i><b>(3)</b>
assert options.audience == 'Groovologist'                  <i class="conum" data-value="4"></i><b>(4)</b>
assert options.remaining == ['foo']                        <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>CliBuilder</code> instance as before with optional parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance for <code>CliBuilder</code> to populate</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Parse arguments populating the supplied instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Interrogate the String option property</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Interrogate the remaining arguments property</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>parseFromInstance</code> is called, <code>CliBuilder</code> automatically populates your instance.
You simply interrogate the instance properties (or whatever accessor methods you have provided
in your domain object) to access the option values.</p>
</div>
</div>
<div class="sect6">
<h7 id="_using_annotations_and_a_script"><a class="anchor" href="#_using_annotations_and_a_script"></a><a class="link" href="#_using_annotations_and_a_script">Using Annotations and a script</a></h7>
<div class="paragraph">
<p>Finally, there are two additional convenience annotation aliases specifically for scripts. They
simply combine the previously mentioned annotations and <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/transform/Field.html">groovy.transform.Field</a>.
The groovydoc for those annotations reveals the details: <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/cli/OptionField.html">groovy.cli.OptionField</a> and
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/cli/UnparsedField.html">groovy.cli.UnparsedField</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example using those annotations in a self-contained script that would be called
with the same arguments as shown for the instance example earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import CliBuilder not shown
import groovy.cli.OptionField
import groovy.cli.UnparsedField

@OptionField String audience
@OptionField Boolean help
@UnparsedField List remaining
new CliBuilder().parseFromInstance(this, args)
assert audience == 'Groovologist'
assert remaining == ['foo']</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_options_with_arguments"><a class="anchor" href="#_options_with_arguments"></a><a class="link" href="#_options_with_arguments">Options with arguments</a></h7>
<div class="paragraph">
<p>We saw in our initial example that some options act like flags, e.g. <code>Greeter -h</code> but
others take an argument, e.g. <code>Greeter --audience Groovologist</code>. The simplest cases
involve options which act like flags or have a single (potentially optional) argument.
Here is an example involving those cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import CliBuilder not shown
def cli = new CliBuilder()
cli.a(args: 0, 'a arg') <i class="conum" data-value="1"></i><b>(1)</b>
cli.b(args: 1, 'b arg') <i class="conum" data-value="2"></i><b>(2)</b>
cli.c(args: 1, optionalArg: true, 'c arg') <i class="conum" data-value="3"></i><b>(3)</b>
def options = cli.parse('-a -b foo -c bar baz'.split()) <i class="conum" data-value="4"></i><b>(4)</b>

assert options.a == true
assert options.b == 'foo'
assert options.c == 'bar'
assert options.arguments() == ['baz']

options = cli.parse('-a -c -b foo bar baz'.split()) <i class="conum" data-value="5"></i><b>(5)</b>

assert options.a == true
assert options.c == true
assert options.b == 'foo'
assert options.arguments() == ['bar', 'baz']</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An option that is simply a flag - the default; setting args to 0 is allowed but not needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An option with exactly one argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An option with an optional argument; it acts like a flag if the option is left out</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>An example using this spec where an argument is supplied to the 'c' option</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>An example using this spec where no argument is supplied to the 'c' option; it&#8217;s just a flag</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note: when an option with an optional argument is encountered, it will (somewhat) greedily consume the
next parameter from the supplied commandline parameters. If however, the next parameter matches a known long or short
option (with leading single or double hyphens), that will take precedence, e.g. <code>-b</code> in the above example.</p>
</div>
<div class="paragraph">
<p>Option arguments may also be specified using the annotation style. Here is an interface option specification
illustrating such a definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface WithArgsI {
    @Option boolean a()
    @Option String b()
    @Option(optionalArg=true) String[] c()
    @Unparsed List remaining()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how it is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()
def options = cli.parseFromSpec(WithArgsI, '-a -b foo -c bar baz'.split())
assert options.a()
assert options.b() == 'foo'
assert options.c() == ['bar']
assert options.remaining() == ['baz']

options = cli.parseFromSpec(WithArgsI, '-a -c -b foo bar baz'.split())
assert options.a()
assert options.c() == []
assert options.b() == 'foo'
assert options.remaining() == ['bar', 'baz']</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example makes use of an array-typed option specification. We cover this in more detail shortly when we discuss
multiple arguments.</p>
</div>
</div>
<div class="sect6">
<h7 id="_specifying_a_type"><a class="anchor" href="#_specifying_a_type"></a><a class="link" href="#_specifying_a_type">Specifying a type</a></h7>
<div class="paragraph">
<p>Arguments on the commandline are by nature Strings (or arguably can be considered Booleans for flags) but can be
converted to richer types automatically by supplying additional typing information. For the
annotation-based argument definition style, these types are supplied using the field types for annotation
properties or return types of annotated methods (or the setter argument type for setter methods).
For the dynamic method style of argument definition a special 'type' property is supported
which allows you to specify a Class name.</p>
</div>
<div class="paragraph">
<p>When an explicit type is defined, the <code>args</code> named-parameter is assumed to be 1 (except for Boolean-typed
options where it is 0 by default). An explicit <code>args</code> parameter can still be provided if needed.
Here is an example using types with the dynamic api argument definition style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def argz = '''-a John -b -d 21 -e 1980 -f 3.5 -g 3.14159
    -h cv.txt -i DOWN and some more'''.split()
def cli = new CliBuilder()
cli.a(type: String, 'a-arg')
cli.b(type: boolean, 'b-arg')
cli.c(type: Boolean, 'c-arg')
cli.d(type: int, 'd-arg')
cli.e(type: Long, 'e-arg')
cli.f(type: Float, 'f-arg')
cli.g(type: BigDecimal, 'g-arg')
cli.h(type: File, 'h-arg')
cli.i(type: RoundingMode, 'i-arg')
def options = cli.parse(argz)
assert options.a == 'John'
assert options.b
assert !options.c
assert options.d == 21
assert options.e == 1980L
assert options.f == 3.5f
assert options.g == 3.14159
assert options.h == new File('cv.txt')
assert options.i == RoundingMode.DOWN
assert options.arguments() == ['and', 'some', 'more']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Primitives, numeric types, files, enums and arrays thereof, are supported (they are converted using
<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/runtime/StringGroovyMethods.html#asType">org.codehaus.groovy.runtime.StringGroovyMethods#asType</a>).</p>
</div>
</div>
<div class="sect6">
<h7 id="_custom_parsing_of_the_argument_string"><a class="anchor" href="#_custom_parsing_of_the_argument_string"></a><a class="link" href="#_custom_parsing_of_the_argument_string">Custom parsing of the argument String</a></h7>
<div class="paragraph">
<p>If the supported types aren&#8217;t sufficient, you can supply a closure to handle the String to rich type conversion
for you. Here is a sample using the dynamic api style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def argz = '''-a John -b Mary -d 2016-01-01 and some more'''.split()
def cli = new CliBuilder()
def lower = { it.toLowerCase() }
cli.a(convert: lower, 'a-arg')
cli.b(convert: { it.toUpperCase() }, 'b-arg')
cli.d(convert: { Date.parse('yyyy-MM-dd', it) }, 'd-arg')
def options = cli.parse(argz)
assert options.a == 'john'
assert options.b == 'MARY'
assert options.d.format('dd-MM-yyyy') == '01-01-2016'
assert options.arguments() == ['and', 'some', 'more']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the annotation style by supplying the conversion closure as an annotation parameter.
Here is an example specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface WithConvertI {
    @Option(convert={ it.toLowerCase() }) String a()
    @Option(convert={ it.toUpperCase() }) String b()
    @Option(convert={ Date.parse("yyyy-MM-dd", it) }) Date d()
    @Unparsed List remaining()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And an example using that specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Date newYears = Date.parse("yyyy-MM-dd", "2016-01-01")
def argz = '''-a John -b Mary -d 2016-01-01 and some more'''.split()
def cli = new CliBuilder()
def options = cli.parseFromSpec(WithConvertI, argz)
assert options.a() == 'john'
assert options.b() == 'MARY'
assert options.d() == newYears
assert options.remaining() == ['and', 'some', 'more']</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_options_with_multiple_arguments"><a class="anchor" href="#_options_with_multiple_arguments"></a><a class="link" href="#_options_with_multiple_arguments">Options with multiple arguments</a></h7>
<div class="paragraph">
<p>Multiple arguments are also supported using an <code>args</code> value greater than 1. There is a special named parameter,
<code>valueSeparator</code>, which can also be optionally used when processing multiple arguments. It allows some additional
flexibility in the syntax supported when supplying such argument lists on the commandline. For example,
supplying a value separator of ',' allows a comma-delimited list of values to be passed on the commandline.</p>
</div>
<div class="paragraph">
<p>The <code>args</code> value is normally an integer. It can be optionally supplied as a String. There are two special
String symbols: <code>` and `\*`.
The `*` value means 0 or more. The `</code> value means 1 or more.
The <code>*</code> value is the same as using <code>+</code> and also setting the <code>optionalArg</code> value to true.</p>
</div>
<div class="paragraph">
<p>Accessing the multiple arguments follows a special convention. Simply add an 's' to the normal property
you would use to access the argument option and you will retrieve all the supplied arguments as a list.
So, for a short option named 'a', you access the first 'a' argument using <code>options.a</code> and the list of
all arguments using <code>options.as</code>. It&#8217;s fine to have a shortname or longname ending in 's' so long as you
don&#8217;t also have the singular variant without the 's'. So, if <code>name</code> is one of your options with multiple arguments
and <code>guess</code> is another with a single argument, there will be no confusion using <code>options.names</code> and <code>options.guess</code>.</p>
</div>
<div class="paragraph">
<p>Here is an excerpt highlighting the use of multiple arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// import CliBuilder not shown
def cli = new CliBuilder()
cli.a(args: 2, 'a-arg')
cli.b(args: '2', valueSeparator: ',', 'b-arg') <i class="conum" data-value="1"></i><b>(1)</b>
cli.c(args: '+', valueSeparator: ',', 'c-arg') <i class="conum" data-value="2"></i><b>(2)</b>

def options = cli.parse('-a 1 2 3 4'.split()) <i class="conum" data-value="3"></i><b>(3)</b>
assert options.a == '1' <i class="conum" data-value="4"></i><b>(4)</b>
assert options.as == ['1', '2'] <i class="conum" data-value="5"></i><b>(5)</b>
assert options.arguments() == ['3', '4']

options = cli.parse('-a1 -a2 3'.split()) <i class="conum" data-value="6"></i><b>(6)</b>
assert options.as == ['1', '2']
assert options.arguments() == ['3']

options = cli.parse(['-b1,2']) <i class="conum" data-value="7"></i><b>(7)</b>
assert options.bs == ['1', '2']

options = cli.parse(['-c', '1'])
assert options.cs == ['1']

options = cli.parse(['-c1'])
assert options.cs == ['1']

options = cli.parse(['-c1,2,3'])
assert options.cs == ['1', '2', '3']</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Args value supplied as a String and comma value separator specified</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more arguments are allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Two commandline parameters will be supplied as the 'b' option&#8217;s list of arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Access the 'a' option&#8217;s first argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Access the 'a' option&#8217;s list of arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An alternative syntax for specifying two arguments for the 'a' option</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The arguments to the 'b' option supplied as a comma-separated value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative to accessing multiple arguments using the <em>plural name</em> approach, you can use an
array-based type for the option. In this case, all options will always be returned via the array
which is accessed via the normal singular name. We&#8217;ll see an example of this next when discussing
types.</p>
</div>
<div class="paragraph">
<p>Multiple arguments are also supported using the annotation style of option definition by using an
array type for the annotated class member (method or property) as this example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface ValSepI {
    @Option(numberOfArguments=2) String[] a()
    @Option(numberOfArgumentsString='2', valueSeparator=',') String[] b()
    @Option(numberOfArgumentsString='+', valueSeparator=',') String[] c()
    @Unparsed remaining()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()

def options = cli.parseFromSpec(ValSepI, '-a 1 2 3 4'.split())
assert options.a() == ['1', '2']
assert options.remaining() == ['3', '4']

options = cli.parseFromSpec(ValSepI, '-a1 -a2 3'.split())
assert options.a() == ['1', '2']
assert options.remaining() == ['3']

options = cli.parseFromSpec(ValSepI, ['-b1,2'] as String[])
assert options.b() == ['1', '2']

options = cli.parseFromSpec(ValSepI, ['-c', '1'] as String[])
assert options.c() == ['1']

options = cli.parseFromSpec(ValSepI, ['-c1'] as String[])
assert options.c() == ['1']

options = cli.parseFromSpec(ValSepI, ['-c1,2,3'] as String[])
assert options.c() == ['1', '2', '3']</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_types_and_multiple_arguments"><a class="anchor" href="#_types_and_multiple_arguments"></a><a class="link" href="#_types_and_multiple_arguments">Types and multiple arguments</a></h7>
<div class="paragraph">
<p>Here is an example using types and multiple arguments with the dynamic api argument definition style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def argz = '''-j 3 4 5 -k1.5,2.5,3.5 and some more'''.split()
def cli = new CliBuilder()
cli.j(args: 3, type: int[], 'j-arg')
cli.k(args: '+', valueSeparator: ',', type: BigDecimal[], 'k-arg')
def options = cli.parse(argz)
assert options.js == [3, 4, 5] <i class="conum" data-value="1"></i><b>(1)</b>
assert options.j == [3, 4, 5]  <i class="conum" data-value="1"></i><b>(1)</b>
assert options.k == [1.5, 2.5, 3.5]
assert options.arguments() == ['and', 'some', 'more']</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For an array type, the trailing 's' can be used but isn&#8217;t needed</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_setting_a_default_value"><a class="anchor" href="#_setting_a_default_value"></a><a class="link" href="#_setting_a_default_value">Setting a default value</a></h7>
<div class="paragraph">
<p>Groovy makes it easy using the Elvis operator to provide a default value at the point of usage of some variable,
e.g. <code>String x = someVariable ?: 'some default'</code>. But sometimes you wish to make such a default part of the
options specification to minimise the interrogators work in later stages. <code>CliBuilder</code> supports the <code>defaultValue</code>
property to cater for this scenario.</p>
</div>
<div class="paragraph">
<p>Here is how you could use it using the dynamic api style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()
cli.f longOpt: 'from', type: String, args: 1, defaultValue: 'one', 'f option'
cli.t longOpt: 'to', type: int, defaultValue: '35', 't option'

def options = cli.parse('-f two'.split())
assert options.hasOption('f')
assert options.f == 'two'
assert !options.hasOption('t')
assert options.t == 35

options = cli.parse('-t 45'.split())
assert !options.hasOption('from')
assert options.from == 'one'
assert options.hasOption('to')
assert options.to == 45</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you might want such a specification using the annotation style. Here is an example using an interface
specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface WithDefaultValueI {
    @Option(shortName='f', defaultValue='one') String from()
    @Option(shortName='t', defaultValue='35') int to()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()

def options = cli.parseFromSpec(WithDefaultValueI, '-f two'.split())
assert options.from() == 'two'
assert options.to() == 35

options = cli.parseFromSpec(WithDefaultValueI, '-t 45'.split())
assert options.from() == 'one'
assert options.to() == 45</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>defaultValue</code> annotation attribute when using annotations with an instance,
though it&#8217;s probably just as easy to provide an initial value for the property (or backing field).</p>
</div>
</div>
<div class="sect6">
<h7 id="_use_with_typechecked"><a class="anchor" href="#_use_with_typechecked"></a><a class="link" href="#_use_with_typechecked">Use with <code>TypeChecked</code></a></h7>
<div class="paragraph">
<p>The dynamic api style of using <code>CliBuilder</code> is inherently dynamic but you have a few options
should you want to make use of Groovy&#8217;s static type checking capabilities. Firstly, consider using the
annotation style, for example, here is an interface option specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface TypeCheckedI{
    @Option String name()
    @Option int age()
    @Unparsed List remaining()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And it can be used in combination with <code>@TypeChecked</code> as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@TypeChecked
void testTypeCheckedInterface() {
    def argz = "--name John --age 21 and some more".split()
    def cli = new CliBuilder()
    def options = cli.parseFromSpec(TypeCheckedI, argz)
    String n = options.name()
    int a = options.age()
    assert n == 'John' &amp;&amp; a == 21
    assert options.remaining() == ['and', 'some', 'more']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, there is a feature of the dynamic api style which offers some support. The definition statements
are inherently dynamic but actually return a value which we have ignored in earlier examples.
The returned value is in fact a <code>TypedOption&lt;Type&gt;</code> and special <code>getAt</code> support allows the options
to be interrogated using the typed option, e.g. <code>options[savedTypeOption]</code>. So, if you have statements
similar to these in a non type checked part of your code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()
TypedOption&lt;Integer&gt; age = cli.a(longOpt: 'age', type: Integer, 'some age option')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the following statements can be in a separate part of your code which is type checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def args = '--age 21'.split()
def options = cli.parse(args)
int a = options[age]
assert a == 21</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, there is one additional convenience method offered by <code>CliBuilder</code> to even allow the
definition part to be type checked. It is a slightly more verbose method call. Instead of using
the short name (the <em>opt</em> name) in the method call, you use a fixed name of <code>option</code> and
supply the <code>opt</code> value as a property. You must also specify the type directly as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.cli.TypedOption
import groovy.transform.TypeChecked

@TypeChecked
void testTypeChecked() {
    def cli = new CliBuilder()
    TypedOption&lt;String&gt; name = cli.option(String, opt: 'n', longOpt: 'name', 'name option')
    TypedOption&lt;Integer&gt; age = cli.option(Integer, longOpt: 'age', 'age option')
    def argz = "--name John --age 21 and some more".split()
    def options = cli.parse(argz)
    String n = options[name]
    int a = options[age]
    assert n == 'John' &amp;&amp; a == 21
    assert options.arguments() == ['and', 'some', 'more']
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_advanced_cli_usage"><a class="anchor" href="#_advanced_cli_usage"></a><a class="link" href="#_advanced_cli_usage">Advanced CLI Usage</a></h7>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>NOTE</strong> Advanced CLI features</p>
</div>
<div class="paragraph">
<p><code>CliBuilder</code> can be thought of as a Groovy friendly wrapper on top of either
<a href="https://github.com/remkop/picocli">picocli</a> or <a href="https://commons.apache.org/proper/commons-cli/">Apache Commons CLI</a>.
If there is a feature not provided by <code>CliBuilder</code> that you know is supported in the underlying
library, the current <code>CliBuilder</code> implementation (and various Groovy language features) make it easy for you
to call the underlying library methods directly. Doing so is a pragmatic way to leverage the Groovy-friendly
syntax offered by <code>CliBuilder</code> and yet still access some of the underlying library&#8217;s advanced features.
A word of caution however; future versions of <code>CliBuilder</code> could potentially use another underlying library
and in that event, some porting work may be required for your Groovy classes and/or scripts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect7">
<h8 id="_apache_commons_cli"><a class="anchor" href="#_apache_commons_cli"></a><a class="link" href="#_apache_commons_cli">Apache Commons CLI</a></h8>
<div class="paragraph">
<p>As an example, here is some code for making use of Apache Commons CLI&#8217;s grouping mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.apache.commons.cli.*

def cli = new CliBuilder()
cli.f longOpt: 'from', 'f option'
cli.u longOpt: 'until', 'u option'
def optionGroup = new OptionGroup()
optionGroup.with {
  addOption cli.option('o', [longOpt: 'output'], 'o option')
  addOption cli.option('d', [longOpt: 'directory'], 'd option')
}
cli.options.addOptionGroup optionGroup
assert !cli.parse('-d -o'.split()) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The parse will fail since only one option from a group can be used at a time.</td>
</tr>
</table>
</div>
</div>
<div class="sect7">
<h8 id="_picocli"><a class="anchor" href="#_picocli"></a><a class="link" href="#_picocli">Picocli</a></h8>
<div class="paragraph">
<p>Below are some features available in the picocli version of <code>CliBuilder</code>.</p>
</div>
<div class="paragraph">
<p><strong>New property: errorWriter</strong></p>
</div>
<div class="paragraph">
<p>When users of your application give invalid command line arguments,
CliBuilder writes an error message and the usage help message to the <code>stderr</code> output stream.
It doesn&#8217;t use the <code>stdout</code> stream to prevent the error message from being parsed when your program&#8217;s
output is used as input for another process.
You can customize the destination by setting the <code>errorWriter</code> to a different value.</p>
</div>
<div class="paragraph">
<p>On the other hand, <code>CliBuilder.usage()</code> prints the usage help message to the <code>stdout</code> stream.
This way, when users request help (e.g. with a <code>--help</code> parameter),
they can pipe the output to a utility like <code>less</code> or <code>grep</code>.</p>
</div>
<div class="paragraph">
<p>You can specify different writers for testing.
<em>Be aware that for backwards compatibility, setting the <code>writer</code> property to a different value
will set <strong>both</strong> the <code>writer</code> and the <code>errorWriter</code> to the specified writer.</em></p>
</div>
<div class="paragraph">
<p><strong>ANSI colors</strong></p>
</div>
<div class="paragraph">
<p>The picocli version of CliBuilder renders the usage help message in ANSI colors on supported platforms automatically.
If desired you can <a href="http://picocli.info/#_usage_help_with_styles_and_colors">customize</a> this.
(An example follows below.)</p>
</div>
<div class="paragraph">
<p><strong>New property: name</strong></p>
</div>
<div class="paragraph">
<p>As before, you can set the synopsis of the usage help message with the <code>usage</code> property.
You may be interested in a small improvement:
if you only set the command <code>name</code>, a synopsis will be generated automatically,
with repeating elements followed by <code>&#8230;&#8203;</code> and optional elements surrounded with <code>[</code> and <code>]</code>.
(An example follows below.)</p>
</div>
<div class="paragraph">
<p><strong>New property: usageMessage</strong></p>
</div>
<div class="paragraph">
<p>This property exposes a <code>UsageMessageSpec</code> object from the underlying picocli library,
which gives fine-grained control over various sections of the usage help message. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()
cli.name = "myapp"
cli.usageMessage.with {
    headerHeading("@|bold,underline Header heading:|@%n")
    header("Header 1", "Header 2")                     // before the synopsis
    synopsisHeading("%n@|bold,underline Usage:|@ ")
    descriptionHeading("%n@|bold,underline Description heading:|@%n")
    description("Description 1", "Description 2")      // after the synopsis
    optionListHeading("%n@|bold,underline Options heading:|@%n")
    footerHeading("%n@|bold,underline Footer heading:|@%n")
    footer("Footer 1", "Footer 2")
}
cli.a('option a description')
cli.b('option b description')
cli.c(args: '*', 'option c description')
cli.usage()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives this output:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xusageMessageSpec.png.pagespeed.ic.5MN-2VPBgY.png" alt="usageMessageSpec"></span></p>
</div>
<div class="paragraph">
<p><strong>Property: parser</strong></p>
</div>
<div class="paragraph">
<p>The <code>parser</code> property gives access to the picocli <code>ParserSpec</code> object that can be used to customize the parser behavior.</p>
</div>
<div class="paragraph">
<p>This can be useful when the <code>CliBuilder</code> options to control the parser are not fine-grained enough.
For example, for backward compatibility with the Commons CLI implementation of <code>CliBuilder</code>, by default <code>CliBuilder</code> stops looking for options when an unknown option is encountered, and subsequent command line arguments are treated as positional parameters.
<code>CliBuilder</code> provides a <code>stopAtNonOption</code> property, and by setting this to <code>false</code> you can make the parser more strict, so an unknown option results in <code>error: Unknown option: '-x'</code>.</p>
</div>
<div class="paragraph">
<p>But what if you want to treat unknown options as positional parameters, and still process subsequent command line arguments as options?</p>
</div>
<div class="paragraph">
<p>This can be accomplished with the <code>parser</code> property.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def cli = new CliBuilder()
cli.parser.stopAtPositional(false)
cli.parser.unmatchedOptionsArePositionalParams(true)
// ...
def opts = cli.parse(args)
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://picocli.info/apidocs/picocli/CommandLine.Model.ParserSpec.html">documentation</a> for details.</p>
</div>
<div class="paragraph">
<p><strong>Map options</strong></p>
</div>
<div class="paragraph">
<p>Finally, if your application has options that are key-value pairs, you may be interested in picocli&#8217;s support for maps. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.concurrent.TimeUnit
import static java.util.concurrent.TimeUnit.DAYS
import static java.util.concurrent.TimeUnit.HOURS

def cli = new CliBuilder()
cli.D(args: 2,   valueSeparator: '=', 'the old way')                          <i class="conum" data-value="1"></i><b>(1)</b>
cli.X(type: Map, 'the new way')                                               <i class="conum" data-value="2"></i><b>(2)</b>
cli.Z(type: Map, auxiliaryTypes: [TimeUnit, Integer].toArray(), 'typed map')  <i class="conum" data-value="3"></i><b>(3)</b>

def options = cli.parse('-Da=b -Dc=d -Xx=y -Xi=j -ZDAYS=2 -ZHOURS=23'.split())<i class="conum" data-value="4"></i><b>(4)</b>
assert options.Ds == ['a', 'b', 'c', 'd']                                     <i class="conum" data-value="5"></i><b>(5)</b>
assert options.Xs == [ 'x':'y', 'i':'j' ]                                     <i class="conum" data-value="6"></i><b>(6)</b>
assert options.Zs == [ (DAYS as TimeUnit):2, (HOURS as TimeUnit):23 ]         <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Previously, <code>key=value</code> pairs were split up into parts and added to a list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Picocli map support: simply specify <code>Map</code> as the type of the option</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can even specify the type of the map elements</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>To compare, let&#8217;s specify two key-value pairs for each option</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Previously, all key-value pairs end up in a list and it is up to the application to work with this list</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Picocli returns the key-value pairs as a <code>Map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Both keys and values of the map can be strongly typed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Controlling the Picocli version</strong></p>
</div>
<div class="paragraph">
<p>To use a specific version of picocli, add a dependency to that version in your build configuration.
If running scripts using a pre-installed version of Groovy, use the <code>@Grab</code> annotation to control the version of picocli to use in <code>CliBuilder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@GrabConfig(systemClassLoader=true)
@Grab('info.picocli:picocli:4.2.0')
import groovy.cli.picocli.CliBuilder

def cli = new CliBuilder()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_objectgraphbuilder"><a class="anchor" href="#_objectgraphbuilder"></a><a class="link" href="#_objectgraphbuilder">ObjectGraphBuilder</a></h6>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> is a builder for an arbitrary graph of beans that
follow the JavaBean convention. It is in particular useful for creating test data.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a list of classes that belong to your domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.acme

class Company {
    String name
    Address address
    List employees = []
}

class Address {
    String line1
    String line2
    int zip
    String state
}

class Employee {
    String name
    int employeeId
    Address address
    Company company
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then using <code>ObjectGraphBuilder</code> building a <code>Company</code> with three employees is as
easy as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def builder = new ObjectGraphBuilder()                          <i class="conum" data-value="1"></i><b>(1)</b>
builder.classLoader = this.class.classLoader                    <i class="conum" data-value="2"></i><b>(2)</b>
builder.classNameResolver = "com.acme"                          <i class="conum" data-value="3"></i><b>(3)</b>

def acme = builder.company(name: 'ACME') {                      <i class="conum" data-value="4"></i><b>(4)</b>
    3.times {
        employee(id: it.toString(), name: "Drone $it") {        <i class="conum" data-value="5"></i><b>(5)</b>
            address(line1:"Post street")                        <i class="conum" data-value="6"></i><b>(6)</b>
        }
    }
}

assert acme != null
assert acme instanceof Company
assert acme.name == 'ACME'
assert acme.employees.size() == 3
def employee = acme.employees[0]
assert employee instanceof Employee
assert employee.name == 'Drone 0'
assert employee.address instanceof Address</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a new object graph builder</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>sets the classloader where the classes will be resolved</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>sets the base package name for classes to be resolved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>creates a <code>Company</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>with 3 <code>Employee</code> instances</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>each of them having a distinct <code>Address</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Behind the scenes, the object graph builder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>will try to match a node name into a <code>Class</code>, using a default <code>ClassNameResolver</code> strategy that requires a package name</p>
</li>
<li>
<p>then will create an instance of the appropriate class using a default <code>NewInstanceResolver</code> strategy that calls a no-arg constructor</p>
</li>
<li>
<p>resolves the parent/child relationship for nested nodes, involving two other strategies:</p>
<div class="ulist">
<ul>
<li>
<p><code>RelationNameResolver</code> will yield the name of the child property in the parent, and the name of the parent property
in the child (if any, in this case, <code>Employee</code> has a parent property aptly named <code>company</code>)</p>
</li>
<li>
<p><code>ChildPropertySetter</code> will insert the child into the parent taking into account if the child belongs to a <code>Collection</code>
or not (in this case <code>employees</code> should be a list of <code>Employee</code> instances in <code>Company</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All 4 strategies have a default implementation that work as expected if
the code follows the usual conventions for writing JavaBeans. In case any of your beans or objects do not follow the convention
you may plug your own implementation of each strategy. For example imagine that you need to build a class which is
immutable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Immutable
class Person {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then if you try to create a <code>Person</code> with the builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def person = builder.person(name:'Jon', age:17)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will fail at runtime with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot set readonly property: name for class: com.acme.Person</pre>
</div>
</div>
<div class="paragraph">
<p>Fixing this can be done by changing the new instance strategy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">builder.newInstanceResolver = { Class klazz, Map attributes -&gt;
    if (klazz.getConstructor(Map)) {
        def o = klazz.newInstance(attributes)
        attributes.clear()
        return o
    }
    klazz.newInstance()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> supports ids per node, meaning
that you can store a reference to a node in the builder. This is
useful when multiple objects reference the same instance. Because a
property named <code>id</code> may be of business meaning in some domain models
<code>ObjectGraphBuilder</code> has a strategy named <code>IdentifierResolver</code> that you
may configure to change the default name value. The same may
happen with the property used for referencing a previously saved
instance, a strategy named <code>ReferenceResolver</code> will yield the
appropriate value (default is `refId'):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def company = builder.company(name: 'ACME') {
    address(id: 'a1', line1: '123 Groovy Rd', zip: 12345, state: 'JV')          <i class="conum" data-value="1"></i><b>(1)</b>
    employee(name: 'Duke', employeeId: 1, address: a1)                          <i class="conum" data-value="2"></i><b>(2)</b>
    employee(name: 'John', employeeId: 2 ){
      address( refId: 'a1' )                                                    <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an address can be created with an <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an employee can reference the address directly with its id</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or use the <code>refId</code> attribute corresponding to the <code>id</code> of the corresponding address</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its worth mentioning that you cannot modify the properties of a
referenced bean.</p>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder"><a class="anchor" href="#_jmxbuilder"></a><a class="link" href="#_jmxbuilder">JmxBuilder</a></h6>
<div class="paragraph">
<p>See <a href="#jmx_jmxbuilder">Working with JMX - JmxBuilder</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="_filetreebuilder"><a class="anchor" href="#_filetreebuilder"></a><a class="link" href="#_filetreebuilder">FileTreeBuilder</a></h6>
<div class="paragraph">
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/util/FileTreeBuilder.html">groovy.util.FileTreeBuilder</a> is a builder for generating a file directory structure from a specification. For example, to create the following tree:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> src/
  |--- main
  |     |--- groovy
  |            |--- Foo.groovy
  |--- test
        |--- groovy
               |--- FooTest.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>You can use a <code>FileTreeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">tmpDir = File.createTempDir()
def fileTreeBuilder = new FileTreeBuilder(tmpDir)
fileTreeBuilder.dir('src') {
    dir('main') {
       dir('groovy') {
          file('Foo.groovy', 'println "Hello"')
       }
    }
    dir('test') {
       dir('groovy') {
          file('FooTest.groovy', 'class FooTest extends groovy.test.GroovyTestCase {}')
       }
    }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check that everything worked as expected we use the following `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new File(tmpDir, '/src/main/groovy/Foo.groovy').text == 'println "Hello"'
assert new File(tmpDir, '/src/test/groovy/FooTest.groovy').text == 'class FooTest extends groovy.test.GroovyTestCase {}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FileTreeBuilder</code> also supports a shorthand syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">tmpDir = File.createTempDir()
def fileTreeBuilder = new FileTreeBuilder(tmpDir)
fileTreeBuilder.src {
    main {
       groovy {
          'Foo.groovy'('println "Hello"')
       }
    }
    test {
       groovy {
          'FooTest.groovy'('class FooTest extends groovy.test.GroovyTestCase {}')
       }
    }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces the same directory structure as above, as shown by these `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert new File(tmpDir, '/src/main/groovy/Foo.groovy').text == 'println "Hello"'
assert new File(tmpDir, '/src/test/groovy/FooTest.groovy').text == 'class FooTest extends groovy.test.GroovyTestCase {}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_builder"><a class="anchor" href="#_creating_a_builder"></a><a class="link" href="#_creating_a_builder">Creating a builder</a></h5>
<div class="paragraph">
<p>While Groovy has many built-in builders, the builder pattern is so common,
you will no doubt eventually come across a building requirement that
hasn&#8217;t been catered for by those built-in builders.
The good news is that you can build your own.
You can do everything from scratch by relying on Groovy&#8217;s
metaprogramming capabilities. Alternatively, the <code>BuilderSupport</code>
and <code>FactoryBuilderSupport</code> classes make designing your own
builders much easier.</p>
</div>
<div class="sect5">
<h6 id="_buildersupport"><a class="anchor" href="#_buildersupport"></a><a class="link" href="#_buildersupport">BuilderSupport</a></h6>
<div class="paragraph">
<p>One approach to building a builder is to subclass <code>BuilderSupport</code>.
With this approach, the general idea is to override one or more of a number of
<em>lifecycle</em> methods including <code>setParent</code>, <code>nodeCompleted</code> and some or
all of the <code>createNode</code> methods from the <code>BuilderSupport</code> abstract class.</p>
</div>
<div class="paragraph">
<p>As an example, suppose we want to create a builder of
tracking athletic training programs. Each program is made
up of a number of sets and each set has its own steps.
A step might itself be a set of smaller steps.
For each <code>set</code> or <code>step</code>, we might wish to record
the <code>distance</code> required (or <code>time</code>), whether to <code>repeat</code>
the steps a certain number of times, whether to take a <code>break</code>
between each step and so forth.</p>
</div>
<div class="paragraph">
<p>For the simplicity of this example, we&#8217;ll capture the training
programming using maps and lists. A set has a list of steps.
Information like <code>repeat</code> count or <code>distance</code> will be tracked
in a map of attributes for each step and set.</p>
</div>
<div class="paragraph">
<p>The builder implementation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override a couple of the <code>createNode</code> methods.
We&#8217;ll create a map capturing the set name, an empty list of steps,
and potentially some attributes.</p>
</li>
<li>
<p>Whenever we complete a node we&#8217;ll add the node to the list of steps
for the parent (if any).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TrainingBuilder1 extends BuilderSupport {
    protected createNode(name) {
        [name: name, steps: []]
    }

    protected createNode(name, Map attributes) {
        createNode(name) + attributes
    }

    void nodeCompleted(maybeParent, node) {
        if (maybeParent) maybeParent.steps &lt;&lt; node
    }

    // unused lifecycle methods
    protected void setParent(parent, child) { }
    protected createNode(name, Map attributes, value) { }
    protected createNode(name, value) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we&#8217;ll write a little helper method which recursively
adds up the distances of all substeps, accounting for repeated steps
as needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def total(map) {
    if (map.distance) return map.distance
    def repeat = map.repeat ?: 1
    repeat * map.steps.sum{ total(it) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can now use our builder and helper method to create a
swimming training program and check its total distance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def training = new TrainingBuilder1()

def monday = training.swimming {
    warmup(repeat: 3) {
        freestyle(distance: 50)
        breaststroke(distance: 50)
    }
    endurance(repeat: 20) {
        freestyle(distance: 50, break: 15)
    }
    warmdown {
        kick(distance: 100)
        choice(distance: 100)
    }
}

assert 1500 == total(monday)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_factorybuildersupport"><a class="anchor" href="#_factorybuildersupport"></a><a class="link" href="#_factorybuildersupport">FactoryBuilderSupport</a></h6>
<div class="paragraph">
<p>A second approach to building a builder is to subclass <code>FactoryBuilderSupport</code>.
This builder has similar goals to <code>BuilderSupport</code> but with extra features
to simplify domain class construction.</p>
</div>
<div class="paragraph">
<p>With this approach, the general idea is to override one or more of a number of
<em>lifecycle</em> methods including <code>resolveFactory</code>, <code>nodeCompleted</code> and <code>postInstantiate</code> methods from the <code>FactoryBuilderSupport</code> abstract class.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll use the same example as for the previous <code>BuilderSupport</code> example;
a builder of tracking athletic training programs.</p>
</div>
<div class="paragraph">
<p>For this example, rather than capturing the training
programming using maps and lists, we&#8217;ll use some simple domain classes.</p>
</div>
<div class="paragraph">
<p>The builder implementation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override the <code>resolveFactory</code> method to return a special
factory which returns classes by capitalizing the names used in our mini DSL.</p>
</li>
<li>
<p>Whenever we complete a node we&#8217;ll add the node to the list of steps
for the parent (if any).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code, including the code for the special factory class, looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static org.apache.groovy.util.BeanUtils.capitalize

class TrainingBuilder2 extends FactoryBuilderSupport {
    def factory = new TrainingFactory(loader: getClass().classLoader)

    protected Factory resolveFactory(name, Map attrs, value) {
        factory
    }

    void nodeCompleted(maybeParent, node) {
        if (maybeParent) maybeParent.steps &lt;&lt; node
    }
}

class TrainingFactory extends AbstractFactory {
    ClassLoader loader
    def newInstance(FactoryBuilderSupport fbs, name, value, Map attrs) {
        def clazz = loader.loadClass(capitalize(name))
        value ? clazz.newInstance(value: value) : clazz.newInstance()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rather than using lists and maps, we&#8217;ll have some simple domain classes
and related traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">trait HasDistance {
    int distance
}

trait Container extends HasDistance {
    List steps = []
    int repeat
}

class Cycling implements Container { }

class Interval implements Container { }

class Sprint implements HasDistance {}

class Tempo implements HasDistance {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like for the <code>BuilderSupport</code> example, it is useful to have a helper method
to calculate the total distance covered during the training session.
The implementation is very similar to our earlier example, but is adjusted
to work well with our newly defined traits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def total(HasDistance c) {
    c.distance
}

def total(Container c) {
    if (c.distance) return c.distance
    def repeat = c.repeat ?: 1
    repeat * c.steps.sum{ total(it) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can now use our new builder and helper methods to create a
cycling training program and check its total distance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def training = new TrainingBuilder2()

def tuesday = training.cycling {
    interval(repeat: 5) {
        sprint(distance: 400)
        tempo(distance: 3600)
    }
}

assert 20000 == total(tuesday)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_jmx"><a class="anchor" href="#_working_with_jmx"></a><a class="link" href="#_working_with_jmx">3.22. Working with JMX</a></h3>
<div class="sect3">
<h4 id="_introduction_6"><a class="anchor" href="#_introduction_6"></a><a class="link" href="#_introduction_6">3.22.1. Introduction</a></h4>
<div class="paragraph">
<p>The <a href="https://www.oracle.com/java/technologies/javase/javamanagement.html">Java Management Extensions (JMX)</a>
technology provides a standard way of managing resources such as applications, devices, and services on the JDK.
Each resource to be managed is represented by a <em>Managed Bean</em> (or <em>MBean</em>).
Given that Groovy sits directly on top of Java, Groovy can leverage the tremendous amount of work already
done for JMX with Java. In addition, Groovy provides a <code>GroovyMBean</code> class, in the <code>groovy-jmx</code> module,
which makes an MBean look like a normal Groovy object and simplifies Groovy code for interacting with MBeans.
For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">println server.getAttribute(beanName, 'Age')
server.setAttribute(beanName, new Attribute('Name', 'New name'))
Object[] params = [5, 20]
String[] signature = [Integer.TYPE, Integer.TYPE]
println server.invoke(beanName, 'add', params, signature)</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be simplified to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def mbean = new GroovyMBean(server, beanName)
println mbean.Age
mbean.Name = 'New name'
println mbean.add(5, 20)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The remainder of this page shows you how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitor the JVM using MXBeans</p>
</li>
<li>
<p>Monitor Apache Tomcat and display statistics</p>
</li>
<li>
<p>Monitor Oracle OC4J and display information</p>
</li>
<li>
<p>Monitor BEA WebLogic and display information</p>
</li>
<li>
<p>Leverage Spring&#8217;s MBean annotation support to export your Groovy beans as MBeans</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_the_jvm"><a class="anchor" href="#_monitoring_the_jvm"></a><a class="link" href="#_monitoring_the_jvm">3.22.2. Monitoring the JVM</a></h4>
<div class="paragraph">
<p>MBeans are not accessed directly by an application but are managed by a repository called an <em>MBean server</em>. Java includes a special MBean server called the <em>platform MBean server</em>, which is built into the JVM. Platform MBeans are registered in this server using unique names.</p>
</div>
<div class="paragraph">
<p>You can monitor the JVM through its platform MBeans with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.lang.management.*

def os = ManagementFactory.operatingSystemMXBean
println """OPERATING SYSTEM:
\tarchitecture = $os.arch
\tname = $os.name
\tversion = $os.version
\tprocessors = $os.availableProcessors
"""

def rt = ManagementFactory.runtimeMXBean
println """RUNTIME:
\tname = $rt.name
\tspec name = $rt.specName
\tvendor = $rt.specVendor
\tspec version = $rt.specVersion
\tmanagement spec version = $rt.managementSpecVersion
"""

def cl = ManagementFactory.classLoadingMXBean
println """CLASS LOADING SYSTEM:
\tisVerbose = ${cl.isVerbose()}
\tloadedClassCount = $cl.loadedClassCount
\ttotalLoadedClassCount = $cl.totalLoadedClassCount
\tunloadedClassCount = $cl.unloadedClassCount
"""

def comp = ManagementFactory.compilationMXBean
println """COMPILATION:
\ttotalCompilationTime = $comp.totalCompilationTime
"""

def mem = ManagementFactory.memoryMXBean
def heapUsage = mem.heapMemoryUsage
def nonHeapUsage = mem.nonHeapMemoryUsage
println """MEMORY:
HEAP STORAGE:
\tcommitted = $heapUsage.committed
\tinit = $heapUsage.init
\tmax = $heapUsage.max
\tused = $heapUsage.used
NON-HEAP STORAGE:
\tcommitted = $nonHeapUsage.committed
\tinit = $nonHeapUsage.init
\tmax = $nonHeapUsage.max
\tused = $nonHeapUsage.used
"""

ManagementFactory.memoryPoolMXBeans.each { mp -&gt;
    println "\tname: " + mp.name
    String[] mmnames = mp.memoryManagerNames
    mmnames.each{ mmname -&gt;
        println "\t\tManager Name: $mmname"
    }
    println "\t\tmtype = $mp.type"
    println "\t\tUsage threshold supported = " + mp.isUsageThresholdSupported()
}
println()

def td = ManagementFactory.threadMXBean
println "THREADS:"
td.allThreadIds.each { tid -&gt;
    println "\tThread name = ${td.getThreadInfo(tid).threadName}"
}
println()

println "GARBAGE COLLECTION:"
ManagementFactory.garbageCollectorMXBeans.each { gc -&gt;
    println "\tname = $gc.name"
    println "\t\tcollection count = $gc.collectionCount"
    println "\t\tcollection time = $gc.collectionTime"
    String[] mpoolNames = gc.memoryPoolNames
    mpoolNames.each { mpoolName -&gt;
        println "\t\tmpool name = $mpoolName"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, you will see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OPERATING SYSTEM:
            	architecture = amd64
            	name = Windows 10
            	version = 10.0
            	processors = 12

RUNTIME:
            	name = 724176@QUOKKA
            	spec name = Java Virtual Machine Specification
            	vendor = Oracle Corporation
            	spec version = 11
            	management spec version = 2.0

CLASS LOADING SYSTEM:
            	isVerbose = false
            	loadedClassCount = 6962
            	totalLoadedClassCount = 6969
            	unloadedClassCount = 0

COMPILATION:
            	totalCompilationTime = 7548

MEMORY:
            HEAP STORAGE:
            	committed = 645922816
            	init = 536870912
            	max = 8560574464
            	used = 47808352
            NON-HEAP STORAGE:
            	committed = 73859072
            	init = 7667712
            	max = -1
            	used = 70599520

	name: CodeHeap 'non-nmethods'
		Manager Name: CodeCacheManager
		mtype = Non-heap memory
		Usage threshold supported = true
	name: Metaspace
		Manager Name: Metaspace Manager
		mtype = Non-heap memory
		Usage threshold supported = true
	name: CodeHeap 'profiled nmethods'
		Manager Name: CodeCacheManager
		mtype = Non-heap memory
		Usage threshold supported = true
	name: Compressed Class Space
		Manager Name: Metaspace Manager
		mtype = Non-heap memory
		Usage threshold supported = true
	name: G1 Eden Space
		Manager Name: G1 Old Generation
		Manager Name: G1 Young Generation
		mtype = Heap memory
		Usage threshold supported = false
	name: G1 Old Gen
		Manager Name: G1 Old Generation
		Manager Name: G1 Young Generation
		mtype = Heap memory
		Usage threshold supported = true
	name: G1 Survivor Space
		Manager Name: G1 Old Generation
		Manager Name: G1 Young Generation
		mtype = Heap memory
		Usage threshold supported = false
	name: CodeHeap 'non-profiled nmethods'
		Manager Name: CodeCacheManager
		mtype = Non-heap memory
		Usage threshold supported = true

THREADS:
	Thread name = Reference Handler
	Thread name = Finalizer
	Thread name = Signal Dispatcher
	Thread name = Attach Listener
	Thread name = Common-Cleaner
	Thread name = Java2D Disposer
	Thread name = AWT-Shutdown
	Thread name = AWT-Windows
	Thread name = Image Fetcher 0
	Thread name = AWT-EventQueue-0
	Thread name = D3D Screen Updater
	Thread name = DestroyJavaVM
	Thread name = TimerQueue
	Thread name = Thread-0

GARBAGE COLLECTION:
	name = G1 Young Generation
		collection count = 6
		collection time = 69
		mpool name = G1 Eden Space
		mpool name = G1 Survivor Space
		mpool name = G1 Old Gen
	name = G1 Old Generation
		collection count = 0
		collection time = 0
		mpool name = G1 Eden Space
		mpool name = G1 Survivor Space
		mpool name = G1 Old Gen</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_tomcat"><a class="anchor" href="#_monitoring_tomcat"></a><a class="link" href="#_monitoring_tomcat">3.22.3. Monitoring Tomcat</a></h4>
<div class="paragraph">
<p>First start up <a href="https://tomcat.apache.org">Tomcat</a> with JMX monitoring enabled by setting the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">set JAVA_OPTS=-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9004\
 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can do this in your startup script and may choose any available port, we used 9004.</p>
</div>
<div class="paragraph">
<p>The following code uses JMX to discover the available MBeans in the running Tomcat, determine which are web modules,
extract the processing time for each web module and displays the result in a graph using JFreeChart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.swing.SwingBuilder
import groovy.jmx.GroovyMBean

import javax.management.ObjectName
import javax.management.remote.JMXConnectorFactory as JmxFactory
import javax.management.remote.JMXServiceURL as JmxUrl
import javax.swing.WindowConstants as WC

import org.jfree.chart.ChartFactory
import org.jfree.data.category.DefaultCategoryDataset as Dataset
import org.jfree.chart.plot.PlotOrientation as Orientation

def serverUrl = 'service:jmx:rmi:///jndi/rmi://localhost:9004/jmxrmi'
def server = JmxFactory.connect(new JmxUrl(serverUrl)).MBeanServerConnection
def serverInfo = new GroovyMBean(server, 'Catalina:type=Server').serverInfo
println "Connected to: $serverInfo"

def query = new ObjectName('Catalina:*')
String[] allNames = server.queryNames(query, null)
def modules = allNames.findAll { name -&gt;
    name.contains('j2eeType=WebModule')
}.collect{ new GroovyMBean(server, it) }

println "Found ${modules.size()} web modules. Processing ..."
def dataset = new Dataset()

modules.each { m -&gt;
    println m.name()
    dataset.addValue m.processingTime, 0, m.path
}

def labels = ['Time per Module', 'Module', 'Time']
def options = [false, true, true]
def chart = ChartFactory.createBarChart(*labels, dataset,
                Orientation.VERTICAL, *options)
def swing = new SwingBuilder()
def frame = swing.frame(title:'Catalina Module Processing Time', defaultCloseOperation:WC.DISPOSE_ON_CLOSE) {
    panel(id:'canvas') { rigidArea(width:800, height:350) }
}
frame.pack()
frame.show()
chart.draw(swing.canvas.graphics, swing.canvas.bounds)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, we will see a trace of progress being made:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Connected to: Apache Tomcat/9.0.37
Found 5 web modules. Processing ...
Catalina:j2eeType=WebModule,name=//localhost/docs,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/manager,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/examples,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/host-manager,J2EEApplication=none,J2EEServer=none</pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xcatalina.png.pagespeed.ic.zIQO-SZoHR.png" alt="catalina"></span></p>
</div>
<div class="paragraph">
<p>Note: if you get errors running this script, see the <strong>Troubleshooting</strong> section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oc4j_example"><a class="anchor" href="#_oc4j_example"></a><a class="link" href="#_oc4j_example">3.22.4. OC4J Example</a></h4>
<div class="paragraph">
<p>Here is a script to access OC4J and print out some information about the server, its runtime and (as an example) the configured JMS destinations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import javax.management.remote.*
import oracle.oc4j.admin.jmx.remote.api.JMXConnectorConstant

def serverUrl = new JMXServiceURL('service:jmx:rmi://localhost:23791')
def serverPath = 'oc4j:j2eeType=J2EEServer,name=standalone'
def jvmPath = 'oc4j:j2eeType=JVM,name=single,J2EEServer=standalone'
def provider = 'oracle.oc4j.admin.jmx.remote'
def credentials = [
    (JMXConnectorConstant.CREDENTIALS_LOGIN_KEY): 'oc4jadmin',
    (JMXConnectorConstant.CREDENTIALS_PASSWORD_KEY): 'admin'
]
def env = [
    (JMXConnectorFactory.PROTOCOL_PROVIDER_PACKAGES): provider,
    (JMXConnector.CREDENTIALS): credentials
]
def server = JmxFactory.connect(serverUrl, env).MBeanServerConnection
def serverInfo = new GroovyMBean(server, serverPath)
def jvmInfo = new GroovyMBean(server, jvmPath)
println """Connected to $serverInfo.node. \
Server started ${new Date(serverInfo.startTime)}.
OC4J version:  $serverInfo.serverVersion from $serverInfo.serverVendor
JVM version:   $jvmInfo.javaVersion from $jvmInfo.javaVendor
Memory usage:  $jvmInfo.freeMemory bytes free, \
$jvmInfo.totalMemory bytes total
"""

def query = new javax.management.ObjectName('oc4j:*')
String[] allNames = server.queryNames(query, null)
def dests = allNames.findAll { name -&gt;
    name.contains('j2eeType=JMSDestinationResource')
}.collect { new GroovyMBean(server, it) }

println "Found ${dests.size()} JMS destinations. Listing ..."
dests.each { d -&gt; println "$d.name: $d.location" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Connected to LYREBIRD. Server started Thu May 31 21:04:54 EST 2007.
OC4J version:  11.1.1.0.0 from Oracle Corp.
JVM version:   1.6.0_01 from Sun Microsystems Inc.
Memory usage:  8709976 bytes free, 25153536 bytes total

Found 5 JMS destinations. Listing ...
Demo Queue: jms/demoQueue
Demo Topic: jms/demoTopic
jms/Oc4jJmsExceptionQueue: jms/Oc4jJmsExceptionQueue
jms/RAExceptionQueue: jms/RAExceptionQueue
OracleASRouter_store: OracleASRouter_store</pre>
</div>
</div>
<div class="paragraph">
<p>As a slight variation, this script displays a pie chart of memory usage using JFreeChart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.jfree.chart.ChartFactory
import javax.swing.WindowConstants as WC
import javax.management.remote.*
import oracle.oc4j.admin.jmx.remote.api.JMXConnectorConstant

def url = 'service:jmx:rmi://localhost:23791'
def credentials = [:]
credentials[JMXConnectorConstant.CREDENTIALS_LOGIN_KEY] = "oc4jadmin"
credentials[JMXConnectorConstant.CREDENTIALS_PASSWORD_KEY] = "password"
def env = [:]
env[JMXConnectorFactory.PROTOCOL_PROVIDER_PACKAGES] = "oracle.oc4j.admin.jmx.remote"
env[JMXConnector.CREDENTIALS] = credentials
def server = JMXConnectorFactory.connect(new JMXServiceURL(url), env).MBeanServerConnection
def jvmInfo = new GroovyMBean(server, 'oc4j:j2eeType=JVM,name=single,J2EEServer=standalone')

def piedata = new org.jfree.data.general.DefaultPieDataset()
piedata.setValue "Free", jvmInfo.freeMemory
piedata.setValue "Used", jvmInfo.totalMemory - jvmInfo.freeMemory

def options = [true, true, true]
def chart = ChartFactory.createPieChart('OC4J Memory Usage', piedata, *options)
chart.backgroundPaint = java.awt.Color.white
def swing = new groovy.swing.SwingBuilder()
def frame = swing.frame(title:'OC4J Memory Usage', defaultCloseOperation:WC.EXIT_ON_CLOSE) {
    panel(id:'canvas') { rigidArea(width:350, height:250) }
}
frame.pack()
frame.show()
chart.draw(swing.canvas.graphics, swing.canvas.bounds)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which looks like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xoc4jpie.png.pagespeed.ic.gbxKqm8f4H.png" alt="oc4jpie"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_weblogic_example"><a class="anchor" href="#_weblogic_example"></a><a class="link" href="#_weblogic_example">3.22.5. WebLogic Example</a></h4>
<div class="paragraph">
<p>This script prints out information about the server followed by information about JMS Destinations (as an example). Many other mbeans are <a href="http://docs.oracle.com/cd/E13222_01/wls/docs90/wlsmbeanref/core/index.html">available</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import javax.management.remote.*
import javax.management.*
import javax.naming.Context
import groovy.jmx.GroovyMBean

def urlRuntime = '/jndi/weblogic.management.mbeanservers.runtime'
def urlBase = 'service:jmx:t3://localhost:7001'

def serviceURL = new JMXServiceURL(urlBase + urlRuntime)
def h = new Hashtable()
h.put(Context.SECURITY_PRINCIPAL, 'weblogic')
h.put(Context.SECURITY_CREDENTIALS, 'weblogic')
h.put(JMXConnectorFactory.PROTOCOL_PROVIDER_PACKAGES, 'weblogic.management.remote')
def server = JMXConnectorFactory.connect(serviceURL, h).MBeanServerConnection
def domainName = new ObjectName('com.bea:Name=RuntimeService,Type=weblogic.management.mbeanservers.runtime.RuntimeServiceMBean')
def rtName = server.getAttribute(domainName, 'ServerRuntime')
def rt = new GroovyMBean(server, rtName)
println "Server: name=$rt.Name, state=$rt.State, version=$rt.WeblogicVersion"
def destFilter = Query.match(Query.attr('Type'), Query.value('JMSDestinationRuntime'))
server.queryNames(new ObjectName('com.bea:*'), destFilter).each { name -&gt;
    def jms = new GroovyMBean(server, name)
    println "JMS Destination: name=$jms.Name, type=$jms.DestinationType, messages=$jms.MessagesReceivedCount"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Server: name=examplesServer, state=RUNNING, version=WebLogic Server 10.0  Wed May 9 18:10:27 EDT 2007 933139
JMS Destination: name=examples-jms!exampleTopic, type=Topic, messages=0
JMS Destination: name=examples-jms!exampleQueue, type=Queue, messages=0
JMS Destination: name=examples-jms!jms/MULTIDATASOURCE_MDB_QUEUE, type=Queue, messages=0
JMS Destination: name=examplesJMSServer!examplesJMSServer.TemporaryQueue0, type=Queue, messages=68
JMS Destination: name=examples-jms!quotes, type=Topic, messages=0
JMS Destination: name=examples-jms!weblogic.wsee.wseeExamplesDestinationQueue, type=Queue, messages=0
JMS Destination: name=examples-jms!weblogic.examples.ejb30.ExampleQueue, type=Queue, messages=0</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spring_example"><a class="anchor" href="#_spring_example"></a><a class="link" href="#_spring_example">3.22.6. Spring Example</a></h4>
<div class="paragraph">
<p>You can also use Spring to automatically register beans as JMX aware.</p>
</div>
<div class="paragraph">
<p>Here is an example class (Calculator.groovy):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.springframework.jmx.export.annotation.*

@ManagedResource(objectName="bean:name=calcMBean", description="Calculator MBean")
public class Calculator {

    private int invocations

    @ManagedAttribute(description="The Invocation Attribute")
    public int getInvocations() {
        return invocations
    }

    private int base = 10

    @ManagedAttribute(description="The Base to use when adding strings")
    public int getBase() {
        return base
    }

    @ManagedAttribute(description="The Base to use when adding strings")
    public void setBase(int base) {
        this.base = base
    }

    @ManagedOperation(description="Add two numbers")
    @ManagedOperationParameters([
        @ManagedOperationParameter(name="x", description="The first number"),
        @ManagedOperationParameter(name="y", description="The second number")])
    public int add(int x, int y) {
        invocations++
        return x + y
    }

    @ManagedOperation(description="Add two strings representing numbers of a particular base")
    @ManagedOperationParameters([
        @ManagedOperationParameter(name="x", description="The first number"),
        @ManagedOperationParameter(name="y", description="The second number")])
    public String addStrings(String x, String y) {
        invocations++
        def result = Integer.valueOf(x, base) + Integer.valueOf(y, base)
        return Integer.toString(result, base)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the Spring configuration file (beans.xml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;
    &lt;bean id="mbeanServer"
          class="org.springframework.jmx.support.MBeanServerFactoryBean"&gt;
        &lt;property name="locateExistingServerIfPossible" value="true"/&gt;
    &lt;/bean&gt;

    &lt;bean id="exporter"
          class="org.springframework.jmx.export.MBeanExporter"&gt;
        &lt;property name="assembler" ref="assembler"/&gt;
        &lt;property name="namingStrategy" ref="namingStrategy"/&gt;
        &lt;property name="beans"&gt;
            &lt;map&gt;
                &lt;entry key="bean:name=defaultCalcName" value-ref="calcBean"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
        &lt;property name="server" ref="mbeanServer"/&gt;
        &lt;property name="autodetect" value="true"/&gt;
    &lt;/bean&gt;

    &lt;bean id="jmxAttributeSource"
          class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"/&gt;

    &lt;!-- will create management interface using annotation metadata --&gt;
    &lt;bean id="assembler"
          class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    &lt;!-- will pick up the ObjectName from the annotation --&gt;
    &lt;bean id="namingStrategy"
          class="org.springframework.jmx.export.naming.MetadataNamingStrategy"&gt;
        &lt;property name="attributeSource" ref="jmxAttributeSource"/&gt;
    &lt;/bean&gt;

    &lt;bean id="calcBean"
          class="Calculator"&gt;
        &lt;property name="base" value="10"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a script which uses this bean and configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.springframework.context.support.ClassPathXmlApplicationContext
import java.lang.management.ManagementFactory
import javax.management.ObjectName
import javax.management.Attribute
import groovy.jmx.GroovyMBean

// get normal bean
def ctx = new ClassPathXmlApplicationContext("beans.xml")
def calc = ctx.getBean("calcBean")

Thread.start {
    // access bean via JMX, use a separate thread just to
    // show that we could access remotely if we wanted
    def server = ManagementFactory.platformMBeanServer
    def mbean = new GroovyMBean(server, 'bean:name=calcMBean')
    sleep 1000
    assert 8 == mbean.add(7, 1)
    mbean.Base = 8
    assert '10' == mbean.addStrings('7', '1')
    mbean.Base = 16
    sleep 2000
    println "Number of invocations: $mbean.Invocations"
    println mbean
}

assert 15 == calc.add(9, 6)
assert '11' == calc.addStrings('10', '1')
sleep 2000
assert '20' == calc.addStrings('1f', '1')</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Number of invocations: 5
MBean Name:
  bean:name=calcMBean

Attributes:
  (rw) int Base
  (r) int Invocations
Operations:
  int add(int x, int y)
  java.lang.String addStrings(java.lang.String x, java.lang.String y)
  int getInvocations()
  int getBase()
  void setBase(int p1)</pre>
</div>
</div>
<div class="paragraph">
<p>You can even attach to the process while it is running with <a href="https://docs.oracle.com/en/java/javase/14/management/using-jconsole.html">jconsole</a>. It will look something like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xjconsole.png.pagespeed.ic.QKMc5lv7r9.png" alt="jconsole"></span></p>
</div>
<div class="paragraph">
<p>We started the Groovy application with the <code>-Dcom.sun.management.jmxremote</code> JVM argument.</p>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#dynamic-language-beans">Dynamic language beans in Spring</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jmx">Spring JMX Documentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a><a class="link" href="#_troubleshooting">3.22.7. Troubleshooting</a></h4>
<div class="sect4">
<h5 id="_java_lang_securityexception"><a class="anchor" href="#_java_lang_securityexception"></a><a class="link" href="#_java_lang_securityexception">java.lang.SecurityException</a></h5>
<div class="paragraph">
<p>If you get the following error, your container&#8217;s JMX access is password protected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.SecurityException: Authentication failed! Credentials required</pre>
</div>
</div>
<div class="paragraph">
<p>To fix that, add an environment with the credentials when connecting, like this (password has to be set before that):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jmxEnv = null
if (password != null) {
    jmxEnv = [(JMXConnector.CREDENTIALS): (String[])["monitor", password]]
}
def connector = JMXConnectorFactory.connect(new JMXServiceURL(serverUrl), jmxEnv)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Details for the software you are trying to monitor/manage may differ slightly. Check out the other examples using credentials above if appropriate (e.g. OC4J and WebLogic). If you still have troubles, you will have to consult the documentation for the software you are trying to monitor/manage for details on how to provide credentials.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx_jmxbuilder"><a class="anchor" href="#jmx_jmxbuilder"></a><a class="link" href="#jmx_jmxbuilder">3.22.8. JmxBuilder</a></h4>
<div class="paragraph">
<p><strong>JmxBuilder is a Groovy-based domain specific language for the Java Management Extension (JMX) API</strong>. It uses the builder pattern (FactoryBuilder) to create an internal DSL that facilitates the exposure of POJO&#8217;s and Groovy beans as management components via the MBean server. JmxBuilder hides the complexity of creating and exporting management beans via the JMX API and provides a set of natural Groovy constructs to interact with the JMX infrastructure.</p>
</div>
<div class="sect4">
<h5 id="_instantiating_jmxbuilder"><a class="anchor" href="#_instantiating_jmxbuilder"></a><a class="link" href="#_instantiating_jmxbuilder">Instantiating JmxBuilder</a></h5>
<div class="paragraph">
<p>To start using JmxBuilder, simply make sure the jar file is on your class path. Then you can do the following in your code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def jmx = new JmxBuilder()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>That&#8217;s it!</strong> You are now ready to use the JmxBuilder.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can pass in an instance of <strong>your own MBeanServer</strong> to the builder (<strong>JmxBuilder(MBeanServer)</strong>)</p>
</li>
<li>
<p>If no MBeanServer is specified, the builder instance will default to the underlying platform MBeanServer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have an instance of JmxBuilder, you are now ready to invoke any of its builder nodes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jmx_connectors"><a class="anchor" href="#_jmx_connectors"></a><a class="link" href="#_jmx_connectors">JMX Connectors</a></h5>
<div class="paragraph">
<p>Remote connectivity is a crucial part of the JMX architecture. JmxBuilder facilitates the creation of connector servers and connector clients with a minimal amount of coding.</p>
</div>
<div class="sect5">
<h6 id="_connector_server"><a class="anchor" href="#_connector_server"></a><a class="link" href="#_connector_server">Connector Server</a></h6>
<div class="paragraph">
<p>JmxBuilder.connectorServer() supports the full Connector api syntax and will let you specify properties, override the URL, specify your own host, etc.</p>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.connectorServer(
    protocol:"rmi",
    host:"...",
    port:1099,
    url:"...",
    properties:[
        "authenticate":true|false,
        "passwordFile":"...",
        "accessFile":"...",
        "sslEnabled" : true | false
        // any valid connector property
    ]
)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the serverConnector node will accept four ServerConnector property aliases (authenticate, passwordFile,accessFile, and sslEnabled). You can use these aliases or provided any of the RMI-supported properties.</p>
</div>
<div class="paragraph">
<p><strong>Example - Connector Server (see correction below)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jmx.connectorServer(port: 9000).start()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above returns an RMI connector that will start listening on port 9000. By default, the builder will internally generate URL <strong>"service:jmx:rmi:///jndi/rmi://localhost:9000/jmxrmi"</strong>.</p>
</div>
<div class="paragraph">
<p><em>NOTE: Sadly you are as likely to get something like the following when attempting to run the previous snippet of code (example is incomplete, see below):</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Caught: java.io.IOException: Cannot bind to URL [rmi://localhost:9000/jmxrmi]: javax.naming.ServiceUnavailableException [Root exception is java.rmi.ConnectException: Connection refused to host: localhost; nested exception is:
?????? java.net.ConnectException: Connection refused]
??</pre>
</div>
</div>
<div class="paragraph">
<p><em>This occurs on Mac and Linux (CentOS 5) with Groovy 1.6 installed. Perhaps there were assumptions made about the configuration of the /etc/hosts file?</em></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>The correct example is shown below.</em>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Connector Example (Corrected) - Connector Server</strong></p>
</div>
<div class="paragraph">
<p>The example above does not create the RMI registry. So, in order to export, you have to first export the RMI object registry (make sure to import <code>java.rmi.registry.LocateRegistry</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.rmi.registry.LocateRegistry
//...

LocateRegistry.createRegistry(9000)
jmx.connectorServer(port: 9000).start()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_connector_client"><a class="anchor" href="#_connector_client"></a><a class="link" href="#_connector_client">Connector Client</a></h6>
<div class="paragraph">
<p>JmxBuilder.connectorClient() node lets you create JMX connector client object to connect to a JMX MBean Server.</p>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.connectorClient (
    protocol:"rmi",
    host:"...",
    port:1099,
    url:"...",
)</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example - Client Connector</strong></p>
</div>
<div class="paragraph">
<p>Creating a connector client can be done just as easily. With one line of code, you can create an instance of a JMX Connector Client as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def client = jmx.connectorClient(port: 9000)
client.connect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then access the MBeanServerConnection associated with the connector using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">client.getMBeanServerConnection()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jmxbuilder_mbean_export"><a class="anchor" href="#_jmxbuilder_mbean_export"></a><a class="link" href="#_jmxbuilder_mbean_export">JmxBuilder MBean Export</a></h5>
<div class="paragraph">
<p>You can <strong>export a Java object or a Groovy object</strong> with minimal coding. JmxBuilder will even find and <strong>export dynamic Groovy methods</strong> injected at runtime.</p>
</div>
<div class="sect5">
<h6 id="_implicit_vs_explicit_descriptors"><a class="anchor" href="#_implicit_vs_explicit_descriptors"></a><a class="link" href="#_implicit_vs_explicit_descriptors">Implicit vs Explicit Descriptors</a></h6>
<div class="paragraph">
<p>When using the builder, you can <strong>let JmxBuilder implicitly generate</strong> all of your MBean descriptor info. This is useful when you want to write minimal code to quickly export your beans. You can also explicitly declare all descriptor info for the bean. This gives you total control on how you want to describe every piece of information that you want to export for the underlying bean.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_jmxbuilder_export_node"><a class="anchor" href="#_the_jmxbuilder_export_node"></a><a class="link" href="#_the_jmxbuilder_export_node">The JmxBuilder.export() Node</a></h6>
<div class="paragraph">
<p>The <strong>JmxBuilder.export() node provides a container</strong> where all management entities to be exported to the MBeanServer are placed. You can place one or more bean() or timer() nodes as children of the export() node. JmxBuilder will <strong>automatically batch export the entities described</strong> by the nodes to the MBean server for management (see example below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def beans = jmx.export {
    bean(new Foo())
    bean(new Bar())
    bean(new SomeBar())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code snippet above, <strong>JmxBuilder.export() will export three management beans</strong> to the MBean server.</p>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder_export_syntax"><a class="anchor" href="#_jmxbuilder_export_syntax"></a><a class="link" href="#_jmxbuilder_export_syntax">JmxBuilder.export() Syntax</a></h6>
<div class="paragraph">
<p>JmxBuilder.export() node supports the <strong>registrationPolicy</strong> parameter to specify how JmxBuilder will behave to resolve bean name collision during MBean registration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.export(policy:"replace|ignore|error")
or
jmx.export(regPolicy:"replace|ignore|error")</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>replace</strong> - JmxBuilder.export() will replace any bean already registered with the MBean during export.</p>
</li>
<li>
<p><strong>ignore</strong> - The bean being exported will be ignored if the same bean is already registered.</p>
</li>
<li>
<p><strong>error</strong> - JmxBuilder.export() throws an error upon bean name collision during registration.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_integration_with_groovymbean_class"><a class="anchor" href="#_integration_with_groovymbean_class"></a><a class="link" href="#_integration_with_groovymbean_class">Integration with GroovyMBean Class</a></h6>
<div class="paragraph">
<p>When you export an MBean to the MBeanServer, <strong>JmxBuilder will return an instance of GroovyMBean</strong> representing the management bean that have been exported by the builder. Nodes such as <strong>bean()</strong> and <strong>timer()</strong> will return an instances of GroovyMBean when they are invoked. The <strong>export()</strong> node returns an <strong>array of all of GroovyMBean[]</strong> representing all managed objects exported to the MBean server.</p>
</div>
</div>
<div class="sect5">
<h6 id="_mbean_registration_with_jmxbuilder_bean"><a class="anchor" href="#_mbean_registration_with_jmxbuilder_bean"></a><a class="link" href="#_mbean_registration_with_jmxbuilder_bean">MBean Registration with JmxBuilder.bean()</a></h6>
<div class="paragraph">
<p>This portion of this reference uses class <strong>RequestController</strong> to illustrate how to use JmxBuilder to export runtime management beans. The class is for illustration purpose and can be a POJO or a Groovy bean.</p>
</div>
<div class="paragraph">
<p><strong>RequestController</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RequestController {
    // constructors
    RequestController() { super() }
    RequestController(Map resource) { }

    // attributes
    boolean isStarted() { true }
    int getRequestCount() { 0 }
    int getResourceCount() { 0 }
    void setRequestLimit(int limit) { }
    int getRequestLimit() { 0 }

    // operations
    void start() { }
    void stop() { }
    void putResource(String name, Object resource) { }
    void makeRequest(String res) { }
    void makeRequest() { }
}</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_implicit_export"><a class="anchor" href="#_implicit_export"></a><a class="link" href="#_implicit_export">Implicit Export</a></h7>
<div class="paragraph">
<p>As mentioned earlier, you can use JmxBuilder&#8217;s flexible syntax to export any POJO/POGO with no descriptor. The builder can automatically describe all aspects of the management beans using implicit defaults. These default values can easily be overridden as we&#8217;ll see in this in the next section.</p>
</div>
<div class="paragraph">
<p>The simplest way to export a POJO or POGO is listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jmx.export {
    bean(new RequestController(resource: "Hello World"))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What this does:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, the <strong>JmxBuilder.export() node will export</strong> an MBean to the MBeanServer representing <strong>the declared POJO</strong> instance.</p>
</li>
<li>
<p>The builder will <strong>generate a default ObjectName</strong> for the MBean and all other MBean descriptor information.</p>
</li>
<li>
<p><strong>JmxBuilder will automatically export</strong> all declared <strong>attributes</strong> (MBean getter/setters), <strong>constructors</strong>, and <strong>operations</strong> on the instance.</p>
</li>
<li>
<p>The exported <strong>attributes</strong> will have <strong>read-only</strong> visibility.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember, <strong>JmxBuilder.export() returns an array of GroovyMBean[] objects</strong> for all exported instances. So, once you call JmxBuilder.export(), <strong>you have immediate access to the underlying MBean proxy</strong> (via GroovyMBean).</p>
</div>
<div class="sect7">
<h8 id="_jconsole_view_of_exported_bean"><a class="anchor" href="#_jconsole_view_of_exported_bean"></a><a class="link" href="#_jconsole_view_of_exported_bean">JConsole view of Exported Bean</a></h8>
<div class="paragraph">
<p><span class="image"><img src="assets/img/xjconsole-implicit-export.png.pagespeed.ic.xxX2qzu5xn.png" alt="jconsole implicit export"></span></p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder_bean_syntax"><a class="anchor" href="#_jmxbuilder_bean_syntax"></a><a class="link" href="#_jmxbuilder_bean_syntax">JmxBuilder.bean() Syntax</a></h6>
<div class="paragraph">
<p>The JmxBuilder.bean() node supports an extensive set of descriptors to describe your bean for management. The JMX MBeanServer uses these descriptors to expose metadata about the bean exposed for management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.export {
    bean(
        target:bean instance,
        name:ObjectName,
        desc:"...",
        attributes:"*",
        attributes:[]
        attributes:[ "AttrubuteName1","AttributeName2",...,"AttributeName_n" ]
        attributes:[
            "AttributeName":"*",
            "AttributeName":[
                desc:"...",
                defaultValue:value,
                writable:true|false,
                editable:true|false,
                onChange:{event-&gt; // event handler}
            ]
        ],

        constructors:"*",
        constructors:[
            "Constructor Name":[],
            "Constructor Name":[ "ParamType1","ParamType2,...,ParamType_n" ],
            "Constructor Name":[
                desc:"...",
                params:[
                    "ParamType1":"*",
                    "ParamType2":[desc:"...", name:"..."],...,
                    "ParamType_n":[desc:"...", name:"..."]
                ]
            ]
        ],

        operations:"*",
        operations:[ "OperationName1", "OperationName2",...,"OperationNameN" ],
        operations:[
            "OperationName1":"*",
            "OperationName2":[ "type1","type2,"type3" ]
            "OperationName3":[
                desc:"...",
                params:[
                    "ParamType1":"*"
                    "ParamType2":[desc:"...", name:"..."],...,
                    "ParamType_n":[desc:"...", name:"..."]
                ],
                onInvoked:{event-&gt; JmxBuilder.send(event:"", to:"")}
            ]
        ],

        listeners:[
            "ListenerName1":[event: "...", from:ObjectName, call:{event-&gt;}],
            "ListenerName2":[event: "...", from:ObjectName, call:&amp;methodPointer]
        ]

    )
}</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of describing the entire node, the following section explore each attribute separately.</p>
</div>
</div>
<div class="sect5">
<h6 id="_bean_node_specifying_mbean_objectname"><a class="anchor" href="#_bean_node_specifying_mbean_objectname"></a><a class="link" href="#_bean_node_specifying_mbean_objectname">Bean() Node - Specifying MBean ObjectName</a></h6>
<div class="paragraph">
<p>Using the bean() node descriptors, you can specify your own MBean ObjectName.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def ctrl = new RequestController(resource:"Hello World")
def beans = jmx.export {
    bean(target: ctrl, name: "jmx.tutorial:type=Object")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ObjectName can be specified as a String or an instance of the ObjectName.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_attribute_export"><a class="anchor" href="#_bean_node_attribute_export"></a><a class="link" href="#_bean_node_attribute_export">Bean() Node - Attribute Export</a></h5>
<div class="paragraph">
<p>JMX attributes are the setters and getters on the underlying bean. The JmxBuilder.bean() node provides several ways to flexibly describe and export MBean attributes. You can combine them however you want to achieve any level of attribute visibility. Let&#8217;s take a look.</p>
</div>
<div class="sect5">
<h6 id="_export_all_attributes_with_wildcard"><a class="anchor" href="#_export_all_attributes_with_wildcard"></a><a class="link" href="#_export_all_attributes_with_wildcard">Export All Attributes with Wildcard "*"</a></h6>
<div class="paragraph">
<p>The following code snippet <strong>will describe and export all attributes</strong> on the bean as read-only. <strong>JmxBuilder will use default values</strong> to describe the attributes that exported for management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(target: new RequestController(),
    name: objName,
    attributes: "*")
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_export_attribute_list"><a class="anchor" href="#_export_attribute_list"></a><a class="link" href="#_export_attribute_list">Export Attribute List</a></h6>
<div class="paragraph">
<p>JmxBuilder will let you specify a list of attributes to export.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        attributes: ["Resource", "RequestCount"]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, <strong>only the "Resource" and "RequestCount" attributes will be exported</strong>. Again, since no descriptors are provided, <strong>JmxBuilder will use sensible defaults</strong> to describe the exported attributes.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_attribute_with_explicit_descriptors"><a class="anchor" href="#_export_attribute_with_explicit_descriptors"></a><a class="link" href="#_export_attribute_with_explicit_descriptors">Export Attribute with Explicit Descriptors</a></h6>
<div class="paragraph">
<p>One of the strengths of JmxBuilder is its flexibility in describing MBean. With the builder you can describe all aspects of the MBeans attribute that you want to export to the MBeanServer (see syntax above).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        attributes: [
            "Resource": [desc: "The resource to request.", readable: true, writable: true, defaultValue: "Hello"],
            "RequestCount": "*"
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, attribute <strong>"Resource" is fully-described</strong> using all supported descriptors (i.e. desc, readable, writable, defaultValue) for a JMX attribute. However, we use the wildcard to describe attribute <strong>RequestCount</strong> and it will be exported and described using defaults.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_constructor_export"><a class="anchor" href="#_bean_node_constructor_export"></a><a class="link" href="#_bean_node_constructor_export">Bean() Node - Constructor Export</a></h5>
<div class="paragraph">
<p>JmxBuilder <strong>supports the explicit description and export of constructors</strong> defined in the underlying bean. There are several options available when exporting constructors. You can combine them however you want to achieve the desired level of manageability.</p>
</div>
<div class="sect5">
<h6 id="_export_all_constructors_with"><a class="anchor" href="#_export_all_constructors_with"></a><a class="link" href="#_export_all_constructors_with">Export all Constructors with "*"</a></h6>
<div class="paragraph">
<p>You can use the builder&#8217;s special "*" <strong>notation to export all constructors</strong> declared on the underlying bean. The builder will use default values to describe the MBean constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        constructors: "*"
    )
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_export_constructors_using_parameter_descriptor"><a class="anchor" href="#_export_constructors_using_parameter_descriptor"></a><a class="link" href="#_export_constructors_using_parameter_descriptor">Export Constructors using Parameter Descriptor</a></h6>
<div class="paragraph">
<p>JmxBuilder lets you <strong>target specific constructor</strong> to export <strong>by describing the parameter signature</strong>. This is useful when you have several constructors with different parameter signature and you want to export specific constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        constructors: [
            "RequestController": ["Object"]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, JmxBuilder will <strong>export a constructor that takes one parameter of type "Object"</strong>. Again, JmxBuilder will use default values to fill in the description of the constructor and the parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_constructor_with_explicit_descriptors"><a class="anchor" href="#_export_constructor_with_explicit_descriptors"></a><a class="link" href="#_export_constructor_with_explicit_descriptors">Export Constructor with Explicit Descriptors</a></h6>
<div class="paragraph">
<p>JmxBuilder allows you to <strong>fully-describe</strong> the constructor that you want to target for export (see syntax above).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(target: new RequestController(), name: objName,
        constructors: [
            "RequestController": [
                desc: "Constructor takes param",
                params: ["Object" : [name: "Resource", desc: "Resource for controller"]]
            ]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, JmxBuilder will target a constructor that takes one parameter for export to the MBeanServer. Notice how the constructor can be fully-described using all optional descriptor keys including parameter descriptors.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_operation_export"><a class="anchor" href="#_bean_node_operation_export"></a><a class="link" href="#_bean_node_operation_export">Bean() Node - Operation Export</a></h5>
<div class="paragraph">
<p>Similar to constructors, JmxBuilder supports the description and export of MBean operations using a flexible notation (see above for syntax). You can combine these notations however you want to achieve the level of operation manageability desired.</p>
</div>
<div class="sect5">
<h6 id="_export_all_operations_with"><a class="anchor" href="#_export_all_operations_with"></a><a class="link" href="#_export_all_operations_with">Export All Operations with "*"</a></h6>
<div class="paragraph">
<p>You can use the builder&#8217;s special "*" <strong>notation to export all operations</strong> defined on the bean to be exposed for management. The builder will use default descriptor values for the operations being exported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        operations: "*"
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this snippet, JmxBuilder will <strong>export all bean operations</strong> and will use default values to describe them in the MBeanServer.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operation_list"><a class="anchor" href="#_export_operation_list"></a><a class="link" href="#_export_operation_list">Export Operation List</a></h6>
<div class="paragraph">
<p>JmxBuilder has a shorthand notation that lets you quickly target operations to be exported by providing a list of methods to export.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        operations: ["start", "stop"]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, the <strong>builder will only export methods start() and stop()</strong>. All other methods will be ignored. JmxBuilder will use default descriptor values to describe the operations being exported.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operations_by_signature"><a class="anchor" href="#_export_operations_by_signature"></a><a class="link" href="#_export_operations_by_signature">Export Operations by Signature</a></h6>
<div class="paragraph">
<p>Using JmxBuilder, you can target methods to export for management using the methods' parameter signature. This is useful when you want to distinguish methods with the same name that you want to export (i.e. stop() instead of stop(boolean)).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(
        target: new RequestController(),
        name: objName,
        operations: [
            "makeRequest": ["String"]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, JmxBuilder would <strong>select method makeRequest(String)</strong> to be exported instead of the other version makeRequest() which takes no parameter. In this shorthand context, the signature is specified as a list of type (i.e. "String").</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operations_with_explicit_descriptors"><a class="anchor" href="#_export_operations_with_explicit_descriptors"></a><a class="link" href="#_export_operations_with_explicit_descriptors">Export Operations with Explicit Descriptors</a></h6>
<div class="paragraph">
<p>JmxBuilder supports detailed descriptors for bean operations. You can supply deep descriptor info about any operation on your bean including a name, description, method parameters, parameter type, and parameter description.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def objName = new ObjectName("jmx.tutorial:type=Object")
def beans = jmx.export {
    bean(target: new RequestController(), name: objName,
        operations: [
            "start": [desc: "Starts request controller"],
            "stop": [desc: "Stops the request controller"],
            "setResource": [params: ["Object"]],
            "makeRequest": [
                desc: "Executes the request.",
                params: [
                    "String": [name: "Resource", desc: "The resource to request"]
                ]
            ]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above shows all the ways JmxBuilder allows you to describe an operation targeted for management:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operations <strong>start() and stop()</strong> are described by the "desc" key (this is enough since there are no params).</p>
</li>
<li>
<p>In operation <strong>setResource()</strong> uses of a shorthand version of <strong>params</strong>: to describe the parameters for the method.</p>
</li>
<li>
<p><strong>makeRequest()</strong> uses the extended descriptor syntax to describe all aspects of the operation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_embedding_descriptor"><a class="anchor" href="#_embedding_descriptor"></a><a class="link" href="#_embedding_descriptor">Embedding Descriptor</a></h5>
<div class="paragraph">
<p>JmxBuilder supports the ability to <strong>embed descriptors directly in your Groovy class</strong>. So, instead of wrapping your description around the declared object (as we&#8217;ve seen here), you can embed your JMX descriptors directly in your class.</p>
</div>
<div class="paragraph">
<p><strong>RequestControllerGroovy</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RequestControllerGroovy {
    // attributes
    boolean started
    int requestCount
    int resourceCount
    int requestLimit
    Map resources

    // operations
    void start() { }
    void stop(){ }
    void putResource(String name, Object resource) { }
    void makeRequest(String res) { }
    void makeRequest() { }

    static descriptor = [
        name: "jmx.builder:type=EmbeddedObject",
        operations: ["start", "stop", "putResource"],
        attributes: "*"
    ]
}

// export
jmx.export(
    bean(new RequestControllerGroovy())
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two things going on in the code above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy class RequestControllerGroovy is defined and includes a <strong>static descriptor</strong> member. That member is used to declare a JmxBuilder descriptor to describe member of the class targeted for JMX export.</p>
</li>
<li>
<p>The second part of the code shows how to use JmxBuilder to export that class for management.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_timer_export"><a class="anchor" href="#_timer_export"></a><a class="link" href="#_timer_export">Timer Export</a></h5>
<div class="paragraph">
<p>JMX standards mandate that the implementation of the API makes available a timer service. Since JMX is a component-based architecture, timers provide an excellent signalling mechanism to communicate to registered listener components in the MBeanServer. JmxBuilder supports the creation and export of timers using the same easy syntax we&#8217;ve seen so far.</p>
</div>
<div class="sect5">
<h6 id="_timer_node_syntax"><a class="anchor" href="#_timer_node_syntax"></a><a class="link" href="#_timer_node_syntax">Timer Node Syntax</a></h6>
<div class="listingblock">
<div class="content">
<pre>timer(
    name:ObjectName,
    event:"...",
    message:"...",
    data:dataValue
    startDate:"now"|dateValue
    period:"99d"|"99h"|"99m"|"99s"|99
    occurrences:long
)</pre>
</div>
</div>
<div class="paragraph">
<p>The timer() node supports several attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: - Required The qualified JMX ObjectName instance (or String) for the timer.</p>
</li>
<li>
<p><strong>event</strong>: - The JMX event type string that will be broadcast with every timing signal (default <strong>"jmx.builder.event"</strong>).</p>
</li>
<li>
<p><strong>message</strong>: - An optional string value that can be sent to listeners.</p>
</li>
<li>
<p><strong>data</strong>: - An optional object that can be sent to listeners of timing signal.</p>
</li>
<li>
<p><strong>startDate</strong>: - When to start timer. Set of valid values [ "now", date object ]. Default is "now"</p>
</li>
<li>
<p><strong>period</strong>: - A timer&#8217;s period expressed as either a number of millisecond or time unit (day, hour, minute, second). See description below.</p>
</li>
<li>
<p><strong>occurrences</strong>: - A number indicating the number of time to repeat timer. Default is forever.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_exporting_a_timer"><a class="anchor" href="#_exporting_a_timer"></a><a class="link" href="#_exporting_a_timer">Exporting a Timer</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def timer = jmx.timer(name: "jmx.builder:type=Timer", event: "heartbeat", period: "1s")
timer.start()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet above <strong>describes, creates, and exports a standard JMX Timer</strong> component. Here, the <strong>timer()</strong> node <strong>returns a GroovyMBean</strong> that represents the registered timer MBean in the MBeanServer.</p>
</div>
<div class="paragraph">
<p>An <strong>alternative way of exporting timers</strong> is within the JmxBuilder.export() node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def beans = jmx.export {
    timer(name: "jmx.builder:type=Timer1", event: "event.signal", period: "1s")
    timer(name: "jmx.builder:type=Timer2", event: "event.log", period: "1s")
}
beans[0].start()
beans[1].start()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_timer_period"><a class="anchor" href="#_timer_period"></a><a class="link" href="#_timer_period">Timer Period</a></h6>
<div class="paragraph">
<p>The <strong>timer() node supports a flexible notation</strong> for specifying the <strong>timer period values</strong>. You can specify the time in second, minutes, hour, and day. The default is millisecond.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>timer(<strong>period: 100</strong>) = 100 millisecond</p>
</li>
<li>
<p>timer(<strong>period: "1s"</strong>) = 1 second</p>
</li>
<li>
<p>timer(<strong>period: "1m"</strong>) = 1 minute</p>
</li>
<li>
<p>timer(<strong>period: "1h"</strong>) = 1 hour</p>
</li>
<li>
<p>timer(<strong>period: "1d"</strong>) = 1 day</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The node will automatically translate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jmxbuilder_and_events"><a class="anchor" href="#_jmxbuilder_and_events"></a><a class="link" href="#_jmxbuilder_and_events">JmxBuilder and Events</a></h5>
<div class="paragraph">
<p>An integral part of <strong>JMX</strong> is its <strong>event model</strong>. Registered management beans can <strong>communicate with each other by broadcasting events</strong> on the MBeanServer&#8217;s event bus. <strong>JmxBuilder provides several ways to easily listen and react to events</strong> broadcasted on the MBeanServer&#8217;s event bus. Developers can <strong>capture any event on the bus or throw their own</strong> to be consumed by other components registered on the MBeanServer.</p>
</div>
<div class="sect5">
<h6 id="_event_handling_closures"><a class="anchor" href="#_event_handling_closures"></a><a class="link" href="#_event_handling_closures">Event Handling Closures</a></h6>
<div class="paragraph">
<p>JmxBuilder leverages Groovy&#8217;s use of closures to provide simple, yet elegant, mean of reacting to JMX events. JmxBuilder supports two closure signatures:</p>
</div>
<div class="sect6">
<h7 id="_parameterless"><a class="anchor" href="#_parameterless"></a><a class="link" href="#_parameterless">Parameterless</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">callback = { -&gt;
    // event handling code here.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JmxBuilder executes the closure and passes no information about the event that was captured on the bus.</p>
</div>
</div>
<div class="sect6">
<h7 id="_with_event_parameter"><a class="anchor" href="#_with_event_parameter"></a><a class="link" href="#_with_event_parameter">With Event Parameter</a></h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">callback = { event -&gt;
    // event handling code
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JmxBuilder will pass an <strong>"event" object to the closure</strong> using this format. The event object contains information about the event was intercepted so that it can be handled by the handler. The parameter will contain different set of info depending on the event that was captured.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_handling_attribute_onchange_event"><a class="anchor" href="#_handling_attribute_onchange_event"></a><a class="link" href="#_handling_attribute_onchange_event">Handling Attribute onChange Event</a></h6>
<div class="paragraph">
<p>When describing attributes (see bean() node section above), you can <strong>provide a closure (or method pointer) for callback to be executed when the value of the attribute is updated</strong> on the exported MBean. This gives developers an opportunity to listen to and react to state changes on the MBean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jmx.export {
    bean(
        target: new RequestController(), name: "jmx.tutorial:type=Object",
        attributes: [
            "Resource": [
                readable: true, writable: true,
                onChange: { e -&gt;
                    println e.oldValue
                    println e.newValue
                }
            ]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample snippet above shows how to <strong>specify an "onChange" callback closure</strong> when describing MBean attributes. In this sample code, whenever attribute "Resource" is updated via the exported MBean, the <strong>onChange event will be executed</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_attribute_onchange_event_object"><a class="anchor" href="#_attribute_onchange_event_object"></a><a class="link" href="#_attribute_onchange_event_object">Attribute onChange Event Object</a></h6>
<div class="paragraph">
<p>When handling the attribute onChange event, the handler closure will receive an event object with the following info:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event.<strong>oldValue</strong> - the previous attribute value before the change event.</p>
</li>
<li>
<p>event.<strong>newValue</strong> - the new value of the attribute after the change.</p>
</li>
<li>
<p>event.<strong>attribute</strong> - the name of the attribute on which the event occurred.</p>
</li>
<li>
<p>event.<strong>attributeType</strong> - the data type of the attribute that causes the event.</p>
</li>
<li>
<p>event.<strong>sequenceNumber</strong> - a numeric value representing the sequence number of event.</p>
</li>
<li>
<p>event.<strong>timeStamp</strong> - a time stamp for the event occurrence.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_handling_operation_oncall_event"><a class="anchor" href="#_handling_operation_oncall_event"></a><a class="link" href="#_handling_operation_oncall_event">Handling Operation onCall Event</a></h6>
<div class="paragraph">
<p>Similar to mbean attributes, JmxBuilder affords developers the <strong>ability to listen for operation invocation</strong> on an MBean registered in the MBeaServer. JmxBuilder accepts a <strong>callback closure that will be executed after the MBean method has invoked</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class EventHandler {
    void handleStart(e){
        println e
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def handler = new EventHandler()

def beans = jmx.export {
    bean(target: new RequestController(), name: "jmx.tutorial:type=Object",
        operations: [
            "start": [
                desc:"Starts request controller",
                onCall:handler.&amp;handleStart
            ]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above <strong>shows how to declare an "onCall" closure to be used as listener</strong> when operation "start()" is invoked on the MBean. This sample <strong>uses the method pointer syntax</strong> to illustrate the versatility of JmxBuilder.</p>
</div>
</div>
<div class="sect5">
<h6 id="_operation_oncall_event_object"><a class="anchor" href="#_operation_oncall_event_object"></a><a class="link" href="#_operation_oncall_event_object">Operation onCall Event Object</a></h6>
<div class="paragraph">
<p>When handling the operation onCall event, the callback closure will receive an event object with the following info:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event.<strong>event</strong> - the event type string that was broadcasted.</p>
</li>
<li>
<p>event.<strong>source</strong> - The object on which the method was invoked.</p>
</li>
<li>
<p>event.<strong>data</strong> - the data type of the attribute that causes the event.</p>
</li>
<li>
<p>event.<strong>sequenceNumber</strong> - a numeric value representing the sequence number of event.</p>
</li>
<li>
<p>event.<strong>timeStamp</strong> - a time stamp for the event occurrence.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_listener_mbean"><a class="anchor" href="#_listener_mbean"></a><a class="link" href="#_listener_mbean">Listener MBean</a></h5>
<div class="paragraph">
<p>When you export an MBean with the bean() node, you can define events the MBean can listen and react to. The bean() node provides a "listeners:" attribute that lets you define event listeners that your bean can react to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def beans = jmx.export {
    timer(name: "jmx.builder:type=Timer", event: "heartbeat", period: "1s").start()
    bean(target: new RequestController(), name: "jmx.tutorial:type=Object",
        operations: "*",
        listeners: [
            heartbeat: [
                from: "jmx.builder:type=Timer",
                call: { e -&gt;
                    println e
                }
            ]
        ]
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample above, we see the <strong>syntax for adding listeners to an exported MBean</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, a <strong>timer is exported</strong> and started.</p>
</li>
<li>
<p>Then, an <strong>MBean is declared that will listen to the timer</strong> event and do something meaningful.</p>
</li>
<li>
<p>The <strong>"heartbeat:"</strong> name is arbitrary and has no correlation to the timer declared above.</p>
</li>
<li>
<p>The <strong>source</strong> of the event <strong>is specified using the "from:" attribute</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also specify an <strong>event type</strong> you are interested in receiving from a broadcaster (since a broadcaster can be emitting multiple events).</p>
</div>
<div class="sect5">
<h6 id="_listening_to_jmx_events"><a class="anchor" href="#_listening_to_jmx_events"></a><a class="link" href="#_listening_to_jmx_events">Listening to JMX Events</a></h6>
<div class="paragraph">
<p>In some cases, you will want to create stand-alone event listeners (not attached to exported MBeans). JmxBuilder provides the Listener() node to let you create JMX listeners that can listen to MBeanServer events. This is useful when creating JMX client applications to monitor/manage JMX agents on remote JMX MBeanServers.</p>
</div>
</div>
<div class="sect5">
<h6 id="_listener_node_syntax"><a class="anchor" href="#_listener_node_syntax"></a><a class="link" href="#_listener_node_syntax">Listener Node Syntax</a></h6>
<div class="listingblock">
<div class="content">
<pre>jmx.listener(
    event: "...",
    from: "object name" | ObjectName,
    call: { event-&gt; }
)</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the description of the <strong>listener()</strong> node attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event: An optional string that identifies the JMX event type to listen for.</p>
</li>
<li>
<p>from (required): The JMX ObjectName of the component to listen to. This can be specified as a string or an instance of ObjectName.</p>
</li>
<li>
<p>call: The closure to execute when the event is captured. This can also be specified as a Groovy method pointer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of JmxBuilder&#8217;s listener node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jmx.timer(name: "jmx.builder:type=Timer", period: "1s").start()

jmx.listener(
    from: "jmx.builder:type=Timer",
    call: { e -&gt;
        println "beep..."
    }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how you can use a stand-alone listener (outside an MBean export). Here, we <strong>export a timer with a 1 second</strong> resolution. Then, we specify a listener to that timer that will print "beep" every second.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_emitting_jmx_events"><a class="anchor" href="#_emitting_jmx_events"></a><a class="link" href="#_emitting_jmx_events">Emitting JMX Events</a></h5>
<div class="paragraph">
<p>JmxBuilder provides the <strong>tools needed to broadcast your own events</strong> on the MBeanServer&#8217;s event bus. There are no restrictions on the event type you can broadcast. You simply <strong>declare your emitter</strong> and the event type that you want to send, then <strong>broadcast your event</strong> at any time. Any registered component in the MBeanServer can register themselves to listen to your events.</p>
</div>
<div class="sect5">
<h6 id="_emitter_syntax"><a class="anchor" href="#_emitter_syntax"></a><a class="link" href="#_emitter_syntax">Emitter Syntax</a></h6>
<div class="listingblock">
<div class="content">
<pre>jmx.emitter(name:"Object:Name", event:"type")</pre>
</div>
</div>
<div class="paragraph">
<p>The attributes for the node Emitter() can be summarized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name: an optional JMX ObjectName used to register your emitter in the MBeanServer. Default is jmx.builder:type=Emitter,name=Emitter@OBJECT_HASH_VALUE</p>
</li>
<li>
<p>event: an option string value that describes the JMX event type. Default is <strong>"jmx.builder.event.emitter"</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_declare_the_emitter"><a class="anchor" href="#_declare_the_emitter"></a><a class="link" href="#_declare_the_emitter">Declare the Emitter</a></h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def emitter = jmx.emitter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet <strong>declares the emitter using implicit descriptor syntax</strong>. JmxBuilder will do the followings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and register an emitter MBean with a default ObjectName.</p>
</li>
<li>
<p>Setup a <strong>default event type</strong> with value <strong>"jmx.builder.event.emitter"</strong>.</p>
</li>
<li>
<p>Return a GroovyMBean representing the emitter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with other nodes in the builder, <strong>you can override all keys in the emitter() node</strong>. You can specify the <strong>ObjectName</strong> and the <strong>event type</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_broadcast_event"><a class="anchor" href="#_broadcast_event"></a><a class="link" href="#_broadcast_event">Broadcast Event</a></h6>
<div class="paragraph">
<p>Once you have declared your emitter, you can broadcast your event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">emitter.send()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above shows the <strong>emitter sending an event</strong>, once it has been declared. Any JMX component registered in the MBeanServer can register to receive message from this emitter.</p>
</div>
</div>
<div class="sect5">
<h6 id="_sending_event_objects"><a class="anchor" href="#_sending_event_objects"></a><a class="link" href="#_sending_event_objects">Sending Event Objects</a></h6>
<div class="paragraph">
<p>You can optionally pass data to the receiver when you send the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">emitter.send("Hello!")</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use an <strong>event listener closure (see above) that accepts a parameter</strong>, you can access that value.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_further_jmx_information"><a class="anchor" href="#_further_jmx_information"></a><a class="link" href="#_further_jmx_information">3.22.9. Further JMX Information</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.ddj.com/dept/java/184406481?pgno=1">Monitoring the Java Virtual Machine</a></p>
</li>
<li>
<p><a href="http://buttso.blogspot.com/2006/05/using-groovy-for-system-management.html">Using Groovy for System Management</a></p>
</li>
<li>
<p><a href="https://blogs.oracle.com/sundararajan/entry/groovier_jconsole">Groovier jconsole!</a></p>
</li>
<li>
<p><a href="http://jmesnil.net/weblog/2007/05/23/jmx-scripts-with-eclipse-monkey">JMX Scripts with Eclipse Monkey</a></p>
</li>
<li>
<p><a href="http://activemq.apache.org/jmx.html">Using JMX to monitor Apache ActiveMQ</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_swing_uis"><a class="anchor" href="#_creating_swing_uis"></a><a class="link" href="#_creating_swing_uis">3.23. Creating Swing UIs</a></h3>
<div class="paragraph">
<p>Creating Swing UIs is made easy thanks to the use of <a href="#swingbuilder">SwingBuilder</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">3.24. Security</a></h3>
<div class="paragraph">
<p>Security is a complex and multi-faceted issue and needs to be addressed in a holistic way.
Groovy offers some features to improve security, but organisations
concerned about security should already be addressing other necessary aspects
such as network security, file-system security, operating system security, database security,
passwords and potentially encryption.</p>
</div>
<div class="paragraph">
<p>Also, since Groovy runs on the JDK and optionally uses other library dependencies,
users should ensure their JDK and all dependencies are up-to-date with respect to
the latest security fixes.</p>
</div>
<div class="paragraph">
<p>With regard to security issues that may affect the Groovy project itself,
the project follows the Apache <a href="http://www.apache.org/security/committers.html">general guidelines for handling security vulnerabilities</a>. See also the project&#8217;s
<a href="https://github.com/apache/groovy/security/policy">security policy</a> and list of
<a href="https://groovy-lang.org/security.html">past vulnerabilities</a>.</p>
</div>
<div class="paragraph">
<p>By virtue of running on the JVM and following various Java conventions, Groovy programs
offer some of the same security features as Java programs, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>programs cannot access arbitrary memory locations</p>
</li>
<li>
<p>final variables cannot be changed</p>
</li>
<li>
<p>array bounds are checked</p>
</li>
<li>
<p>class loaders perform bytecode verification when loading classes</p>
</li>
<li>
<p>casting cannot be done to an incompatible class</p>
</li>
<li>
<p>access is available to APIs for encryption and authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Special security support is provided through:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyShell.html">groovy.lang.GroovyShell</a>, <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/GroovyClassLoader.html">groovy.lang.GroovyClassLoader</a> and other parts of the Groovy runtime fully support the Java security manager which allows you to sandbox script execution with a security policy. (Note: this functionality might be scaled back in future Groovy versions or when running
on particular JDK versions in line with <a href="https://openjdk.java.net/jeps/411">JEP 411</a>)</p>
</li>
<li>
<p><a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer.html">org.codehaus.groovy.control.customizers.SecureASTCustomizer</a>
secures source code by controlling what code constructs are permitted or prohibited in a code base
(or part of a code base)</p>
</li>
<li>
<p>Default <a href="#processing-xml">XML processing</a> has secure processing enabled and doctype definitions disabled</p>
</li>
<li>
<p>Groovy&#8217;s <a href="#processing-sql">SQL processing</a> features provide support to guard against SQL injection</p>
</li>
<li>
<p>Temporary directory creation protects against known security vulnerabilities such as privilege escalation if scripts are stored in operating system temp directories</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_design_patterns_in_groovy"><a class="anchor" href="#_design_patterns_in_groovy"></a><a class="link" href="#_design_patterns_in_groovy">3.25. Design patterns in Groovy</a></h3>
<div class="paragraph">
<p>Using <a href="https://en.wikipedia.org/wiki/Design_pattern_%28computer_science%29">design patterns</a> with Java is a well-established topic.
Design patterns also apply to Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>some patterns carry over directly (and can make use of normal Groovy syntax improvements for greater readability)</p>
</li>
<li>
<p>some patterns are no longer required because they are built right into the language or because Groovy supports a better way of achieving the intent of the pattern</p>
</li>
<li>
<p>some patterns that have to be expressed at the design level in other languages can be implemented directly in Groovy (due to the way Groovy can blur the distinction between design and implementation)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_patterns"><a class="anchor" href="#_patterns"></a><a class="link" href="#_patterns">3.25.1. Patterns</a></h4>
<div class="sect4">
<h5 id="_abstract_factory_pattern"><a class="anchor" href="#_abstract_factory_pattern"></a><a class="link" href="#_abstract_factory_pattern">Abstract Factory Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a> provides a way to encapsulate a group of individual factories that have a common theme. It embodies the intent of a normal factory, i.e. remove the need for code using an interface to know the concrete implementation behind the interface, but applies to a set of interfaces and selects an entire family of concrete classes which implement those interfaces.</p>
</div>
<div class="paragraph">
<p>As an example, I might have interfaces Button, TextField and Scrollbar. I might have WindowsButton, MacButton, FlashButton as concrete classes for Button. I might have WindowsScrollBar, MacScrollBar and FlashScrollBar as concrete implementations for ScrollBar. Using the Abstract Factory Pattern should allow me to select which windowing system (i.e. Windows, Mac, Flash) I want to use once and from then on should be able to write code that references the interfaces but is always using the appropriate concrete classes (all from the one windowing system) under the covers.</p>
</div>
<div class="sect5">
<h6 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">Example</a></h6>
<div class="paragraph">
<p>Suppose we want to write a game system. We might note that many games have very similar features and control.</p>
</div>
<div class="paragraph">
<p>We decide to try to split the common and game-specific code into separate classes.</p>
</div>
<div class="paragraph">
<p>First let&#8217;s look at the game-specific code for a <a href="http://en.wikipedia.org/wiki/Two-Up">Two-up</a> game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TwoupMessages {
    def welcome = 'Welcome to the twoup game, you start with $1000'
    def done = 'Sorry, you have no money left, goodbye'
}

class TwoupInputConverter {
    def convert(input) { input.toInteger() }
}

class TwoupControl {
    private money = 1000
    private random = new Random()
    private tossWasHead() {
        def next = random.nextInt()
        return next % 2 == 0
    }
    def moreTurns() {
        if (money &gt; 0) {
            println "You have $money, how much would you like to bet?"
            return true
        }

        false
    }
    def play(amount) {
        def coin1 = tossWasHead()
        def coin2 = tossWasHead()
        if (coin1 &amp;&amp; coin2) {
            money += amount
            println 'You win'
        } else if (!coin1 &amp;&amp; !coin2) {
            money -= amount
            println 'You lose'
        } else {
            println 'Draw'
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s look at the game-specific code for a number guessing game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class GuessGameMessages {
    def welcome = 'Welcome to the guessing game, my secret number is between 1 and 100'
    def done = 'Correct'
}

class GuessGameInputConverter {
    def convert(input) { input.toInteger() }
}

class GuessGameControl {
    private lower = 1
    private upper = 100
    private guess = new Random().nextInt(upper - lower) + lower
    def moreTurns() {
        def done = (lower == guess || upper == guess)
        if (!done) {
            println "Enter a number between $lower and $upper"
        }

        !done
    }
    def play(nextGuess) {
        if (nextGuess &lt;= guess) {
            lower = [lower, nextGuess].max()
        }
        if (nextGuess &gt;= guess) {
            upper = [upper, nextGuess].min()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s write our factory code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def guessFactory = [messages: GuessGameMessages, control: GuessGameControl, converter: GuessGameInputConverter]
def twoupFactory = [messages: TwoupMessages, control: TwoupControl, converter: TwoupInputConverter]

class GameFactory {
    def static factory
    def static getMessages() { return factory.messages.newInstance() }
    def static getControl() { return factory.control.newInstance() }
    def static getConverter() { return factory.converter.newInstance() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important aspect of this factory is that it allows selection of an entire family of concrete classes.</p>
</div>
<div class="paragraph">
<p>Here is how we would use the factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">GameFactory.factory = twoupFactory
def messages = GameFactory.messages
def control = GameFactory.control
def converter = GameFactory.converter
println messages.welcome
def reader = new BufferedReader(new InputStreamReader(System.in))
while (control.moreTurns()) {
    def input = reader.readLine().trim()
    control.play(converter.convert(input))
}
println messages.done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first line configures which family of concrete game classes we will use. It&#8217;s not important that we selected which family to use by using the factory property as shown in the first line. Other ways would be equally valid examples of this pattern. For example, we may have asked the user which game they wanted to play or determined which game from an environment setting.</p>
</div>
<div class="paragraph">
<p>With the code as shown, the game might look like this when run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the twoup game, you start with $1000
You have 1000, how much would you like to bet?
300
Draw
You have 1000, how much would you like to bet?
700
You win
You have 1700, how much would you like to bet?
1700
You lose
Sorry, you have no money left, goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>If we change the first line of the script to GameFactory.factory = guessFactory, then the sample run might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the guessing game, my secret number is between 1 and 100
Enter a number between 1 and 100
75
Enter a number between 1 and 75
35
Enter a number between 1 and 35
15
Enter a number between 1 and 15
5
Enter a number between 5 and 15
10
Correct</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_pattern"><a class="anchor" href="#_adapter_pattern"></a><a class="link" href="#_adapter_pattern">Adapter Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter Pattern</a> (sometimes called the wrapper pattern) allows objects satisfying one interface to be used where another type of interface is expected. There are two typical flavours of the pattern: the <em>delegation</em> flavour and the <em>inheritance</em> flavour.</p>
</div>
<div class="sect5">
<h6 id="_delegation_example"><a class="anchor" href="#_delegation_example"></a><a class="link" href="#_delegation_example">Delegation Example</a></h6>
<div class="paragraph">
<p>Suppose we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SquarePeg {
    def width
}

class RoundPeg {
    def radius
}

class RoundHole {
    def radius
    def pegFits(peg) {
        peg.radius &lt;= radius
    }
    String toString() { "RoundHole with radius $radius" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask the <code>RoundHole</code> class if a <code>RoundPeg</code> fits in it, but if we ask the same question for a <code>SquarePeg</code>, then it will fail because the <code>SquarePeg</code> class doesn&#8217;t have a <code>radius</code> property (i.e. doesn&#8217;t satisfy the required interface).</p>
</div>
<div class="paragraph">
<p>To get around this problem, we can create an adapter to make it appear to have the correct interface. It would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SquarePegAdapter {
    def peg
    def getRadius() {
        Math.sqrt(((peg.width / 2) ** 2) * 2)
    }
    String toString() {
        "SquarePegAdapter with peg width $peg.width (and notional radius $radius)"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the adapter like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def hole = new RoundHole(radius: 4.0)
(4..7).each { w -&gt;
    def peg = new SquarePegAdapter(peg: new SquarePeg(width: w))
    if (hole.pegFits(peg)) {
        println "peg $peg fits in hole $hole"
    } else {
        println "peg $peg does not fit in hole $hole"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with peg width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inheritance_example"><a class="anchor" href="#_inheritance_example"></a><a class="link" href="#_inheritance_example">Inheritance Example</a></h6>
<div class="paragraph">
<p>Let&#8217;s consider the same example again using inheritance. First, here are the original classes (unchanged):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SquarePeg {
    def width
}

class RoundPeg {
    def radius
}

class RoundHole {
    def radius
    def pegFits(peg) {
        peg.radius &lt;= radius
    }
    String toString() { "RoundHole with radius $radius" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An adapter using inheritance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SquarePegAdapter extends SquarePeg {
    def getRadius() {
        Math.sqrt(((width / 2) ** 2) * 2)
    }
    String toString() {
        "SquarePegAdapter with width $width (and notional radius $radius)"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def hole = new RoundHole(radius: 4.0)
(4..7).each { w -&gt;
    def peg = new SquarePegAdapter(width: w)
    if (hole.pegFits(peg)) {
        println "peg $peg fits in hole $hole"
    } else {
        println "peg $peg does not fit in hole $hole"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_closures"><a class="anchor" href="#_adapting_using_closures"></a><a class="link" href="#_adapting_using_closures">Adapting using Closures</a></h6>
<div class="paragraph">
<p>As a variation of the previous examples, we could instead define the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface RoundThing {
    def getRadius()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then define an adapter as a closure as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def adapter = {
    p -&gt; [getRadius: { Math.sqrt(((p.width / 2) ** 2) * 2) }] as RoundThing
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def peg = new SquarePeg(width: 4)
if (hole.pegFits(adapter(peg))) {
    // ... as before
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_the_expandometaclass"><a class="anchor" href="#_adapting_using_the_expandometaclass"></a><a class="link" href="#_adapting_using_the_expandometaclass">Adapting using the ExpandoMetaClass</a></h6>
<div class="paragraph">
<p>As of Groovy 1.1, there is a built-in MetaClass which can automatically add properties and methods dynamically.</p>
</div>
<div class="paragraph">
<p>Here is how the example would work using that feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def peg = new SquarePeg(width: 4)
peg.metaClass.radius = Math.sqrt(((peg.width / 2) ** 2) * 2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you create a peg object, you can simply add a property to it on the fly. No need to change the original class and no need for an adapter class.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bouncer_pattern"><a class="anchor" href="#_bouncer_pattern"></a><a class="link" href="#_bouncer_pattern">Bouncer Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://www.c2.com/cgi/wiki?BouncerPattern">Bouncer Pattern</a> describes usage of a method whose sole purpose is to either throw an exception (when particular conditions hold) or do nothing. Such methods are often used to defensively guard pre-conditions of a method.</p>
</div>
<div class="paragraph">
<p>When writing utility methods, you should always guard against faulty input arguments. When writing internal methods, you may be able to ensure that certain pre-conditions always hold by having sufficient unit tests in place. Under such circumstances, you may reduce the desirability to have guards on your methods.</p>
</div>
<div class="paragraph">
<p>Groovy differs from other languages in that you frequently use the <code>assert</code> method within your methods rather than having a large number of utility checker methods or classes.</p>
</div>
<div class="sect5">
<h6 id="_null_checking_example"><a class="anchor" href="#_null_checking_example"></a><a class="link" href="#_null_checking_example">Null Checking Example</a></h6>
<div class="paragraph">
<p>We might have a utility method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class NullChecker {
    static check(name, arg) {
        if (arg == null) {
            throw new IllegalArgumentException(name + ' is null')
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void doStuff(String name, Object value) {
    NullChecker.check('name', name)
    NullChecker.check('value', value)
    // do stuff
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But a more Groovy way to do this would simply be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">void doStuff(String name, Object value) {
    assert name != null, 'name should not be null'
    assert value != null, 'value should not be null'
    // do stuff
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_validation_example"><a class="anchor" href="#_validation_example"></a><a class="link" href="#_validation_example">Validation Example</a></h6>
<div class="paragraph">
<p>As an alternative example, we might have this utility method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class NumberChecker {
    static final String NUMBER_PATTERN = "\\\\d+(\\\\.\\\\d+(E-?\\\\d+)?)?"
    static isNumber(str) {
        if (!str ==~ NUMBER_PATTERN) {
            throw new IllegalArgumentException("Argument '$str' must be a number")
        }
    }
    static isNotZero(number) {
        if (number == 0) {
            throw new IllegalArgumentException('Argument must not be 0')
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def stringDivide(String dividendStr, String divisorStr) {
    NumberChecker.isNumber(dividendStr)
    NumberChecker.isNumber(divisorStr)
    def dividend = dividendStr.toDouble()
    def divisor = divisorStr.toDouble()
    NumberChecker.isNotZero(divisor)
    dividend / divisor
}

println stringDivide('1.2E2', '3.0')
// =&gt; 40.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>But with Groovy we could just as easily use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def stringDivide(String dividendStr, String divisorStr) {
    assert dividendStr =~ NumberChecker.NUMBER_PATTERN
    assert divisorStr =~ NumberChecker.NUMBER_PATTERN
    def dividend = dividendStr.toDouble()
    def divisor = divisorStr.toDouble()
    assert divisor != 0, 'Divisor must not be 0'
    dividend / divisor
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chain_of_responsibility_pattern"><a class="anchor" href="#_chain_of_responsibility_pattern"></a><a class="link" href="#_chain_of_responsibility_pattern">Chain of Responsibility Pattern</a></h5>
<div class="paragraph">
<p>In the Chain of Responsibility Pattern, objects using and implementing an interface (one or more methods) are intentionally loosely coupled. A set of objects that <em>implement</em> the interface are organised in a list (or in rare cases a tree). Objects using the interface make requests from the first <em>implementor</em> object. It will decide whether to perform any action itself and whether to pass the request further down the line in the list (or tree). Sometimes a default implementation for some request is also coded into the pattern if none of the implementors respond to the request.</p>
</div>
<div class="sect5">
<h6 id="_example_using_traditional_classes"><a class="anchor" href="#_example_using_traditional_classes"></a><a class="link" href="#_example_using_traditional_classes">Example using traditional classes</a></h6>
<div class="paragraph">
<p>In this example, the script sends requests to the <code>lister</code> object. The <code>lister</code> points to a <code>UnixLister</code> object. If it can&#8217;t handle the request, it sends the request to the <code>WindowsLister</code>. If it can&#8217;t handle the request, it sends the request to the <code>DefaultLister</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class UnixLister {
    private nextInLine
    UnixLister(next) { nextInLine = next }
    def listFiles(dir) {
        if (System.getProperty('os.name') == 'Linux') {
            println "ls $dir".execute().text
        } else {
            nextInLine.listFiles(dir)
        }
    }
}

class WindowsLister {
    private nextInLine
    WindowsLister(next) { nextInLine = next }
    def listFiles(dir) {
        if (System.getProperty('os.name').startsWith('Windows')) {
            println "cmd.exe /c dir $dir".execute().text
        } else {
            nextInLine.listFiles(dir)
        }
    }
}

class DefaultLister {
    def listFiles(dir) {
        new File(dir).eachFile { f -&gt; println f }
    }
}

def lister = new UnixLister(new WindowsLister(new DefaultLister()))

lister.listFiles('Downloads')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be a list of files (with slightly different format depending on the operating system).</p>
</div>
<div class="paragraph">
<p>Here is a UML representation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xChainOfResponsibilityClasses.png.pagespeed.ic.Ihb-SM4GOo.png" alt="ChainOfResponsibilityClasses" width="478" height="356">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_example_using_simplifying_strategies"><a class="anchor" href="#_example_using_simplifying_strategies"></a><a class="link" href="#_example_using_simplifying_strategies">Example using simplifying strategies</a></h6>
<div class="paragraph">
<p>For simple cases, consider simplifying your code by not requiring the chain of classes.
Instead, use Groovy truth and the elvis operator as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String unixListFiles(dir) {
    if (System.getProperty('os.name') == 'Linux') {
        "ls $dir".execute().text
    }
}

String windowsListFiles(dir) {
    if (System.getProperty('os.name').startsWith('Windows')) {
        "cmd.exe /c dir $dir".execute().text
    }
}

String defaultListFiles(dir) {
    new File(dir).listFiles().collect{ f -&gt; f.name }.join('\\n')
}

def dir = 'Downloads'
println unixListFiles(dir) ?: windowsListFiles(dir) ?: defaultListFiles(dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or Groovy&#8217;s switch as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">String listFiles(dir) {
    switch(dir) {
    case { System.getProperty('os.name') == 'Linux' }:
        return "ls $dir".execute().text
    case { System.getProperty('os.name').startsWith('Windows') }:
        return "cmd.exe /c dir $dir".execute().text
    default:
        new File(dir).listFiles().collect{ f -&gt; f.name }.join('\\n')
    }
}

println listFiles('Downloads')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, for Groovy 3+, consider using streams of lambdas as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Optional&lt;String&gt; unixListFiles(String dir) {
    Optional.ofNullable(dir)
        .filter(d -&gt; System.getProperty('os.name') == 'Linux')
        .map(d -&gt; "ls $d".execute().text)
}

Optional&lt;String&gt; windowsListFiles(String dir) {
    Optional.ofNullable(dir)
        .filter(d -&gt; System.getProperty('os.name').startsWith('Windows'))
        .map(d -&gt; "cmd.exe /c dir $d".execute().text)
}

Optional&lt;String&gt; defaultListFiles(String dir) {
    Optional.ofNullable(dir)
        .map(d -&gt; new File(d).listFiles().collect{ f -&gt; f.name }.join('\\n'))
}

def dir = 'Downloads'
def handlers = [this::unixListFiles, this::windowsListFiles, this::defaultListFiles]
println handlers.stream()
    .map(f -&gt; f(dir))
    .filter(Optional::isPresent)
    .map(Optional::get)
    .findFirst()
    .get()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_when_not_to_use"><a class="anchor" href="#_when_not_to_use"></a><a class="link" href="#_when_not_to_use">When not to use</a></h6>
<div class="paragraph">
<p>If your use of chain of responsibility involves frequent use of the <code>instanceof</code> operator, like here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static Math.PI as π
abstract class Shape {
    String name
}
class Polygon extends Shape {
    String name
    double lengthSide
    int numSides
}
class Circle extends Shape {
    double radius
}

class CircleAreaCalculator {
    def next
    def area(shape) {
        if (shape instanceof Circle) {            <i class="conum" data-value="1"></i><b>(1)</b>
            return shape.radius ** 2 * π
        } else {
            next.area(shape)
        }
    }
}
class SquareAreaCalculator {
    def next
    def area(shape) {
        if (shape instanceof Polygon &amp;&amp; shape.numSides == 4) {      <i class="conum" data-value="1"></i><b>(1)</b>
            return shape.lengthSide ** 2
        } else {
            next.area(shape)
        }
    }
}
class DefaultAreaCalculator {
    def area(shape) {
        throw new IllegalArgumentException("Don't know how to calculate area for $shape")
    }
}

def chain = new CircleAreaCalculator(next: new SquareAreaCalculator(next: new DefaultAreaCalculator()))
def shapes = [
    new Circle(name: 'Circle', radius: 5.0),
    new Polygon(name: 'Square', lengthSide: 10.0, numSides: 4)
]
shapes.each { println chain.area(it) }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instanceof code smell</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It could indicate that instead of using the chain of responsibility pattern, you might consider
using richer types, perhaps in combination with Groovy&#8217;s multimethods. For example, perhaps this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// ...
class Square extends Polygon {
    // ...
}

double area(Circle c) {
    c.radius ** 2 * π
}

double area(Square s) {
    s.lengthSide ** 2
}

def shapes = [
    new Circle(radius: 5.0),
    new Square(lengthSide: 10.0, numSides: 4)
]
shapes.each { println area(it) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using more traditional object-oriented style like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static Math.PI as π
interface Shape {
    double area()
}
abstract class Polygon implements Shape {
    double lengthSide
    int numSides
    abstract double area()
}
class Circle implements Shape {
    double radius
    double area() {
        radius ** 2 * π
    }
}
class Square extends Polygon {
    // ...
    double area() {
        lengthSide ** 2
    }
}

def shapes = [
    new Circle(radius: 5.0),
    new Square(lengthSide: 10.0, numSides: 4)
]
shapes.each { println it.area() }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_going_further"><a class="anchor" href="#_going_further"></a><a class="link" href="#_going_further">Going further</a></h6>
<div class="paragraph">
<p>Other variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we could have an explicit interface in the traditional example, e.g. <code>Lister</code>, to statically type the implementations but because of <em>duck-typing</em> this is optional</p>
</li>
<li>
<p>we could use a chain tree instead of a list, e.g. <code>if (animal.hasBackbone())</code> delegate to <code>VertebrateHandler</code> else delegate to <code>InvertebrateHandler</code></p>
</li>
<li>
<p>we could always pass down the chain even if we processed a request (no early return)</p>
</li>
<li>
<p>we could decide at some point to not respond and not pass down the chain (pre-emptive abort)</p>
</li>
<li>
<p>we could use Groovy’s meta-programming capabilities to pass unknown methods down the chain, e.g. combine
chain of responsibility with the use of <code>methodMissing</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_command_pattern"><a class="anchor" href="#_command_pattern"></a><a class="link" href="#_command_pattern">Command Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Command_pattern">Command Pattern</a> is a pattern for
loosely coupling a client object which wants to execute a series of commands and
receiver objects which enact those commands.
Instead of talking to receivers directly, clients interact with an intermediary object
which then relays the necessary commands to the receivers.
The pattern is in common use within the JDK, for example the api:javax.swing.Action[] class in Swing
decouples swing code from receivers like buttons, menu items and panels.</p>
</div>
<div class="paragraph">
<p>The class diagram showing the typical classes is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xCommandClasses.png.pagespeed.ic.lnkP87ssaV.png" alt="CommandClasses" width="565" height="188">
</div>
</div>
<div class="paragraph">
<p>The sequence of interactions is as shown below for an arbitrary receiver:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xCommandSequence.png.pagespeed.ic.NPD4UFJCT0.png" alt="CommandSequence" width="244" height="153">
</div>
</div>
<div class="sect5">
<h6 id="_example_with_traditional_classes"><a class="anchor" href="#_example_with_traditional_classes"></a><a class="link" href="#_example_with_traditional_classes">Example with traditional classes</a></h6>
<div class="paragraph">
<p>The relevant classes required for turning a light on and off (see the example in the earlier wikipedia reference)
would be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Command {
    void execute()
}

// invoker class
class Switch {
    private final Map&lt;String, Command&gt; commandMap = new HashMap&lt;&gt;()

    void register(String commandName, Command command) {
        commandMap[commandName] = command
    }

    void execute(String commandName) {
        Command command = commandMap[commandName]
        if (!command) {
            throw new IllegalStateException("no command registered for " + commandName)
        }
        command.execute()
    }
}

// receiver class
class Light {
    void turnOn() {
        println "The light is on"
    }

    void turnOff() {
        println "The light is off"
    }
}

class SwitchOnCommand implements Command {
    Light light

    @Override // Command
    void execute() {
        light.turnOn()
    }
}

class SwitchOffCommand implements Command {
    Light light

    @Override // Command
    void execute() {
        light.turnOff()
    }
}

Light lamp = new Light()
Command switchOn = new SwitchOnCommand(light: lamp)
Command switchOff = new SwitchOffCommand(light: lamp)

Switch mySwitch = new Switch()
mySwitch.register("on", switchOn)
mySwitch.register("off", switchOff)

mySwitch.execute("on")
mySwitch.execute("off")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our client scripts sends <code>execute</code> commands to an intermediary and knows nothing
about any specific receivers, or any specific action method names and arguments.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simplifying_variations"><a class="anchor" href="#_simplifying_variations"></a><a class="link" href="#_simplifying_variations">Simplifying variations</a></h6>
<div class="paragraph">
<p>Given that Groovy has first-class function support, we can do away with the
actual command classes (like <code>SwitchOnCommand</code>) by instead using closures as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Command {
    void execute()
}

// invoker class
class Switch {
    private final Map&lt;String, Command&gt; commandMap = [:]

    void register(String commandName, Command command) {
        commandMap[commandName] = command
    }

    void execute(String commandName) {
        Command command = commandMap[commandName]
        if (!command) {
            throw new IllegalStateException("no command registered for $commandName")
        }
        command.execute()
    }
}

// receiver class
class Light {
    void turnOn() {
        println 'The light is on'
    }

    void turnOff() {
        println 'The light is off'
    }
}

Light lamp = new Light()

Switch mySwitch = new Switch()
mySwitch.register("on", lamp.&amp;turnOn)       <i class="conum" data-value="1"></i><b>(1)</b>
mySwitch.register("off", lamp.&amp;turnOff)     <i class="conum" data-value="1"></i><b>(1)</b>

mySwitch.execute("on")
mySwitch.execute("off")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Command closures (here method closures) but could be lambdas/method references for Groovy 3+</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can simplify further using the JDK&#8217;s existing <code>Runnable</code> interface
and using a switch map rather than a separate <code>Switch</code> class as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Light {
    void turnOn() {
        println 'The light is on'
    }

    void turnOff() {
        println 'The light is off'
    }
}

class Door {
    static void unlock() {
        println 'The door is unlocked'
    }
}

Light lamp = new Light()
Map&lt;String, Runnable&gt; mySwitch = [
    on: lamp::turnOn,
    off: lamp::turnOff,
    unlock: Door::unlock
]

mySwitch.on()
mySwitch.off()
mySwitch.unlock()</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added an additional <code>Door</code> receiver to illustrate how to expand the original example.
Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The light is on
The light is off
The door is unlocked</pre>
</div>
</div>
<div class="paragraph">
<p>As a variation, if the command names aren&#8217;t important to us,
we can forgo using the switch map and just have a list of tasks to invoke as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// ...
List&lt;Runnable&gt; tasks = [lamp::turnOn, lamp::turnOff, Door::unlock]
tasks.each{ it.run() }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composite_pattern"><a class="anchor" href="#_composite_pattern"></a><a class="link" href="#_composite_pattern">Composite Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Composite_pattern">Composite Pattern</a> allows you to treat single instances of an object the same way as a group of objects. The pattern is often used with hierarchies of objects. Typically, one or more methods should be callable in the same way for either <em>leaf</em> or <em>composite</em> nodes within the hierarchy. In such a case, composite nodes typically invoke the same named method for each of their children nodes.</p>
</div>
<div class="sect5">
<h6 id="_example_2"><a class="anchor" href="#_example_2"></a><a class="link" href="#_example_2">Example</a></h6>
<div class="paragraph">
<p>Consider this usage of the composite pattern where we want to call <code>toString()</code> on either <code>Leaf</code> or <code>Composite</code> objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xCompositeClasses.png.pagespeed.ic.5haJcidKJO.png" alt="CompositeClasses" width="338" height="188">
</div>
</div>
<div class="paragraph">
<p>In Java, the <code>Component</code> class is essential as it provides the type used for both leaf and composite nodes. In Groovy, because of duck-typing, we don&#8217;t need it for that purpose, however, it can still serve as a useful place to place common behaviour between the leaf and composite nodes.</p>
</div>
<div class="paragraph">
<p>For our purposes, we will assemble the following hierarchy of components.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xCompositeComponents.png.pagespeed.ic.xKXoQrJzuT.png" alt="CompositeComponents" width="244" height="245">
</div>
</div>
<div class="paragraph">
<p>Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Component {
    def name
    def toString(indent) {
        ("-" * indent) + name
    }
}

class Composite extends Component {
    private children = []
    def toString(indent) {
        def s = super.toString(indent)
        children.each { child -&gt;
            s += "\\n" + child.toString(indent + 1)
        }
        s
    }
    def leftShift(component) {
        children &lt;&lt; component
    }
}

class Leaf extends Component { }

def root = new Composite(name: "root")
root &lt;&lt; new Leaf(name: "leaf A")
def comp = new Composite(name: "comp B")
root &lt;&lt; comp
root &lt;&lt; new Leaf(name: "leaf C")
comp &lt;&lt; new Leaf(name: "leaf B1")
comp &lt;&lt; new Leaf(name: "leaf B2")
println root.toString(0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root
-leaf A
-comp B
--leaf B1
--leaf B2
-leaf C</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decorator_pattern"><a class="anchor" href="#_decorator_pattern"></a><a class="link" href="#_decorator_pattern">Decorator Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a> provides a mechanism to embellish the behaviour of an object without changing its essential interface. A decorated object should be able to be substituted wherever the original (non-decorated) object was expected. Decoration typically does not involve modifying the source code of the original object and decorators should be able to be combined in flexible ways to produce objects with several embellishments.</p>
</div>
<div class="sect5">
<h6 id="_traditional_example"><a class="anchor" href="#_traditional_example"></a><a class="link" href="#_traditional_example">Traditional Example</a></h6>
<div class="paragraph">
<p>Suppose we have the following <code>Logger</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Logger {
    def log(String message) {
        println message
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There might be times when it is useful to timestamp a log message, or times when we might want to change the case of the message. We could try to build all of this functionality into our <code>Logger</code> class. If we did that, the <code>Logger</code> class would start to be very complex. Also, everyone would obtain all of the features even when they might want only a small subset of the features. Finally, feature interaction would become quite difficult to control.</p>
</div>
<div class="paragraph">
<p>To overcome these drawbacks, we instead define two decorator classes. Uses of the <code>Logger</code> class are free to embellish their base logger with zero or more decorator classes in whatever order they desire. The classes look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TimeStampingLogger extends Logger {
    private Logger logger
    TimeStampingLogger(logger) {
        this.logger = logger
    }
    def log(String message) {
        def now = Calendar.instance
        logger.log("$now.time: $message")
    }
}

class UpperLogger extends Logger {
    private Logger logger
    UpperLogger(logger) {
        this.logger = logger
    }
    def log(String message) {
        logger.log(message.toUpperCase())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the decorators like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def logger = new UpperLogger(new TimeStampingLogger(new Logger()))
logger.log("G'day Mate")
// =&gt; Tue May 22 07:13:50 EST 2007: G'DAY MATE</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we embellish the logger behaviour with both decorators. Because of the order we chose to apply the decorators, our log message comes out capitalised and the timestamp is in normal case. If we swap the order around, let&#8217;s see what happens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">logger = new TimeStampingLogger(new UpperLogger(new Logger()))
logger.log('Hi There')
// =&gt; TUE MAY 22 07:13:50 EST 2007: HI THERE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the timestamp itself has also been changed to be uppercase.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simplifying_with_closures_or_lambdas"><a class="anchor" href="#_simplifying_with_closures_or_lambdas"></a><a class="link" href="#_simplifying_with_closures_or_lambdas">Simplifying with closures or lambdas</a></h6>
<div class="paragraph">
<p>Closures make it easy to represent code. We can use that fact to
make a general purpose logger class that accepts the decoration code as a closure.
This saves us defining many decoration classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class DecoratingLogger {
    def decoration = Closure.IDENTITY

    def log(String message) {
        println decoration(message)
    }
}

def upper = { it.toUpperCase() }
def stamp = { "$Calendar.instance.time: $it" }
def logger = new DecoratingLogger(decoration: stamp &lt;&lt; upper)
logger.log("G'day Mate")
// Sat Aug 29 15:28:29 AEST 2020: G'DAY MATE</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the same approach with lambdas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.function.Function

class DecoratingLogger {
    Function&lt;String, String&gt; decoration = Function.identity()

    def log(String message) {
        println decoration.apply(message)
    }
}

Function&lt;String, String&gt; upper = s -&gt; s.toUpperCase()
Function&lt;String, String&gt; stamp = s -&gt; "$Calendar.instance.time: $s"
def logger = new DecoratingLogger(decoration: upper.andThen(stamp))
logger.log("G'day Mate")
// =&gt; Sat Aug 29 15:38:28 AEST 2020: G'DAY MATE</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_a_touch_of_dynamic_behaviour"><a class="anchor" href="#_a_touch_of_dynamic_behaviour"></a><a class="link" href="#_a_touch_of_dynamic_behaviour">A touch of dynamic behaviour</a></h6>
<div class="paragraph">
<p>Our previous decorators were specific to <code>Logger</code> objects. We can use Groovy&#8217;s Meta-Object Programming capabilities to create a decorator which is far more general purpose in nature. Consider this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class GenericLowerDecorator {
    private delegate
    GenericLowerDecorator(delegate) {
        this.delegate = delegate
    }
    def invokeMethod(String name, args) {
        def newargs = args.collect { arg -&gt;
            if (arg instanceof String) {
                return arg.toLowerCase()
            } else {
                return arg
            }
        }
        delegate.invokeMethod(name, newargs)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes any class and decorates it so that any <code>String</code> method parameter will automatically be changed to lower case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">logger = new GenericLowerDecorator(new TimeStampingLogger(new Logger()))
logger.log('IMPORTANT Message')
// =&gt; Tue May 22 07:27:18 EST 2007: important message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just be careful with ordering here. The original decorators were restricted to decorating <code>Logger</code> objects. This decorator works with any object type, so we can&#8217;t swap the ordering around, i.e. this won&#8217;t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Can't mix and match Interface-Oriented and Generic decorators
// logger = new TimeStampingLogger(new GenericLowerDecorator(new Logger()))</pre>
</div>
</div>
<div class="paragraph">
<p>We could overcome this limitation be generating an appropriate Proxy type at runtime but we won&#8217;t complicate the example here.</p>
</div>
</div>
<div class="sect5">
<h6 id="_runtime_behaviour_embellishment"><a class="anchor" href="#_runtime_behaviour_embellishment"></a><a class="link" href="#_runtime_behaviour_embellishment">Runtime behaviour embellishment</a></h6>
<div class="paragraph">
<p>You can also consider using the <code>ExpandoMetaClass</code> from Groovy 1.1 to dynamically embellish a class with behaviour. This isn&#8217;t the normal style of usage of the decorator pattern (it certainly isn&#8217;t nearly as flexible) but may help you to achieve similar results in some cases without creating a new class.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what the code looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// current mechanism to enable ExpandoMetaClass
GroovySystem.metaClassRegistry.metaClassCreationHandle = new ExpandoMetaClassCreationHandle()

def logger = new Logger()
logger.metaClass.log = { String m -&gt; println 'message: ' + m.toUpperCase() }
logger.log('x')
// =&gt; message: X</code></pre>
</div>
</div>
<div class="paragraph">
<p>This achieves a similar result to applying a single decorator but we have no way to easily apply and remove embellishments on the fly.</p>
</div>
</div>
<div class="sect5">
<h6 id="_more_dynamic_decorating"><a class="anchor" href="#_more_dynamic_decorating"></a><a class="link" href="#_more_dynamic_decorating">More dynamic decorating</a></h6>
<div class="paragraph">
<p>Suppose we have a calculator class (Actually any class would do).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Calc {
    def add(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We might be interested in observing usage of the class over time. If it is buried deep within our codebase, it might be hard to determine when it is being called and with what parameters. Also, it might be hard to know if it is performing well. We can easily make a generic tracing decorator that prints out tracing information whenever any method on the <code>Calc</code> class is called and also provide timing information about how long it took to execute. Here is the code for the tracing decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TracingDecorator {
    private delegate
    TracingDecorator(delegate) {
        this.delegate = delegate
    }
    def invokeMethod(String name, args) {
        println "Calling $name$args"
        def before = System.currentTimeMillis()
        def result = delegate.invokeMethod(name, args)
        println "Got $result in ${System.currentTimeMillis()-before} ms"
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how to use the class in a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def tracedCalc = new TracingDecorator(new Calc())
assert 15 == tracedCalc.add(3, 12)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is what you would see after running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Calling add{3, 12}
Got 15 in 31 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_an_interceptor"><a class="anchor" href="#_decorating_with_an_interceptor"></a><a class="link" href="#_decorating_with_an_interceptor">Decorating with an Interceptor</a></h6>
<div class="paragraph">
<p>The above timing example hooks into the lifecycle of Groovy objects (via <code>invokeMethod</code>). This is such an important style performing meta-programming that Groovy has special support for this style of decorating using <em>interceptors</em>.</p>
</div>
<div class="paragraph">
<p>Groovy even comes with a built-in <code>TracingInterceptor</code>. We can extend the built-in class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class TimingInterceptor extends TracingInterceptor {
    private beforeTime
    def beforeInvoke(object, String methodName, Object[] arguments) {
        super.beforeInvoke(object, methodName, arguments)
        beforeTime = System.currentTimeMillis()
    }
    Object afterInvoke(Object object, String methodName, Object[] arguments, Object result) {
        super.afterInvoke(object, methodName, arguments, result)
        def duration = System.currentTimeMillis() - beforeTime
        writer.write("Duration: $duration ms\\n")
        writer.flush()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of using this new class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def proxy = ProxyMetaClass.getInstance(Calc)
proxy.interceptor = new TimingInterceptor()
proxy.use {
    assert 7 == new Calc().add(1, 6)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>before Calc.ctor()
after  Calc.ctor()
Duration: 0 ms
before Calc.add(java.lang.Integer, java.lang.Integer)
after  Calc.add(java.lang.Integer, java.lang.Integer)
Duration: 2 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_java_lang_reflect_proxy"><a class="anchor" href="#_decorating_with_java_lang_reflect_proxy"></a><a class="link" href="#_decorating_with_java_lang_reflect_proxy">Decorating with java.lang.reflect.Proxy</a></h6>
<div class="paragraph">
<p>If you are trying to decorate an object (i.e. just a particular instance of the class, not the class generally), then you can use Java&#8217;s <code>java.lang.reflect.Proxy</code>. Groovy makes working with this easier than just Java. Below is a code sample taken out of a grails project that wraps a <code>java.sql.Connection</code> so that it&#8217;s close method is a no-op:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">protected Sql getGroovySql() {
    final Connection con = session.connection()
    def invoker = { object, method, args -&gt;
        if (method.name == "close") {
            log.debug("ignoring call to Connection.close() for use by groovy.sql.Sql")
        } else {
            log.trace("delegating $method")
            return con.invokeMethod(method.name, args)
        }
    } as InvocationHandler;
    def proxy = Proxy.newProxyInstance( getClass().getClassLoader(), [Connection] as Class[], invoker )
    return new Sql(proxy)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there were many methods to intercept, then this approach could be modified to look up closure in a map by method name and invoke it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_spring"><a class="anchor" href="#_decorating_with_spring"></a><a class="link" href="#_decorating_with_spring">Decorating with Spring</a></h6>
<div class="paragraph">
<p>The <a href="https://spring.io/">Spring Framework</a> allows decorators to be applied with <em>interceptors</em> (you may have heard the terms <em>advice</em> or <em>aspect</em>). You can leverage this mechanism from Groovy as well.</p>
</div>
<div class="paragraph">
<p>First define a class that you want to decorate (we&#8217;ll also use an interface as is normal Spring practice):</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Calc {
    def add(a, b)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class CalcImpl implements Calc {
    def add(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we define our wiring in a file called <code>beans.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:lang="http://www.springframework.org/schema/lang"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/lang https://www.springframework.org/schema/lang/spring-lang.xsd"&gt;

    &lt;bean id="performanceInterceptor" autowire="no"
          class="org.springframework.aop.interceptor.PerformanceMonitorInterceptor"&gt;
        &lt;property name="loggerName" value="performance"/&gt;
    &lt;/bean&gt;
    &lt;bean id="calc" class="util.CalcImpl"/&gt;
    &lt;bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
        &lt;property name="beanNames" value="calc"/&gt;
        &lt;property name="interceptorNames" value="performanceInterceptor"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our script looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.springframework:spring-context:5.2.8.RELEASE')
import org.springframework.context.support.ClassPathXmlApplicationContext

def ctx = new ClassPathXmlApplicationContext('beans.xml')
def calc = ctx.getBean('calc')
println calc.add(3, 25)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And when we run it, we see the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>21/05/2007 23:02:35 org.springframework.aop.interceptor.PerformanceMonitorInterceptor invokeUnderTrace
FINEST: StopWatch 'util.Calc.add': running time (millis) = 16</pre>
</div>
</div>
<div class="paragraph">
<p>You may have to adjust your <code>logging.properties</code> file for messages at log level <code>FINEST</code> to be displayed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_asynchronous_decorators_using_gpars"><a class="anchor" href="#_asynchronous_decorators_using_gpars"></a><a class="link" href="#_asynchronous_decorators_using_gpars">Asynchronous Decorators using GPars</a></h6>
<div class="paragraph">
<p>The following example is inspired by some of the early example code for the
<a href="http://design.cs.iastate.edu/~panini/">Panini</a> programming language.
These days, you&#8217;ll see this style used with async functions in JavaScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grab('org.codehaus.gpars:gpars:0.10')
import static groovyx.gpars.GParsPool.withPool

interface Document {
    void print()
    String getText()
}

class DocumentImpl implements Document {
    def document
    void print() { println document }
    String getText() { document }
}

def words(String text) {
    text.replaceAll('[^a-zA-Z]', ' ').trim().split("\\\\s+")*.toLowerCase()
}

def avgWordLength = {
    def words = words(it.text)
    sprintf "Avg Word Length: %4.2f", words*.size().sum() / words.size()
}
def modeWord = {
    def wordGroups = words(it.text).groupBy {it}.collectEntries { k, v -&gt; [k, v.size()] }
    def maxSize = wordGroups*.value.max()
    def maxWords = wordGroups.findAll { it.value == maxSize }
    "Mode Word(s): ${maxWords*.key.join(', ')} ($maxSize occurrences)"
}
def wordCount = { d -&gt; "Word Count: " + words(d.text).size() }

def asyncDecorator(Document d, Closure c) {
    ProxyGenerator.INSTANCE.instantiateDelegate([print: {
        withPool {
            def result = c.callAsync(d)
            d.print()
            println result.get()
        }
    }], [Document], d)
}

Document d = asyncDecorator(asyncDecorator(asyncDecorator(
        new DocumentImpl(document:"This is the file with the words in it\\n\\t\\nDo you see the words?\\n"),
//        new DocumentImpl(document: new File('AsyncDecorator.groovy').text),
        wordCount), modeWord), avgWordLength)
d.print()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delegation_pattern"><a class="anchor" href="#_delegation_pattern"></a><a class="link" href="#_delegation_pattern">Delegation Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Delegation_pattern">Delegation Pattern</a> is a technique where an object&#8217;s behavior (public methods) is implemented by delegating responsibility to one or more associated objects.</p>
</div>
<div class="paragraph">
<p>Groovy allows the traditional style of applying the delegation pattern, e.g. see <a href="https://refactoring.com/catalog/replaceSuperclassWithDelegate.html">Replace Inheritance with Delegation</a>.</p>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_expandometaclass"><a class="anchor" href="#_implement_delegation_pattern_using_expandometaclass"></a><a class="link" href="#_implement_delegation_pattern_using_expandometaclass">Implement Delegation Pattern using ExpandoMetaClass</a></h6>
<div class="paragraph">
<p>The <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/lang/ExpandoMetaClass.html">groovy.lang.ExpandoMetaClass</a> allows usage of this pattern to be encapsulated in a library. This allows Groovy to emulate similar libraries available for the Ruby language.</p>
</div>
<div class="paragraph">
<p>Consider the following library class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Delegator {
    private targetClass
    private delegate
    Delegator(targetClass, delegate) {
        this.targetClass = targetClass
        this.delegate = delegate
    }
    def delegate(String methodName) {
        delegate(methodName, methodName)
    }
    def delegate(String methodName, String asMethodName) {
        targetClass.metaClass."$asMethodName" = delegate.&amp;"$methodName"
    }
    def delegateAll(String[] names) {
        names.each { delegate(it) }
    }
    def delegateAll(Map names) {
        names.each { k, v -&gt; delegate(k, v) }
    }
    def delegateAll() {
        delegate.class.methods*.name.each { delegate(it) }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in your classpath, you can now apply the delegation pattern dynamically as shown in the following examples. First, consider we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    String name
}

class MortgageLender {
    def borrowAmount(amount) {
       "borrow \\$$amount"
    }
    def borrowFor(thing) {
       "buy \\$thing"
    }
}

def lender = new MortgageLender()

def delegator = new Delegator(Person, lender)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the <em>delegator</em> to automatically borrow methods from the <em>lender</em> object to extend the <em>Person</em> class. We can borrow the methods as is or with a rename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">delegator.delegate 'borrowFor'
delegator.delegate 'borrowAmount', 'getMoney'

def p = new Person()

println p.borrowFor('present')   // =&gt; buy present
println p.getMoney(50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line above, adds the <em>borrowFor</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object. The second line adds a <em>getMoney</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object&#8217;s <em>borrowAmount</em> method.</p>
</div>
<div class="paragraph">
<p>Alternatively, we could borrow multiple methods like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">delegator.delegateAll 'borrowFor', 'borrowAmount'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which adds these two methods to the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Or if we want all the methods, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">delegator.delegateAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will make all the methods in the delegate object available in the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can use a map notation to rename multiple methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">delegator.delegateAll borrowAmount:'getMoney', borrowFor:'getThing'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_delegate_annotation"><a class="anchor" href="#_implement_delegation_pattern_using_delegate_annotation"></a><a class="link" href="#_implement_delegation_pattern_using_delegate_annotation">Implement Delegation Pattern using @Delegate annotation</a></h6>
<div class="paragraph">
<p>Since version 1.6 you can use the built-in delegation mechanism which is based on AST transformation.</p>
</div>
<div class="paragraph">
<p>This make delegation even easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Person {
    def name
    @Delegate MortgageLender mortgageLender = new MortgageLender()
}

class MortgageLender {
    def borrowAmount(amount) {
       "borrow \\$$amount"
    }
    def borrowFor(thing) {
       "buy $thing"
    }
}

def p = new Person()

assert "buy present" == p.borrowFor('present')
assert "borrow \\$50" == p.borrowAmount(50)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_flyweight_pattern"><a class="anchor" href="#_flyweight_pattern"></a><a class="link" href="#_flyweight_pattern">Flyweight Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight Pattern</a> is a pattern for greatly reducing memory requirements by not requiring that heavy-weight objects be created in large numbers when dealing with systems that contain many things that are mostly the same. If for instance, a document was modelled using a complex character class that knew about unicode, fonts, positioning, etc., then the memory requirements could be quite large for large documents if each physical character in the document required its own character class instance. Instead, characters themselves might be kept within Strings and we might have one character class (or a small number such as one character class for each font type) that knew the specifics of how to deal with characters.</p>
</div>
<div class="paragraph">
<p>In such circumstances, we call the state that is shared with many other things (e.g. the character type) <em>intrinsic</em> state. It is captured within the heavy-weight class. The state which distinguishes the physical character (maybe just its ASCII code or Unicode) is called its <em>extrinsic</em> state.</p>
</div>
<div class="sect5">
<h6 id="_example_3"><a class="anchor" href="#_example_3"></a><a class="link" href="#_example_3">Example</a></h6>
<div class="paragraph">
<p>First we are going to model some complex aircraft (the first being a hoax competitor of the second - though that is not relevant to the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Boeing797 {
    def wingspan = '80.8 m'
    def capacity = 1000
    def speed = '1046 km/h'
    def range = '14400 km'
    // ...
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/xb797-hoax.jpg.pagespeed.ic.I6RcM4fhlP.jpg" alt="b797 hoax">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Airbus380 {
    def wingspan = '79.8 m'
    def capacity = 555
    def speed = '912 km/h'
    def range = '10370 km'
    // ...
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/xa380.jpg.pagespeed.ic.Xsn2ioR-2M.jpg" alt="a380">
</div>
</div>
<div class="paragraph">
<p>If we want to model our fleet, our first attempt might involve using many instances of these heavy-weight objects. It turns out though that only a few small pieces of state (our extrinsic state) change for each aircraft, so we will have singletons for the heavy-weight objects and capture the extrinsic state (bought date and asset number in the code below) separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class FlyweightFactory {
    static instances = [797: new Boeing797(), 380: new Airbus380()]
}

class Aircraft {
    private type         // intrinsic state
    private assetNumber  // extrinsic state
    private bought       // extrinsic state
    Aircraft(typeCode, assetNumber, bought) {
        type = FlyweightFactory.instances[typeCode]
        this.assetNumber = assetNumber
        this.bought = bought
    }
    def describe() {
        println """
        Asset Number: $assetNumber
        Capacity: $type.capacity people
        Speed: $type.speed
        Range: $type.range
        Bought: $bought
        """
    }
}

def fleet = [
    new Aircraft(380, 1001, '10-May-2007'),
    new Aircraft(380, 1002, '10-Nov-2007'),
    new Aircraft(797, 1003, '10-May-2008'),
    new Aircraft(797, 1004, '10-Nov-2008')
]

fleet.each { p -&gt; p.describe() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>So here, even if our fleet contained hundreds of planes, we would only have one heavy-weight object for each type of aircraft.</p>
</div>
<div class="paragraph">
<p>As a further efficiency measure, we might use lazy creation of the flyweight objects rather than create the initial map up front as in the above example.</p>
</div>
<div class="paragraph">
<p>Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Asset Number: 1001
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-May-2007

Asset Number: 1002
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-Nov-2007

Asset Number: 1003
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-May-2008

Asset Number: 1004
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-Nov-2008</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterator_pattern"><a class="anchor" href="#_iterator_pattern"></a><a class="link" href="#_iterator_pattern">Iterator Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Iterator_pattern">Iterator Pattern</a> allows sequential access to the elements of an aggregate object without exposing its underlying representation.</p>
</div>
<div class="paragraph">
<p>Groovy has the iterator pattern built right in to many of its closure operators, e.g. <code>each</code> and <code>eachWithIndex</code> as well as the <code>for .. in</code> loop.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def printAll(container) {
    for (item in container) { println item }
}

def numbers = [ 1,2,3,4 ]
def months = [ Mar:31, Apr:30, May:31 ]
def colors = [ java.awt.Color.BLACK, java.awt.Color.WHITE ]
printAll numbers
printAll months
printAll colors</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1
2
3
4
May=31
Mar=31
Apr=30
java.awt.Color[r=0,g=0,b=0]
java.awt.Color[r=255,g=255,b=255]</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">colors.eachWithIndex { item, pos -&gt;
    println "Position $pos contains '$item'"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Position 0 contains 'java.awt.Color[r=0,g=0,b=0]'
Position 1 contains 'java.awt.Color[r=255,g=255,b=255]'</pre>
</div>
</div>
<div class="paragraph">
<p>The iterator pattern is also built in to other special operators such as the <code>eachByte</code>, <code>eachFile</code>, <code>eachDir</code>, <code>eachLine</code>, <code>eachObject</code>, <code>eachMatch</code> operators for working with streams, URLs, files, directories and regular expressions matches.</p>
</div>
</div>
<div class="sect4">
<h5 id="_loan_my_resource_pattern"><a class="anchor" href="#_loan_my_resource_pattern"></a><a class="link" href="#_loan_my_resource_pattern">Loan my Resource Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://wiki.scala-lang.org/display/SYGN/Loan">Loan my Resource</a> pattern ensures that a resource is deterministically disposed of once it goes out of scope.</p>
</div>
<div class="paragraph">
<p>This pattern is built in to many Groovy helper methods. You should consider using it yourself if you need to work with resources in ways beyond what Groovy supports.</p>
</div>
<div class="sect5">
<h6 id="_example_4"><a class="anchor" href="#_example_4"></a><a class="link" href="#_example_4">Example</a></h6>
<div class="paragraph">
<p>Consider the following code which works with a file. First we might write some line to the file and then print its size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def f = new File('junk.txt')
f.withPrintWriter { pw -&gt;
    pw.println(new Date())
    pw.println(this.class.name)
}
println f.size()
// =&gt; 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also read back the contents of the file a line at a time and print each line out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">f.eachLine { line -&gt;
    println line
}
// =&gt;
// Mon Jun 18 22:38:17 EST 2007
// RunPattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that normal Java <code>Reader</code> and <code>PrintWriter</code> objects were used under the covers by Groovy but the code writer did not have to worry about explicitly creating or closing those resources. The built-in Groovy methods loan the respective reader or writer to the closure code and then tidy up after themselves. So, you are using this pattern without having to do any work.</p>
</div>
<div class="paragraph">
<p>Sometimes however, you wish to do things slightly differently to what you can get for free using Groovy&#8217;s built-in mechanisms. You should consider utilising this pattern within your own resource-handling operations.</p>
</div>
<div class="paragraph">
<p>Consider how you might process the list of words on each line within the file. We could actually do this one too using Groovy&#8217;s built-in functions, but bear with us and assume we have to do some resource handling ourselves. Here is how we might write the code without using this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def reader = f.newReader()
reader.splitEachLine(' ') { wordList -&gt;
    println wordList
}
reader.close()
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we now have an explicit call to <code>close()</code> in our code. If we didn&#8217;t code it just right (here we didn&#8217;t surround the code in a <code>try &#8230;&#8203; finally</code> block, we run the risk of leaving the file handle open.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now apply the loan pattern. First, we&#8217;ll write a helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def withListOfWordsForEachLine(File f, Closure c) {
    def r = f.newReader()
    try {
        r.splitEachLine(' ', c)
    } finally {
        r?.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can re-write our code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withListOfWordsForEachLine(f) { wordList -&gt;
    println wordList
}
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is much simpler and has removed the explicit <code>close()</code>. This is now catered for in one spot so we can apply the appropriate level of testing or reviewing in just one spot to be sure we have no problems.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_monoids"><a class="anchor" href="#_using_monoids"></a><a class="link" href="#_using_monoids">Using Monoids</a></h5>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Monoid#Monoids_in_computer_science">Monoids</a> allow
the mechanics of an aggregation algorithm to be separated from the algorithm-specific logic associated with that aggregation.
It is often thought to be a functional design pattern.</p>
</div>
<div class="paragraph">
<p>Perhaps, it is easiest seen with an example. Consider the code for integer sum, integer product and string concatenation.
We might note various similarities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nums = [1, 2, 3, 4]

def sum = 0    <i class="conum" data-value="1"></i><b>(1)</b>
for (num in nums) { sum += num }    <i class="conum" data-value="2"></i><b>(2)</b>
assert sum == 10

def product = 1    <i class="conum" data-value="1"></i><b>(1)</b>
for (num in nums) { product *= num }    <i class="conum" data-value="2"></i><b>(2)</b>
assert product == 24

def letters = ['a', 'b', 'c']

def concat = ''    <i class="conum" data-value="1"></i><b>(1)</b>
for (letter in letters) { concat += letter }    <i class="conum" data-value="2"></i><b>(2)</b>
assert concat == 'abc'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize an aggregate counter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Loop throw elements with for/while/iteration adjusting counter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can remove the duplicate aggregation coding and the tease out the important differences for each algorithm.
We might instead use Groovy&#8217;s <code>inject</code> method. This is a <em>fold</em> operation in functional programming jargon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert nums.inject(0){ total, next -&gt; total + next } == 10
assert nums.inject(1){ total, next -&gt; total * next } == 24
assert letters.inject(''){ total, next -&gt; total + next } == 'abc'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the first parameter is the initial value, and the supplied closure contains the algorithm-specific logic.</p>
</div>
<div class="paragraph">
<p>Similarly, for Groovy 3+, we can use the JDK stream API and lambda syntax as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert nums.stream().reduce(0, (total, next) -&gt; total + next) == 10
assert nums.stream().reduce(1, (total, next) -&gt; total * next) == 24
assert letters.stream().reduce('', (total, next) -&gt; total + next) == 'abc'</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_a_touch_of_formalism"><a class="anchor" href="#_a_touch_of_formalism"></a><a class="link" href="#_a_touch_of_formalism">A touch of formalism</a></h6>
<div class="paragraph">
<p>Looking at these examples, we might think all aggregation can be supported this way.
In fact, we look for certain characteristics to ensure that this aggregation pattern will apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Closure: performing the aggregation step should produce a result of the same type as the elements being aggregated.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>1L + 3L</code> produces a <code>Long</code>, and <code>'foo' + 'bar'</code> produces a <code>String</code>.<br>
Non-monoid examples: <code>'foo'.size() + 'bar'.size()</code> (takes strings, returns an integer),
the type <em>odd numbers</em> with respect to addition, algorithms which don&#8217;t handle null arguments if such arguments are possible.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the term <em>closure</em> here, we simply mean closed under the operation, not the Groovy <code>Closure</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Associativity: the order in which we apply the aggregation step should not matter.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>(1 + 3) + 5</code> is the same as <code>1 + (3 + 5)</code>, and <code>('a' + 'b') + 'c'</code> is the same as <code>'a' + ('b' + 'c')</code>.<br>
Non-monoid example: <code>(10 - 5) - 3</code> is not equal to <code>10 - (5 - 3)</code> therefore integers are not a monoid with respect to subtraction.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Identity element (sometimes also called a 'zero' element):
there should be an element which aggregated with any element returns the original element.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>0 + 42 == 42</code>, <code>42 + 0 == 42</code>, <code>1 * 42 == 42</code>, and <code>'' + 'foo' == 'foo'</code>.<br>
Non-monoid example: the type <em>non-empty strings</em> is not a monoid with respect to concatenation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If your algorithm doesn&#8217;t satisfy all the monoid properties, that doesn&#8217;t mean aggregation isn&#8217;t possible.
It just means that you won&#8217;t get all the benefits from monoids, which we&#8217;ll cover shortly, or you might have
a little more work to do.
Also, you might be able to convert your data structures slightly to turn your problem into one involving monoids.
We&#8217;ll cover that topic a little later in this section.</p>
</div>
</div>
<div class="sect5">
<h6 id="_benefits_of_monoids"><a class="anchor" href="#_benefits_of_monoids"></a><a class="link" href="#_benefits_of_monoids">Benefits of monoids</a></h6>
<div class="paragraph">
<p>Consider adding the integers 10 through 16.
Because the operation of addition for integers is a monoid, we already know that we can save writing code
and instead use the approach we saw in the earlier <code>inject</code> examples.
There are some other nice properties.</p>
</div>
<div class="paragraph">
<p>Because of the <em>closure</em> property,
if we have a pairwise method like <code>sum(Integer a, Integer b)</code>, then for a monoid, we can always
extend that method to work with a list, e.g. <code>sum(List&lt;Integer&gt; nums)</code> or <code>sum(Integer first, Integer&#8230;&#8203; rest)</code>.</p>
</div>
<div class="paragraph">
<p>Because of <em>associativity</em>,
we can employ some interesting ways to solve the aggregation including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Divide and conquer algorithms which break the problem into smaller pieces</p>
</li>
<li>
<p>Various incremental algorithms for example memoization would allow summing from 1..5
to potentially start part way through be reusing a cached value of summing 1..4 if that had been calculated earlier</p>
</li>
<li>
<p>Inherent parallelization can make use of multiple cores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s just look at the first of these in more detail. With a multicore
processor, one core could add <code>10</code> plus <code>11</code>, another core <code>12</code> plus <code>13</code>, and so on.
We&#8217;d use the <em>identity</em> element if needed (shown being added to <code>16</code> in our example).
Then the intermediate results could also be added together concurrently and so on until the result was reached.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xMonoidAddition.png.pagespeed.ic.UNeJD_gls-.png" alt="MonoidAddition" width="592" height="338">
</div>
</div>
<div class="paragraph">
<p>We have reduced the amount of code we need to write, and we also have potential performance gains.</p>
</div>
<div class="paragraph">
<p>Here is how we might code the previous example using the <a href="http://gpars.org/">GPars</a>
concurrency and parallelism framework (two alternatives shown):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nums = 10..16
GParsPool.withPool {
    assert 91 == nums.injectParallel(0){ total, next -&gt; total + next }
    assert 91 == nums.parallel.reduce(0, (total, next) -&gt; total + next)
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_working_with_non_monoids"><a class="anchor" href="#_working_with_non_monoids"></a><a class="link" href="#_working_with_non_monoids">Working with Non-monoids</a></h6>
<div class="paragraph">
<p>Suppose we want to find the average of the numbers 1..10. Groovy has a built-in method for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (1..10).average() == 5.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, suppose we want to build our own monoid solution instead of using the built-in version.
It might seem difficult to find the <em>identity</em> element. After all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert (0..10).average() == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we are tempted to write the pairwise aggregation closure it might be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def avg = { a, b -&gt; (a + b) / 2 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What <code>b</code> can we use for the <em>identity</em> element here so that our equation returns the original?
We need to use <code>a</code>, but that isn&#8217;t a fixed value, so there is no <em>identity</em>.</p>
</div>
<div class="paragraph">
<p>Also, associativity doesn&#8217;t hold for this initial attempt at defining <code>avg</code> as these examples show:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 6 == avg(avg(10, 2), 6)
assert 7 == avg(10, avg(2, 6))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, what about our <em>closure</em> property? Our original numbers were integers, but our average (<code>5.5</code>)
is not. We can solve this by making our average work for any <code>Number</code> instances, but it might not always be this easy.</p>
</div>
<div class="paragraph">
<p>It might appear that this problem is not amenable to a monoidal solution.
However, there are numerous ways to bring monoids into the solution.</p>
</div>
<div class="paragraph">
<p>We can split it into two parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def nums = 1..10
def total = nums.sum()
def avg = total / nums.size()
assert avg == 5.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The calculation of <code>sum()</code> can follow monoid rules and then our last step can calculate the average.
We can even do a concurrent version with GPars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">withPool {
    assert 5.5 == nums.sumParallel() / nums.size()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we were using the built-in <code>sum()</code> method (and <code>sumParallel()</code> for the GPars example),
but if you were doing it by hand, the monoid nature of that part of your calculation would
make it easier to write your own code for that step.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can introduce a helper data structure that reworks the problem to be a monoid.
Instead of just keeping the total, let&#8217;s keep a list containing the total and count of numbers.
The code could look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def holder = nums
    .collect{ [it, 1] }
    .inject{ a, b -&gt; [a[0] + b[0], a[1] + b[1]] }
def avg = holder[0] / holder[1]
assert avg == 5.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, to be a little fancier, we could introduce a class for our data structure and even calculate
concurrently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class AverageHolder {
    int total
    int count
    AverageHolder plus(AverageHolder other) {
        return new AverageHolder(total: total + other.total,
                                 count: count + other.count)
    }
    static final AverageHolder ZERO =
        new AverageHolder(total: 0, count: 0)
}

def asHolder = {
    it instanceof Integer ? new AverageHolder(total: it, count : 1) : it
}
def pairwiseAggregate = { aggregate, next -&gt;
    asHolder(aggregate) + asHolder(next)
}
withPool {
    def holder = nums.injectParallel(AverageHolder.ZERO, pairwiseAggregate)
    def avg = holder.with{ total / count }
    assert avg == 5.5
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_null_object_pattern"><a class="anchor" href="#_null_object_pattern"></a><a class="link" href="#_null_object_pattern">Null Object Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Null_object_pattern">Null Object Pattern</a> involves using a special object place-marker object representing null. Typically, if you have a reference to null, you can&#8217;t invoke <code>reference.field</code> or <code>reference.method()</code> You receive the dreaded <code>NullPointerException</code>. The null object pattern uses a special object representing null, instead of using an actual <code>null</code>. This allows you to invoke field and method references on the null object. The result of using the null object should semantically be equivalent to <em>doing nothing</em>.</p>
</div>
<div class="sect5">
<h6 id="_simple_example"><a class="anchor" href="#_simple_example"></a><a class="link" href="#_simple_example">Simple Example</a></h6>
<div class="paragraph">
<p>Suppose we have the following system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Job {
    def salary
}

class Person {
    def name
    def Job job
}

def people = [
    new Person(name: 'Tom', job: new Job(salary: 1000)),
    new Person(name: 'Dick', job: new Job(salary: 1200)),
]

def biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this prints out <code>1200</code>. Suppose now that we now invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">people &lt;&lt; new Person(name: 'Harry')</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now try to calculate <code>biggestSalary</code> again, we receive a null pointer exception.</p>
</div>
<div class="paragraph">
<p>To overcome this problem, we can introduce a <code>NullJob</code> class and change the above statement to become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class NullJob extends Job { def salary = 0 }

people &lt;&lt; new Person(name: 'Harry', job: new NullJob())
biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works as we require but it&#8217;s not always the best way to do this with Groovy. Groovy&#8217;s safe-dereference operator (<code>?.</code>) operator and null aware closures often allow Groovy to avoid the need to create a special null object or null class. This is illustrated by examining a groovier way to write the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">people &lt;&lt; new Person(name:'Harry')
biggestSalary = people.collect { p -&gt; p.job?.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two things are going on here to allow this to work. First of all, <code>max()</code> is <em>'null aware'</em> so that [300, null, 400].max() == 400. Secondly, with the <code>?.</code> operator, an expression like <code>p?.job?.salary</code> will be equal to null if <code>salary</code> is equal to null, or if <code>job</code> is equal ` null or if <code>p</code> is equal to null. You don&#8217;t need to code a complex nested if ... then ... else to avoid a <code>NullPointerException</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tree_example"><a class="anchor" href="#_tree_example"></a><a class="link" href="#_tree_example">Tree Example</a></h6>
<div class="paragraph">
<p>Consider the following example where we want to calculate size, cumulative sum and cumulative product of all the values in a tree structure.</p>
</div>
<div class="paragraph">
<p>Our first attempt has special logic within the calculation methods to handle null values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class NullHandlingTree {
    def left, right, value

    def size() {
        1 + (left ? left.size() : 0) + (right ? right.size() : 0)
    }

    def sum() {
       value + (left ? left.sum() : 0) + (right ? right.sum() : 0)
    }

    def product() {
       value * (left ? left.product() : 1) * (right ? right.product() : 1)
    }
}

def root = new NullHandlingTree(
    value: 2,
    left: new NullHandlingTree(
        value: 3,
        right: new NullHandlingTree(value: 4),
        left: new NullHandlingTree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we introduce the null object pattern (here by defining the <code>NullTree</code> class), we can now simplify the logic in the <code>size()</code>, <code>sum()</code> and`product()` methods. These methods now much more clearly represent the logic for the normal (and now universal) case. Each of the methods within <code>NullTree</code> returns a value which represents doing nothing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Tree {
    def left = new NullTree(), right = new NullTree(), value

    def size() {
        1 + left.size() + right.size()
    }

    def sum() {
       value + left.sum() + right.sum()
    }

    def product() {
       value * left.product() * right.product()
    }
}

class NullTree {
    def size() { 0 }
    def sum() { 0 }
    def product() { 1 }
}

def root = new Tree(
    value: 2,
    left: new Tree(
        value: 3,
        right: new Tree(value: 4),
        left: new Tree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of running either of these examples is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4
14
120</pre>
</div>
</div>
<div class="paragraph">
<p>Note: a slight variation with the null object pattern is to combine it with the singleton pattern. So, we wouldn&#8217;t write new NullTree() wherever we needed a null object as shown above. Instead we would have a single null object instance which we would place within our data structures as needed.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_observer_pattern"><a class="anchor" href="#_observer_pattern"></a><a class="link" href="#_observer_pattern">Observer Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a> allows one or more <em>observers</em> to be notified
about changes or events from a <em>subject</em> object.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xObserverClasses.png.pagespeed.ic.kUrdUW4QrV.png" alt="ObserverClasses" width="529" height="262">
</div>
</div>
<div class="sect5">
<h6 id="_example_5"><a class="anchor" href="#_example_5"></a><a class="link" href="#_example_5">Example</a></h6>
<div class="paragraph">
<p>Here is a typical implementation of the classic pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Observer {
    void update(message)
}

class Subject {
    private List observers = []
    void register(observer) {
        observers &lt;&lt; observer
    }
    void unregister(observer) {
        observers -= observer
    }
    void notifyAll(message) {
        observers.each{ it.update(message) }
    }
}

class ConcreteObserver1 implements Observer {
    def messages = []
    void update(message) {
        messages &lt;&lt; message
    }
}

class ConcreteObserver2 implements Observer {
    def messages = []
    void update(message) {
        messages &lt;&lt; message.toUpperCase()
    }
}

def o1a = new ConcreteObserver1()
def o1b = new ConcreteObserver1()
def o2 = new ConcreteObserver2()
def observers = [o1a, o1b, o2]
new Subject().with {
    register(o1a)
    register(o2)
    notifyAll('one')
}
new Subject().with {
    register(o1b)
    register(o2)
    notifyAll('two')
}
def expected = [['one'], ['two'], ['ONE', 'TWO']]
assert observers*.messages == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Closures, we can avoid creating the concrete observer classes as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Observer {
    void update(message)
}

class Subject {
    private List observers = []
    void register(Observer observer) {
        observers &lt;&lt; observer
    }
    void unregister(observer) {
        observers -= observer
    }
    void notifyAll(message) {
        observers.each{ it.update(message) }
    }
}

def messages1a = [], messages1b = [], messages2 = []
def o2 = { messages2 &lt;&lt; it.toUpperCase() }
new Subject().with {
    register{ messages1a &lt;&lt; it }
    register(o2)
    notifyAll('one')
}
new Subject().with {
    register{ messages1b &lt;&lt; it }
    register(o2)
    notifyAll('two')
}
def expected = [['one'], ['two'], ['ONE', 'TWO']]
assert [messages1a, messages1b, messages2] == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a variation for Groovy 3+, let&#8217;s consider dropping the <code>Observer</code> interface and using lambdas as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.function.Consumer

class Subject {
    private List&lt;Consumer&gt; observers = []
    void register(Consumer observer) {
        observers &lt;&lt; observer
    }
    void unregister(observer) {
        observers -= observer
    }
    void notifyAll(message) {
        observers.each{ it.accept(message) }
    }
}

def messages1a = [], messages1b = [], messages2 = []
def o2 = { messages2 &lt;&lt; it.toUpperCase() }
new Subject().with {
    register(s -&gt; messages1a &lt;&lt; s)
    register(s -&gt; messages2 &lt;&lt; s.toUpperCase())
    notifyAll('one')
}
new Subject().with {
    register(s -&gt; messages1b &lt;&lt; s)
    register(s -&gt; messages2 &lt;&lt; s.toUpperCase())
    notifyAll('two')
}
def expected = [['one'], ['two'], ['ONE', 'TWO']]
assert [messages1a, messages1b, messages2] == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are now calling the <code>accept</code> method from <code>Consumer</code> rather
than the <code>update</code> method from <code>Observer</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_bindable_and_vetoable"><a class="anchor" href="#_bindable_and_vetoable"></a><a class="link" href="#_bindable_and_vetoable">@Bindable and @Vetoable</a></h6>
<div class="paragraph">
<p>The JDK has some built-in classes which follow the observer pattern.
The <code>java.util.Observer</code> and <code>java.util.Observable</code> classes are deprecated from JDK 9 due to various limitations.
Instead, you are recommended to use various more powerful classes in the <code>java.beans</code> package such as <code>java.beans.PropertyChangeListener</code>.
Luckily, Groovy has some built-in transforms (<a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/beans/Bindable.html">groovy.beans.Bindable</a> and <a href="https://docs.groovy-lang.org/4.0.15/html/gapi/index.html?groovy/beans/Vetoable.html">groovy.beans.Vetoable</a>)
which support for some key classes from that package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.beans.*
import java.beans.*

class PersonBean {
    @Bindable String first
    @Bindable String last
    @Vetoable Integer age
}

def messages = [:].withDefault{[]}
new PersonBean().with {
    addPropertyChangeListener{ PropertyChangeEvent ev -&gt;
        messages[ev.propertyName] &lt;&lt; "prop: $ev.newValue"
    }
    addVetoableChangeListener{ PropertyChangeEvent ev -&gt;
        def name = ev.propertyName
        if (name == 'age' &amp;&amp; ev.newValue &gt; 40)
            throw new PropertyVetoException()
        messages[name] &lt;&lt; "veto: $ev.newValue"
    }
    first = 'John'
    age = 35
    last = 'Smith'
    first = 'Jane'
    age = 42
}

def expected = [
    first:['prop: John', 'prop: Jane'],
    age:['veto: 35'],
    last:['prop: Smith']
]
assert messages == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, methods like <code>addPropertyChangeListener</code> perform the same role as <code>registerObserver</code> in previous examples.
There is a <code>firePropertyChange</code> method corresponding to <code>notifyAll</code>/<code>notifyObservers</code> in previous examples but Groovy adds that
automatically here, so it isn&#8217;t visible in the source code. There is also a <code>propertyChange</code> method that corresponds
to the <code>update</code> method in previous examples, though again, that isn&#8217;t visible here.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pimp_my_library_pattern"><a class="anchor" href="#_pimp_my_library_pattern"></a><a class="link" href="#_pimp_my_library_pattern">Pimp my Library Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=179766">Pimp my Library</a> Pattern suggests an approach for extending a library that nearly does everything that you need but just needs a little more. It assumes that you do not have source code for the library of interest.</p>
</div>
<div class="sect5">
<h6 id="_example_6"><a class="anchor" href="#_example_6"></a><a class="link" href="#_example_6">Example</a></h6>
<div class="paragraph">
<p>Suppose we want to make use of the built-in Integer facilities in Groovy (which build upon the features already in Java). Those libraries have nearly all of the features we want but not quite everything. We may not have all of the source code to the Groovy and Java libraries so we can&#8217;t just change the library. Instead we augment the library. Groovy has a number of ways to do this. One way is to use a Category.</p>
</div>
<div class="paragraph">
<p>First, we&#8217;ll define a suitable category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class EnhancedInteger {
    static boolean greaterThanAll(Integer self, Object[] others) {
        greaterThanAll(self, others)
    }
    static boolean greaterThanAll(Integer self, others) {
        others.every { self &gt; it }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added two methods which augment the Integer methods by providing the <code>greaterThanAll</code> method. Categories follow conventions where they are defined as static methods with a special first parameter representing the class we wish to extend. The greaterThanAll(Integer self, others) static method becomes the <code>greaterThanAll(other)</code> instance method.</p>
</div>
<div class="paragraph">
<p>We defined two versions of <code>greaterThanAll</code>. One which works for collections, ranges etc. The other which works with a variable number of <code>Integer</code> arguments.</p>
</div>
<div class="paragraph">
<p>Here is how you would use the category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">use(EnhancedInteger) {
    assert 4.greaterThanAll(1, 2, 3)
    assert !5.greaterThanAll(2, 4, 6)
    assert 5.greaterThanAll(-4..4)
    assert 5.greaterThanAll([])
    assert !5.greaterThanAll([4, 5])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, using this technique you can effectively enrich an original class without having access to its source code. Moreover, you can apply different enrichments in different parts of the system as well as work with un-enriched objects if we need to.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_proxy_pattern"><a class="anchor" href="#_proxy_pattern"></a><a class="link" href="#_proxy_pattern">Proxy Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Proxy_pattern">Proxy Pattern</a> allows one object to act as a pretend replacement for some other object. In general, whoever is using the proxy, doesn&#8217;t realise that they are not using the real thing. The pattern is useful when the real object is hard to create or use: it may exist over a network connection, or be a large object in memory, or be a file, database or some other resource that is expensive or impossible to duplicate.</p>
</div>
<div class="sect5">
<h6 id="_example_7"><a class="anchor" href="#_example_7"></a><a class="link" href="#_example_7">Example</a></h6>
<div class="paragraph">
<p>One common use of the proxy pattern is when talking to remote objects in a different JVM. Here is the client code for creating a proxy that talks via sockets to a server object as well as an example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class AccumulatorProxy {
    def accumulate(args) {
        def result
        def s = new Socket("localhost", 54321)
        s.withObjectStreams { ois, oos -&gt;
            oos &lt;&lt; args
            result = ois.readObject()
        }
        s.close()
        return result
    }
}

println new AccumulatorProxy().accumulate([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
// =&gt; 55</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what your server code might look like (start this first):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Accumulator {
    def accumulate(args) {
        args.inject(0) { total, arg -&gt; total += arg }
    }
}

def port = 54321
def accumulator = new Accumulator()
def server = new ServerSocket(port)
println "Starting server on port $port"
while(true) {
    server.accept() { socket -&gt;
        socket.withObjectStreams { ois, oos -&gt;
            def args = ois.readObject()
            oos &lt;&lt; accumulator.accumulate(args)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_singleton_pattern"><a class="anchor" href="#_singleton_pattern"></a><a class="link" href="#_singleton_pattern">Singleton Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Pattern</a> is used to make sure only one object of a particular class is ever created. This can be useful when exactly one object is needed to coordinate actions across a system; perhaps for efficiency where creating lots of identical objects would be wasteful, perhaps because a particular algorithm needing a single point of control is required or perhaps when an object is used to interact with a non-shareable resource.</p>
</div>
<div class="paragraph">
<p>Weaknesses of the Singleton pattern include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can reduce reuse. For instance, there are issues if you want to use inheritance with Singletons. If <code>SingletonB</code> extends <code>SingletonA</code>, should there be exactly (at most) one instance of each or should the creation of an object from one of the classes prohibit creation from the other. Also, if you decide both classes can have an instance, how do you override the <code>getInstance()</code> method which is static?</p>
</li>
<li>
<p>It is also hard to test singletons in general because of the static methods but Groovy can support that if required.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_the_classic_java_singleton"><a class="anchor" href="#_example_the_classic_java_singleton"></a><a class="link" href="#_example_the_classic_java_singleton">Example: The Classic Java Singleton</a></h6>
<div class="paragraph">
<p>Suppose we wish to create a class for collecting votes. Because getting the right number of votes may be very important, we decide to use the singleton pattern. There will only ever be one <code>VoteCollector</code> object, so it makes it easier for us to reason about that objects creation and use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class VoteCollector {
    def votes = 0
    private static final INSTANCE = new VoteCollector()
    static getInstance() { return INSTANCE }
    private VoteCollector() { }
    def display() { println "Collector:${hashCode()}, Votes:$votes" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some points of interest in this code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it has a private constructor, so no <code>VoteCollector</code> objects can be created in our system (except for the <code>INSTANCE</code> we create)</p>
</li>
<li>
<p>the <code>INSTANCE</code> is also private, so it can&#8217;t be changed once set</p>
</li>
<li>
<p>we haven&#8217;t made the updating of votes thread-safe at this point (it doesn&#8217;t add to this example)</p>
</li>
<li>
<p>the vote collector instance is not lazily created (if we never reference the class, the instance won&#8217;t be created; however, as soon as we reference the class, the instance will be created even if not needed initially)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use this singleton class in some script code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def collector = VoteCollector.instance
collector.display()
collector.votes++
collector = null

Thread.start{
    def collector2 = VoteCollector.instance
    collector2.display()
    collector2.votes++
    collector2 = null
}.join()

def collector3 = VoteCollector.instance
collector3.display()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we used the instance 3 times. The second usage was even in a different thread (but don&#8217;t try this in a scenario with a new class loader).</p>
</div>
<div class="paragraph">
<p>Running this script yields (your hashcode value will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Collector:15959960, Votes:0
Collector:15959960, Votes:1
Collector:15959960, Votes:2</pre>
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To support lazy-loading and multi-threading, we could just use the <code>synchronized</code> keyword with the <code>getInstance()</code> method. This has a performance hit but will work.</p>
</li>
<li>
<p>We can consider variations involving double-checked locking and the <code>volatile</code> keyword, but see the limitations of this approach <a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_singleton_via_metaprogramming"><a class="anchor" href="#_example_singleton_via_metaprogramming"></a><a class="link" href="#_example_singleton_via_metaprogramming">Example: Singleton via MetaProgramming</a></h6>
<div class="paragraph">
<p>Groovy&#8217;s meta-programming capabilities allow concepts like the singleton pattern to be enacted in a far more fundamental way. This example illustrates a simple way to use Groovy&#8217;s meta-programming capabilities to achieve the singleton pattern but not necessarily the most efficient way.</p>
</div>
<div class="paragraph">
<p>Suppose we want to keep track of the total number of calculations that a calculator performs. One way to do that is to use a singleton for the calculator class and keep a variable in the class with the count.</p>
</div>
<div class="paragraph">
<p>First we define some base classes. A <code>Calculator</code> class which performs calculations and records how many such calculations it performs and a <code>Client</code> class which acts as a facade to the calculator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    def calc = new Calculator()
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and register a <em>MetaClass</em> which intercepts all attempts to create a <code>Calculator</code> object and always provides a pre-created instance instead. We also register this MetaClass with the Groovy system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class CalculatorMetaClass extends MetaClassImpl {
    private static final INSTANCE = new Calculator()
    CalculatorMetaClass() { super(Calculator) }
    def invokeConstructor(Object[] arguments) { return INSTANCE }
}

def registry = GroovySystem.metaClassRegistry
registry.setMetaClass(Calculator, new CalculatorMetaClass())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we use instances of our <code>Client</code> class from within a script. The client class will attempt to create new instances of the calculator but will always get the singleton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def client = new Client()
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = new Client()
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script (your hashcode values may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 7306473, Calc: 24230857, Total Calculations: 1
Client: 31436753, Calc: 24230857, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_guice_example"><a class="anchor" href="#_guice_example"></a><a class="link" href="#_guice_example">Guice Example</a></h6>
<div class="paragraph">
<p>We can also implement the Singleton Pattern using <a href="https://github.com/google/guice">Guice</a>.</p>
</div>
<div class="paragraph">
<p>Consider the Calculator example again.</p>
</div>
<div class="paragraph">
<p>Guice is a Java-oriented framework that supports Interface-Oriented design. Hence we create a <code>Calculator</code> interface first. We can then create our <code>CalculatorImpl</code> implementation and a <code>Client</code> object which our script will interact with. The <code>Client</code> class isn&#8217;t strictly needed for this example but allows us to show that non-singleton instances are the default. Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grapes([@Grab('aopalliance:aopalliance:1.0'), @Grab('com.google.code.guice:guice:1.0')])
import com.google.inject.*

interface Calculator {
    def add(a, b)
}

class CalculatorImpl implements Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    @Inject Calculator calc
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}

def injector = Guice.createInjector (
    [configure: { binding -&gt;
        binding.bind(Calculator)
               .to(CalculatorImpl)
               .asEagerSingleton() } ] as Module
)

def client = injector.getInstance(Client)
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = injector.getInstance(Client)
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Inject</code> annotation in the <code>Client</code> class. We can always tell right in the source code which fields will be injected.</p>
</div>
<div class="paragraph">
<p>In this example we chose to use an <em>explicit</em> binding. All of our dependencies (ok, only one in this example at the moment) are configured in the binding. The Guide injector knows about the binding and injects the dependencies as required when we create objects. For the singleton pattern to hold, you must always use Guice to create your instances. Nothing shown so far would stop you creating another instance of the calculator manually using new CalculatorImpl() which would of course violate the desired singleton behaviour.</p>
</div>
<div class="paragraph">
<p>In other scenarios (though probably not in large systems), we could choose to express dependencies using annotations, such as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grapes([@Grab('aopalliance:aopalliance:1.0'), @Grab('com.google.code.guice:guice:1.0')])
import com.google.inject.*

@ImplementedBy(CalculatorImpl)
interface Calculator {
    // as before ...
}

@Singleton
class CalculatorImpl implements Calculator {
    // as before ...
}

class Client {
    // as before ...
}

def injector = Guice.createInjector()

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Singleton</code> annotation on the <code>CalculatorImpl</code> class and the <code>@ImplementedBy</code> annotation in the <code>Calculator</code> interface.</p>
</div>
<div class="paragraph">
<p>When run, the above example (using either approach) yields (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 8897128, Calc: 17431955, Total Calculations: 1
Client: 21145613, Calc: 17431955, Total Calculations: 2</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we obtained a new client object whenever we asked for an instance but it was injected with the same calculator object.</p>
</div>
</div>
<div class="sect5">
<h6 id="_spring_example_2"><a class="anchor" href="#_spring_example_2"></a><a class="link" href="#_spring_example_2">Spring Example</a></h6>
<div class="paragraph">
<p>We can do the Calculator example again using Spring as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Grapes([@Grab('org.springframework:spring-core:5.2.8.RELEASE'), @Grab('org.springframework:spring-beans:5.2.8.RELEASE')])
import org.springframework.beans.factory.support.*

interface Calculator {
    def add(a, b)
}

class CalculatorImpl implements Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    Client(Calculator calc) { this.calc = calc }
    def calc
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}

// Here we 'wire' up our dependencies through the API. Alternatively,
// we could use XML-based configuration or the Grails Bean Builder DSL.
def factory = new DefaultListableBeanFactory()
factory.registerBeanDefinition('calc', new RootBeanDefinition(CalculatorImpl))
def beanDef = new RootBeanDefinition(Client, false)
beanDef.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_AUTODETECT)
factory.registerBeanDefinition('client', beanDef)

def client = factory.getBean('client')
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = factory.getBean('client')
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the result (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 29418586, Calc: 10580099, Total Calculations: 1
Client: 14800362, Calc: 10580099, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information"><a class="anchor" href="#_further_information"></a><a class="link" href="#_further_information">Further information</a></h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.javaworld.com/javaworld/jw-04-2003/jw-0425-designpatterns.html?page=1">Simply Singleton</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/webservices/library/co-single/index.html">Use your singletons wisely</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">Double-checked locking and the Singleton pattern</a></p>
</li>
<li>
<p><a href="https://web.archive.org/web/20160807234810/http://blog.crazybob.org/2007/01/lazy-loading-singletons.html">Lazy Loading Singletons</a></p>
</li>
<li>
<p><a href="https://csharpindepth.com/Articles/Singleton">Implementing the Singleton Pattern in C#</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_state_pattern"><a class="anchor" href="#_state_pattern"></a><a class="link" href="#_state_pattern">State Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/State_pattern">State Pattern</a> provides a structured approach to partitioning the behaviour within complex systems. The overall behaviour of a system is partitioned into well-defined states. Typically, each state is implemented by a class. The overall system behaviour can be determined firstly by knowing the <em>current state</em> of the system; secondly, by understanding the behaviour possible while in that state (as embodied in the methods of the class corresponding to that state).</p>
</div>
<div class="sect5">
<h6 id="_example_8"><a class="anchor" href="#_example_8"></a><a class="link" href="#_example_8">Example</a></h6>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Client {
    def context = new Context()
    def connect() {
        context.state.connect()
    }
    def disconnect() {
        context.state.disconnect()
    }
    def send_message(message) {
        context.state.send_message(message)
    }
    def receive_message() {
        context.state.receive_message()
    }
}

class Context {
    def state = new Offline(this)
}

class ClientState {
    def context
    ClientState(context) {
        this.context = context
        inform()
    }
}

class Offline extends ClientState {
    Offline(context) {
        super(context)
    }
    def inform() {
        println "offline"
    }
    def connect() {
        context.state = new Online(context)
    }
    def disconnect() {
        println "error: not connected"
    }
    def send_message(message) {
        println "error: not connected"
    }
    def receive_message() {
        println "error: not connected"
    }
}

class Online extends ClientState {
    Online(context) {
        super(context)
    }
    def inform() {
        println "connected"
    }
    def connect() {
        println "error: already connected"
    }
    def disconnect() {
        context.state = new Offline(context)
    }
    def send_message(message) {
        println "\"$message\" sent"
    }
    def receive_message() {
        println "message received"
    }
}

client = new Client()
client.send_message("Hello")
client.connect()
client.send_message("Hello")
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>offline
error: not connected
connected
"Hello" sent
error: already connected
message received
offline</pre>
</div>
</div>
<div class="paragraph">
<p>One of the great things about a dynamic language like Groovy though is that we can take this example and express it in many different ways depending on our particular needs. Some potential variations for this example are shown below.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_1_leveraging_interface_oriented_design"><a class="anchor" href="#_variation_1_leveraging_interface_oriented_design"></a><a class="link" href="#_variation_1_leveraging_interface_oriented_design">Variation 1: Leveraging Interface-Oriented Design</a></h6>
<div class="paragraph">
<p>One approach we could take is to leverage <a href="http://www.pragmaticprogrammer.com/titles/kpiod/index.html">Interface-Oriented Design</a>. To do this, we could introduce the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface State {
    def connect()
    def disconnect()
    def send_message(message)
    def receive_message()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then our <code>Client</code>, <code>Online</code> and 'Offline` classes could be modified to implement that interface, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Client implements State {
  // ... as before ...
}

class Online implements State {
  // ... as before ...
}

class Offline implements State {
  // ... as before ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might ask: Haven&#8217;t we just introduced additional boilerplate code? Can&#8217;t we rely on duck-typing for this? The answer is 'yes' and 'no'. We can get away with duck-typing but one of the key intentions of the state pattern is to partition complexity. If we know that the <em>client</em> class and each <em>state</em> class all satisfy one interface, then we have placed some key boundaries around the complexity. We can look at any state class in isolation and know the bounds of behaviour possible for that state.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t have to use interfaces for this, but it helps express the intent of this particular style of partitioning and it helps reduce the size of our unit tests (we would have to have additional tests in place to express this intent in languages which have less support for interface-oriented design).</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_2_extract_state_pattern_logic"><a class="anchor" href="#_variation_2_extract_state_pattern_logic"></a><a class="link" href="#_variation_2_extract_state_pattern_logic">Variation 2: Extract State Pattern Logic</a></h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to extract some of our State Pattern logic into helper classes. For example, we could define the following classes in a state pattern package/jar/script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class InstanceProvider {
    static def registry = GroovySystem.metaClassRegistry
    static def create(objectClass, param) {
        registry.getMetaClass(objectClass).invokeConstructor([param] as Object[])
    }
}

abstract class Context {
    private context
    protected setContext(context) {
        this.context = context
    }
    def invokeMethod(String name, Object arg) {
        context.invokeMethod(name, arg)
    }
    def startFrom(initialState) {
        setContext(InstanceProvider.create(initialState, this))
    }
}

abstract class State {
    private client

    State(client) { this.client = client }

    def transitionTo(nextState) {
        client.setContext(InstanceProvider.create(nextState, client))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all quite generic and can be used wherever we want to introduce the state pattern. Here is what our code would look like now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Client extends Context {
    Client() {
        startFrom(Offline)
    }
}

class Offline extends State {
    Offline(client) {
        super(client)
        println "offline"
    }
    def connect() {
        transitionTo(Online)
    }
    def disconnect() {
        println "error: not connected"
    }
    def send_message(message) {
        println "error: not connected"
    }
    def receive_message() {
        println "error: not connected"
    }
}

class Online extends State {
    Online(client) {
        super(client)
        println "connected"
    }
    def connect() {
        println "error: already connected"
    }
    def disconnect() {
        transitionTo(Offline)
    }
    def send_message(message) {
        println "\"$message\" sent"
    }
    def receive_message() {
        println "message received"
    }
}

client = new Client()
client.send_message("Hello")
client.connect()
client.send_message("Hello")
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the <code>startFrom</code> and <code>transitionTo</code> methods begin to give our example code a DSL feel.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_3_bring_on_the_dsl"><a class="anchor" href="#_variation_3_bring_on_the_dsl"></a><a class="link" href="#_variation_3_bring_on_the_dsl">Variation 3: Bring on the DSL</a></h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to fully embrace a Domain Specific Language (DSL) approach to this example.</p>
</div>
<div class="paragraph">
<p>We can define the following generic helper functions (first discussed <a href="https://web.archive.org/web/20170624004445/http://www.bytemycode.com:80/snippets/snippet/640/">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class Grammar {
    def fsm

    def event
    def fromState
    def toState

    Grammar(a_fsm) {
        fsm = a_fsm
    }

    def on(a_event) {
        event = a_event
        this
    }

    def on(a_event, a_transitioner) {
        on(a_event)
        a_transitioner.delegate = this
        a_transitioner.call()
        this
    }

    def from(a_fromState) {
        fromState = a_fromState
        this
    }

    def to(a_toState) {
        assert a_toState, "Invalid toState: $a_toState"
        toState = a_toState
        fsm.registerTransition(this)
        this
    }

    def isValid() {
        event &amp;&amp; fromState &amp;&amp; toState
    }

    public String toString() {
        "$event: $fromState=&gt;$toState"
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class FiniteStateMachine {
    def transitions = [:]

    def initialState
    def currentState

    FiniteStateMachine(a_initialState) {
        assert a_initialState, "You need to provide an initial state"
        initialState = a_initialState
        currentState = a_initialState
    }

    def record() {
        Grammar.newInstance(this)
    }

    def reset() {
        currentState = initialState
    }

    def isState(a_state) {
        currentState == a_state
    }

    def registerTransition(a_grammar) {
        assert a_grammar.isValid(), "Invalid transition ($a_grammar)"
        def transition
        def event = a_grammar.event
        def fromState = a_grammar.fromState
        def toState = a_grammar.toState

        if (!transitions[event]) {
            transitions[event] = [:]
        }

        transition = transitions[event]
        assert !transition[fromState], "Duplicate fromState $fromState for transition $a_grammar"
        transition[fromState] = toState
    }

    def fire(a_event) {
        assert currentState, "Invalid current state '$currentState': passed into constructor"
        assert transitions.containsKey(a_event), "Invalid event '$a_event', should be one of ${transitions.keySet()}"
        def transition = transitions[a_event]
        def nextState = transition[currentState]
        assert nextState, "There is no transition from '$currentState' to any other state"
        currentState = nextState
        currentState
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and test our state machine like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class StatePatternDslTest extends GroovyTestCase {
    private fsm

    protected void setUp() {
        fsm = FiniteStateMachine.newInstance('offline')
        def recorder = fsm.record()
        recorder.on('connect').from('offline').to('online')
        recorder.on('disconnect').from('online').to('offline')
        recorder.on('send_message').from('online').to('online')
        recorder.on('receive_message').from('online').to('online')
    }

    void testInitialState() {
        assert fsm.isState('offline')
    }

    void testOfflineState() {
        shouldFail{
            fsm.fire('send_message')
        }
        shouldFail{
            fsm.fire('receive_message')
        }
        shouldFail{
            fsm.fire('disconnect')
        }
        assert 'online' == fsm.fire('connect')
    }

    void testOnlineState() {
        fsm.fire('connect')
        fsm.fire('send_message')
        fsm.fire('receive_message')
        shouldFail{
            fsm.fire('connect')
        }
        assert 'offline' == fsm.fire('disconnect')
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example isn&#8217;t an exact equivalent of the others. It doesn&#8217;t use predefined <code>Online</code> and <code>Offline</code> classes.
Instead, it defines the entire state machine on the fly as needed.
See the <a href="https://web.archive.org/web/20170624004445/http://www.bytemycode.com:80/snippets/snippet/640/">previous reference</a> for more elaborate examples of this style.</p>
</div>
<div class="paragraph">
<p>See also: <a href="https://web.archive.org/web/20150102211229/http://groovy.codehaus.org/Model-based+testing+using+ModelJUnit">Model-based testing using ModelJUnit</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_strategy_pattern"><a class="anchor" href="#_strategy_pattern"></a><a class="link" href="#_strategy_pattern">Strategy Pattern</a></h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a> allows you to abstract away particular algorithms from their usage. This allows you to easily swap the algorithm being used without having to change the calling code. The general form of the pattern is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xStrategyClasses.png.pagespeed.ic.th2zKj7V9Y.png" alt="StrategyClasses" width="628" height="194">
</div>
</div>
<div class="paragraph">
<p>In Groovy, because of its ability to treat code as a first class object using anonymous methods (which we loosely call <em>Closures</em>), the need for the strategy pattern is greatly reduced. You can simply place algorithms inside Closures.</p>
</div>
<div class="sect5">
<h6 id="_example_using_traditional_class_hierarchy"><a class="anchor" href="#_example_using_traditional_class_hierarchy"></a><a class="link" href="#_example_using_traditional_class_hierarchy">Example using traditional class hierarchy</a></h6>
<div class="paragraph">
<p>First let&#8217;s look at the traditional way of encapsulating the Strategy Pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Calc {
    def execute(n, m)
}

class CalcByMult implements Calc {
    def execute(n, m) { n * m }
}

class CalcByManyAdds implements Calc {
    def execute(n, m) {
        def result = 0
        n.times{
            result += m
        }

        result
    }
}

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

Calc[] multiplicationStrategies = [
    new CalcByMult(),
    new CalcByManyAdds()
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc.execute(data[0], data[1])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have defined an interface <code>Calc</code> which our concrete strategy classes will implement (we could also have used an abstract class).
We then defined two algorithms for doing simple multiplication: <code>CalcByMult</code> the normal way, and CalcByManyAdds using only addition (don&#8217;t try this one using negative numbers - yes we could fix this but it would just make the example longer).
We then use normal <a href="http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming">polymorphism</a> to invoke the algorithms.</p>
</div>
</div>
<div class="sect5">
<h6 id="_example_using_closures"><a class="anchor" href="#_example_using_closures"></a><a class="link" href="#_example_using_closures">Example using closures</a></h6>
<div class="paragraph">
<p>Here is the Groovier way to achieve the same thing using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def multiplicationStrategies = [
    { n, m -&gt; n * m },
    { n, m -&gt; def result = 0; n.times{ result += m }; result }
]

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc(data[0], data[1])
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_example_using_lambdas"><a class="anchor" href="#_example_using_lambdas"></a><a class="link" href="#_example_using_lambdas">Example using lambdas</a></h6>
<div class="paragraph">
<p>For Groovy 3+, we can leverage lambda syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Calc {
    def execute(n, m)
}

List&lt;Calc&gt; multiplicationStrategies = [
    (n, m) -&gt; n * m,
    (n, m) -&gt; { def result = 0; n.times{ result += m }; result }
]

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc(data[0], data[1])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can use the built-in JDK <code>BiFunction</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import java.util.function.BiFunction

List&lt;BiFunction&lt;Integer, Integer, Integer&gt;&gt; multiplicationStrategies = [
    (n, m) -&gt; n * m,
    (n, m) -&gt; { def result = 0; n.times{ result += m }; result }
]

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc(data[0], data[1])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template_method_pattern"><a class="anchor" href="#_template_method_pattern"></a><a class="link" href="#_template_method_pattern">Template Method Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Template_method_pattern">Template Method Pattern</a> abstracts
away the details of several algorithms.
The generic part of an algorithm is contained within a base class.
Particular implementation details are captured within child classes.
The generic pattern of classes involved looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="xTemplateMethodClasses.png.pagespeed.ic.hvKDof76Yi.png" alt="TemplateMethodClasses" width="547" height="258">
</div>
</div>
<div class="sect5">
<h6 id="_example_with_traditional_classes_2"><a class="anchor" href="#_example_with_traditional_classes_2"></a><a class="link" href="#_example_with_traditional_classes_2">Example with traditional classes</a></h6>
<div class="paragraph">
<p>In this example, the base <code>Accumulator</code> class captures the essence of the accumulation algorithm.
The child classes <code>Sum</code> and <code>Product</code> provide particular customised ways to use the generic accumulation algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Accumulator {
    protected initial
    abstract doAccumulate(total, v)
    def accumulate(values) {
        def total = initial
        values.each { v -&gt; total = doAccumulate(total, v) }
        total
    }
}

class Sum extends Accumulator {
    def Sum() { initial = 0 }
    def doAccumulate(total, v) { total + v }
}

class Product extends Accumulator {
    def Product() { initial = 1 }
    def doAccumulate(total, v) { total * v }
}

assert 10 == new Sum().accumulate([1,2,3,4])
assert 24 == new Product().accumulate([1,2,3,4])</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_example_with_simplifying_strategies"><a class="anchor" href="#_example_with_simplifying_strategies"></a><a class="link" href="#_example_with_simplifying_strategies">Example with simplifying strategies</a></h6>
<div class="paragraph">
<p>In this particular case, you could use Groovy&#8217;s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Closure addAll = { total, item -&gt; total += item }
def accumulated = [1, 2, 3, 4].inject(0, addAll)
assert accumulated == 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to duck-typing, this would also work with other objects which support an add (<code>plus()</code> in Groovy) method, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">accumulated = [ "1", "2", "3", "4" ].inject("", addAll)
assert accumulated == "1234"</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also do the multiplication case as follows (re-writing as a one-liner):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 24 == [1, 2, 3, 4].inject(1) { total, item -&gt; total *= item }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using closures this way looks like the <a href="#_strategy_pattern">Strategy Pattern</a>, but if we realise
that Groovy&#8217;s <code>inject</code> method is the generic part of the algorithm for our template method,
then the Closures become the customised parts of the template method pattern.</p>
</div>
<div class="paragraph">
<p>For Groovy 3+, we can use lambda syntax as an alternative to the closure syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">assert 10 == [1, 2, 3, 4].stream().reduce(0, (l, r) -&gt; l + r)
assert 24 == [1, 2, 3, 4].stream().reduce(1, (l, r) -&gt; l * r)
assert '1234' == ['1', '2', '3', '4'].stream().reduce('', (l, r) -&gt; l + r)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the stream api&#8217;s <code>reduce</code> method is the generic part of the algorithm for our template method,
and the lambdas are the customised parts of the template method pattern.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_visitor_pattern"><a class="anchor" href="#_visitor_pattern"></a><a class="link" href="#_visitor_pattern">Visitor Pattern</a></h5>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> is one of those well-known but not
often used patterns. Perhaps this is because it seems a little complex at first.
But once you become familiar with it, it becomes a powerful way to evolve your code
and as we&#8217;ll see, Groovy provides ways to reduce some to the complexity, so there is
no reason not to consider using this pattern.</p>
</div>
<div class="paragraph">
<p>The goal of the pattern is to separate an algorithm from an object structure.
A practical result of this separation is the ability to add new operations to existing
object structures without modifying those structures.</p>
</div>
<div class="sect5">
<h6 id="_simple_example_2"><a class="anchor" href="#_simple_example_2"></a><a class="link" href="#_simple_example_2">Simple Example</a></h6>
<div class="paragraph">
<p>This example considers how to calculate the bounds of shapes (or collections of shapes).
Our first attempt uses the traditional visitor pattern.
We will see a more Groovy way to do this shortly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Shape { }

@ToString(includeNames=true)
class Rectangle extends Shape {
    def x, y, w, h

    Rectangle(x, y, w, h) {
        this.x = x; this.y = y; this.w = w; this.h = h
    }

    def union(rect) {
        if (!rect) return this
        def minx = [rect.x, x].min()
        def maxx = [rect.x + rect.w, x + w].max()
        def miny = [rect.y, y].min()
        def maxy = [rect.y + rect.h, y + h].max()
        new Rectangle(minx, miny, maxx - minx, maxy - miny)
    }

    def accept(visitor) {
        visitor.visit_rectangle(this)
    }
}

class Line extends Shape {
    def x1, y1, x2, y2

    Line(x1, y1, x2, y2) {
        this.x1 = x1; this.y1 = y1; this.x2 = x2; this.y2 = y2
    }

    def accept(visitor){
        visitor.visit_line(this)
    }
}

class Group extends Shape {
    def shapes = []
    def add(shape) { shapes += shape }
    def remove(shape) { shapes -= shape }
    def accept(visitor) {
        visitor.visit_group(this)
    }
}

class BoundingRectangleVisitor {
    def bounds

    def visit_rectangle(rectangle) {
        if (bounds)
            bounds = bounds.union(rectangle)
        else
            bounds = rectangle
    }

    def visit_line(line) {
        def line_bounds = new Rectangle([line.x1, line.x2].min(),
                                        [line.y1, line.y2].min(),
                                        line.x2 - line.y1,
                                        line.x2 - line.y2)
        if (bounds)
            bounds = bounds.union(line_bounds)
        else
            bounds = line_bounds
    }

    def visit_group(group) {
        group.shapes.each { shape -&gt; shape.accept(this) }
    }
}

def group = new Group()
group.add(new Rectangle(100, 40, 10, 5))
group.add(new Rectangle(100, 70, 10, 5))
group.add(new Line(90, 30, 60, 5))
def visitor = new BoundingRectangleVisitor()
group.accept(visitor)
bounding_box = visitor.bounds
assert bounding_box.toString() == 'Rectangle(x:60, y:5, w:50, h:70)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>That took quite a bit of code, but the idea now is that we could add
further algorithms just by adding new visitors with our shape classes remaining
unchanged, e.g. we could add a total area visitor or a collision detection visitor.</p>
</div>
<div class="paragraph">
<p>We can improve the clarity of our code (and shrink it to about half the size) by
making use of Groovy Closures as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Shape {
    def accept(Closure yield) { yield(this) }
}

@ToString(includeNames=true)
class Rectangle extends Shape {
    def x, y, w, h
    def bounds() { this }
    def union(rect) {
        if (!rect) return this
        def minx = [ rect.x, x ].min()
        def maxx = [ rect.x + rect.w, x + w ].max()
        def miny = [ rect.y, y ].min()
        def maxy = [ rect.y + rect.h, y + h ].max()
        new Rectangle(x:minx, y:miny, w:maxx - minx, h:maxy - miny)
    }
}

class Line extends Shape {
    def x1, y1, x2, y2
    def bounds() {
        new Rectangle(x:[x1, x2].min(), y:[y1, y2].min(),
                      w:(x2 - x1).abs(), h:(y2 - y1).abs())
    }
}

class Group {
    def shapes = []
    def leftShift(shape) { shapes += shape }
    def accept(Closure yield) { shapes.each{it.accept(yield)} }
}

def group = new Group()
group &lt;&lt; new Rectangle(x:100, y:40, w:10, h:5)
group &lt;&lt; new Rectangle(x:100, y:70, w:10, h:5)
group &lt;&lt; new Line(x1:90, y1:30, x2:60, y2:5)
def bounds
group.accept{ bounds = it.bounds().union(bounds) }
assert bounds.toString() == 'Rectangle(x:60, y:5, w:50, h:70)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, using lambdas as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">abstract class Shape {
    def accept(Function&lt;Shape, Shape&gt; yield) { yield.apply(this) }
}

@ToString(includeNames=true)
class Rectangle extends Shape {
    /* ... same as with Closures ... */
}

class Line extends Shape {
    /* ... same as with Closures ... */
}

class Group {
    def shapes = []
    def leftShift(shape) { shapes += shape }
    def accept(Function&lt;Shape, Shape&gt; yield) {
        shapes.stream().forEach(s -&gt; s.accept(yield))
    }
}

def group = new Group()
group &lt;&lt; new Rectangle(x:100, y:40, w:10, h:5)
group &lt;&lt; new Rectangle(x:100, y:70, w:10, h:5)
group &lt;&lt; new Line(x1:90, y1:30, x2:60, y2:5)
def bounds
group.accept(s -&gt; { bounds = s.bounds().union(bounds) })
assert bounds.toString() == 'Rectangle(x:60, y:5, w:50, h:70)'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_example"><a class="anchor" href="#_advanced_example"></a><a class="link" href="#_advanced_example">Advanced Example</a></h6>
<div class="paragraph">
<p>Let&#8217;s consider another example to illustrate some more points about this pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Visitor {
    void visit(NodeType1 n1)
    void visit(NodeType2 n2)
}

interface Visitable {
    void accept(Visitor visitor)
}

class NodeType1 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
        for(int i = 0; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

class NodeType2 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
        for(int i = 0; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

class NodeType1Counter implements Visitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
    }
    void visit(NodeType2 n2){}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now use <code>NodeType1Counter</code> on a tree like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">NodeType1 root = new NodeType1()
root.children = new Visitable[]{new NodeType1(), new NodeType2()}

def counter = new NodeType1Counter()
root.accept(counter)
assert counter.count == 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we have one <code>NodeType1</code> object as root and one of the children is also a <code>NodeType1</code> instance.
The other child is a <code>NodeType2</code> instance.
That means using <code>NodeType1Counter</code> here should count 2 <code>NodeType1</code> objects as the last statement verifies.</p>
</div>
<div class="sect6">
<h7 id="_when_to_use_this"><a class="anchor" href="#_when_to_use_this"></a><a class="link" href="#_when_to_use_this">When to use this</a></h7>
<div class="paragraph">
<p>This example illustrates some of the advantages of the visitor pattern.
For example, while our visitor has state (the count of <code>NodeType1</code> objects), the tree of objects itself is not changed.
Similarly, if we wanted to have a visitor counting all node types,
or one that counts how many different types are used, or one that gathers information
using methods special to the node types, again, the visitor alone is all that would need to be written.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_happens_if_we_add_a_new_type"><a class="anchor" href="#_what_happens_if_we_add_a_new_type"></a><a class="link" href="#_what_happens_if_we_add_a_new_type">What happens if we add a new type?</a></h7>
<div class="paragraph">
<p>In this case we might have a fair bit of work to do. We probably have to change the <code>Visitor</code> interface to accept the new type,
and change potentially most existing visitors based on that interface change,
and we have to write the new type itself.
A better approach is to write a default implementation of the visitor which all concrete visitors will extend.
We&#8217;ll see this approach in use shortly.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_if_we_want_to_have_different_iteration_patterns"><a class="anchor" href="#_what_if_we_want_to_have_different_iteration_patterns"></a><a class="link" href="#_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</a></h7>
<div class="paragraph">
<p>Then you have a problem.
Since the node describes how to iterate, you have no influence and stop iteration at a point or change the order.
So maybe we should change this a little to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">interface Visitor {
    void visit(NodeType1 n1)
    void visit(NodeType2 n2)
}

class DefaultVisitor implements Visitor{
    void visit(NodeType1 n1) {
        for(int i = 0; i &lt; n1.children.length; ++i) {
            n1.children[i].accept(this)
        }
    }
    void visit(NodeType2 n2) {
        for(int i = 0; i &lt; n2.children.length; ++i) {
            n2.children[i].accept(this)
        }
    }
}

interface Visitable {
    void accept(Visitor visitor)
}

class NodeType1 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
    }
}

class NodeType2 implements Visitable {
    Visitable[] children = new Visitable[0];
    void accept(Visitor visitor) {
        visitor.visit(this)
    }
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some small changes but with big effect.
The visitor is now recursive and tells me how to iterate.
The implementation in the Nodes is minimized to <code>visitor.visit(this)</code>, <code>DefaultVisitor</code> is now able to catch the new types, we can stop iteration by not delegating to super.
Of course the big disadvantage now is that it is no longer iterative, but you can&#8217;t get all the benefits.</p>
</div>
</div>
<div class="sect6">
<h7 id="_make_it_groovy"><a class="anchor" href="#_make_it_groovy"></a><a class="link" href="#_make_it_groovy">Make it Groovy</a></h7>
<div class="paragraph">
<p>The question now is how to make that a bit more Groovy.
Didn&#8217;t you find this <code>visitor.visit(this)</code> strange? Why is it there?
The answer is to simulate double dispatch.
In Java, the compile time type is used, so for <code>visitor.visit(children[i])</code> the compiler won&#8217;t be
able to find the correct method, because <code>Visitor</code> does not contain a method <code>visit(Visitable)</code>.
And even if it would, we would like to visit the more special methods with <code>NodeType1</code> or <code>NodeType2</code>.</p>
</div>
<div class="paragraph">
<p>Now Groovy is not using the static type, Groovy uses the runtime type.
This means we can use <code>visitor.visit(children[i])</code> without any problem.
Since we minimized the accept method to just do the double dispatch part and
since the runtime type system of Groovy will already cover that, do we need the accept method?
Not really, but we can do even more.
We had the disadvantage of not knowing how to handle unknown tree elements.
We had to <em>extend</em> the interface <code>Visitor</code> for that, resulting in changes to <code>DefaultVisitor</code> and
then we have the task to provide a useful default like iterating the node or not doing anything at all.
Now with Groovy we can catch that case by adding a <code>visit(Visitable)</code> method that does nothing.
That would be the same in Java btw.</p>
</div>
<div class="paragraph">
<p>But don&#8217;t let us stop here. Do we need the <code>Visitor</code> interface?
If we don&#8217;t have the accept method, then we don&#8217;t need the <code>Visitor</code> interface at all.
So the new code would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class DefaultVisitor {
    void visit(NodeType1 n1) {
        n1.children.each { visit(it) }
    }
    void visit(NodeType2 n2) {
        n2.children.each { visit(it) }
    }
    void visit(Visitable v) { }
}

interface Visitable { }

class NodeType1 implements Visitable {
    Visitable[] children = []
}

class NodeType2 implements Visitable {
    Visitable[] children = []
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looks like we saved a few lines of code here, but we made more.
The <code>Visitable</code> nodes now do not refer to any <code>Visitor</code> class or interface.
This is about the best level of separation you might expect here, but we can go further.
Let&#8217;s change the <code>Visitable</code> interface a little and let it return the children we want to visit next.
This allows us a general iteration method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class DefaultVisitor {
    void visit(Visitable v) {
        doIteration(v)
    }
    void doIteration(Visitable v) {
        v.children.each {
            visit(it)
        }
    }
}

interface Visitable {
    Visitable[] getChildren()
}

class NodeType1 implements Visitable {
    Visitable[] children = []
}

class NodeType2 implements Visitable {
    Visitable[] children = []
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DefaultVisitor</code> now looks a bit different.
It has a <code>doIteration</code> method that will get the children it should iterate over and then call visit on each element.
Per default this will call <code>visit(Visitable)</code> which then iterates over the children of this child.
<code>Visitable</code> has also changed to ensure that any node will be able to return children (even if empty).
We didn&#8217;t have to change the <code>NodeType1</code> and <code>NodeType2</code> class, because the way the children field was
defined already made them a property, which means Groovy is so nice to generate a get method for us.
Now the really interesting part is <code>NodeType1Counter</code>, it is interesting because we have not changed it.
<code>super.visit(n1)</code> will now call <code>visit(Visitable)</code> which will call <code>doIteration</code> which will start the next level of iteration.
So no change. But <code>visit(it)</code> will call <code>visit(NodeType1)</code> if it is of type <code>NodeType1</code>.
In fact, we don&#8217;t need the <code>doIteration</code> method, we could do that in <code>visit(Visitable)</code> too,
but this variant has some benefits. It allows us to write a new <code>Visitor</code> that overwrites visit(<code>Visitable</code>)
for error cases which of course means we must not do <code>super.visit(n1)</code> but <code>doIteration(n1)</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_summary"><a class="anchor" href="#_summary"></a><a class="link" href="#_summary">Summary</a></h7>
<div class="paragraph">
<p>In the end we got ~40% less code, a robust and stable architecture,
and we completely removed the Visitor from the Visitable.
To achieve the same in Java, you would probably need to resort to reflection.</p>
</div>
<div class="paragraph">
<p>The visitor pattern has sometimes been described as a poor fit for extreme programming
techniques because you need to make changes to so many classes all the time.
With our design, if we add new types we don&#8217;t need to change anything.
So, the pattern is a good fit for agile approaches when using Groovy.</p>
</div>
<div class="paragraph">
<p>There are variants of the Visitor pattern, like the <a href="https://java-design-patterns.com/patterns/acyclic-visitor/">acyclic visitor pattern</a>,
that try to solve the problem of adding new node types with special visitors.
The implementations of these visitors have their own code smells, like using casts, overuse of <code>instanceof</code>, and other tricks.
What&#8217;s more the problems such approaches are trying to solve don&#8217;t occur within the Groovy version. We recommend avoiding that variant of this pattern.</p>
</div>
<div class="paragraph">
<p>Finally, in case it isn&#8217;t obvious, <code>NodeType1Counter</code> could be implemented in Java as well.
Groovy will recognize the visit methods and call them as needed because <code>DefaultVisitor</code> is still Groovy and does all the magic.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information_2"><a class="anchor" href="#_further_information_2"></a><a class="link" href="#_further_information_2">Further Information</a></h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://se.ethz.ch/~meyer/publications/computer/visitor.pdf">Componentization: the Visitor example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_references"><a class="anchor" href="#_references"></a><a class="link" href="#_references">3.25.2. References</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides (1995). <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>. Addison-Wesley. ISBN 0-201-63361-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>The canonical reference of design patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Martin Fowler (1999). <em>Refactoring: Improving the Design of Existing Code</em>. Addison-Wesley. ISBN 0-201-48567-2.</p>
</li>
<li>
<p>Joshua Kerievsky (2004). <em>Refactoring To Patterns</em>. Addison-Wesley. ISBN 0-321-21335-1.</p>
</li>
<li>
<p>Eric Freeman, Elisabeth Freeman, Kathy Sierra, Bert Bates (2004). <em>Head First Design Patterns</em>. O’Reilly. ISBN 0-596-00712-4.
*<em>A great book to read, informative as well as amusing.</em></p>
</li>
<li>
<p>Dierk Koenig with Andrew Glover, Paul King, Guillaume Laforge and Jon Skeet (2007). <em>Groovy in Action</em>. Manning. ISBN 1-932394-84-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>Discusses Visitor, Builder and other Patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Brad Appleton (1999). <a href="http://www.bradapp.com/docs/pizza-inv.html">Pizza Inversion - a Pattern for Efficient Resource Consumption</a>.</p>
<div class="ulist">
<ul>
<li>
<p><em>One of the most frequently used patterns by many software engineers!</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Design Patterns in Dynamic Languages</em> by Neil Ford. Houston Java User’s Group. Examples in Groovy and Ruby. <a href="http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf" class="bare">http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a><a class="link" href="#_acknowledgements">4. Acknowledgements</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a><a class="link" href="#_contributors">4.1. Contributors</a></h3>
<div class="paragraph">
<p>The Groovy team would like to thank the contributors of this documentation (in alphabetical order of last/surname):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/mojavelinux">Dan Allen</a></p>
</li>
<li>
<p><a href="https://github.com/and-dmitry">Dmitry Andreychuk</a></p>
</li>
<li>
<p><a href="http://hamletdarcy.blogspot.fr/">Hamlet D&#8217;Arcy</a></p>
</li>
<li>
<p><a href="https://github.com/anshbansal">Aseem Bansal</a></p>
</li>
<li>
<p><a href="https://github.com/bura">Andrey Bloschetsov</a></p>
</li>
<li>
<p><a href="https://github.com/JBrownVisualSpection">J Brown</a></p>
</li>
<li>
<p><a href="https://github.com/jeffbrown">Jeff Scott Brown</a></p>
</li>
<li>
<p><a href="http://twitter.com/CedricChampeau">Cédric Champeau</a></p>
</li>
<li>
<p><a href="https://github.com/tobia">Tobia Conforto</a></p>
</li>
<li>
<p><a href="https://github.com/ddimtirov">Dimitar Dimitrov</a></p>
</li>
<li>
<p><a href="http://twitter.com/werdnagreb">Andrew Eisenberg</a></p>
</li>
<li>
<p><a href="https://github.com/erdi">Marcin Erdmann</a></p>
</li>
<li>
<p><a href="https://github.com/christoph-frick">Christoph Frick</a></p>
</li>
<li>
<p><a href="http://twitter.com/marioggar">Mario García</a></p>
</li>
<li>
<p><a href="https://github.com/davidmichaelkarr">David Michael Karr</a></p>
</li>
<li>
<p><a href="http://twitter.com/paulk_asert">Paul King</a></p>
</li>
<li>
<p><a href="http://twitter.com/glaforge">Guillaume Laforge</a></p>
</li>
<li>
<p><a href="http://twitter.com/pledbrook">Peter Ledbrook</a></p>
</li>
<li>
<p><a href="http://grantmcconnaughey.github.io/">Grant McConnaughey</a></p>
</li>
<li>
<p><a href="https://github.com/eric-milles">Eric Milles</a></p>
</li>
<li>
<p><a href="https://github.com/dnahodil">David Nahodil</a></p>
</li>
<li>
<p><a href="https://github.com/jnorthr">James Northrop</a></p>
</li>
<li>
<p><a href="https://github.com/marcpa00">Marc Paquette</a></p>
</li>
<li>
<p><a href="https://github.com/michaelss">Michael Schuenck</a></p>
</li>
<li>
<p><a href="https://github.com/PascalSchumacher">Pascal Schumacher</a></p>
</li>
<li>
<p><a href="https://github.com/shils">Shil Sinha</a></p>
</li>
<li>
<p><a href="https://github.com/stavytskyi">Maksym Stavytskyi</a></p>
</li>
<li>
<p><a href="https://twitter.com/asteingr">André Steingreß</a></p>
</li>
<li>
<p><a href="https://twitter.com/daniel_sun">Daniel Sun</a></p>
</li>
<li>
<p><a href="https://github.com/EPadronU">Edinson Padrón Urdaneta</a></p>
</li>
<li>
<p><a href="https://github.com/keeganwitt">Keegan Witt</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_license"><a class="anchor" href="#_license"></a><a class="link" href="#_license">4.2. License</a></h3>
<div class="paragraph">
<p>This work is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.0.15<br>
Last updated 2023-09-11 18:22:48 +1000
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>